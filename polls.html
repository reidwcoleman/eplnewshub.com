<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Vote in Premier League polls and see fan opinions on transfers, matches, and more at EPL News Hub.">
    <meta name="keywords" content="Premier League polls, EPL voting, football polls, fan opinions, soccer polls">
    <title>Premier League Polls | EPL News Hub</title>

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/eplnewshubnewlogo.png">
    <link rel="apple-touch-icon" href="/eplnewshubnewlogo.png">

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-TVPLGM5QY9"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-TVPLGM5QY9');
    </script>

    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6480210605786899" crossorigin="anonymous"></script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif:wght@400;600;700;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="styles.css">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            background: #ffffff;
            color: #121212;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Page Header */
        .polls-header {
            max-width: 680px;
            margin: 80px auto 60px;
            padding: 0 24px;
            border-bottom: 1px solid #e5e5e5;
            padding-bottom: 40px;
        }

        .polls-header h1 {
            font-family: 'Noto Serif', Georgia, serif;
            font-size: 52px;
            font-weight: 700;
            line-height: 1.1;
            color: #121212;
            margin-bottom: 16px;
            letter-spacing: -1px;
        }

        .polls-header .subtitle {
            font-family: 'Georgia', serif;
            font-size: 20px;
            line-height: 1.5;
            color: #666;
            margin-bottom: 28px;
        }

        .polls-stats {
            display: flex;
            gap: 32px;
            font-family: 'Inter', sans-serif;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
        }

        .stat-number {
            font-size: 32px;
            font-weight: 700;
            color: #121212;
            font-family: 'Noto Serif', Georgia, serif;
            line-height: 1;
        }

        .stat-label {
            font-size: 13px;
            color: #767676;
            margin-top: 6px;
            letter-spacing: 0.3px;
        }

        /* Main Content */
        .polls-container {
            max-width: 680px;
            margin: 0 auto;
            padding: 0 24px 100px;
        }

        .poll-card {
            margin-bottom: 80px;
            border-bottom: 1px solid #e5e5e5;
            padding-bottom: 60px;
        }

        .poll-card:last-child {
            border-bottom: none;
        }

        .poll-question {
            font-family: 'Noto Serif', Georgia, serif;
            font-size: 32px;
            font-weight: 700;
            line-height: 1.2;
            color: #121212;
            margin-bottom: 24px;
            letter-spacing: -0.5px;
        }

        .poll-meta {
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            color: #767676;
            margin-bottom: 32px;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .poll-leader {
            background: #f8f8f8;
            border-left: 3px solid #121212;
            padding: 16px 20px;
            margin-bottom: 32px;
            font-family: 'Inter', sans-serif;
        }

        .leader-label {
            font-size: 12px;
            font-weight: 600;
            letter-spacing: 0.8px;
            text-transform: uppercase;
            color: #767676;
            margin-bottom: 6px;
        }

        .leader-name {
            font-size: 18px;
            font-weight: 700;
            color: #121212;
        }

        /* Poll Options */
        .poll-options {
            margin-bottom: 32px;
        }

        .poll-option {
            display: grid;
            grid-template-columns: auto 1fr auto;
            align-items: center;
            gap: 16px;
            padding: 18px 0;
            border-bottom: 1px solid #f0f0f0;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .poll-option:hover {
            background: #fafafa;
            padding-left: 12px;
            padding-right: 12px;
            margin-left: -12px;
            margin-right: -12px;
        }

        .poll-option input[type="radio"],
        .poll-option input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #121212;
        }

        .poll-option label {
            font-family: 'Inter', sans-serif;
            font-size: 17px;
            font-weight: 500;
            cursor: pointer;
            color: #121212;
        }

        .poll-result {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .poll-bar {
            width: 100px;
            height: 6px;
            background: #e5e5e5;
            border-radius: 3px;
            overflow: hidden;
            position: relative;
        }

        .poll-fill {
            height: 100%;
            background: #121212;
            border-radius: 3px;
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .poll-percentage {
            font-family: 'Inter', sans-serif;
            font-size: 15px;
            font-weight: 600;
            color: #121212;
            min-width: 48px;
            text-align: right;
        }

        .poll-option.user-selected {
            background: #f8f8f8;
            padding-left: 12px;
            padding-right: 12px;
            margin-left: -12px;
            margin-right: -12px;
            border-left: 3px solid #121212;
        }

        .poll-option.leading label::after {
            content: '★';
            margin-left: 8px;
            color: #121212;
        }

        /* Vote Button */
        .vote-btn {
            font-family: 'Inter', sans-serif;
            background: #121212;
            color: #ffffff;
            border: none;
            padding: 16px 32px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            letter-spacing: 0.3px;
        }

        .vote-btn:hover {
            background: #333;
        }

        .vote-btn:active {
            transform: scale(0.98);
        }

        .vote-btn:disabled {
            background: #767676;
            cursor: not-allowed;
        }

        .poll-votes {
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            color: #767676;
            margin-top: 20px;
        }

        /* Selection Counter for multi-select */
        .selection-counter {
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            color: #767676;
            margin-bottom: 20px;
            padding: 12px;
            background: #f8f8f8;
            border-left: 3px solid #e5e5e5;
        }

        .selection-counter.warning {
            color: #c82333;
            border-left-color: #c82333;
        }

        .selection-counter.valid {
            color: #28a745;
            border-left-color: #28a745;
        }

        /* Success Message */
        .vote-success {
            background: #121212;
            color: #ffffff;
            padding: 16px 20px;
            margin-top: 24px;
            font-family: 'Inter', sans-serif;
            font-size: 15px;
            font-weight: 500;
            animation: fadeIn 0.3s ease;
        }

        /* Past Results Section */
        .results-section {
            max-width: 680px;
            margin: 80px auto 100px;
            padding: 0 24px;
            border-top: 1px solid #e5e5e5;
            padding-top: 60px;
        }

        .results-section h2 {
            font-family: 'Noto Serif', Georgia, serif;
            font-size: 32px;
            font-weight: 700;
            color: #121212;
            margin-bottom: 40px;
            letter-spacing: -0.5px;
        }

        .result-item {
            margin-bottom: 40px;
            padding-bottom: 40px;
            border-bottom: 1px solid #f0f0f0;
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-item h3 {
            font-family: 'Inter', sans-serif;
            font-size: 18px;
            font-weight: 600;
            color: #121212;
            margin-bottom: 12px;
        }

        .result-item p {
            font-family: 'Inter', sans-serif;
            font-size: 15px;
            color: #666;
            line-height: 1.6;
            margin-bottom: 8px;
        }

        .result-date {
            font-size: 13px;
            color: #999;
            font-style: italic;
        }

        /* Reset Button */
        .reset-btn {
            font-family: 'Inter', sans-serif;
            font-size: 12px;
            color: #767676;
            background: transparent;
            border: 1px solid #e5e5e5;
            padding: 8px 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            letter-spacing: 0.3px;
        }

        .reset-btn:hover {
            border-color: #121212;
            color: #121212;
        }

        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        .stat-number.updated {
            animation: pulse 0.3s ease;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .polls-header {
                margin: 60px auto 40px;
                padding: 0 20px;
                padding-bottom: 32px;
            }

            .polls-header h1 {
                font-size: 40px;
            }

            .polls-header .subtitle {
                font-size: 18px;
            }

            .polls-stats {
                gap: 24px;
            }

            .stat-number {
                font-size: 28px;
            }

            .polls-container {
                padding: 0 20px 80px;
            }

            .poll-card {
                margin-bottom: 60px;
                padding-bottom: 40px;
            }

            .poll-question {
                font-size: 28px;
            }

            .poll-option {
                grid-template-columns: auto 1fr;
                gap: 12px;
            }

            .poll-result {
                grid-column: 1 / -1;
                margin-top: 8px;
                padding-left: 36px;
            }

            .poll-bar {
                width: 100%;
                max-width: 200px;
            }

            .results-section {
                margin: 60px auto 80px;
                padding: 0 20px;
                padding-top: 40px;
            }

            .results-section h2 {
                font-size: 28px;
            }
        }

        @media (max-width: 480px) {
            .polls-header h1 {
                font-size: 34px;
            }

            .polls-stats {
                flex-wrap: wrap;
            }

            .poll-question {
                font-size: 24px;
            }

            .poll-option label {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="header" include="./header.html"></div>

    <!-- Page Header -->
    <header class="polls-header">
        <h1>Premier League Polls</h1>
        <p class="subtitle">Voice your opinion on the biggest topics in English football and see what the community thinks.</p>

        <div class="polls-stats">
            <div class="stat-item">
                <span class="stat-number" id="total-votes">0</span>
                <span class="stat-label">Total votes cast</span>
            </div>
            <div class="stat-item">
                <span class="stat-number">3</span>
                <span class="stat-label">Active polls</span>
            </div>
            <div class="stat-item">
                <span class="stat-number" id="participation-rate">0%</span>
                <span class="stat-label">Your participation</span>
            </div>
        </div>
    </header>

    <!-- Active Polls -->
    <main class="polls-container">

        <!-- Poll 1: Title Winner -->
        <article class="poll-card" id="poll-title">
            <h2 class="poll-question">Who will win the Premier League title this season?</h2>

            <div class="poll-meta">
                <span id="title-votes-count">0 votes</span>
                <button class="reset-btn" onclick="resetSinglePoll('title')">Reset</button>
            </div>

            <div class="poll-leader">
                <div class="leader-label">Current Leader</div>
                <div class="leader-name" id="title-leader">No votes yet</div>
            </div>

            <div class="poll-options">
                <div class="poll-option" onclick="selectOption(event, 'title', 'city')">
                    <input type="radio" id="city" name="title" value="city">
                    <label for="city">Manchester City</label>
                    <div class="poll-result">
                        <div class="poll-bar">
                            <div class="poll-fill" data-option="city"></div>
                        </div>
                        <span class="poll-percentage" data-option="city">0%</span>
                    </div>
                </div>

                <div class="poll-option" onclick="selectOption(event, 'title', 'arsenal')">
                    <input type="radio" id="arsenal" name="title" value="arsenal">
                    <label for="arsenal">Arsenal</label>
                    <div class="poll-result">
                        <div class="poll-bar">
                            <div class="poll-fill" data-option="arsenal"></div>
                        </div>
                        <span class="poll-percentage" data-option="arsenal">0%</span>
                    </div>
                </div>

                <div class="poll-option" onclick="selectOption(event, 'title', 'liverpool')">
                    <input type="radio" id="liverpool" name="title" value="liverpool">
                    <label for="liverpool">Liverpool</label>
                    <div class="poll-result">
                        <div class="poll-bar">
                            <div class="poll-fill" data-option="liverpool"></div>
                        </div>
                        <span class="poll-percentage" data-option="liverpool">0%</span>
                    </div>
                </div>

                <div class="poll-option" onclick="selectOption(event, 'title', 'united')">
                    <input type="radio" id="united" name="title" value="united">
                    <label for="united">Manchester United</label>
                    <div class="poll-result">
                        <div class="poll-bar">
                            <div class="poll-fill" data-option="united"></div>
                        </div>
                        <span class="poll-percentage" data-option="united">0%</span>
                    </div>
                </div>
            </div>

            <button class="vote-btn" onclick="submitVote('title')">Submit Vote</button>
            <p class="poll-votes" id="title-votes">0 votes</p>
        </article>

        <!-- Poll 2: Best Signing -->
        <article class="poll-card" id="poll-signing">
            <h2 class="poll-question">Best Premier League signing this summer?</h2>

            <div class="poll-meta">
                <span id="signing-votes-count">0 votes</span>
                <button class="reset-btn" onclick="resetSinglePoll('signing')">Reset</button>
            </div>

            <div class="poll-leader">
                <div class="leader-label">Current Leader</div>
                <div class="leader-name" id="signing-leader">No votes yet</div>
            </div>

            <div class="poll-options">
                <div class="poll-option" onclick="selectOption(event, 'signing', 'kvaratskhelia')">
                    <input type="radio" id="kvaratskhelia" name="signing" value="kvaratskhelia">
                    <label for="kvaratskhelia">Khvicha Kvaratskhelia (Man United)</label>
                    <div class="poll-result">
                        <div class="poll-bar">
                            <div class="poll-fill" data-option="kvaratskhelia"></div>
                        </div>
                        <span class="poll-percentage" data-option="kvaratskhelia">0%</span>
                    </div>
                </div>

                <div class="poll-option" onclick="selectOption(event, 'signing', 'gyokeres')">
                    <input type="radio" id="gyokeres" name="signing" value="gyokeres">
                    <label for="gyokeres">Viktor Gyökeres (Arsenal)</label>
                    <div class="poll-result">
                        <div class="poll-bar">
                            <div class="poll-fill" data-option="gyokeres"></div>
                        </div>
                        <span class="poll-percentage" data-option="gyokeres">0%</span>
                    </div>
                </div>

                <div class="poll-option" onclick="selectOption(event, 'signing', 'wirtz')">
                    <input type="radio" id="wirtz" name="signing" value="wirtz">
                    <label for="wirtz">Florian Wirtz (Liverpool)</label>
                    <div class="poll-result">
                        <div class="poll-bar">
                            <div class="poll-fill" data-option="wirtz"></div>
                        </div>
                        <span class="poll-percentage" data-option="wirtz">0%</span>
                    </div>
                </div>

                <div class="poll-option" onclick="selectOption(event, 'signing', 'other')">
                    <input type="radio" id="other" name="signing" value="other">
                    <label for="other">Other</label>
                    <div class="poll-result">
                        <div class="poll-bar">
                            <div class="poll-fill" data-option="other"></div>
                        </div>
                        <span class="poll-percentage" data-option="other">0%</span>
                    </div>
                </div>
            </div>

            <button class="vote-btn" onclick="submitVote('signing')">Submit Vote</button>
            <p class="poll-votes" id="signing-votes">0 votes</p>
        </article>

        <!-- Poll 3: Top 4 -->
        <article class="poll-card" id="poll-top4">
            <h2 class="poll-question">Which teams will finish in the top 4?</h2>

            <div class="poll-meta">
                <span id="top4-votes-count">0 votes</span>
                <button class="reset-btn" onclick="resetSinglePoll('top4')">Reset</button>
            </div>

            <div class="selection-counter" id="top4-counter">Select up to 4 teams</div>

            <div class="poll-leader">
                <div class="leader-label">Most Popular</div>
                <div class="leader-name" id="top4-leader">No votes yet</div>
            </div>

            <div class="poll-options">
                <div class="poll-option" onclick="selectOption(event, 'top4', 'city-top4')">
                    <input type="checkbox" id="city-top4" name="top4" value="city">
                    <label for="city-top4">Manchester City</label>
                    <div class="poll-result">
                        <div class="poll-bar">
                            <div class="poll-fill" data-option="city"></div>
                        </div>
                        <span class="poll-percentage" data-option="city">0%</span>
                    </div>
                </div>

                <div class="poll-option" onclick="selectOption(event, 'top4', 'arsenal-top4')">
                    <input type="checkbox" id="arsenal-top4" name="top4" value="arsenal">
                    <label for="arsenal-top4">Arsenal</label>
                    <div class="poll-result">
                        <div class="poll-bar">
                            <div class="poll-fill" data-option="arsenal"></div>
                        </div>
                        <span class="poll-percentage" data-option="arsenal">0%</span>
                    </div>
                </div>

                <div class="poll-option" onclick="selectOption(event, 'top4', 'liverpool-top4')">
                    <input type="checkbox" id="liverpool-top4" name="top4" value="liverpool">
                    <label for="liverpool-top4">Liverpool</label>
                    <div class="poll-result">
                        <div class="poll-bar">
                            <div class="poll-fill" data-option="liverpool"></div>
                        </div>
                        <span class="poll-percentage" data-option="liverpool">0%</span>
                    </div>
                </div>

                <div class="poll-option" onclick="selectOption(event, 'top4', 'united-top4')">
                    <input type="checkbox" id="united-top4" name="top4" value="united">
                    <label for="united-top4">Manchester United</label>
                    <div class="poll-result">
                        <div class="poll-bar">
                            <div class="poll-fill" data-option="united"></div>
                        </div>
                        <span class="poll-percentage" data-option="united">0%</span>
                    </div>
                </div>

                <div class="poll-option" onclick="selectOption(event, 'top4', 'chelsea-top4')">
                    <input type="checkbox" id="chelsea-top4" name="top4" value="chelsea">
                    <label for="chelsea-top4">Chelsea</label>
                    <div class="poll-result">
                        <div class="poll-bar">
                            <div class="poll-fill" data-option="chelsea"></div>
                        </div>
                        <span class="poll-percentage" data-option="chelsea">0%</span>
                    </div>
                </div>

                <div class="poll-option" onclick="selectOption(event, 'top4', 'spurs-top4')">
                    <input type="checkbox" id="spurs-top4" name="top4" value="spurs">
                    <label for="spurs-top4">Tottenham</label>
                    <div class="poll-result">
                        <div class="poll-bar">
                            <div class="poll-fill" data-option="spurs"></div>
                        </div>
                        <span class="poll-percentage" data-option="spurs">0%</span>
                    </div>
                </div>
            </div>

            <button class="vote-btn" onclick="submitVote('top4')">Submit Vote</button>
            <p class="poll-votes" id="top4-votes">0 votes</p>
        </article>

    </main>

    <!-- Past Results -->
    <section class="results-section">
        <h2>Recent Poll Results</h2>

        <div class="result-item">
            <h3>Best goal of the season so far?</h3>
            <p><strong>Winner:</strong> Bukayo Saka vs Liverpool</p>
            <p>47% of 1,284 votes</p>
            <p class="result-date">Closed July 15, 2025</p>
        </div>

        <div class="result-item">
            <h3>Which manager is under the most pressure?</h3>
            <p><strong>Winner:</strong> Erik ten Hag</p>
            <p>34% of 2,103 votes</p>
            <p class="result-date">Closed July 10, 2025</p>
        </div>

        <div class="result-item">
            <h3>Most impressive promoted team?</h3>
            <p><strong>Winner:</strong> Leeds United</p>
            <p>56% of 1,567 votes</p>
            <p class="result-date">Closed June 28, 2025</p>
        </div>
    </section>

    <div class="footer" include="./footer.html"></div>
    <script src="./index.js"></script>

    <script>
        // Poll data with localStorage persistence
        const defaultPolls = {
            title: {
                votes: { city: 342, arsenal: 287, liverpool: 421, united: 156 },
                totalVotes: 1206,
                userVoted: false,
                userChoice: null
            },
            signing: {
                votes: { kvaratskhelia: 189, gyokeres: 234, wirtz: 178, other: 112 },
                totalVotes: 713,
                userVoted: false,
                userChoice: null
            },
            top4: {
                votes: { city: 891, arsenal: 834, liverpool: 923, united: 412, chelsea: 567, spurs: 289 },
                totalVotes: 978,
                userVoted: false,
                userChoice: []
            }
        };

        let polls = JSON.parse(JSON.stringify(defaultPolls));

        // Load saved data
        function loadPolls() {
            const saved = localStorage.getItem('eplPollsData');
            if (saved) {
                const savedPolls = JSON.parse(saved);
                // Merge with defaults to handle new options
                for (let pollKey in defaultPolls) {
                    if (savedPolls[pollKey]) {
                        polls[pollKey] = { ...defaultPolls[pollKey], ...savedPolls[pollKey] };
                    }
                }
            }
        }

        // Save data
        function savePolls() {
            localStorage.setItem('eplPollsData', JSON.stringify(polls));
        }

        // Calculate percentages
        function getPercentages(pollKey) {
            const poll = polls[pollKey];
            const percentages = {};

            if (pollKey === 'top4') {
                const total = Object.values(poll.votes).reduce((sum, v) => sum + v, 0);
                for (let option in poll.votes) {
                    percentages[option] = total > 0 ? Math.round((poll.votes[option] / total) * 100) : 0;
                }
            } else {
                for (let option in poll.votes) {
                    percentages[option] = poll.totalVotes > 0 ?
                        Math.round((poll.votes[option] / poll.totalVotes) * 100) : 0;
                }
            }

            return percentages;
        }

        // Update poll display
        function updatePollDisplay(pollKey) {
            const poll = polls[pollKey];
            const percentages = getPercentages(pollKey);

            // Update bars and percentages
            for (let option in poll.votes) {
                const fillBar = document.querySelector(`#poll-${pollKey} .poll-fill[data-option="${option}"]`);
                const percentSpan = document.querySelector(`#poll-${pollKey} .poll-percentage[data-option="${option}"]`);

                if (fillBar) fillBar.style.width = percentages[option] + '%';
                if (percentSpan) percentSpan.textContent = percentages[option] + '%';
            }

            // Update vote count
            const votesEl = document.getElementById(`${pollKey}-votes`);
            const votesCountEl = document.getElementById(`${pollKey}-votes-count`);
            if (votesEl) votesEl.textContent = `${poll.totalVotes.toLocaleString()} ${poll.totalVotes === 1 ? 'vote' : 'votes'}`;
            if (votesCountEl) votesCountEl.textContent = `${poll.totalVotes.toLocaleString()} votes`;

            // Find and display leader
            let maxVotes = 0;
            let leaders = [];
            for (let option in poll.votes) {
                if (poll.votes[option] > maxVotes) {
                    maxVotes = poll.votes[option];
                    leaders = [option];
                } else if (poll.votes[option] === maxVotes && poll.votes[option] > 0) {
                    leaders.push(option);
                }
            }

            const leaderEl = document.getElementById(`${pollKey}-leader`);
            if (leaderEl) {
                if (maxVotes > 0) {
                    const leaderNames = leaders.map(l => getOptionLabel(pollKey, l));
                    const percentage = percentages[leaders[0]];
                    leaderEl.textContent = `${leaderNames.join(' & ')} (${percentage}%)`;
                } else {
                    leaderEl.textContent = 'No votes yet';
                }
            }

            // Mark leading options
            document.querySelectorAll(`#poll-${pollKey} .poll-option`).forEach(opt => {
                opt.classList.remove('leading');
            });
            if (maxVotes > 0) {
                leaders.forEach(leader => {
                    const input = document.querySelector(`#poll-${pollKey} input[value="${leader}"]`);
                    if (input) input.closest('.poll-option').classList.add('leading');
                });
            }

            // Handle voted state
            if (poll.userVoted) {
                const voteBtn = document.querySelector(`#poll-${pollKey} .vote-btn`);
                if (voteBtn) {
                    voteBtn.textContent = 'Vote Submitted';
                    voteBtn.disabled = true;
                }

                // Highlight user's choice
                if (pollKey === 'top4') {
                    poll.userChoice.forEach(choice => {
                        const input = document.querySelector(`#poll-${pollKey} input[value="${choice}"]`);
                        if (input) {
                            input.checked = true;
                            input.closest('.poll-option').classList.add('user-selected');
                        }
                    });
                } else {
                    const input = document.querySelector(`#poll-${pollKey} input[value="${poll.userChoice}"]`);
                    if (input) {
                        input.checked = true;
                        input.closest('.poll-option').classList.add('user-selected');
                    }
                }
            }
        }

        // Get option label text
        function getOptionLabel(pollKey, value) {
            const input = document.querySelector(`#poll-${pollKey} input[value="${value}"]`);
            if (input) {
                const label = input.nextElementSibling;
                return label ? label.textContent : value;
            }
            return value;
        }

        // Handle option selection
        function selectOption(event, pollKey, optionId) {
            const poll = polls[pollKey];
            if (poll.userVoted) return;

            const input = document.getElementById(optionId);
            if (!input) return;

            if (pollKey === 'top4') {
                const checked = document.querySelectorAll(`#poll-${pollKey} input:checked`);
                if (!input.checked && checked.length >= 4) {
                    event.preventDefault();
                    return;
                }
                input.checked = !input.checked;
                updateTop4Counter();
            } else {
                input.checked = true;
            }
        }

        // Update top 4 selection counter
        function updateTop4Counter() {
            const checked = document.querySelectorAll('#poll-top4 input:checked').length;
            const counter = document.getElementById('top4-counter');

            if (checked === 0) {
                counter.textContent = 'Select up to 4 teams';
                counter.className = 'selection-counter';
            } else if (checked <= 4) {
                counter.textContent = `${checked}/4 teams selected`;
                counter.className = 'selection-counter valid';
            } else {
                counter.textContent = `Too many selected (${checked}/4)`;
                counter.className = 'selection-counter warning';
            }
        }

        // Submit vote
        function submitVote(pollKey) {
            const poll = polls[pollKey];

            if (poll.userVoted) {
                alert('You have already voted in this poll.');
                return;
            }

            let selected = [];

            if (pollKey === 'top4') {
                const checked = document.querySelectorAll(`#poll-${pollKey} input:checked`);
                if (checked.length === 0) {
                    alert('Please select at least one team.');
                    return;
                }
                if (checked.length > 4) {
                    alert('Please select maximum 4 teams.');
                    return;
                }
                checked.forEach(box => selected.push(box.value));
            } else {
                const checked = document.querySelector(`#poll-${pollKey} input:checked`);
                if (!checked) {
                    alert('Please select an option.');
                    return;
                }
                selected = [checked.value];
            }

            // Update votes
            if (pollKey === 'top4') {
                selected.forEach(option => poll.votes[option]++);
                poll.totalVotes++;
            } else {
                selected.forEach(option => poll.votes[option]++);
                poll.totalVotes++;
            }

            poll.userVoted = true;
            poll.userChoice = pollKey === 'top4' ? selected : selected[0];

            savePolls();
            updatePollDisplay(pollKey);
            updateStats();
            showSuccess(pollKey);
        }

        // Show success message
        function showSuccess(pollKey) {
            const pollCard = document.getElementById(`poll-${pollKey}`);
            const existing = pollCard.querySelector('.vote-success');
            if (existing) existing.remove();

            const msg = document.createElement('div');
            msg.className = 'vote-success';
            msg.textContent = 'Thank you for voting. Your response has been recorded.';
            pollCard.appendChild(msg);

            setTimeout(() => msg.remove(), 4000);
        }

        // Update header stats
        function updateStats() {
            const totalVotes = Object.values(polls).reduce((sum, p) => sum + p.totalVotes, 0);
            const votedCount = Object.values(polls).filter(p => p.userVoted).length;
            const participation = Math.round((votedCount / 3) * 100);

            const totalEl = document.getElementById('total-votes');
            const partEl = document.getElementById('participation-rate');

            totalEl.textContent = totalVotes.toLocaleString();
            partEl.textContent = participation + '%';

            totalEl.classList.add('updated');
            partEl.classList.add('updated');
            setTimeout(() => {
                totalEl.classList.remove('updated');
                partEl.classList.remove('updated');
            }, 300);
        }

        // Reset single poll
        function resetSinglePoll(pollKey) {
            if (confirm('Reset this poll? This will clear your vote.')) {
                polls[pollKey] = JSON.parse(JSON.stringify(defaultPolls[pollKey]));
                savePolls();
                updatePollDisplay(pollKey);
                updateStats();
            }
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', () => {
            loadPolls();
            Object.keys(polls).forEach(key => updatePollDisplay(key));
            updateStats();

            // Add event listeners for top4 checkboxes
            document.querySelectorAll('#poll-top4 input').forEach(input => {
                input.addEventListener('change', updateTop4Counter);
            });
            updateTop4Counter();
        });
    </script>
</body>
</html>
