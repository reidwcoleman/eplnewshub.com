<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-TVPLGM5QY9"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-TVPLGM5QY9');
    </script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Vote in Premier League polls and see fan opinions on transfers, matches, and more at EPL News Hub.">
    <meta name="keywords" content="Premier League polls, EPL voting, football polls, fan opinions, soccer polls">
    <title>Premier League Polls | EPL News Hub</title>
    <link rel="stylesheet" href="styles.css">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6480210605786899" crossorigin="anonymous"></script>
    <link rel="apple-touch-icon" href="reidsnbest.webp">
    <link rel="icon" type="image/webp" href="reidsnbest.webp">
</head>
<body>
    <div class="header" include="./header.html"></div>

    <!-- Main Content Area -->
    <main class="main-content">
        <div class="content-wrapper">
            <!-- Page Title -->
            <div class="page-header">
                <h1 class="page-title">üó≥Ô∏è Premier League Polls</h1>
                <div class="page-divider"></div>
                <button id="resetPolls" style="position: absolute; top: 10px; right: 10px; background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 4px; font-size: 0.8rem; cursor: pointer; opacity: 0.7;">Reset Polls</button>
            </div>

            <!-- Active Polls Section -->
            <section class="polls-section">
                <div class="polls-container">
                    <div class="poll-card">
                        <h3 class="poll-question">Who will win the Premier League title this season?</h3>
                        <div class="poll-options">
                            <div class="poll-option">
                                <input type="radio" id="city" name="title" value="city">
                                <label for="city">Manchester City</label>
                                <div class="poll-bar">
                                    <div class="poll-fill" style="width: 35%;"></div>
                                </div>
                                <span class="poll-percentage">35%</span>
                            </div>
                            <div class="poll-option">
                                <input type="radio" id="arsenal" name="title" value="arsenal">
                                <label for="arsenal">Arsenal</label>
                                <div class="poll-bar">
                                    <div class="poll-fill" style="width: 28%;"></div>
                                </div>
                                <span class="poll-percentage">28%</span>
                            </div>
                            <div class="poll-option">
                                <input type="radio" id="liverpool" name="title" value="liverpool">
                                <label for="liverpool">Liverpool</label>
                                <div class="poll-bar">
                                    <div class="poll-fill" style="width: 22%;"></div>
                                </div>
                                <span class="poll-percentage">22%</span>
                            </div>
                            <div class="poll-option">
                                <input type="radio" id="united" name="title" value="united">
                                <label for="united">Manchester United</label>
                                <div class="poll-bar">
                                    <div class="poll-fill" style="width: 15%;"></div>
                                </div>
                                <span class="poll-percentage">15%</span>
                            </div>
                        </div>
                        <button class="vote-btn">Vote Now</button>
                        <p class="poll-votes">2,547 votes</p>
                    </div>

                    <div class="poll-card">
                        <h3 class="poll-question">Best Premier League signing this summer?</h3>
                        <div class="poll-options">
                            <div class="poll-option">
                                <input type="radio" id="kvaratskhelia" name="signing" value="kvaratskhelia">
                                <label for="kvaratskhelia">Khvicha Kvaratskhelia (Man United)</label>
                                <div class="poll-bar">
                                    <div class="poll-fill" style="width: 42%;"></div>
                                </div>
                                <span class="poll-percentage">42%</span>
                            </div>
                            <div class="poll-option">
                                <input type="radio" id="gyokeres" name="signing" value="gyokeres">
                                <label for="gyokeres">Viktor Gy√∂keres (Arsenal)</label>
                                <div class="poll-bar">
                                    <div class="poll-fill" style="width: 31%;"></div>
                                </div>
                                <span class="poll-percentage">31%</span>
                            </div>
                            <div class="poll-option">
                                <input type="radio" id="other" name="signing" value="other">
                                <label for="other">Other</label>
                                <div class="poll-bar">
                                    <div class="poll-fill" style="width: 27%;"></div>
                                </div>
                                <span class="poll-percentage">27%</span>
                            </div>
                        </div>
                        <button class="vote-btn">Vote Now</button>
                        <p class="poll-votes">1,832 votes</p>
                    </div>

                    <div class="poll-card">
                        <h3 class="poll-question">Which team will finish in the top 4?</h3>
                        <div class="poll-options">
                            <div class="poll-option">
                                <input type="checkbox" id="city-top4" name="top4" value="city">
                                <label for="city-top4">Manchester City</label>
                            </div>
                            <div class="poll-option">
                                <input type="checkbox" id="arsenal-top4" name="top4" value="arsenal">
                                <label for="arsenal-top4">Arsenal</label>
                            </div>
                            <div class="poll-option">
                                <input type="checkbox" id="liverpool-top4" name="top4" value="liverpool">
                                <label for="liverpool-top4">Liverpool</label>
                            </div>
                            <div class="poll-option">
                                <input type="checkbox" id="united-top4" name="top4" value="united">
                                <label for="united-top4">Manchester United</label>
                            </div>
                            <div class="poll-option">
                                <input type="checkbox" id="chelsea-top4" name="top4" value="chelsea">
                                <label for="chelsea-top4">Chelsea</label>
                            </div>
                            <div class="poll-option">
                                <input type="checkbox" id="spurs-top4" name="top4" value="spurs">
                                <label for="spurs-top4">Tottenham</label>
                            </div>
                        </div>
                        <button class="vote-btn">Vote Now</button>
                        <p class="poll-votes">3,421 votes</p>
                    </div>
                </div>
            </section>

            <!-- Poll Results Section -->
            <section class="poll-results">
                <h2 class="section-title">Recent Poll Results</h2>
                <div class="results-container">
                    <div class="result-item">
                        <h4>Best goal of the season so far?</h4>
                        <p><strong>Winner:</strong> Bukayo Saka vs Liverpool (47% of votes)</p>
                        <p class="result-date">Closed: July 15, 2025</p>
                    </div>
                    <div class="result-item">
                        <h4>Which manager is under the most pressure?</h4>
                        <p><strong>Winner:</strong> Erik ten Hag (34% of votes)</p>
                        <p class="result-date">Closed: July 10, 2025</p>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <div class="footer" include="./footer.html"></div>
    <script src="./index.js"></script>
    <script>
        // Poll data structure - Starting fresh with 0 votes
        const defaultPollsData = {
            title: {
                question: "Who will win the Premier League title this season?",
                votes: {
                    city: 0,
                    arsenal: 0,
                    liverpool: 0,
                    united: 0
                },
                totalVotes: 0,
                userVoted: false,
                userChoice: null
            },
            signing: {
                question: "Best Premier League signing this summer?",
                votes: {
                    kvaratskhelia: 0,
                    gyokeres: 0,
                    other: 0
                },
                totalVotes: 0,
                userVoted: false,
                userChoice: null
            },
            top4: {
                question: "Which team will finish in the top 4?",
                votes: {
                    city: 0,
                    arsenal: 0,
                    liverpool: 0,
                    united: 0,
                    chelsea: 0,
                    spurs: 0
                },
                totalVotes: 0,
                userVoted: false,
                userChoice: []
            }
        };
        
        let pollsData = { ...defaultPollsData };

        // Load data from localStorage
        function loadPollData() {
            const saved = localStorage.getItem('eplNewsHubPolls');
            if (saved) {
                const savedData = JSON.parse(saved);
                // Merge saved data with default structure to ensure all properties exist
                for (const pollKey in defaultPollsData) {
                    if (savedData[pollKey]) {
                        pollsData[pollKey] = { ...defaultPollsData[pollKey], ...savedData[pollKey] };
                    }
                }
            } else {
                // First time visitor - use default data with 0 votes
                pollsData = { ...defaultPollsData };
            }
        }

        // Save data to localStorage
        function savePollData() {
            localStorage.setItem('eplNewsHubPolls', JSON.stringify(pollsData));
        }

        // Calculate percentages
        function calculatePercentages(pollKey) {
            const poll = pollsData[pollKey];
            const percentages = {};
            
            for (const option in poll.votes) {
                percentages[option] = poll.totalVotes > 0 ? 
                    Math.round((poll.votes[option] / poll.totalVotes) * 100) : 0;
            }
            
            return percentages;
        }
        
        // Reset all polls (for testing/admin purposes)
        function resetPolls() {
            if (confirm('Are you sure you want to reset all polls? This will clear all votes.')) {
                localStorage.removeItem('eplNewsHubPolls');
                pollsData = { ...defaultPollsData };
                
                // Update all displays
                Object.keys(pollsData).forEach(pollKey => {
                    updatePollDisplay(pollKey);
                });
                
                // Remove all winner crowns
                document.querySelectorAll('.winner-crown').forEach(crown => crown.remove());
                
                alert('All polls have been reset!');
            }
        }

        // Update poll display
        function updatePollDisplay(pollKey) {
            const poll = pollsData[pollKey];
            const percentages = calculatePercentages(pollKey);
            
            // Update vote bars and percentages
            for (const option in poll.votes) {
                const optionElement = document.querySelector(`input[value="${option}"]`);
                if (optionElement) {
                    const pollOption = optionElement.closest('.poll-option');
                    const fillBar = pollOption.querySelector('.poll-fill');
                    const percentageSpan = pollOption.querySelector('.poll-percentage');
                    
                    if (fillBar) fillBar.style.width = `${percentages[option]}%`;
                    if (percentageSpan) percentageSpan.textContent = `${percentages[option]}%`;
                }
            }
            
            // Update total votes
            const pollCard = document.querySelector(`input[name="${pollKey}"]`).closest('.poll-card');
            const votesElement = pollCard.querySelector('.poll-votes');
            if (votesElement) {
                const voteText = poll.totalVotes === 1 ? 'vote' : 'votes';
                votesElement.textContent = `${poll.totalVotes.toLocaleString()} ${voteText}`;
            }
            
            // Update vote button
            const voteBtn = pollCard.querySelector('.vote-btn');
            if (poll.userVoted) {
                voteBtn.textContent = 'Thank You!';
                voteBtn.disabled = true;
                voteBtn.style.background = '#28a745';
                voteBtn.style.cursor = 'not-allowed';
                
                // Highlight user's choice
                if (pollKey === 'top4') {
                    poll.userChoice.forEach(choice => {
                        const choiceElement = document.querySelector(`input[value="${choice}"]`);
                        if (choiceElement) {
                            choiceElement.closest('.poll-option').style.background = 'rgba(40, 167, 69, 0.1)';
                            choiceElement.closest('.poll-option').style.border = '2px solid #28a745';
                        }
                    });
                } else {
                    const choiceElement = document.querySelector(`input[value="${poll.userChoice}"]`);
                    if (choiceElement) {
                        choiceElement.closest('.poll-option').style.background = 'rgba(40, 167, 69, 0.1)';
                        choiceElement.closest('.poll-option').style.border = '2px solid #28a745';
                        choiceElement.checked = true;
                    }
                }
            }
        }

        // Handle voting
        function handleVote(pollKey) {
            const poll = pollsData[pollKey];
            
            if (poll.userVoted) {
                alert('You have already voted in this poll!');
                return;
            }
            
            let selectedOptions = [];
            
            if (pollKey === 'top4') {
                // Multi-select poll
                const checkedBoxes = document.querySelectorAll(`input[name="${pollKey}"]:checked`);
                if (checkedBoxes.length === 0) {
                    alert('Please select at least one team!');
                    return;
                }
                if (checkedBoxes.length > 4) {
                    alert('Please select maximum 4 teams!');
                    return;
                }
                
                checkedBoxes.forEach(box => selectedOptions.push(box.value));
            } else {
                // Single-select poll
                const selectedOption = document.querySelector(`input[name="${pollKey}"]:checked`);
                if (!selectedOption) {
                    alert('Please select an option!');
                    return;
                }
                selectedOptions = [selectedOption.value];
            }
            
            // Update vote counts
            selectedOptions.forEach(option => {
                poll.votes[option]++;
            });
            
            // For multi-select polls, only increment total votes once per vote session
            if (pollKey === 'top4') {
                poll.totalVotes++;
            } else {
                poll.totalVotes++;
            }
            
            // Mark as voted
            poll.userVoted = true;
            poll.userChoice = pollKey === 'top4' ? selectedOptions : selectedOptions[0];
            
            // Save and update display
            savePollData();
            updatePollDisplay(pollKey);
            
            // Show success message
            showVoteSuccess(pollKey);
        }

        // Show vote success message
        function showVoteSuccess(pollKey) {
            const pollCard = document.querySelector(`input[name="${pollKey}"]`).closest('.poll-card');
            const successMsg = document.createElement('div');
            successMsg.className = 'vote-success';
            successMsg.innerHTML = '‚úÖ Your vote has been recorded! Thank you for participating.';
            successMsg.style.cssText = `
                background: linear-gradient(135deg, #28a745, #20c997);
                color: white;
                padding: 15px;
                border-radius: 8px;
                margin-top: 15px;
                text-align: center;
                font-weight: 600;
                animation: fadeIn 0.5s ease-in;
            `;
            
            pollCard.appendChild(successMsg);
            
            // Remove success message after 3 seconds
            setTimeout(() => {
                if (successMsg.parentNode) {
                    successMsg.remove();
                }
            }, 3000);
        }

        // Add winner indicators
        function addWinnerIndicators() {
            Object.keys(pollsData).forEach(pollKey => {
                const poll = pollsData[pollKey];
                const percentages = calculatePercentages(pollKey);
                
                // Find the winner(s)
                let maxPercentage = 0;
                let winners = [];
                
                for (const option in percentages) {
                    if (percentages[option] > maxPercentage) {
                        maxPercentage = percentages[option];
                        winners = [option];
                    } else if (percentages[option] === maxPercentage) {
                        winners.push(option);
                    }
                }
                
                // Add winner crown to leading option(s)
                winners.forEach(winner => {
                    const winnerElement = document.querySelector(`input[value="${winner}"]`);
                    if (winnerElement && maxPercentage > 0) {
                        const label = winnerElement.nextElementSibling;
                        if (label && !label.querySelector('.winner-crown')) {
                            const crown = document.createElement('span');
                            crown.className = 'winner-crown';
                            crown.innerHTML = ' üëë';
                            crown.style.cssText = 'color: #ffc107; font-size: 1.2em; animation: bounce 2s infinite;';
                            label.appendChild(crown);
                        }
                    }
                });
            });
        }

        // Initialize polls
        function initializePolls() {
            loadPollData();
            
            // Update all poll displays
            Object.keys(pollsData).forEach(pollKey => {
                updatePollDisplay(pollKey);
            });
            
            // Add winner indicators
            addWinnerIndicators();
            
            // Add event listeners to vote buttons
            document.querySelectorAll('.vote-btn').forEach((btn, index) => {
                const pollKeys = ['title', 'signing', 'top4'];
                const pollKey = pollKeys[index];
                
                btn.addEventListener('click', () => {
                    handleVote(pollKey);
                });
            });
            
            // Add event listener to reset button
            document.getElementById('resetPolls').addEventListener('click', resetPolls);
        }

        // Add CSS animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(10px); }
                to { opacity: 1; transform: translateY(0); }
            }
            
            @keyframes bounce {
                0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
                40% { transform: translateY(-5px); }
                60% { transform: translateY(-3px); }
            }
            
            .poll-option {
                transition: all 0.3s ease;
                border: 2px solid transparent;
                border-radius: 8px;
                padding: 10px;
                margin: 5px 0;
            }
            
            .poll-option:hover {
                background: rgba(55, 0, 60, 0.05);
            }
            
            .vote-btn:disabled {
                opacity: 0.8;
            }
            
            .poll-fill {
                transition: width 0.8s ease-out;
            }
        `;
        document.head.appendChild(style);

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initializePolls);
    </script>
</body>
</html>