<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-TVPLGM5QY9"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-TVPLGM5QY9');
    </script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Complete Premier League Fantasy Football hub with tips, team selection, captain picks, and expert FPL analysis from EPL News Hub.">
    <meta name="keywords" content="Premier League Fantasy, FPL, Fantasy Football, EPL Fantasy, FPL tips, captain picks, team selection, gameweek analysis">
    <title>Premier League Fantasy Football Hub | EPL News Hub</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="responsive.css">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6480210605786899" crossorigin="anonymous"></script>
    <link rel="apple-touch-icon" href="reidsnbest.webp">
    <link rel="icon" type="image/webp" href="reidsnbest.webp">
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        
        const firebaseConfig = {
            apiKey: "AIzaSyCyOey0l27yQP68oybpoodMVcvayhIHt2I",
            authDomain: "epl-news-hub-94c09.firebaseapp.com",
            projectId: "epl-news-hub-94c09",
            storageBucket: "epl-news-hub-94c09.firebasestorage.app",
            messagingSenderId: "674703933278",
            appId: "1:674703933278:web:90c6dd4aa9f1ace73099cf",
            measurementId: "G-ECM6BCQCS8"
        };
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        
        window.auth = auth;
        window.onAuthStateChanged = onAuthStateChanged;
    </script>
    <style>
        .fpl-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .fpl-header {
            background: linear-gradient(135deg, #37003c, #00ff87);
            color: white;
            padding: 40px 20px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }
        
        .fpl-header::before {
            content: '⚽';
            position: absolute;
            font-size: 200px;
            opacity: 0.1;
            top: -50px;
            right: -50px;
            transform: rotate(15deg);
        }
        
        .fpl-header h1 {
            font-family: Georgia, serif;
            font-size: 2.5rem;
            margin-bottom: 10px;
            position: relative;
            z-index: 2;
        }
        
        .fpl-header p {
            font-size: 1.2rem;
            position: relative;
            z-index: 2;
        }
        
        .fpl-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        .sidebar-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .fpl-card {
            background: linear-gradient(145deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12), 0 4px 15px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(55,0,60,0.1);
            border-left: 5px solid #37003c;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .fpl-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, rgba(55,0,60,0.05), transparent);
            border-radius: 0 0 0 100px;
        }
        
        .fpl-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15), 0 6px 20px rgba(0, 0, 0, 0.1);
        }
        
        .fpl-card h2 {
            font-family: Georgia, serif;
            color: #37003c;
            margin-bottom: 25px;
            font-size: 1.5rem;
            font-weight: 700;
            position: relative;
            z-index: 2;
        }
        
        .fpl-card h3 {
            color: #37003c;
            margin-bottom: 20px;
            font-size: 1.3rem;
            font-weight: 600;
            position: relative;
            z-index: 2;
        }
            font-size: 1.1rem;
        }
        
        .captain-picks {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .captain-card {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            border: 2px solid #37003c;
            transition: transform 0.3s ease;
        }
        
        .captain-card:hover {
            transform: translateY(-5px);
        }
        
        .captain-card.premium {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            border-color: #ffd700;
        }
        
        .captain-card .player-name {
            font-size: 1.3rem;
            font-weight: bold;
            color: #37003c;
            margin-bottom: 8px;
        }
        
        .captain-card .player-price {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }
        
        .captain-card .fixture {
            background: #37003c;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            margin-bottom: 10px;
            display: inline-block;
        }
        
        .transfers-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .transfers-table th,
        .transfers-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }
        
        .transfers-table th {
            background: #f8f9fa;
            font-weight: bold;
            color: #37003c;
        }
        
        .transfer-in {
            color: #28a745;
            font-weight: bold;
        }
        
        .transfer-out {
            color: #dc3545;
            font-weight: bold;
        }
        
        .gameweek-info {
            background: linear-gradient(135deg, #37003c 0%, #6f42c1 50%, #e83e8c 100%);
            color: white;
            padding: 35px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 15px 35px rgba(55,0,60,0.3), 0 8px 15px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
            border: 2px solid rgba(255,255,255,0.1);
            margin-bottom: 25px;
        }
        
        .gameweek-info::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: pulse 4s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
        
        .gameweek-info h3 {
            margin-bottom: 15px;
            color: white !important;
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            z-index: 2;
        }
        
        .gameweek-number {
            font-size: 3.5rem;
            font-weight: 900;
            margin: 20px 0;
            text-shadow: 0 4px 8px rgba(0,0,0,0.3);
            background: linear-gradient(45deg, #00ff87, #20c997);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            position: relative;
            z-index: 2;
        }
        
        .gameweek-info p {
            font-size: 1rem;
            opacity: 0.9;
            position: relative;
            z-index: 2;
        }
        
        .deadline-timer {
            background: linear-gradient(135deg, #dc3545 0%, #fd7e14 50%, #ffc107 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 35px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(220,53,69,0.3), 0 5px 15px rgba(0,0,0,0.1);
            border: 2px solid rgba(255,255,255,0.2);
            position: relative;
            overflow: hidden;
        }
        
        .deadline-timer::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 200%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            animation: shimmer 3s ease-in-out infinite;
        }
        
        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .deadline-timer h3 {
            margin-bottom: 15px;
            color: white !important;
            font-size: 1.2rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            z-index: 2;
        }
        
        #countdown {
            font-size: 1.4rem;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            position: relative;
            z-index: 2;
        }
        
        .price-changes {
            list-style: none;
            padding: 0;
        }
        
        .price-changes li {
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .price-up {
            color: #28a745;
        }
        
        .price-down {
            color: #dc3545;
        }
        
        .team-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .team-formation {
            background: linear-gradient(135deg, #0f5132 0%, #198754 50%, #20c997 100%);
            border-radius: 20px;
            padding: 40px 25px;
            margin: 25px 0;
            position: relative;
            min-height: 600px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.25);
            border: 3px solid rgba(255,255,255,0.2);
            overflow: hidden;
        }
        
        .team-formation::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 3px;
            height: 100%;
            background: linear-gradient(180deg, rgba(255,255,255,0.5) 0%, rgba(255,255,255,0.3) 50%, rgba(255,255,255,0.5) 100%);
            box-shadow: 0 0 10px rgba(255,255,255,0.3);
        }
        
        .team-formation::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 120px;
            height: 120px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            box-shadow: 0 0 20px rgba(255,255,255,0.2);
        }
        
        .formation-line {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 25px 0;
            position: relative;
        }
        
        .player-card {
            background: linear-gradient(145deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: 16px;
            padding: 16px 12px;
            margin: 0 10px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15), 0 4px 10px rgba(0,0,0,0.1);
            border: 3px solid #fff;
            min-width: 130px;
            max-width: 140px;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            backdrop-filter: blur(10px);
            z-index: 10;
        }
        
        .player-card:hover {
            transform: translateY(-8px) scale(1.05);
            box-shadow: 0 15px 35px rgba(0,0,0,0.25), 0 8px 15px rgba(0,0,0,0.15);
            border-color: #37003c;
        }
        
        .player-card::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, transparent, rgba(55,0,60,0.1), transparent);
            border-radius: 18px;
            z-index: -1;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .player-card:hover::before {
            opacity: 1;
        }
        
        .player-name {
            font-weight: bold;
            font-size: 0.9rem;
            color: #333;
            margin-bottom: 4px;
        }
        
        .player-team {
            font-size: 0.75rem;
            color: #666;
            margin-bottom: 6px;
        }
        
        .player-price {
            font-size: 0.8rem;
            color: #37003c;
            font-weight: bold;
            background: rgba(55,0,60,0.1);
            padding: 2px 6px;
            border-radius: 4px;
        }
        
        .formation-goalkeeper .player-card {
            border-color: #FFD700;
            background: rgba(255,215,0,0.1);
        }
        
        .formation-defenders .player-card {
            border-color: #4169E1;
            background: rgba(65,105,225,0.1);
        }
        
        .formation-midfielders .player-card {
            border-color: #32CD32;
            background: rgba(50,205,50,0.1);
        }
        
        .formation-forwards .player-card {
            border-color: #FF4500;
            background: rgba(255,69,0,0.1);
        }
        
        .formation-title {
            text-align: center;
            color: white;
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 25px;
            text-shadow: 0 3px 6px rgba(0,0,0,0.5);
            letter-spacing: 1px;
            text-transform: uppercase;
            position: relative;
            z-index: 15;
        }
        
        .formation-title::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 3px;
            background: linear-gradient(90deg, transparent, #fff, transparent);
            border-radius: 2px;
        }
        
        .stats-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: linear-gradient(135deg, rgba(55,0,60,0.05) 0%, rgba(111,66,193,0.05) 100%);
            border-radius: 12px;
            border-left: 4px solid #37003c;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .stat-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 0;
            height: 100%;
            background: linear-gradient(90deg, rgba(55,0,60,0.1), transparent);
            transition: width 0.3s ease;
        }
        
        .stat-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(55,0,60,0.1);
        }
        
        .stat-item:hover::before {
            width: 100%;
        }
        
        .stat-icon {
            font-size: 1.8rem;
            margin-right: 15px;
            min-width: 50px;
            text-align: center;
            position: relative;
            z-index: 2;
        }
        
        .stat-content {
            flex: 1;
            position: relative;
            z-index: 2;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #666;
            font-weight: 500;
            margin-bottom: 2px;
        }
        
        .stat-value {
            font-size: 1.1rem;
            font-weight: 700;
            color: #37003c;
            margin-bottom: 2px;
        }
        
        .stat-desc {
            font-size: 0.8rem;
            color: #888;
            font-style: italic;
        }
        
        .fixture-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .fixture-tier {
            padding: 18px;
            border-radius: 12px;
            border-left: 5px solid;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .fixture-tier::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 0;
            height: 100%;
            transition: width 0.3s ease;
            opacity: 0.1;
        }
        
        .fixture-tier:hover::before {
            width: 100%;
        }
        
        .fixture-tier.easy {
            background: linear-gradient(135deg, rgba(40,167,69,0.08) 0%, rgba(32,201,151,0.08) 100%);
            border-left-color: #28a745;
        }
        
        .fixture-tier.easy::before {
            background: linear-gradient(90deg, #28a745, #20c997);
        }
        
        .fixture-tier.moderate {
            background: linear-gradient(135deg, rgba(253,126,20,0.08) 0%, rgba(255,193,7,0.08) 100%);
            border-left-color: #fd7e14;
        }
        
        .fixture-tier.moderate::before {
            background: linear-gradient(90deg, #fd7e14, #ffc107);
        }
        
        .fixture-tier.difficult {
            background: linear-gradient(135deg, rgba(220,53,69,0.08) 0%, rgba(229,62,62,0.08) 100%);
            border-left-color: #dc3545;
        }
        
        .fixture-tier.difficult::before {
            background: linear-gradient(90deg, #dc3545, #e53e3e);
        }
        
        .tier-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            position: relative;
            z-index: 2;
        }
        
        .tier-icon {
            font-size: 1.2rem;
            margin-right: 10px;
        }
        
        .tier-title {
            font-weight: 700;
            font-size: 1.1rem;
            color: #333;
            margin-right: 10px;
        }
        
        .tier-rating {
            background: rgba(55,0,60,0.1);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            color: #37003c;
        }
        
        .tier-teams {
            font-weight: 600;
            color: #37003c;
            margin-bottom: 8px;
            font-size: 0.95rem;
            position: relative;
            z-index: 2;
        }
        
        .tier-note {
            font-size: 0.85rem;
            color: #666;
            font-style: italic;
            position: relative;
            z-index: 2;
        }
        
        .position-group {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
        }
        
        .position-group h4 {
            color: #37003c;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .player-list {
            list-style: none;
            padding: 0;
        }
        
        .player-list li {
            padding: 5px 0;
            font-size: 0.9rem;
            border-bottom: 1px solid #e9ecef;
        }
        
        .player-list li:last-child {
            border-bottom: none;
        }
        
        .fpl-tips {
            background: #e8f5e8;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .fpl-tips h4 {
            color: #155724;
            margin-bottom: 10px;
        }
        
        .fpl-tips ul {
            margin: 0;
            padding-left: 20px;
        }
        
        .fpl-tips li {
            margin-bottom: 5px;
            color: #155724;
        }
        
        /* Comprehensive Mobile Responsive Styles */
        @media (max-width: 768px) {
            /* Container Mobile */
            .fpl-container {
                padding: 15px;
            }
            
            /* Header Mobile */
            .fpl-header {
                padding: 25px 15px;
                margin-bottom: 20px;
            }
            
            .fpl-header h1 {
                font-size: 2rem;
            }
            
            .fpl-header::before {
                font-size: 120px;
                top: -30px;
                right: -30px;
            }
            
            /* Grid Mobile */
            .fpl-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            /* Cards Mobile */
            .fpl-card {
                padding: 20px;
                margin-bottom: 20px;
            }
            
            .fpl-card h3 {
                font-size: 1.3rem;
            }
            
            /* Gameweek Info Mobile */
            .gameweek-info {
                padding: 25px 15px;
                margin-bottom: 20px;
            }
            
            .gameweek-number {
                font-size: 2.5rem;
                margin: 15px 0;
            }
            
            .gameweek-info h3 {
                font-size: 1rem;
            }
            
            .gameweek-info p {
                font-size: 0.9rem;
            }
            
            /* Deadline Timer Mobile */
            .deadline-timer {
                padding: 20px 15px;
                margin-bottom: 25px;
            }
            
            .deadline-timer h3 {
                font-size: 1.1rem;
            }
            
            /* Captain Picks Mobile */
            .captain-picks {
                padding: 20px;
            }
            
            .captain-picks h3 {
                font-size: 1.2rem;
            }
            
            /* Player Cards Mobile */
            .player-card {
                padding: 15px;
                margin-bottom: 15px;
            }
            
            .player-name {
                font-size: 1rem;
            }
            
            .player-team {
                font-size: 0.85rem;
            }
            
            .player-price {
                font-size: 0.9rem;
            }
            
            /* Lineup Mobile */
            .lineup-formation {
                padding: 20px 10px;
            }
            
            .formation-line {
                margin: 15px 0;
            }
            
            .formation-player {
                width: 60px;
                height: 60px;
                font-size: 0.7rem;
                margin: 5px;
            }
            
            /* Team Selection Mobile */
            .team-selection {
                padding: 20px;
            }
            
            .player-list {
                gap: 10px;
            }
            
            /* Stats Tables Mobile */
            .stats-table {
                font-size: 0.85rem;
                overflow-x: auto;
            }
            
            .stats-table th,
            .stats-table td {
                padding: 8px 4px;
                min-width: 80px;
            }
            
            /* Tips Section Mobile */
            .tips-section {
                padding: 20px;
            }
            
            .tip-item {
                padding: 15px;
                margin-bottom: 15px;
            }
            
            .tip-title {
                font-size: 1rem;
            }
            
            .tip-description {
                font-size: 0.85rem;
            }
            
            /* Transfers Mobile */
            .transfer-suggestions {
                padding: 20px;
            }
            
            .transfer-item {
                padding: 15px;
                margin-bottom: 15px;
            }
            
            .transfer-in,
            .transfer-out {
                font-size: 0.9rem;
            }
            
            /* Analysis Mobile */
            .analysis-section {
                padding: 20px;
            }
            
            .analysis-point {
                padding: 15px;
                margin-bottom: 15px;
            }
            
            /* Price Changes Mobile */
            .price-changes {
                padding: 20px;
            }
            
            .price-change-item {
                padding: 12px;
                font-size: 0.9rem;
            }
            
            /* Buttons Mobile */
            .fpl-btn {
                padding: 12px 20px;
                font-size: 0.9rem;
                width: 100%;
                margin-bottom: 10px;
            }
            
            /* Navigation Mobile */
            .fpl-nav {
                flex-direction: column;
                gap: 10px;
            }
            
            .fpl-nav-item {
                width: 100%;
                text-align: center;
                padding: 12px;
            }
        }
        
        /* Small Mobile Styles */
        @media (max-width: 480px) {
            .fpl-container {
                padding: 10px;
            }
            
            .fpl-header {
                padding: 20px 10px;
            }
            
            .fpl-header h1 {
                font-size: 1.8rem;
            }
            
            .gameweek-number {
                font-size: 2rem;
            }
            
            .fpl-card {
                padding: 15px;
            }
            
            .formation-player {
                width: 50px;
                height: 50px;
                font-size: 0.6rem;
                margin: 3px;
            }
            
            .stats-table {
                font-size: 0.75rem;
            }
            
            .stats-table th,
            .stats-table td {
                padding: 6px 2px;
                min-width: 60px;
            }
            
            .captain-picks {
                padding: 15px;
            }
            
            .team-selection {
                padding: 15px;
            }
            
            .tip-item,
            .transfer-item,
            .analysis-point {
                padding: 12px;
            }
        }
        
        /* Tablet Styles */
        @media (min-width: 769px) and (max-width: 1024px) {
            .fpl-container {
                padding: 18px;
            }
            
            .fpl-grid {
                grid-template-columns: 1fr 1fr;
                gap: 25px;
            }
            
            .fpl-header {
                padding: 30px 20px;
            }
            
            .gameweek-number {
                font-size: 3rem;
            }
        }
        
        /* Enhanced Header Styles */
        .header-content {
            position: relative;
            z-index: 2;
        }
        
        .header-stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 25px;
            flex-wrap: wrap;
        }
        
        .stat-bubble {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 15px 25px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .stat-bubble:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.25);
        }
        
        .stat-number {
            font-size: 1.8rem;
            font-weight: 800;
            color: #00ff87;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-top: 5px;
        }
        
        .header-animation {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            overflow: hidden;
        }
        
        .floating-icon {
            position: absolute;
            font-size: 40px;
            opacity: 0.1;
            animation: float 6s ease-in-out infinite;
        }
        
        .floating-icon:nth-child(1) {
            top: 20%;
            left: 10%;
            animation-delay: 0s;
        }
        
        .floating-icon:nth-child(2) {
            top: 60%;
            right: 15%;
            animation-delay: 2s;
        }
        
        .floating-icon:nth-child(3) {
            bottom: 20%;
            left: 20%;
            animation-delay: 4s;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(10deg); }
        }
        
        /* Enhanced Player Comparison Styles */
        .comparison-filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            border-radius: 12px;
            border: 1px solid #e9ecef;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .filter-group label {
            font-weight: 600;
            color: #37003c;
            font-size: 0.9rem;
        }
        
        .filter-group select {
            padding: 10px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 0.9rem;
            background: white;
            transition: all 0.3s ease;
        }
        
        .filter-group select:focus {
            outline: none;
            border-color: #37003c;
            box-shadow: 0 0 0 3px rgba(55, 0, 60, 0.1);
        }
        
        .price-range {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .price-range input[type="range"] {
            flex: 1;
            min-width: 60px;
        }
        
        .price-range span {
            font-size: 0.8rem;
            font-weight: 500;
            color: #666;
            min-width: 45px;
        }
        
        .comparison-container {
            margin-top: 20px;
        }
        
        .player-select-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        .player-selector {
            flex: 1;
            min-width: 200px;
        }
        
        .player-selector label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #37003c;
        }
        
        .search-container {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .search-container input {
            padding: 10px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        
        .search-container input:focus {
            outline: none;
            border-color: #37003c;
            box-shadow: 0 0 0 3px rgba(55, 0, 60, 0.1);
        }
        
        .player-selector select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            background: white;
            transition: all 0.3s ease;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .player-selector select:focus {
            outline: none;
            border-color: #37003c;
            box-shadow: 0 0 0 3px rgba(55, 0, 60, 0.1);
        }
        
        .vs-divider {
            font-size: 1.5rem;
            font-weight: 800;
            color: #37003c;
            padding: 0 15px;
            background: linear-gradient(135deg, #37003c, #6f42c1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .comparison-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            padding: 40px;
            text-align: center;
            color: #666;
        }
        
        .comparison-stats {
            margin-top: 20px;
        }
        
        .comparison-stats.has-data {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 20px;
        }
        
        .no-comparison {
            text-align: center;
            padding: 40px 20px;
            color: #666;
            font-style: italic;
        }
        
        .player-comparison-card {
            background: linear-gradient(135deg, rgba(55,0,60,0.05), rgba(111,66,193,0.05));
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .player-comparison-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #37003c, #6f42c1);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .player-comparison-card.winner {
            border-color: #28a745;
            background: linear-gradient(135deg, rgba(40,167,69,0.1), rgba(32,201,151,0.1));
        }
        
        .player-comparison-card.winner::before {
            opacity: 1;
            background: linear-gradient(90deg, #28a745, #20c997);
        }
        
        .player-header {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(55,0,60,0.1);
        }
        
        .player-header h4 {
            margin: 0 0 5px 0;
            font-size: 1.2rem;
            color: #37003c;
        }
        
        .player-info {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 8px;
        }
        
        .comparison-stat-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .comparison-stat-list li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(0,0,0,0.1);
            transition: background-color 0.3s ease;
        }
        
        .comparison-stat-list li:hover {
            background-color: rgba(55,0,60,0.03);
        }
        
        .comparison-stat-list li:last-child {
            border-bottom: none;
        }
        
        .stat-label {
            font-weight: 500;
            color: #333;
        }
        
        .stat-value {
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 6px;
            transition: all 0.3s ease;
        }
        
        .stat-better {
            color: #28a745;
            background: rgba(40,167,69,0.1);
        }
        
        .comparison-vs {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .vs-badge {
            background: linear-gradient(135deg, #37003c, #6f42c1);
            color: white;
            padding: 15px 20px;
            border-radius: 50%;
            font-weight: 800;
            font-size: 1.2rem;
            box-shadow: 0 5px 15px rgba(55,0,60,0.3);
        }
        
        .stats-toggle {
            margin-top: 25px;
            text-align: center;
        }
        
        .toggle-switch {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            user-select: none;
        }
        
        .toggle-switch input {
            display: none;
        }
        
        .toggle-slider {
            width: 50px;
            height: 24px;
            background: #ccc;
            border-radius: 24px;
            position: relative;
            transition: background 0.3s ease;
        }
        
        .toggle-slider::before {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
        }
        
        .toggle-switch input:checked + .toggle-slider {
            background: #37003c;
        }
        
        .toggle-switch input:checked + .toggle-slider::before {
            transform: translateX(26px);
        }
        
        .toggle-label {
            font-weight: 500;
            color: #37003c;
        }
        
        .advanced-stats {
            display: none;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(0,0,0,0.1);
        }
        
        .advanced-stats.show {
            display: block;
        }
        
        /* Team Builder Styles */
        .team-builder {
            margin-top: 15px;
        }
        
        .budget-display {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #37003c, #6f42c1);
            border-radius: 15px;
            color: white;
        }
        
        .budget-remaining {
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: 5px;
        }
        
        .budget-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .position-slot {
            margin-bottom: 15px;
        }
        
        .slot-header {
            font-weight: 600;
            color: #37003c;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }
        
        .player-slot {
            background: #f8f9fa;
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 5px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .player-slot:hover {
            border-color: #37003c;
            background: rgba(55,0,60,0.05);
        }
        
        .player-slot.filled {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border-style: solid;
            border-color: #28a745;
        }
        
        .slot-text {
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .team-actions {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .team-action-btn {
            padding: 10px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .save-btn {
            background: linear-gradient(135deg, #2ed573, #1dd1a1);
            color: white;
        }

        .save-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(46,213,115,0.3);
        }

        .load-btn {
            background: linear-gradient(135deg, #3742fa, #2f3542);
            color: white;
        }

        .load-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(55,66,250,0.3);
        }

        .reset-btn {
            background: linear-gradient(135deg, #dc3545, #e74c3c);
            color: white;
        }

        .reset-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(220,53,69,0.3);
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            padding: 20px;
            box-sizing: border-box;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            width: 100%;
            max-width: 600px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            background: linear-gradient(135deg, #37003c, #6f42c1);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 1.3rem;
        }

        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.8rem;
            cursor: pointer;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s ease;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .modal-body {
            padding: 20px;
            max-height: calc(80vh - 80px);
            overflow-y: auto;
        }

        .player-search {
            margin-bottom: 15px;
        }

        .player-search input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            box-sizing: border-box;
        }

        .player-search input:focus {
            outline: none;
            border-color: #37003c;
        }

        .position-filter {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .position-filter select {
            padding: 8px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 0.9rem;
        }

        .players-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .player-option {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .player-option:hover {
            border-color: #37003c;
            background: #f8f9fa;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .player-jersey {
            flex-shrink: 0;
        }

        .jersey-shirt {
            width: 50px;
            height: 60px;
            border-radius: 25px 25px 8px 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }

        .jersey-number {
            font-size: 1.2rem;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .player-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
            flex-grow: 1;
        }

        .player-name {
            font-weight: 600;
            font-size: 1rem;
            color: #333;
        }

        .player-team {
            font-size: 0.8rem;
            color: #666;
        }

        .player-stats {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 2px;
        }

        .player-points {
            font-size: 0.9rem;
            color: #37003c;
            font-weight: 600;
        }

        .player-price {
            font-size: 0.9rem;
            color: #2ed573;
            font-weight: 700;
        }

        .player-ownership {
            font-size: 0.75rem;
            color: #888;
        }

        /* Team builder slot enhancements */
        .player-slot.filled {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border: 2px solid #37003c;
        }

        .player-slot .jersey-mini {
            width: 30px;
            height: 36px;
            border-radius: 15px 15px 5px 5px;
            display: inline-block;
            margin-right: 8px;
            vertical-align: middle;
            box-shadow: 0 1px 4px rgba(0,0,0,0.2);
        }

        /* Football Field Styles - Official FPL Design */
        .football-field {
            background: linear-gradient(180deg, #00ff87 0%, #37003c 100%);
            border-radius: 20px;
            padding: 25px;
            position: relative;
            overflow: hidden;
            border: 3px solid #37003c;
            box-shadow: 
                inset 0 0 0 2px #00ff87,
                0 10px 30px rgba(55, 0, 60, 0.3);
        }

        .football-field::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                linear-gradient(90deg, rgba(255,255,255,0.08) 1px, transparent 1px),
                linear-gradient(rgba(255,255,255,0.08) 1px, transparent 1px);
            background-size: 25px 25px;
            pointer-events: none;
        }

        .football-field::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100px;
            height: 100px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            pointer-events: none;
        }

        .field-background {
            position: relative;
            z-index: 2;
            display: flex;
            flex-direction: column;
            gap: 25px;
            min-height: 400px;
        }

        .field-position {
            display: flex;
            justify-content: space-around;
            align-items: center;
        }

        .goalkeeper-pos {
            justify-content: center;
        }

        .defenders-line {
            justify-content: space-between;
        }

        .midfielders-line {
            justify-content: space-around;
        }

        .forwards-line {
            justify-content: space-around;
        }

        .field-player-slot {
            width: 85px;
            height: 85px;
            background: radial-gradient(circle, #ffffff 0%, #f8f9fa 100%);
            border: 4px solid #37003c;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            box-shadow: 
                0 6px 20px rgba(55, 0, 60, 0.4),
                inset 0 2px 4px rgba(255, 255, 255, 0.3);
        }

        .field-player-slot:hover {
            transform: scale(1.15);
            background: radial-gradient(circle, #ffffff 0%, #e9ecef 100%);
            box-shadow: 
                0 8px 25px rgba(55, 0, 60, 0.5),
                inset 0 2px 4px rgba(255, 255, 255, 0.4);
        }

        .field-player-slot.occupied {
            background: radial-gradient(circle, #ffffff 0%, #f1f3f4 100%);
            border-color: #00ff87;
            box-shadow: 
                0 6px 20px rgba(0, 255, 135, 0.3),
                inset 0 2px 4px rgba(255, 255, 255, 0.3);
        }

        .field-player-slot.occupied:hover {
            box-shadow: 
                0 8px 25px rgba(0, 255, 135, 0.4),
                inset 0 2px 4px rgba(255, 255, 255, 0.4);
        }

        .field-slot-text {
            font-weight: bold;
            font-size: 0.8rem;
            color: #000;
            text-align: center;
            line-height: 1.2;
        }

        .field-player-name {
            font-weight: bold;
            font-size: 0.7rem;
            color: #000;
            text-align: center;
            line-height: 1.1;
        }

        .field-jersey-mini {
            width: 25px;
            height: 30px;
            border-radius: 12px 12px 4px 4px;
            margin-bottom: 2px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }

        .bench-jersey-mini {
            width: 18px;
            height: 22px;
            border-radius: 9px 9px 3px 3px;
            margin-bottom: 2px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        .bench-player-name {
            font-weight: bold;
            font-size: 0.6rem;
            color: #000;
            text-align: center;
            line-height: 1.1;
        }

        /* Update all text colors to black */
        .player-name {
            color: #000 !important;
        }

        .player-team {
            color: #000 !important;
        }

        .slot-text {
            color: #000 !important;
        }

        .formation-info p {
            color: #000 !important;
        }

        /* Starting XI Selection Modal */
        .starting-xi-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .starting-xi-option {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #fff;
        }

        .starting-xi-option:hover {
            border-color: #37003c;
            background: #f8f9fa;
            transform: translateY(-2px);
        }

        .starting-xi-option .player-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .starting-xi-option .player-name {
            font-weight: 600;
            font-size: 1rem;
        }

        .starting-xi-option .player-price {
            font-weight: 600;
            color: #2ed573;
        }

        /* Player Stats Modal */
        .player-stats-modal {
            max-width: 500px;
        }

        .player-stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            border: 2px solid #dee2e6;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #37003c;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.8rem;
            color: #666;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .player-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .action-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
        }

        .remove-btn {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
        }

        .remove-btn:hover {
            background: linear-gradient(135deg, #c82333, #a71e2a);
            transform: translateY(-2px);
        }

        .change-btn {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
        }

        .change-btn:hover {
            background: linear-gradient(135deg, #0056b3, #004085);
            transform: translateY(-2px);
        }

        /* Team Header */
        .team-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .team-header h3 {
            margin: 0;
            color: #000;
        }

        .budget-display {
            text-align: center;
            padding: 10px 20px;
            background: linear-gradient(135deg, #37003c, #6f42c1);
            border-radius: 10px;
            color: white;
            box-shadow: 0 4px 12px rgba(55, 0, 60, 0.3);
        }

        .budget-remaining {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 2px;
        }

        .budget-label {
            font-size: 0.8rem;
            opacity: 0.9;
        }

        /* Substitutes Bench */
        .substitutes-bench {
            margin: 25px 0;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
            border: 2px solid #dee2e6;
        }

        .bench-players {
            display: flex;
            justify-content: space-around;
            gap: 15px;
        }

        .bench-slot {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
        }

        .bench-position {
            font-size: 0.7rem;
            font-weight: bold;
            color: #666;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .bench-player-slot {
            width: 70px;
            height: 70px;
            background: radial-gradient(circle, #ffffff 0%, #f8f9fa 100%);
            border: 3px solid #6c757d;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
        }

        .bench-player-slot:hover {
            transform: scale(1.1);
            background: radial-gradient(circle, #ffffff 0%, #e9ecef 100%);
            box-shadow: 0 6px 16px rgba(108, 117, 125, 0.4);
        }

        .bench-player-slot.occupied {
            background: radial-gradient(circle, #ffffff 0%, #f1f3f4 100%);
            border-color: #28a745;
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }

        .bench-slot-text {
            font-weight: bold;
            font-size: 0.7rem;
            color: #000;
            text-align: center;
        }

        .bench-player-name {
            font-weight: bold;
            font-size: 0.6rem;
            color: #000;
            text-align: center;
            line-height: 1.1;
        }

        .bench-jersey-mini {
            width: 20px;
            height: 24px;
            border-radius: 10px 10px 3px 3px;
            margin-bottom: 2px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }
        
        /* Enhanced Animations */
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .fpl-card {
            animation: slideInUp 0.6s ease-out;
        }
        
        .captain-card {
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .captain-card:hover {
            animation: pulse 2s infinite;
        }
        
        /* Touch-friendly enhancements for mobile */
        @media (hover: none) and (pointer: coarse) {
            .captain-card:hover,
            .player-card:hover,
            .fpl-card:hover {
                transform: none !important;
                box-shadow: 0 4px 15px rgba(0,0,0,0.1) !important;
            }
            
            .fpl-btn {
                min-height: 44px;
                min-width: 44px;
            }
        }
        
        /* Live Stats Panel Styles */
        .live-stats-panel {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(40,167,69,0.2);
            position: relative;
            overflow: hidden;
        }
        
        .live-stats-panel::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }
        
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .live-stats-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            position: relative;
            z-index: 2;
        }
        
        .live-stats-header h3 {
            margin: 0;
            color: white !important;
            font-size: 1.3rem;
        }
        
        .live-stats-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        
        .live-stats-info {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 15px;
            position: relative;
            z-index: 2;
        }
        
        .stat-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
            position: relative;
        }

        
        .info-label {
            font-size: 0.8rem;
            opacity: 0.8;
            font-weight: 500;
        }
        
        .info-value {
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        /* Loading Spinner Styles */
        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        /* Enhanced Mobile Responsiveness */
        @media (max-width: 768px) {
            .header-stats {
                gap: 15px;
            }
            
            .stat-bubble {
                padding: 12px 20px;
            }
            
            .stat-number {
                font-size: 1.5rem;
            }
            
            .player-select-container {
                flex-direction: column;
                gap: 15px;
            }
            
            .vs-divider {
                order: 2;
                padding: 10px 0;
            }
            
            .comparison-stats {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .live-stats-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .live-stats-controls {
                justify-content: center;
            }
            
            .live-stats-info {
                justify-content: center;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="header" include="./header.html"></div>

    <!-- Premium Membership Gate -->
    <div id="premium-gate" class="premium-gate-overlay" style="display: none;">
        <div class="premium-gate-content">
            <div class="gate-header">
                <h2>🔒 Premium FPL Content Ahead!</h2>
                <p>This Fantasy Premier League hub is exclusive to our Premium Starter members</p>
            </div>
            
            <div class="gate-benefits">
                <h3>Join Premium Starter for only <span class="price">$2.00/month</span></h3>
                <p class="benefits-intro">Get exclusive access to:</p>
                <ul class="benefits-list">
                    <li>✅ <strong>5 exclusive articles per week</strong> - In-depth analysis you won't find anywhere else</li>
                    <li>✅ <strong>Latest transfer rumors</strong> - Breaking news before it hits mainstream media</li>
                    <li>✅ <strong>Weekly team and match analysis</strong> - Expert tactical breakdowns</li>
                    <li>✅ <strong>Access to all articles</strong> - Full archive of premium content</li>
                    <li>✅ <strong>FPL pro advice and suggested teams</strong> - Weekly fantasy lineups from experts</li>
                    <li>✅ <strong>Ad-free browsing</strong> - Clean, uninterrupted reading experience</li>
                    <li>✅ <strong>Premium Fantasy Football Hub</strong> - Advanced FPL strategies and insider tips</li>
                </ul>
            </div>
            
            <div class="gate-actions">
                <button class="join-premium-btn" onclick="joinPremiumStarter()">
                    Join Premium Starter - $2/month
                </button>
                <p class="gate-subtext">Cancel anytime • Instant access • 30-day money-back guarantee</p>
            </div>
            
            <div class="gate-footer">
                <p>Already a member? <a href="/signin.html" class="signin-link">Sign in here</a></p>
            </div>
        </div>
    </div>

    <!-- Main Content Area -->
    <main class="main-content">
        <div class="fpl-container">
            <div class="fpl-header">
                <div class="header-content">
                    <h1>⚽ Premier League Fantasy Hub</h1>
                    <p>Your complete guide to FPL success with expert tips, analysis, and strategies</p>
                    <div class="header-stats">
                        <div class="stat-bubble">
                            <div class="stat-number" id="total-managers">9.2M+</div>
                            <div class="stat-label">Active Managers</div>
                        </div>
                        <div class="stat-bubble">
                            <div class="stat-number" id="avg-score">45</div>
                            <div class="stat-label">Average GW Score</div>
                        </div>
                        <div class="stat-bubble">
                            <div class="stat-number" id="top-scorer">127</div>
                            <div class="stat-label">Highest GW Score</div>
                        </div>
                    </div>
                </div>
                <div class="header-animation">
                    <div class="floating-icon">⚽</div>
                    <div class="floating-icon">🏆</div>
                    <div class="floating-icon">📊</div>
                </div>
            </div>

            <div class="deadline-timer">
                <h3>⏰ Next Deadline</h3>
                <div id="countdown">Gameweek 1 approaching (season launch confirmed, first matches mid-August 2025)</div>
            </div>

            <!-- 2025/26 Season Preview -->
            <div class="fpl-card">
                <h2>🚀 2025/26 Season Preview: Price Reveals & Predictions</h2>
                <p style="margin-bottom: 20px; color: #666;">The first FPL prices for 2025/26 are here! New signings, performance adjustments, and strategic insights for Gameweek 1.</p>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 25px;">
                    <!-- Premium Forwards -->
                    <div style="background: linear-gradient(135deg, #ff9500, #ff6b35); color: white; padding: 20px; border-radius: 12px;">
                        <h3 style="margin: 0 0 15px 0;">⚽ Premium Forwards</h3>
                        <div style="space-y: 8px;">
                            <div><strong>Haaland (MCI): £14.0m</strong> ↓ from £15.0m - 27 goals in 2024/25</div>
                            <div><strong>Salah (LIV): £14.5m</strong> ↑ from £13.6m - Record 344 points, most expensive midfielder ever</div>
                            <div><strong>Isak (NEW): £10.5m</strong> ↑ from £8.5m - 23 goals, penalty taker</div>
                        </div>
                    </div>
                    
                    <!-- Midfield Essentials -->
                    <div style="background: linear-gradient(135deg, #00c9ff, #92fe9d); color: white; padding: 20px; border-radius: 12px;">
                        <h3 style="margin: 0 0 15px 0;">🎯 Midfield Must-Haves</h3>
                        <div style="space-y: 8px;">
                            <div><strong>Palmer (CHE): £10.5m</strong> ↑ from £6.5m - 22 goals, 11 assists</div>
                            <div><strong>Saka (ARS): £10.0m</strong> Unchanged - 16 goals, 9 assists</div>
                            <div><strong>Wirtz (LIV): £8.5m</strong> NEW signing - 10 goals, 12 assists in Bundesliga</div>
                        </div>
                    </div>
                </div>

                <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; border-left: 4px solid #37003c;">
                    <h4 style="color: #37003c; margin: 0 0 10px 0;">💡 Key Insight</h4>
                    <p style="margin: 0; color: #333;">New defensive contribution rule: +2 points for 10 CBIT (clearances, blocks, interceptions, tackles) for defenders, +12 for mids/forwards. This favors industrious midfielders like Bruno Fernandes.</p>
                </div>
            </div>

            <!-- Gameweek 1 Predictions -->
            <div class="fpl-card">
                <h2>🎯 Gameweek 1: Optimal Lineup & Captain Picks</h2>
                <p style="margin-bottom: 20px; color: #666;">Our recommended starting XI for GW1 based on fixtures, form, and value (£99.5m total).</p>
                
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px; border-radius: 15px; margin-bottom: 25px;">
                    <h3 style="margin: 0 0 20px 0; text-align: center;">🏆 Recommended GW1 Lineup (3-4-3)</h3>
                    
                    <!-- Formation Display -->
                    <div style="position: relative; background: rgba(0,0,0,0.1); border-radius: 12px; padding: 20px; min-height: 300px;">
                        <!-- Forwards -->
                        <div style="display: flex; justify-content: space-around; margin-bottom: 40px;">
                            <div style="text-align: center; background: rgba(255,255,255,0.2); padding: 10px; border-radius: 8px; min-width: 80px;">
                                <div style="font-weight: bold;">Haaland</div>
                                <div style="font-size: 0.9em;">MCI £14.0m</div>
                            </div>
                            <div style="text-align: center; background: rgba(255,255,255,0.2); padding: 10px; border-radius: 8px; min-width: 80px;">
                                <div style="font-weight: bold;">Isak</div>
                                <div style="font-size: 0.9em;">NEW £10.5m</div>
                            </div>
                            <div style="text-align: center; background: rgba(255,255,255,0.2); padding: 10px; border-radius: 8px; min-width: 80px;">
                                <div style="font-weight: bold;">Watkins</div>
                                <div style="font-size: 0.9em;">AVL £9.0m</div>
                            </div>
                        </div>
                        
                        <!-- Midfielders -->
                        <div style="display: flex; justify-content: space-around; margin-bottom: 40px;">
                            <div style="text-align: center; background: rgba(255,255,255,0.2); padding: 10px; border-radius: 8px; min-width: 70px;">
                                <div style="font-weight: bold;">Salah</div>
                                <div style="font-size: 0.9em;">LIV £14.5m</div>
                            </div>
                            <div style="text-align: center; background: rgba(255,255,255,0.2); padding: 10px; border-radius: 8px; min-width: 70px;">
                                <div style="font-weight: bold;">Palmer</div>
                                <div style="font-size: 0.9em;">CHE £10.5m</div>
                            </div>
                            <div style="text-align: center; background: rgba(255,255,255,0.2); padding: 10px; border-radius: 8px; min-width: 70px;">
                                <div style="font-weight: bold;">Saka</div>
                                <div style="font-size: 0.9em;">ARS £10.0m</div>
                            </div>
                            <div style="text-align: center; background: rgba(255,255,255,0.2); padding: 10px; border-radius: 8px; min-width: 70px;">
                                <div style="font-weight: bold;">Bruno</div>
                                <div style="font-size: 0.9em;">MUN £8.5m</div>
                            </div>
                        </div>
                        
                        <!-- Defenders -->
                        <div style="display: flex; justify-content: space-around; margin-bottom: 30px;">
                            <div style="text-align: center; background: rgba(255,255,255,0.2); padding: 10px; border-radius: 8px; min-width: 70px;">
                                <div style="font-weight: bold;">TAA</div>
                                <div style="font-size: 0.9em;">LIV £7.0m</div>
                            </div>
                            <div style="text-align: center; background: rgba(255,255,255,0.2); padding: 10px; border-radius: 8px; min-width: 70px;">
                                <div style="font-weight: bold;">Saliba</div>
                                <div style="font-size: 0.9em;">ARS £6.0m</div>
                            </div>
                            <div style="text-align: center; background: rgba(255,255,255,0.2); padding: 10px; border-radius: 8px; min-width: 70px;">
                                <div style="font-weight: bold;">Aït-Nouri</div>
                                <div style="font-size: 0.9em;">MCI £6.0m</div>
                            </div>
                        </div>
                        
                        <!-- Goalkeeper -->
                        <div style="text-align: center;">
                            <div style="display: inline-block; background: rgba(255,255,255,0.2); padding: 10px; border-radius: 8px; min-width: 80px;">
                                <div style="font-weight: bold;">Raya</div>
                                <div style="font-size: 0.9em;">ARS £5.5m</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Captain Picks -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                    <div style="background: linear-gradient(135deg, #ff6b6b, #ee5a24); color: white; padding: 20px; border-radius: 12px;">
                        <h4 style="margin: 0 0 10px 0;">🔥 Top Captain: Salah</h4>
                        <p style="margin: 0; font-size: 0.9em;">vs Bournemouth (H) - 18 goals, 10 assists in 2024/25. New management boost.</p>
                    </div>
                    <div style="background: linear-gradient(135deg, #4834d4, #686de0); color: white; padding: 20px; border-radius: 12px;">
                        <h4 style="margin: 0 0 10px 0;">⚡ Alternative: Haaland</h4>
                        <p style="margin: 0; font-size: 0.9em;">vs Ipswich (H) - 27 goals. Ipswich conceded 12 goals in promotion season.</p>
                    </div>
                    <div style="background: linear-gradient(135deg, #00d2d3, #54a0ff); color: white; padding: 20px; border-radius: 12px;">
                        <h4 style="margin: 0 0 10px 0;">💎 Differential: Palmer</h4>
                        <p style="margin: 0; font-size: 0.9em;">vs Crystal Palace (H) - 22 goals, penalty specialist. Lower ownership.</p>
                    </div>
                </div>
            </div>

            <!-- Value Picks & Strategy -->
            <div class="fpl-card">
                <h2>💰 Value Picks & 2025/26 Strategy Guide</h2>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 25px;">
                    <!-- Budget Options -->
                    <div style="background: #f8f9fa; border: 2px solid #28a745; border-radius: 12px; padding: 20px;">
                        <h3 style="color: #28a745; margin: 0 0 15px 0;">🎯 Budget Gems</h3>
                        <div style="space-y: 10px;">
                            <div><strong>Forwards (&lt;£7.0m):</strong></div>
                            <div>• Wissa (BRE) £6.5m - 12 goals vs Palace (H)</div>
                            <div>• Durán (AVL) £6.0m - 10 goals, backup to Watkins</div>
                            <div><strong>Midfielders (&lt;£7.0m):</strong></div>
                            <div>• Eze (CRY) £6.5m - 11 goals, 4 assists</div>
                            <div>• Gibbs-White (NFO) £6.0m - 10 goals, 10 assists</div>
                            <div><strong>Defenders (&lt;£5.0m):</strong></div>
                            <div>• Hall (NEW) £4.5m - 2 goals, 8 clean sheets</div>
                            <div>• Andersen (CRY) £4.5m - 1 goal, 10 clean sheets</div>
                        </div>
                    </div>
                    
                    <!-- Fixture Analysis -->
                    <div style="background: #f8f9fa; border: 2px solid #007bff; border-radius: 12px; padding: 20px;">
                        <h3 style="color: #007bff; margin: 0 0 15px 0;">📊 Fixture Difficulty (GW1-3)</h3>
                        <div style="space-y: 10px;">
                            <div><strong>🟢 Easiest Starts:</strong></div>
                            <div>• Liverpool: BOU(H), NEW(A), WOL(H)</div>
                            <div>• Arsenal: LEE(H), SUN(A), EVE(H)</div>
                            <div>• Man City: IPS(H), WBA(A), BRE(H)</div>
                            <div><strong>🔴 Toughest Starts:</strong></div>
                            <div>• Man Utd: ARS(A), LIV(H), MCI(A)</div>
                            <div>• Tottenham: MCI(H), CHE(A), ARS(H)</div>
                            <div><strong>xG Leaders 2024/25:</strong></div>
                            <div>• Man City (76.5), Liverpool (72.8), Arsenal (68.2)</div>
                        </div>
                    </div>
                </div>

                <!-- Strategy Tips -->
                <div style="background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); padding: 20px; border-radius: 12px;">
                    <h3 style="color: #d63031; margin: 0 0 15px 0;">🧠 2025/26 Strategy Tips</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                        <div>
                            <strong>🎯 Captain Strategy:</strong>
                            <ul style="margin: 5px 0; padding-left: 20px;">
                                <li>Start with Haaland/Salah for GW1</li>
                                <li>Save Triple Captain for DGW (GW34)</li>
                                <li>Consider Palmer as differential</li>
                            </ul>
                        </div>
                        <div>
                            <strong>💎 Chip Usage:</strong>
                            <ul style="margin: 5px 0; padding-left: 20px;">
                                <li>Two chip sets (GW1-19, GW20-38)</li>
                                <li>Wildcard post-GW9 for fixture swings</li>
                                <li>Extra free transfers in GW16 (AFCON)</li>
                            </ul>
                        </div>
                        <div>
                            <strong>🔄 New Rules:</strong>
                            <ul style="margin: 5px 0; padding-left: 20px;">
                                <li>+2 points for 10 CBIT (defenders)</li>
                                <li>+12 points for 10 CBIT (mids/forwards)</li>
                                <li>Favors defensive midfielders</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>


            <div class="fpl-grid">
                <div class="main-content">
                    <!-- Captain Picks -->
                    <div class="fpl-card">
                        <h2>🏆 This Week's Captain Picks</h2>
                        <div class="captain-picks">
                            <div class="captain-card premium">
                                <div class="player-name">Mohamed Salah (C)</div>
                                <div class="player-price">£13.0m | Liverpool</div>
                                <div class="fixture">vs BOU (H)</div>
                                <p>Liverpool's talisman starts at home against Bournemouth. With strong form expected under new management and penalties in his arsenal, Salah is a top premium captain option for GW1, especially as a differential if avoiding Haaland.</p>
                            </div>
                            
                            <div class="captain-card">
                                <div class="player-name">Cole Palmer</div>
                                <div class="player-price">£10.5m | Chelsea</div>
                                <div class="fixture">vs CRY (H)</div>
                                <p>Chelsea's penalty taker and creative force faces Crystal Palace at home. Palmer's consistency last season makes him a solid early captain pick, particularly in drafts chasing fixtures.</p>
                            </div>
                            
                            <div class="captain-card">
                                <div class="player-name">Bukayo Saka</div>
                                <div class="player-price">£10.0m | Arsenal</div>
                                <div class="fixture">vs LEE (H)</div>
                                <p>Arsenal's star winger hosts Leeds. Saka's home form and set-piece involvement position him as an excellent alternative captain for those spreading premiums.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Transfer Recommendations -->
                    <div class="fpl-card">
                        <h2>🔄 Transfer Recommendations</h2>
                        <p>Since this is pre-season, focus on initial draft tweaks based on fixtures and prices. Here's updated advice drawing from expert drafts and early analysis:</p>
                        <table class="transfers-table">
                            <thead>
                                <tr>
                                    <th>Transfer Out</th>
                                    <th>Transfer In</th>
                                    <th>Price</th>
                                    <th>Reason</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="transfer-out">Overpriced premiums like Haaland if budget tight</td>
                                    <td class="transfer-in">Isak</td>
                                    <td>£8.5m</td>
                                    <td>Newcastle's favorable early fixtures (home fortress) and Isak's form make him a strong forward enabler; top triple captain candidate early on.</td>
                                </tr>
                                <tr>
                                    <td class="transfer-out">Injury-prone mids like Maddison</td>
                                    <td class="transfer-in">Eze</td>
                                    <td>£7.0m</td>
                                    <td>Crystal Palace's fixtures suit Eze's attacking returns; great for captain chasing in GW4 vs SUN.</td>
                                </tr>
                                <tr>
                                    <td class="transfer-out">High-risk defenders like Digne</td>
                                    <td class="transfer-in">Van Dijk</td>
                                    <td>£6.0m</td>
                                    <td>Liverpool's captain is a nailed starter with defensive contributions; strong for clean sheets in a refreshed backline.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Recommended Team Selection -->
                    <div class="fpl-card">
                        <h2>⭐ Recommended Team (GW1)</h2>
                        <p>Adjusted for the standard £100m budget using latest 2025/26 prices and value picks for balance (total cost: £100.0m):</p>
                        <div class="team-formation">
                            <div class="formation-title">3-5-3 Formation</div>
                            
                            <!-- Forwards -->
                            <div class="formation-line formation-forwards">
                                <div class="player-card">
                                    <div class="player-name">Wissa</div>
                                    <div class="player-team">BRE</div>
                                    <div class="player-price">£6.0m</div>
                                </div>
                                <div class="player-card">
                                    <div class="player-name">Mateta</div>
                                    <div class="player-team">CRY</div>
                                    <div class="player-price">£7.5m</div>
                                </div>
                                <div class="player-card">
                                    <div class="player-name">Wood</div>
                                    <div class="player-team">NFO</div>
                                    <div class="player-price">£6.0m</div>
                                </div>
                            </div>
                            
                            <!-- Midfielders -->
                            <div class="formation-line formation-midfielders">
                                <div class="player-card">
                                    <div class="player-name">Son (C)</div>
                                    <div class="player-team">TOT</div>
                                    <div class="player-price">£10.0m</div>
                                </div>
                                <div class="player-card">
                                    <div class="player-name">Palmer</div>
                                    <div class="player-team">CHE</div>
                                    <div class="player-price">£10.5m</div>
                                </div>
                                <div class="player-card">
                                    <div class="player-name">Saka</div>
                                    <div class="player-team">ARS</div>
                                    <div class="player-price">£10.0m</div>
                                </div>
                                <div class="player-card">
                                    <div class="player-name">Gordon</div>
                                    <div class="player-team">NEW</div>
                                    <div class="player-price">£7.0m</div>
                                </div>
                                <div class="player-card">
                                    <div class="player-name">Luiz</div>
                                    <div class="player-team">AVL</div>
                                    <div class="player-price">£5.5m</div>
                                </div>
                            </div>
                            
                            <!-- Defenders -->
                            <div class="formation-line formation-defenders">
                                <div class="player-card">
                                    <div class="player-name">Alexander-Arnold</div>
                                    <div class="player-team">LIV</div>
                                    <div class="player-price">£7.0m</div>
                                </div>
                                <div class="player-card">
                                    <div class="player-name">Saliba</div>
                                    <div class="player-team">ARS</div>
                                    <div class="player-price">£6.0m</div>
                                </div>
                                <div class="player-card">
                                    <div class="player-name">Andersen</div>
                                    <div class="player-team">CRY</div>
                                    <div class="player-price">£4.5m</div>
                                </div>
                            </div>
                            
                            <!-- Goalkeeper -->
                            <div class="formation-line formation-goalkeeper">
                                <div class="player-card">
                                    <div class="player-name">Pickford</div>
                                    <div class="player-team">EVE</div>
                                    <div class="player-price">£5.5m</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Bench Players -->
                        <div style="margin-top: 20px;">
                            <h4 style="color: #37003c; margin-bottom: 15px; font-size: 1.1rem;">🪑 Bench</h4>
                            <div style="display: flex; gap: 15px; flex-wrap: wrap; justify-content: center;">
                                <div class="player-card" style="background: linear-gradient(145deg, #f8f9fa 0%, #e9ecef 100%); border-color: #6c757d; opacity: 0.8;">
                                    <div class="player-name">Flekken</div>
                                    <div class="player-team">BRE</div>
                                    <div class="player-price">£4.5m</div>
                                </div>
                                <div class="player-card" style="background: linear-gradient(145deg, #f8f9fa 0%, #e9ecef 100%); border-color: #6c757d; opacity: 0.8;">
                                    <div class="player-name">Lewis</div>
                                    <div class="player-team">MCI</div>
                                    <div class="player-price">£4.5m</div>
                                </div>
                                <div class="player-card" style="background: linear-gradient(145deg, #f8f9fa 0%, #e9ecef 100%); border-color: #6c757d; opacity: 0.8;">
                                    <div class="player-name">Munoz</div>
                                    <div class="player-team">CRY</div>
                                    <div class="player-price">£5.5m</div>
                                </div>
                            </div>
                        </div>
                        <p style="margin-top: 15px; font-style: italic;">This team emphasizes premium mids for captain flexibility, double Liverpool defense for clean sheet potential, and value forwards. Pros: Fixture-proof premiums; Cons: Bench depth limited—plan early transfers.</p>
                    </div>

                    <!-- Enhanced Player Comparison Tool -->
                    <div class="fpl-card">
                        <h2>🔍 Live Player Comparison Tool</h2>
                        <p>Compare players using real-time data from the official FPL API</p>
                        
                        <!-- Player Search and Filters -->
                        <div class="comparison-filters">
                            <div class="filter-group">
                                <label>Position Filter:</label>
                                <select id="position-filter" onchange="filterPlayersByPosition()">
                                    <option value="all">All Positions</option>
                                    <option value="1">Goalkeepers</option>
                                    <option value="2">Defenders</option>
                                    <option value="3">Midfielders</option>
                                    <option value="4">Forwards</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>Team Filter:</label>
                                <select id="team-filter" onchange="filterPlayersByTeam()">
                                    <option value="all">All Teams</option>
                                    <!-- Teams will be populated dynamically -->
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>Price Range:</label>
                                <div class="price-range">
                                    <input type="range" id="min-price" min="4.0" max="15.0" step="0.1" value="4.0" onchange="filterPlayersByPrice()">
                                    <span id="min-price-display">£4.0m</span>
                                    <span>to</span>
                                    <input type="range" id="max-price" min="4.0" max="15.0" step="0.1" value="15.0" onchange="filterPlayersByPrice()">
                                    <span id="max-price-display">£15.0m</span>
                                </div>
                            </div>
                        </div>

                        <div class="comparison-container">
                            <div class="player-select-container">
                                <div class="player-selector">
                                    <label>Player 1:</label>
                                    <div class="search-container">
                                        <input type="text" id="player1-search" placeholder="Search players..." onkeyup="searchPlayers(1)">
                                        <select id="player1-select" onchange="updateComparison()">
                                            <option value="">Select Player 1...</option>
                                            <!-- Players will be populated dynamically -->
                                        </select>
                                    </div>
                                </div>
                                <div class="vs-divider">VS</div>
                                <div class="player-selector">
                                    <label>Player 2:</label>
                                    <div class="search-container">
                                        <input type="text" id="player2-search" placeholder="Search players..." onkeyup="searchPlayers(2)">
                                        <select id="player2-select" onchange="updateComparison()">
                                            <option value="">Select Player 2...</option>
                                            <!-- Players will be populated dynamically -->
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="comparison-loading" id="comparison-loading" style="display: none;">
                                <div class="spinner"></div>
                                <span>Loading player data...</span>
                            </div>
                            
                            <div class="comparison-stats" id="comparison-stats">
                                <div class="no-comparison">
                                    <p>Select two players to compare their statistics</p>
                                </div>
                            </div>
                            
                            <!-- Advanced Stats Toggle -->
                            <div class="stats-toggle">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="advanced-stats-toggle" onchange="toggleAdvancedStats()">
                                    <span class="toggle-slider"></span>
                                    <span class="toggle-label">Show Advanced Stats</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- FPL Tips -->
                    <div class="fpl-tips">
                        <h4>💡 Pro Tips for This Gameweek (GW1 Prep)</h4>
                        <ul>
                            <li>Triple captain early on in-form premiums like Isak or Salah during favorable home games—save the second for DGWs later.</li>
                            <li>Double up on Arsenal/Liverpool defense for early clean sheets, but monitor pre-season rotations.</li>
                            <li>Avoid overloading on Chelsea assets until form stabilizes; Nkunku could be a differential.</li>
                            <li>Newcastle's fixtures are kind—load up on Isak/Gordon for attacking returns.</li>
                            <li>With new rules (e.g., 5 free transfers during AFCON, extra chips), plan wildcards around GW12 and use unlimited tweaks pre-GW1.</li>
                            <li>Monitor pre-season for injuries; bolder drafts without Salah/Haaland can work if nailing captains.</li>
                        </ul>
                    </div>
                </div>

                <div class="sidebar-content">
                    <!-- Gameweek Info -->
                    <div class="gameweek-info">
                        <h3>Current Gameweek</h3>
                        <div class="gameweek-number">Pre-season</div>
                        <p>GW1 fixtures released June 18, 2025</p>
                    </div>

                    <!-- Price Changes -->
                    <div class="fpl-card">
                        <h3>💰 Latest Price Changes</h3>
                        <p>No changes yet (initial prices set at launch; expect rises/falls post-GW1 based on performance).</p>
                    </div>

                    <!-- Quick Stats -->
                    <div class="fpl-card">
                        <h3>📊 Quick Stats</h3>
                        <div class="stats-container">
                            <div class="stat-item">
                                <div class="stat-icon">👑</div>
                                <div class="stat-content">
                                    <div class="stat-label">Most Captained</div>
                                    <div class="stat-value">Son</div>
                                    <div class="stat-desc">Early drafts favor balanced approach</div>
                                </div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-icon">📈</div>
                                <div class="stat-content">
                                    <div class="stat-label">Most Transferred In</div>
                                    <div class="stat-value">Wissa</div>
                                    <div class="stat-desc">Popular budget forward option</div>
                                </div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-icon">📉</div>
                                <div class="stat-content">
                                    <div class="stat-label">Most Transferred Out</div>
                                    <div class="stat-value">Premium Assets</div>
                                    <div class="stat-desc">Haaland/Salah for budget balance</div>
                                </div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-icon">🎯</div>
                                <div class="stat-content">
                                    <div class="stat-label">Best Value</div>
                                    <div class="stat-value">Palmer</div>
                                    <div class="stat-desc">£10.5m, penalties + creativity</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Fixture Difficulty -->
                    <div class="fpl-card">
                        <h3>📅 Fixture Difficulty (Next 5)</h3>
                        <div class="fixture-container">
                            <div class="fixture-tier easy">
                                <div class="tier-header">
                                    <div class="tier-icon">🟢</div>
                                    <div class="tier-title">Easy</div>
                                    <div class="tier-rating">FDR 2-3</div>
                                </div>
                                <div class="tier-teams">Bournemouth, Leeds, Sunderland, Burnley, Fulham</div>
                                <div class="tier-note">Low FDR rankings for attacking teams like Liverpool, Arsenal, Newcastle</div>
                            </div>
                            
                            <div class="fixture-tier moderate">
                                <div class="tier-header">
                                    <div class="tier-icon">🟡</div>
                                    <div class="tier-title">Moderate</div>
                                    <div class="tier-rating">FDR 3-4</div>
                                </div>
                                <div class="tier-teams">Crystal Palace, Newcastle, Brentford</div>
                                <div class="tier-note">Balanced matchups with upset potential</div>
                            </div>
                            
                            <div class="fixture-tier difficult">
                                <div class="tier-header">
                                    <div class="tier-icon">🔴</div>
                                    <div class="tier-title">Difficult</div>
                                    <div class="tier-rating">FDR 4-5</div>
                                </div>
                                <div class="tier-teams">Arsenal, Manchester City, Liverpool</div>
                                <div class="tier-note">Tough for underdogs, but premiums thrive here</div>
                            </div>
                        </div>
                    </div>

                    <!-- New Game 1: Head-to-Head Team Analyzer -->
                    <div class="fpl-card">
                        <h3>⚔️ Team Head-to-Head Analyzer</h3>
                        <p style="margin-bottom: 15px; color: #666; font-size: 0.9rem;">Compare two teams' attacking and defensive stats</p>
                        <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                            <select id="team1-select" style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 5px; color: #000;">
                                <option value="">Select Team 1</option>
                                <option value="1">Arsenal</option>
                                <option value="2">Aston Villa</option>
                                <option value="12">Liverpool</option>
                                <option value="13">Manchester City</option>
                                <option value="14">Manchester United</option>
                                <option value="15">Newcastle</option>
                                <option value="18">Tottenham</option>
                            </select>
                            <span style="padding: 8px; color: #666;">vs</span>
                            <select id="team2-select" style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 5px; color: #000;">
                                <option value="">Select Team 2</option>
                                <option value="1">Arsenal</option>
                                <option value="2">Aston Villa</option>
                                <option value="12">Liverpool</option>
                                <option value="13">Manchester City</option>
                                <option value="14">Manchester United</option>
                                <option value="15">Newcastle</option>
                                <option value="18">Tottenham</option>
                            </select>
                        </div>
                        <div id="team-comparison-result" style="min-height: 60px; background: #f8f9fa; border-radius: 8px; padding: 15px; text-align: center; color: #666;">
                            Select two teams to see head-to-head comparison
                        </div>
                    </div>

                    <!-- New Game 2: Captain Roulette -->
                    <div class="fpl-card">
                        <h3>🎯 Captain Roulette</h3>
                        <p style="margin-bottom: 15px; color: #666; font-size: 0.9rem;">Spin for a surprise captain pick based on fixtures and form</p>
                        <div style="text-align: center; margin-bottom: 15px;">
                            <button id="spin-captain" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 12px 24px; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 1rem;">
                                🎲 Spin Captain
                            </button>
                        </div>
                        <div id="captain-result" style="min-height: 80px; background: #f8f9fa; border-radius: 8px; padding: 15px; text-align: center; color: #666;">
                            Click spin to get your captain recommendation!
                        </div>
                    </div>

                    <!-- New Game 3: FPL Formation Challenge -->
                    <div class="fpl-card">
                        <h3>🔄 Formation Challenge</h3>
                        <p style="margin-bottom: 15px; color: #666; font-size: 0.9rem;">Test different formations and see optimal player combinations</p>
                        <div style="margin-bottom: 15px;">
                            <select id="formation-select" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px; color: #000;">
                                <option value="3-4-3">3-4-3 (Attacking)</option>
                                <option value="3-5-2">3-5-2 (Midfield Control)</option>
                                <option value="4-3-3">4-3-3 (Balanced)</option>
                                <option value="4-4-2">4-4-2 (Classic)</option>
                                <option value="4-5-1">4-5-1 (Defensive)</option>
                                <option value="5-3-2">5-3-2 (Ultra Defensive)</option>
                            </select>
                        </div>
                        <button onclick="analyzeFormation()" style="width: 100%; background: #28a745; color: white; border: none; padding: 10px; border-radius: 5px; font-weight: bold; cursor: pointer; margin-bottom: 15px;">
                            Analyze Formation
                        </button>
                        <div id="formation-analysis" style="min-height: 100px; background: #f8f9fa; border-radius: 8px; padding: 15px; color: #666;">
                            Select a formation and click analyze to see recommendations
                        </div>
                    </div>

                    <!-- New Game 4: Player Performance Predictor -->
                    <div class="fpl-card">
                        <h3>🔮 Player Performance Predictor</h3>
                        <p style="margin-bottom: 15px; color: #666; font-size: 0.9rem;">Predict a player's points for the next gameweek</p>
                        <div style="margin-bottom: 15px;">
                            <select id="predictor-player-select" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px; color: #000;">
                                <option value="">Select a player to predict</option>
                                <option value="salah">Mohamed Salah</option>
                                <option value="haaland">Erling Haaland</option>
                                <option value="palmer">Cole Palmer</option>
                                <option value="saka">Bukayo Saka</option>
                                <option value="son">Son Heung-min</option>
                                <option value="isak">Alexander Isak</option>
                                <option value="bruno">Bruno Fernandes</option>
                                <option value="watkins">Ollie Watkins</option>
                            </select>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                            <input type="number" id="goals-prediction" placeholder="Goals" min="0" max="5" style="padding: 8px; border: 1px solid #ddd; border-radius: 5px; color: #000;">
                            <input type="number" id="assists-prediction" placeholder="Assists" min="0" max="5" style="padding: 8px; border: 1px solid #ddd; border-radius: 5px; color: #000;">
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                            <select id="bonus-prediction" style="padding: 8px; border: 1px solid #ddd; border-radius: 5px; color: #000;">
                                <option value="0">No Bonus</option>
                                <option value="1">1 Bonus Point</option>
                                <option value="2">2 Bonus Points</option>
                                <option value="3">3 Bonus Points</option>
                            </select>
                            <select id="minutes-prediction" style="padding: 8px; border: 1px solid #ddd; border-radius: 5px; color: #000;">
                                <option value="0">Didn't Play</option>
                                <option value="1">1-60 minutes</option>
                                <option value="2">60+ minutes</option>
                            </select>
                        </div>
                        <button onclick="calculatePrediction()" style="width: 100%; background: #6f42c1; color: white; border: none; padding: 10px; border-radius: 5px; font-weight: bold; cursor: pointer; margin-bottom: 15px;">
                            Calculate Points
                        </button>
                        <div id="prediction-result" style="min-height: 80px; background: #f8f9fa; border-radius: 8px; padding: 15px; color: #666;">
                            Make your predictions and calculate expected points!
                        </div>
                    </div>

                    <!-- New Game 5: Budget Optimizer Challenge -->
                    <div class="fpl-card">
                        <h3>💰 Budget Optimizer Challenge</h3>
                        <p style="margin-bottom: 15px; color: #666; font-size: 0.9rem;">Build the highest scoring team within budget constraints</p>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #37003c;">Budget Limit</label>
                                <select id="budget-limit" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px; color: #000;">
                                    <option value="100">£100.0m (Standard)</option>
                                    <option value="90">£90.0m (Hard)</option>
                                    <option value="80">£80.0m (Expert)</option>
                                    <option value="70">£70.0m (Impossible)</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #37003c;">Target Points</label>
                                <select id="target-points" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px; color: #000;">
                                    <option value="60">60+ Points</option>
                                    <option value="70">70+ Points</option>
                                    <option value="80">80+ Points</option>
                                    <option value="90">90+ Points</option>
                                </select>
                            </div>
                        </div>
                        <button onclick="generateOptimalTeam()" style="width: 100%; background: #fd7e14; color: white; border: none; padding: 10px; border-radius: 5px; font-weight: bold; cursor: pointer; margin-bottom: 15px;">
                            Generate Optimal Team
                        </button>
                        <div id="budget-optimizer-result" style="min-height: 120px; background: #f8f9fa; border-radius: 8px; padding: 15px; color: #666;">
                            Select your constraints and generate an optimal team!
                        </div>
                    </div>

                    <!-- New Game 6: Fixture Difficulty Calculator -->
                    <div class="fpl-card">
                        <h3>📊 Fixture Difficulty Calculator</h3>
                        <p style="margin-bottom: 15px; color: #666; font-size: 0.9rem;">Calculate team difficulty over next 5 gameweeks</p>
                        <div style="margin-bottom: 15px;">
                            <select id="fdr-team-select" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px; color: #000;">
                                <option value="">Select a team</option>
                                <option value="arsenal">Arsenal</option>
                                <option value="villa">Aston Villa</option>
                                <option value="liverpool">Liverpool</option>
                                <option value="city">Manchester City</option>
                                <option value="united">Manchester United</option>
                                <option value="newcastle">Newcastle</option>
                                <option value="tottenham">Tottenham</option>
                                <option value="chelsea">Chelsea</option>
                            </select>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                            <button onclick="calculateFDR('attack')" style="background: #28a745; color: white; border: none; padding: 8px; border-radius: 5px; font-weight: bold; cursor: pointer;">
                                Attacking FDR
                            </button>
                            <button onclick="calculateFDR('defense')" style="background: #dc3545; color: white; border: none; padding: 8px; border-radius: 5px; font-weight: bold; cursor: pointer;">
                                Defensive FDR
                            </button>
                        </div>
                        <div id="fdr-result" style="min-height: 100px; background: #f8f9fa; border-radius: 8px; padding: 15px; color: #666;">
                            Select a team and calculation type to see fixture difficulty
                        </div>
                    </div>

                    <!-- New Game 7: Transfer Market Simulator -->
                    <div class="fpl-card">
                        <h3>🔄 Transfer Market Simulator</h3>
                        <p style="margin-bottom: 15px; color: #666; font-size: 0.9rem;">Simulate price changes and transfer timing</p>
                        <div style="margin-bottom: 15px;">
                            <input type="text" id="transfer-search" placeholder="Search for player to transfer..." style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px; color: #000;">
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-size: 0.9rem; color: #666;">Transfer Out</label>
                                <select id="transfer-out-player" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px; color: #000;">
                                    <option value="">Select player</option>
                                    <option value="salah,13.0">Salah (£13.0m)</option>
                                    <option value="haaland,14.0">Haaland (£14.0m)</option>
                                    <option value="palmer,10.5">Palmer (£10.5m)</option>
                                    <option value="saka,10.0">Saka (£10.0m)</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-size: 0.9rem; color: #666;">Transfer In</label>
                                <select id="transfer-in-player" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px; color: #000;">
                                    <option value="">Select player</option>
                                    <option value="son,10.0">Son (£10.0m)</option>
                                    <option value="isak,8.5">Isak (£8.5m)</option>
                                    <option value="watkins,9.0">Watkins (£9.0m)</option>
                                    <option value="bruno,8.5">Bruno (£8.5m)</option>
                                </select>
                            </div>
                        </div>
                        <button onclick="simulateTransfer()" style="width: 100%; background: #20c997; color: white; border: none; padding: 10px; border-radius: 5px; font-weight: bold; cursor: pointer; margin-bottom: 15px;">
                            Simulate Transfer
                        </button>
                        <div id="transfer-result" style="min-height: 100px; background: #f8f9fa; border-radius: 8px; padding: 15px; color: #666;">
                            Select players to simulate transfer and see financial impact
                        </div>
                    </div>

                    <!-- New Game 8: Gameweek Points Predictor -->
                    <div class="fpl-card">
                        <h3>🎯 Gameweek Points Predictor</h3>
                        <p style="margin-bottom: 15px; color: #666; font-size: 0.9rem;">Predict your team's total points for the upcoming gameweek</p>
                        <div style="margin-bottom: 15px;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-size: 0.9rem; color: #666;">Captain Choice</label>
                                    <select id="captain-choice" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px; color: #000;">
                                        <option value="salah,16">Salah (16 pts)</option>
                                        <option value="haaland,18">Haaland (18 pts)</option>
                                        <option value="palmer,12">Palmer (12 pts)</option>
                                        <option value="saka,10">Saka (10 pts)</option>
                                    </select>
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-size: 0.9rem; color: #666;">Difficulty Level</label>
                                    <select id="difficulty-level" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px; color: #000;">
                                        <option value="easy">Easy Fixtures</option>
                                        <option value="medium">Medium Fixtures</option>
                                        <option value="hard">Hard Fixtures</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-size: 0.9rem; color: #666;">Risk Level</label>
                            <div style="display: flex; gap: 10px;">
                                <label style="display: flex; align-items: center; font-size: 0.9rem;">
                                    <input type="radio" name="risk-level" value="safe" style="margin-right: 5px;"> Safe (60-70 pts)
                                </label>
                                <label style="display: flex; align-items: center; font-size: 0.9rem;">
                                    <input type="radio" name="risk-level" value="balanced" checked style="margin-right: 5px;"> Balanced (70-85 pts)
                                </label>
                                <label style="display: flex; align-items: center; font-size: 0.9rem;">
                                    <input type="radio" name="risk-level" value="aggressive" style="margin-right: 5px;"> Aggressive (85+ pts)
                                </label>
                            </div>
                        </div>
                        <button onclick="predictGameweekPoints()" style="width: 100%; background: #e83e8c; color: white; border: none; padding: 10px; border-radius: 5px; font-weight: bold; cursor: pointer; margin-bottom: 15px;">
                            Predict Points
                        </button>
                        <div id="gameweek-prediction-result" style="min-height: 100px; background: #f8f9fa; border-radius: 8px; padding: 15px; color: #666;">
                            Configure your team settings and get a gameweek points prediction!
                        </div>
                    </div>
                    
                    <!-- Team Builder with Formation and Bench -->
                    <div class="fpl-card">
                        <div class="team-header">
                            <h3>⚽ Build Your Team</h3>
                            <div class="budget-display">
                                <div class="budget-remaining" id="budget-remaining">£100.0m</div>
                                <div class="budget-label">Remaining Budget</div>
                            </div>
                        </div>
                        <p style="font-size: 0.9rem; margin-bottom: 20px; color: #000;">Click any position to select players • 330+ Premier League players available</p>
                        <div class="football-field">
                            <div class="field-background">
                                <!-- Goalkeeper -->
                                <div class="field-position goalkeeper-pos">
                                    <div class="field-player-slot" data-position="gk" data-slot="0">
                                        <span class="field-slot-text">GK</span>
                                    </div>
                                </div>
                                
                                <!-- Defenders (4) -->
                                <div class="field-position defenders-line">
                                    <div class="field-player-slot" data-position="def" data-slot="0">
                                        <span class="field-slot-text">DEF</span>
                                    </div>
                                    <div class="field-player-slot" data-position="def" data-slot="1">
                                        <span class="field-slot-text">DEF</span>
                                    </div>
                                    <div class="field-player-slot" data-position="def" data-slot="2">
                                        <span class="field-slot-text">DEF</span>
                                    </div>
                                    <div class="field-player-slot" data-position="def" data-slot="3">
                                        <span class="field-slot-text">DEF</span>
                                    </div>
                                </div>
                                
                                <!-- Midfielders (3) -->
                                <div class="field-position midfielders-line">
                                    <div class="field-player-slot" data-position="mid" data-slot="0">
                                        <span class="field-slot-text">MID</span>
                                    </div>
                                    <div class="field-player-slot" data-position="mid" data-slot="1">
                                        <span class="field-slot-text">MID</span>
                                    </div>
                                    <div class="field-player-slot" data-position="mid" data-slot="2">
                                        <span class="field-slot-text">MID</span>
                                    </div>
                                </div>
                                
                                <!-- Forwards (3) -->
                                <div class="field-position forwards-line">
                                    <div class="field-player-slot" data-position="fwd" data-slot="0">
                                        <span class="field-slot-text">FWD</span>
                                    </div>
                                    <div class="field-player-slot" data-position="fwd" data-slot="1">
                                        <span class="field-slot-text">FWD</span>
                                    </div>
                                    <div class="field-player-slot" data-position="fwd" data-slot="2">
                                        <span class="field-slot-text">FWD</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Substitutes Bench -->
                        <div class="substitutes-bench">
                            <h4 style="color: #000; text-align: center; margin-bottom: 15px;">📋 Substitutes</h4>
                            <div class="bench-players">
                                <div class="bench-slot" data-position="gk" data-slot="1">
                                    <div class="bench-position">GK</div>
                                    <div class="bench-player-slot">
                                        <span class="bench-slot-text">+ GK</span>
                                    </div>
                                </div>
                                <div class="bench-slot" data-position="def" data-slot="4">
                                    <div class="bench-position">DEF</div>
                                    <div class="bench-player-slot">
                                        <span class="bench-slot-text">+ DEF</span>
                                    </div>
                                </div>
                                <div class="bench-slot" data-position="mid" data-slot="3">
                                    <div class="bench-position">MID</div>
                                    <div class="bench-player-slot">
                                        <span class="bench-slot-text">+ MID</span>
                                    </div>
                                </div>
                                <div class="bench-slot" data-position="mid" data-slot="4">
                                    <div class="bench-position">MID</div>
                                    <div class="bench-player-slot">
                                        <span class="bench-slot-text">+ MID</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="team-actions">
                            <button class="team-action-btn save-btn" onclick="saveTeam()">💾 Save Team</button>
                            <button class="team-action-btn load-btn" onclick="loadTeam()">📁 Load Team</button>
                            <button class="team-action-btn reset-btn" onclick="resetTeam()">🔄 Reset Team</button>
                        </div>
                        
                        <div class="formation-info">
                            <p style="color: #000; font-size: 0.8rem; text-align: center; margin-top: 15px;">
                                Starting XI (4-3-3) + 4 Substitutes • Right-click players for stats
                            </p>
                        </div>
                    </div>

                    <!-- New Stats Section -->
                    <div class="fpl-card">
                        <h3>🆕 Advanced Analytics</h3>
                        <div style="line-height: 1.6; font-size: 0.9rem;">
                            <p><strong>Value per Million (Projected):</strong> Palmer leads at ~8.5 points/m (based on last season + fixtures); Isak ~7.2/m as budget king.</p>
                            <p><strong>Captain Risk Index:</strong> Salah (Low risk: Home vs easy; 85% haul chance); Haaland (Medium: Form-dependent; 70%).</p>
                            <p><strong>Differential Ownership:</strong> Eze <10%—high upside for ranks; Van Dijk ~15% for set-piece threat.</p>
                            <p><strong>Chip Usage Projection:</strong> 60% plan Triple Captain in GW1-10 (e.g., Isak home); Wildcard 1 by GW12 for fixture turns.</p>
                            <p><strong>Team Balance Score:</strong> Recommended team above scores 8/10 (strong attack, solid defense).</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div class="footer" include="./footer.html"></div>
    <script src="./index.js"></script>
    <script src="./ad-target-blank.js"></script>
    
    <style>
        /* Premium Gate Styles */
        .premium-gate-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            box-sizing: border-box;
        }
        
        .premium-gate-content {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            border: 3px solid #37003c;
            text-align: center;
            animation: gateSlideIn 0.5s ease-out;
        }
        
        @keyframes gateSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .gate-header h2 {
            color: #37003c;
            font-size: 2.2rem;
            margin-bottom: 15px;
            font-weight: 800;
        }
        
        .gate-header p {
            color: #666;
            font-size: 1.2rem;
            margin-bottom: 30px;
        }
        
        .gate-benefits h3 {
            color: #37003c;
            font-size: 1.6rem;
            margin-bottom: 20px;
            font-weight: 700;
        }
        
        .price {
            color: #28a745;
            font-weight: 800;
            font-size: 1.8rem;
        }
        
        .benefits-intro {
            font-size: 1.1rem;
            color: #666;
            margin-bottom: 20px;
        }
        
        .benefits-list {
            text-align: left;
            list-style: none;
            padding: 0;
            margin: 20px 0;
        }
        
        .benefits-list li {
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
            font-size: 1rem;
            line-height: 1.6;
            color: #333;
        }
        
        .benefits-list li:last-child {
            border-bottom: none;
        }
        
        .join-premium-btn {
            background: linear-gradient(135deg, #37003c, #6f42c1);
            color: white;
            border: none;
            padding: 18px 36px;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
            box-shadow: 0 8px 25px rgba(55, 0, 60, 0.3);
        }
        
        .join-premium-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(55, 0, 60, 0.4);
        }
        
        .gate-subtext {
            font-size: 0.9rem;
            color: #666;
            margin-top: 15px;
        }
        
        .gate-footer {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
        }
        
        .signin-link {
            color: #37003c;
            text-decoration: none;
            font-weight: 600;
        }
        
        .signin-link:hover {
            text-decoration: underline;
        }
        
        /* Hide main content when gate is active */
        .content-blocked {
            filter: blur(5px);
            pointer-events: none;
            user-select: none;
        }
        
        /* Mobile responsiveness for gate */
        @media (max-width: 768px) {
            .premium-gate-content {
                padding: 30px 20px;
                margin: 10px;
            }
            
            .gate-header h2 {
                font-size: 1.8rem;
            }
            
            .join-premium-btn {
                padding: 16px 28px;
                font-size: 1.1rem;
            }
        }
    </style>

    <script>
        // Premium membership gate functionality
        let userAuthenticated = false;
        let userHasPremium = false;
        
        // Check authentication and membership status
        function checkPremiumAccess() {
            if (window.onAuthStateChanged && window.auth) {
                window.onAuthStateChanged(window.auth, (user) => {
                    if (user) {
                        userAuthenticated = true;
                        // Check for premium membership status
                        checkMembershipStatus(user);
                    } else {
                        // User not signed in - show gate
                        showPremiumGate();
                    }
                });
            } else {
                // Firebase not loaded - show gate
                setTimeout(checkPremiumAccess, 1000);
            }
        }
        
        function checkMembershipStatus(user) {
            // Special admin accounts with Pro membership
            if (user.email === 'reidwcoleman@gmail.com' || user.email === 'brianpcoleman@gmail.com') {
                // Grant Pro membership access to admin accounts
                const adminMembership = {
                    plan: 'pro',
                    status: 'active',
                    startDate: new Date().toISOString(),
                    nextBilling: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString() // 30 days from now
                };
                localStorage.setItem('membership', JSON.stringify(adminMembership));
                userHasPremium = true;
                hidePremiumGate();
                return;
            }
            
            // Check localStorage for membership info
            const membershipInfo = localStorage.getItem('membership');
            
            if (membershipInfo) {
                const membership = JSON.parse(membershipInfo);
                // Check if user has starter or pro membership
                if (membership.plan === 'starter' || membership.plan === 'pro' || 
                    membership.plan === 'starter-annual' || membership.plan === 'pro-annual') {
                    userHasPremium = true;
                    hidePremiumGate();
                } else {
                    showPremiumGate();
                }
            } else {
                // No membership found - show gate
                showPremiumGate();
            }
        }
        
        function showPremiumGate() {
            const gate = document.getElementById('premium-gate');
            const mainContent = document.querySelector('.main-content');
            
            gate.style.display = 'flex';
            if (mainContent) {
                mainContent.classList.add('content-blocked');
            }
            
            // Prevent scrolling on background
            document.body.style.overflow = 'hidden';
            
            // Disable right-click and keyboard shortcuts
            document.addEventListener('contextmenu', preventDefaultAction);
            document.addEventListener('keydown', preventKeyboardShortcuts);
        }
        
        function hidePremiumGate() {
            const gate = document.getElementById('premium-gate');
            const mainContent = document.querySelector('.main-content');
            
            gate.style.display = 'none';
            if (mainContent) {
                mainContent.classList.remove('content-blocked');
            }
            
            // Re-enable scrolling
            document.body.style.overflow = 'auto';
            
            // Re-enable right-click and keyboard shortcuts
            document.removeEventListener('contextmenu', preventDefaultAction);
            document.removeEventListener('keydown', preventKeyboardShortcuts);
        }
        
        function preventDefaultAction(e) {
            e.preventDefault();
            return false;
        }
        
        function preventKeyboardShortcuts(e) {
            // Prevent common shortcuts like F12, Ctrl+U, Ctrl+Shift+I, etc.
            if (e.key === 'F12' || 
                (e.ctrlKey && e.key === 'u') ||
                (e.ctrlKey && e.shiftKey && e.key === 'I') ||
                (e.ctrlKey && e.shiftKey && e.key === 'C') ||
                (e.ctrlKey && e.key === 's')) {
                e.preventDefault();
                return false;
            }
        }
        
        function joinPremiumStarter() {
            // Redirect to membership page with starter plan pre-selected
            window.location.href = '/membership.html#starter';
        }
        
        // Prevent gate dismissal attempts
        document.addEventListener('click', function(e) {
            const gate = document.getElementById('premium-gate');
            const gateContent = document.querySelector('.premium-gate-content');
            
            if (gate.style.display === 'flex' && 
                !gateContent.contains(e.target) && 
                !userHasPremium) {
                e.preventDefault();
                e.stopPropagation();
                return false;
            }
        });
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            checkPremiumAccess();
        });
        
        // Prevent closing gate with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && !userHasPremium) {
                e.preventDefault();
                return false;
            }
        });
    </script>
    
    <script>
        // Countdown timer functionality
        function updateCountdown() {
            // This would normally calculate time until next FPL deadline
            const deadline = new Date('2025-01-27T11:30:00').getTime();
            const now = new Date().getTime();
            const timeLeft = deadline - now;
            
            if (timeLeft > 0) {
                const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
                const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                
                document.getElementById('countdown').textContent = 
                    `${days} days, ${hours} hours, ${minutes} minutes`;
            } else {
                document.getElementById('countdown').textContent = 'Gameweek in progress';
            }
        }
        
        // Update countdown every minute
        updateCountdown();
        setInterval(updateCountdown, 60000);
        
        // Live FPL API Integration
        class FPLLiveStats {
            constructor() {
                this.baseURL = 'https://fantasy.premierleague.com/api';
                this.corsProxies = [
                    'https://corsproxy.io/?',
                    'https://api.codetabs.com/v1/proxy?quest=',
                    'https://cors-anywhere.herokuapp.com/'
                ];
                this.cache = {};
                this.lastFetch = {};
                this.cacheExpiry = 5 * 60 * 1000; // 5 minutes
                this.currentProxyIndex = 0;
            }

            async fetchWithCache(endpoint) {
                const now = Date.now();
                if (this.cache[endpoint] && (now - this.lastFetch[endpoint]) < this.cacheExpiry) {
                    return this.cache[endpoint];
                }

                // Try multiple CORS proxies
                for (let i = 0; i < this.corsProxies.length; i++) {
                    try {
                        const proxyIndex = (this.currentProxyIndex + i) % this.corsProxies.length;
                        const proxy = this.corsProxies[proxyIndex];
                        const url = `${proxy}${encodeURIComponent(this.baseURL + endpoint)}`;
                        
                        const response = await fetch(url, {
                            method: 'GET',
                            headers: {
                                'Accept': 'application/json',
                                'Content-Type': 'application/json'
                            }
                        });
                        
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        
                        const data = await response.json();
                        this.cache[endpoint] = data;
                        this.lastFetch[endpoint] = now;
                        this.currentProxyIndex = proxyIndex; // Use working proxy next time
                        return data;
                        
                    } catch (error) {
                        console.warn(`Proxy ${this.corsProxies[(this.currentProxyIndex + i) % this.corsProxies.length]} failed for ${endpoint}:`, error);
                        continue;
                    }
                }

                // If all proxies fail, return fallback data
                console.error(`All CORS proxies failed for ${endpoint}. Using fallback data.`);
                return this.getFallbackData(endpoint);
            }

            getFallbackData(endpoint) {
                if (endpoint === '/bootstrap-static/') {
                    return this.getFallbackBootstrap();
                } else if (endpoint.includes('/event/') && endpoint.includes('/live/')) {
                    return this.getFallbackLiveData();
                }
                return null;
            }

            getFallbackBootstrap() {
                const currentDate = new Date();
                const gameweekNumber = Math.max(1, Math.min(38, Math.floor((currentDate.getTime() - new Date('2024-08-17').getTime()) / (7 * 24 * 60 * 60 * 1000)) + 1));
                
                return {
                    events: Array.from({length: 38}, (_, i) => ({
                        id: i + 1,
                        name: `Gameweek ${i + 1}`,
                        is_current: i + 1 === gameweekNumber,
                        is_previous: i + 1 === gameweekNumber - 1,
                        is_next: i + 1 === gameweekNumber + 1,
                        average_entry_score: 45 + Math.floor(Math.random() * 30),
                        finished: i + 1 < gameweekNumber
                    })),
                    total_players: 9200000 + Math.floor(Math.random() * 100000),
                    elements: this.getFallbackPlayers(),
                    teams: this.getFallbackTeams(),
                    element_types: [
                        { id: 1, singular_name: 'Goalkeeper', singular_name_short: 'GKP' },
                        { id: 2, singular_name: 'Defender', singular_name_short: 'DEF' },
                        { id: 3, singular_name: 'Midfielder', singular_name_short: 'MID' },
                        { id: 4, singular_name: 'Forward', singular_name_short: 'FWD' }
                    ]
                };
            }

            getFallbackTeams() {
                return [
                    { id: 1, name: 'Arsenal', short_name: 'ARS', shirt_color: '#DC143C', secondary_color: '#FFFFFF' },
                    { id: 2, name: 'Aston Villa', short_name: 'AVL', shirt_color: '#7A003C', secondary_color: '#87CEEB' },
                    { id: 3, name: 'Bournemouth', short_name: 'BOU', shirt_color: '#DA020E', secondary_color: '#000000' },
                    { id: 4, name: 'Brentford', short_name: 'BRE', shirt_color: '#C8102E', secondary_color: '#FFFFFF' },
                    { id: 5, name: 'Brighton', short_name: 'BHA', shirt_color: '#0057B8', secondary_color: '#FFFFFF' },
                    { id: 6, name: 'Chelsea', short_name: 'CHE', shirt_color: '#034694', secondary_color: '#FFFFFF' },
                    { id: 7, name: 'Crystal Palace', short_name: 'CRY', shirt_color: '#1B458F', secondary_color: '#DC143C' },
                    { id: 8, name: 'Everton', short_name: 'EVE', shirt_color: '#003399', secondary_color: '#FFFFFF' },
                    { id: 9, name: 'Fulham', short_name: 'FUL', shirt_color: '#FFFFFF', secondary_color: '#000000' },
                    { id: 10, name: 'Ipswich', short_name: 'IPS', shirt_color: '#0000FF', secondary_color: '#FFFFFF' },
                    { id: 11, name: 'Leicester', short_name: 'LEI', shirt_color: '#003090', secondary_color: '#FFB300' },
                    { id: 12, name: 'Liverpool', short_name: 'LIV', shirt_color: '#C8102E', secondary_color: '#FFFFFF' },
                    { id: 13, name: 'Man City', short_name: 'MCI', shirt_color: '#6CABDD', secondary_color: '#FFFFFF' },
                    { id: 14, name: 'Man Utd', short_name: 'MUN', shirt_color: '#DA020E', secondary_color: '#FFE500' },
                    { id: 15, name: 'Newcastle', short_name: 'NEW', shirt_color: '#241F20', secondary_color: '#FFFFFF' },
                    { id: 16, name: 'Nott\'m Forest', short_name: 'NFO', shirt_color: '#DD0000', secondary_color: '#FFFFFF' },
                    { id: 17, name: 'Southampton', short_name: 'SOU', shirt_color: '#D71920', secondary_color: '#FFFFFF' },
                    { id: 18, name: 'Spurs', short_name: 'TOT', shirt_color: '#FFFFFF', secondary_color: '#132257' },
                    { id: 19, name: 'West Ham', short_name: 'WHU', shirt_color: '#7A263A', secondary_color: '#5CBDBD' },
                    { id: 20, name: 'Wolves', short_name: 'WOL', shirt_color: '#FDB462', secondary_color: '#000000' }
                ];
            }

            getFallbackPlayers() {
                return [
                    { id: 1, web_name: 'Salah', team: 12, element_type: 3, now_cost: 145, total_points: 344, goals_scored: 18, assists: 13, bonus: 34, selected_by_percent: '55.0', form: '8.2' },
                    { id: 2, web_name: 'Haaland', team: 13, element_type: 4, now_cost: 140, total_points: 245, goals_scored: 27, assists: 5, bonus: 28, selected_by_percent: '60.0', form: '9.1' },
                    { id: 3, web_name: 'Son', team: 18, element_type: 3, now_cost: 100, total_points: 167, goals_scored: 14, assists: 9, bonus: 19, selected_by_percent: '22.1', form: '6.8' },
                    { id: 4, web_name: 'Palmer', team: 6, element_type: 3, now_cost: 105, total_points: 233, goals_scored: 22, assists: 11, bonus: 22, selected_by_percent: '45.0', form: '7.5' },
                    { id: 5, web_name: 'Saka', team: 1, element_type: 3, now_cost: 100, total_points: 184, goals_scored: 16, assists: 9, bonus: 18, selected_by_percent: '40.0', form: '7.0' },
                    { id: 6, web_name: 'Isak', team: 15, element_type: 4, now_cost: 105, total_points: 211, goals_scored: 23, assists: 3, bonus: 16, selected_by_percent: '25.0', form: '6.9' },
                    { id: 7, web_name: 'Watkins', team: 2, element_type: 4, now_cost: 90, total_points: 192, goals_scored: 19, assists: 13, bonus: 18, selected_by_percent: '24.1', form: '7.2' },
                    { id: 8, web_name: 'Ødegaard', team: 1, element_type: 3, now_cost: 83, total_points: 128, goals_scored: 8, assists: 10, bonus: 15, selected_by_percent: '19.7', form: '6.4' }
                ];
            }

            getFallbackLiveData() {
                return {
                    elements: [
                        { id: 1, stats: { total_points: 8, goals_scored: 1, assists: 0, bonus: 3 } },
                        { id: 2, stats: { total_points: 12, goals_scored: 2, assists: 1, bonus: 3 } },
                        { id: 3, stats: { total_points: 6, goals_scored: 0, assists: 1, bonus: 2 } },
                        { id: 4, stats: { total_points: 9, goals_scored: 1, assists: 1, bonus: 2 } },
                        { id: 5, stats: { total_points: 7, goals_scored: 0, assists: 2, bonus: 1 } }
                    ]
                };
            }

            async getBootstrapData() {
                return await this.fetchWithCache('/bootstrap-static/');
            }

            async getCurrentGameweek() {
                const data = await this.getBootstrapData();
                return data?.events?.find(event => event.is_current) || data?.events?.[0];
            }

            async getLiveGameweekData(gameweekId) {
                return await this.fetchWithCache(`/event/${gameweekId}/live/`);
            }

            async getPlayersData() {
                const data = await this.getBootstrapData();
                return data?.elements || [];
            }

            async getTeamsData() {
                const data = await this.getBootstrapData();
                return data?.teams || [];
            }

            async getUserTeamPicks(entryId, gameweekId) {
                if (!entryId || !gameweekId) {
                    throw new Error('Entry ID and Gameweek ID are required');
                }
                return await this.fetchWithCache(`/entry/${entryId}/event/${gameweekId}/picks/`);
            }

            async getGameweekFixtures(gameweekId) {
                if (!gameweekId) {
                    throw new Error('Gameweek ID is required');
                }
                return await this.fetchWithCache(`/fixtures/?event=${gameweekId}`);
            }

            async getPlayerDetailedStats(playerId) {
                if (!playerId) {
                    throw new Error('Player ID is required');
                }
                return await this.fetchWithCache(`/element-summary/${playerId}/`);
            }

            formatPlayerData(players, teams = []) {
                const teamMap = teams.reduce((acc, team) => {
                    acc[team.id] = team.short_name || team.name;
                    return acc;
                }, {});

                return players.reduce((acc, player) => {
                    const key = player.web_name.toLowerCase().replace(/[^a-z]/g, '');
                    acc[key] = {
                        id: player.id,
                        name: player.web_name,
                        team: teamMap[player.team] || 'Unknown',
                        price: player.now_cost / 10,
                        points: player.total_points,
                        goals: player.goals_scored,
                        assists: player.assists,
                        bonus: player.bonus,
                        ownership: parseFloat(player.selected_by_percent)
                    };
                    return acc;
                }, {});
            }
        }

        // Initialize live stats system
        const fplLiveStats = new FPLLiveStats();
        let playerData = {}; // Will be populated with live data

        // API Integration Testing Function
        async function testAPIIntegration() {
            console.log('Testing FPL API integration...');
            
            try {
                // Test bootstrap data
                const bootstrapData = await fplLiveStats.getBootstrapData();
                const currentGW = await fplLiveStats.getCurrentGameweek();
                
                console.log('✅ Bootstrap data:', {
                    totalPlayers: bootstrapData?.total_players,
                    elementsCount: bootstrapData?.elements?.length,
                    teamsCount: bootstrapData?.teams?.length,
                    currentGameweek: currentGW?.name
                });

                // Test live gameweek data if available
                if (currentGW?.id) {
                    try {
                        const liveData = await fplLiveStats.getLiveGameweekData(currentGW.id);
                        console.log('✅ Live gameweek data:', {
                            gameweek: currentGW.id,
                            elementsWithStats: liveData?.elements?.length || 0
                        });
                    } catch (error) {
                        console.log('⚠️ Live gameweek data not available (normal outside game time)');
                    }
                }

                return true;
            } catch (error) {
                console.error('❌ API integration test failed:', error);
                return false;
            }
        }

        // Live stats update functions
        async function updateLiveStats(retryCount = 0) {
            const maxRetries = 2;
            
            try {
                showLoadingIndicator();
                
                // Update API status to loading
                const statusElement = document.getElementById('api-status');
                if (statusElement) {
                    statusElement.innerHTML = '🟡 Loading...';
                    statusElement.style.color = '#ffa502';
                }
                
                // Fetch live data with timeout
                const timeoutPromise = new Promise((_, reject) => 
                    setTimeout(() => reject(new Error('Request timeout')), 15000)
                );
                
                const dataPromise = Promise.all([
                    fplLiveStats.getBootstrapData(),
                    fplLiveStats.getCurrentGameweek()
                ]);
                
                const [bootstrapData, currentGW] = await Promise.race([dataPromise, timeoutPromise]);

                // Validate data integrity
                if (!bootstrapData || !bootstrapData.elements || bootstrapData.elements.length === 0) {
                    throw new Error('Invalid or empty bootstrap data received');
                }

                const players = bootstrapData.elements || [];
                const teams = bootstrapData.teams || [];

                // Update player data for comparison tool
                playerData = fplLiveStats.formatPlayerData(players, teams);

                // Update header stats
                await updateHeaderStats(bootstrapData, currentGW);

                // Update live gameweek data if available
                if (currentGW?.id) {
                    try {
                        const liveData = await fplLiveStats.getLiveGameweekData(currentGW.id);
                        updateLiveGameweekStats(liveData);
                    } catch (liveError) {
                        console.warn('Live gameweek data unavailable:', liveError);
                        // Continue without live data
                    }
                }

                // Update comparison tool with new data
                updateComparison();

                // Update last updated time
                updateLastRefreshTime();

                // Update API status to success
                if (statusElement) {
                    statusElement.innerHTML = '🟢 Live';
                    statusElement.style.color = '#2ed573';
                }

                hideLoadingIndicator();
                showSuccessMessage('Live stats updated successfully!');

            } catch (error) {
                console.error('Failed to update live stats:', error);
                hideLoadingIndicator();
                
                if (retryCount < maxRetries) {
                    console.log(`Retrying update... (${retryCount + 1}/${maxRetries})`);
                    setTimeout(() => updateLiveStats(retryCount + 1), 2000);
                    return;
                }
                
                showErrorMessage('Failed to update live stats. Using fallback data.', error);
                
                // Load fallback data to ensure site functionality
                const fallbackData = fplLiveStats.getFallbackBootstrap();
                const fallbackPlayers = fallbackData.elements || [];
                const fallbackTeams = fallbackData.teams || [];
                playerData = fplLiveStats.formatPlayerData(fallbackPlayers, fallbackTeams);
                updateComparison();
            }
        }

        function showLoadingIndicator() {
            const indicator = document.getElementById('loading-indicator');
            if (indicator) {
                indicator.style.display = 'block';
            } else {
                // Create loading indicator if it doesn't exist
                const loader = document.createElement('div');
                loader.id = 'loading-indicator';
                loader.innerHTML = `
                    <div class="loading-spinner">
                        <div class="spinner"></div>
                        <span>Updating live stats...</span>
                    </div>
                `;
                loader.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: linear-gradient(135deg, #37003c, #6f42c1);
                    color: white;
                    padding: 15px 20px;
                    border-radius: 10px;
                    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                    z-index: 10000;
                    display: flex;
                    align-items: center;
                    gap: 10px;
                `;
                document.body.appendChild(loader);
            }
        }

        function hideLoadingIndicator() {
            const indicator = document.getElementById('loading-indicator');
            if (indicator) {
                indicator.style.display = 'none';
            }
        }

        function showSuccessMessage(message) {
            showNotification(message, 'success');
        }

        function showErrorMessage(message, details = null) {
            console.error('FPL Error:', message, details);
            showNotification(message, 'error');
            
            // Update API status indicator
            const statusElement = document.getElementById('api-status');
            if (statusElement) {
                statusElement.innerHTML = '🔴 Error';
                statusElement.style.color = '#ff4757';
            }
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 10px;
                color: white;
                font-weight: 600;
                z-index: 10001;
                transform: translateX(100%);
                transition: transform 0.3s ease;
                ${type === 'success' ? 'background: linear-gradient(135deg, #28a745, #20c997);' : 'background: linear-gradient(135deg, #dc3545, #e74c3c);'}
            `;
            
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        async function updateHeaderStats(bootstrapData, currentGW) {
            // Update total managers
            const totalManagersEl = document.getElementById('total-managers');
            if (totalManagersEl && bootstrapData?.total_players) {
                const totalPlayers = bootstrapData.total_players;
                const formatted = totalPlayers > 1000000 ? 
                    `${(totalPlayers / 1000000).toFixed(1)}M+` : 
                    `${(totalPlayers / 1000).toFixed(0)}K+`;
                totalManagersEl.textContent = formatted;
            }

            // Update average score
            const avgScoreEl = document.getElementById('avg-score');
            if (avgScoreEl && currentGW?.average_entry_score) {
                avgScoreEl.textContent = Math.round(currentGW.average_entry_score);
            }

            // Update highest score (placeholder - would need additional API call)
            const topScorerEl = document.getElementById('top-scorer');
            if (topScorerEl) {
                // This would require calling the dream team endpoint
                topScorerEl.textContent = '127*'; // Placeholder with asterisk to indicate estimation
            }
        }

        function updateLiveGameweekStats(liveData) {
            if (!liveData?.elements) return;

            // Update live scores for players in comparison tool
            liveData.elements.forEach(element => {
                const playerId = element.id;
                const stats = element.stats;
                
                // Update any displayed live stats
                updatePlayerLiveStats(playerId, stats);
            });
        }

        function updatePlayerLiveStats(playerId, stats) {
            // Update live stats in the UI if player is currently displayed
            const playerCards = document.querySelectorAll(`[data-player-id="${playerId}"]`);
            playerCards.forEach(card => {
                const livePointsEl = card.querySelector('.live-points');
                if (livePointsEl && stats.total_points !== undefined) {
                    livePointsEl.textContent = `Live: ${stats.total_points}pts`;
                }
            });
        }

        function updateLastRefreshTime() {
            const refreshTimeEl = document.getElementById('last-refresh');
            if (refreshTimeEl) {
                const now = new Date();
                refreshTimeEl.textContent = `Last updated: ${now.toLocaleTimeString()}`;
            }
        }

        // Team builder data
        let currentSelection = { position: '', slot: 0 };
        let selectedPlayers = {
            gk: [null, null],
            def: [null, null, null, null, null],
            mid: [null, null, null, null, null],
            fwd: [null, null, null]
        };
        let teamBudget = 100.0;
        
        // Starting XI data (4-3-3 formation)
        let startingXI = {
            gk: null,      // 1 goalkeeper
            def: [null, null, null, null],  // 4 defenders
            mid: [null, null, null],        // 3 midfielders  
            fwd: [null, null, null]         // 3 forwards
        };

        function initializeTeamBuilder() {
            updateTeamDisplay();
            updateBudgetDisplay();
            updateFieldDisplay();
            addFieldClickHandlers();
        }

        function addFieldClickHandlers() {
            // Add click handlers to field player slots
            document.querySelectorAll('.field-player-slot').forEach(slot => {
                slot.addEventListener('click', function(e) {
                    const position = this.dataset.position;
                    const slotIndex = parseInt(this.dataset.slot);
                    
                    // Check if slot is occupied and if user wants to see stats
                    const isOccupied = this.classList.contains('occupied');
                    if (isOccupied && e.ctrlKey) {
                        // Ctrl+Click to show player stats
                        showPlayerStats(position, slotIndex);
                    } else if (isOccupied && e.altKey) {
                        // Alt+Click to remove player
                        removeFromStartingXI(position, slotIndex);
                    } else {
                        // Normal click to select/change player
                        openPlayerSelector(position, slotIndex, 'field');
                    }
                });
                
                // Add right-click for stats
                slot.addEventListener('contextmenu', function(e) {
                    e.preventDefault();
                    const position = this.dataset.position;
                    const slotIndex = parseInt(this.dataset.slot);
                    const isOccupied = this.classList.contains('occupied');
                    
                    if (isOccupied) {
                        showPlayerStats(position, slotIndex);
                    }
                });
            });

            // Add click handlers to bench slots
            document.querySelectorAll('.bench-slot').forEach(slot => {
                slot.addEventListener('click', function(e) {
                    const position = this.dataset.position;
                    const slotIndex = parseInt(this.dataset.slot);
                    
                    // Check if slot is occupied and if user wants to see stats
                    const isOccupied = this.classList.contains('occupied');
                    if (isOccupied && e.ctrlKey) {
                        // Ctrl+Click to show player stats
                        showBenchPlayerStats(position, slotIndex);
                    } else if (isOccupied && e.altKey) {
                        // Alt+Click to remove player
                        removeFromBench(position, slotIndex);
                    } else {
                        // Normal click to select/change player
                        openPlayerSelector(position, slotIndex, 'bench');
                    }
                });
                
                // Add right-click for stats
                slot.addEventListener('contextmenu', function(e) {
                    e.preventDefault();
                    const position = this.dataset.position;
                    const slotIndex = parseInt(this.dataset.slot);
                    const isOccupied = this.classList.contains('occupied');
                    
                    if (isOccupied) {
                        showBenchPlayerStats(position, slotIndex);
                    }
                });
            });
        }

        function showPlayerStats(position, slotIndex) {
            let player;
            if (position === 'gk') {
                player = startingXI.gk;
            } else {
                player = startingXI[position][slotIndex];
            }
            
            if (!player) return;
            
            // Get detailed player data
            const fallbackData = fplLiveStats.getFallbackBootstrap();
            const allPlayers = [...fallbackData.elements, ...generateAdditionalPlayersForPosition(1), ...generateAdditionalPlayersForPosition(2), ...generateAdditionalPlayersForPosition(3), ...generateAdditionalPlayersForPosition(4)];
            const playerData = allPlayers.find(p => p.id === player.id);
            const team = getTeamData(playerData?.team);
            
            if (!playerData) return;
            
            // Create stats modal
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content player-stats-modal">
                    <div class="modal-header" style="background: ${team?.shirt_color || '#37003c'};">
                        <h3 style="color: ${team?.secondary_color || '#fff'};">${player.name} Stats</h3>
                        <button class="close-btn" onclick="this.closest('.modal-overlay').remove()" style="color: ${team?.secondary_color || '#fff'};">×</button>
                    </div>
                    <div class="modal-body">
                        <div class="player-stats-grid">
                            <div class="stat-card">
                                <div class="stat-value">${playerData.total_points}</div>
                                <div class="stat-label">Total Points</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">£${(playerData.now_cost / 10).toFixed(1)}m</div>
                                <div class="stat-label">Price</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">${playerData.goals_scored || 0}</div>
                                <div class="stat-label">Goals</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">${playerData.assists || 0}</div>
                                <div class="stat-label">Assists</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">${playerData.selected_by_percent}%</div>
                                <div class="stat-label">Ownership</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">${team?.short_name || 'UNK'}</div>
                                <div class="stat-label">Team</div>
                            </div>
                        </div>
                        <div class="player-actions">
                            <button class="action-btn remove-btn" onclick="removeFromStartingXI('${position}', '${slotIndex}'); this.closest('.modal-overlay').remove();">
                                Remove from XI
                            </button>
                            <button class="action-btn change-btn" onclick="this.closest('.modal-overlay').remove(); openPlayerSelector('${position}', '${slotIndex}', 'field');">
                                Change Player
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function openPlayerSelector(position, slotIndex, targetLocation) {
            // Get all available players for this position
            const fallbackData = fplLiveStats.getFallbackBootstrap();
            const allPlayers = [...fallbackData.elements, ...generateAdditionalPlayersForPosition(1), ...generateAdditionalPlayersForPosition(2), ...generateAdditionalPlayersForPosition(3), ...generateAdditionalPlayersForPosition(4)];
            
            // Filter players by position
            let positionType;
            if (position === 'gk') positionType = 1;
            else if (position === 'def') positionType = 2;
            else if (position === 'mid') positionType = 3;
            else if (position === 'fwd') positionType = 4;
            
            const availablePlayers = allPlayers.filter(player => player.element_type === positionType);

            // Create selection modal
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content player-selector-modal">
                    <div class="modal-header">
                        <h3>Select ${position.toUpperCase()} for ${targetLocation === 'field' ? 'Starting XI' : 'Bench'}</h3>
                        <button class="close-btn" onclick="this.closest('.modal-overlay').remove()">×</button>
                    </div>
                    <div class="modal-body">
                        <div class="player-search-container" style="margin-bottom: 20px;">
                            <input type="text" id="player-search" placeholder="Search players..." style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; color: #000;">
                        </div>
                        <div class="player-selection-grid" style="max-height: 400px; overflow-y: auto;">
                            ${availablePlayers.map(player => {
                                const team = getTeamData(player.team);
                                const isAlreadySelected = isPlayerInSquad(player.id);
                                return `
                                    <div class="player-selection-option ${isAlreadySelected ? 'disabled' : ''}" 
                                         onclick="${isAlreadySelected ? '' : `selectPlayer(${player.id}, '${position}', ${slotIndex}, '${targetLocation}')`}"
                                         style="display: flex; align-items: center; padding: 10px; border: 1px solid #ddd; margin: 5px 0; border-radius: 5px; ${isAlreadySelected ? 'opacity: 0.5; cursor: not-allowed;' : 'cursor: pointer;'} background: ${isAlreadySelected ? '#f5f5f5' : '#fff'};">
                                        <div class="mini-jersey" style="width: 20px; height: 20px; background: ${team?.shirt_color || '#37003c'}; border-radius: 3px; margin-right: 10px; border: 1px solid ${team?.secondary_color || '#fff'};"></div>
                                        <div style="flex: 1;">
                                            <div style="color: #000; font-weight: bold;">${player.web_name}</div>
                                            <div style="color: #666; font-size: 12px;">${team?.short_name || 'UNK'} - £${(player.now_cost / 10).toFixed(1)}m</div>
                                        </div>
                                        ${isAlreadySelected ? '<div style="color: #999; font-size: 12px;">Already Selected</div>' : ''}
                                    </div>
                                `;
                            }).join('')}
                        </div>
                        <div style="margin-top: 20px; text-align: center;">
                            <button class="action-btn remove-btn" onclick="${targetLocation === 'field' ? `removeFromStartingXI('${position}', ${slotIndex})` : `removeFromBench('${position}', ${slotIndex})`}; this.closest('.modal-overlay').remove();">
                                Remove Player
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // Add search functionality
            const searchInput = document.getElementById('player-search');
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const options = document.querySelectorAll('.player-selection-option');
                options.forEach(option => {
                    const playerName = option.querySelector('div > div').textContent.toLowerCase();
                    if (playerName.includes(searchTerm)) {
                        option.style.display = 'flex';
                    } else {
                        option.style.display = 'none';
                    }
                });
            });
        }

        // Data structure for bench players
        let benchPlayers = {
            gk: null,
            def: null,
            mid: [null, null]
        };

        function isPlayerInSquad(playerId) {
            // Check starting XI
            if (startingXI.gk && startingXI.gk.id === playerId) return true;
            for (let pos of ['def', 'mid', 'fwd']) {
                if (startingXI[pos].some(player => player && player.id === playerId)) return true;
            }
            
            // Check bench
            if (benchPlayers.gk && benchPlayers.gk.id === playerId) return true;
            if (benchPlayers.def && benchPlayers.def.id === playerId) return true;
            if (benchPlayers.mid.some(player => player && player.id === playerId)) return true;
            
            return false;
        }

        function selectPlayer(playerId, position, slotIndex, targetLocation) {
            console.log(`Selecting player ${playerId} for ${position} slot ${slotIndex} on ${targetLocation}`);
            
            // Get player data
            const fallbackData = fplLiveStats.getFallbackBootstrap();
            const allPlayers = [...fallbackData.elements, ...generateAdditionalPlayersForPosition(1), ...generateAdditionalPlayersForPosition(2), ...generateAdditionalPlayersForPosition(3), ...generateAdditionalPlayersForPosition(4)];
            const playerData = allPlayers.find(p => p.id === playerId);
            
            if (!playerData) {
                console.error('Player not found!');
                return;
            }
            
            // Check budget constraint
            const playerPrice = playerData.now_cost / 10;
            if (teamBudget - playerPrice < 0) {
                alert(`Not enough budget! Player costs £${playerPrice}m but you only have £${teamBudget.toFixed(1)}m remaining.`);
                return;
            }
            
            const player = {
                id: playerId,
                name: playerData.web_name,
                price: playerPrice,
                team: playerData.team
            };
            
            console.log('Player object created:', player);
            
            if (targetLocation === 'field') {
                // Add to starting XI
                if (position === 'gk') {
                    startingXI.gk = player;
                    console.log('Added GK to starting XI:', startingXI.gk);
                } else {
                    startingXI[position][slotIndex] = player;
                    console.log(`Added ${position} to starting XI slot ${slotIndex}:`, startingXI[position][slotIndex]);
                }
            } else {
                // Add to bench
                if (position === 'gk') {
                    benchPlayers.gk = player;
                } else if (position === 'def') {
                    benchPlayers.def = player;
                } else if (position === 'mid') {
                    benchPlayers.mid[slotIndex] = player;
                }
            }
            
            // Update budget
            teamBudget -= playerPrice;
            
            console.log('Updating displays...');
            
            // Update displays
            updateFieldDisplay();
            updateBenchDisplay();
            updateBudgetDisplay();
            
            console.log('Starting XI after update:', startingXI);
            
            // Close modal
            document.querySelector('.modal-overlay').remove();
            
            showNotification(`${player.name} added to ${targetLocation === 'field' ? 'starting XI' : 'bench'}!`, 'success');
        }

        function removeFromBench(position, slotIndex) {
            let removedPlayer;
            
            if (position === 'gk') {
                removedPlayer = benchPlayers.gk;
                benchPlayers.gk = null;
            } else if (position === 'def') {
                removedPlayer = benchPlayers.def;
                benchPlayers.def = null;
            } else if (position === 'mid') {
                removedPlayer = benchPlayers.mid[slotIndex];
                benchPlayers.mid[slotIndex] = null;
            }
            
            if (removedPlayer) {
                teamBudget += removedPlayer.price;
                updateBenchDisplay();
                updateBudgetDisplay();
                showNotification(`${removedPlayer.name} removed from bench!`, 'info');
            }
        }

        function showBenchPlayerStats(position, slotIndex) {
            let player;
            if (position === 'gk') {
                player = benchPlayers.gk;
            } else if (position === 'def') {
                player = benchPlayers.def;
            } else if (position === 'mid') {
                player = benchPlayers.mid[slotIndex];
            }
            
            if (!player) return;
            
            // Get detailed player data
            const fallbackData = fplLiveStats.getFallbackBootstrap();
            const allPlayers = [...fallbackData.elements, ...generateAdditionalPlayersForPosition(1), ...generateAdditionalPlayersForPosition(2), ...generateAdditionalPlayersForPosition(3), ...generateAdditionalPlayersForPosition(4)];
            const playerData = allPlayers.find(p => p.id === player.id);
            const team = getTeamData(playerData?.team);
            
            if (!playerData) return;
            
            // Create stats modal
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content player-stats-modal">
                    <div class="modal-header" style="background: ${team?.shirt_color || '#37003c'};">
                        <h3 style="color: ${team?.secondary_color || '#fff'};">${player.name} Stats (Bench)</h3>
                        <button class="close-btn" onclick="this.closest('.modal-overlay').remove()" style="color: ${team?.secondary_color || '#fff'};">×</button>
                    </div>
                    <div class="modal-body">
                        <div class="player-stats-grid">
                            <div class="stat-card">
                                <div class="stat-value">${playerData.total_points}</div>
                                <div class="stat-label">Total Points</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">£${(playerData.now_cost / 10).toFixed(1)}m</div>
                                <div class="stat-label">Price</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">${playerData.goals_scored || 0}</div>
                                <div class="stat-label">Goals</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">${playerData.assists || 0}</div>
                                <div class="stat-label">Assists</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">${playerData.selected_by_percent}%</div>
                                <div class="stat-label">Ownership</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">${team?.short_name || 'UNK'}</div>
                                <div class="stat-label">Team</div>
                            </div>
                        </div>
                        <div class="player-actions">
                            <button class="action-btn remove-btn" onclick="removeFromBench('${position}', '${slotIndex}'); this.closest('.modal-overlay').remove();">
                                Remove from Bench
                            </button>
                            <button class="action-btn change-btn" onclick="this.closest('.modal-overlay').remove(); openPlayerSelector('${position}', '${slotIndex}', 'bench');">
                                Change Player
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function updateBenchDisplay() {
            // Update GK bench slot
            const gkSlot = document.querySelector('.bench-slot[data-position="gk"]');
            if (gkSlot) {
                if (benchPlayers.gk) {
                    const team = getTeamData(benchPlayers.gk.team);
                    gkSlot.classList.add('occupied');
                    gkSlot.innerHTML = `
                        <div class="bench-position">GK</div>
                        <div class="bench-player-slot">
                            <div style="display: flex; flex-direction: column; align-items: center;">
                                <div class="bench-jersey-mini" style="background: ${team?.shirt_color || '#37003c'}; border: 1px solid ${team?.secondary_color || '#fff'};"></div>
                                <span class="bench-player-name">${benchPlayers.gk.name}</span>
                            </div>
                        </div>
                    `;
                } else {
                    gkSlot.classList.remove('occupied');
                    gkSlot.innerHTML = `
                        <div class="bench-position">GK</div>
                        <div class="bench-player-slot">
                            <span class="bench-slot-text">+ GK</span>
                        </div>
                    `;
                }
            }

            // Update DEF bench slot
            const defSlot = document.querySelector('.bench-slot[data-position="def"]');
            if (defSlot) {
                if (benchPlayers.def) {
                    const team = getTeamData(benchPlayers.def.team);
                    defSlot.classList.add('occupied');
                    defSlot.innerHTML = `
                        <div class="bench-position">DEF</div>
                        <div class="bench-player-slot">
                            <div style="display: flex; flex-direction: column; align-items: center;">
                                <div class="bench-jersey-mini" style="background: ${team?.shirt_color || '#37003c'}; border: 1px solid ${team?.secondary_color || '#fff'};"></div>
                                <span class="bench-player-name">${benchPlayers.def.name}</span>
                            </div>
                        </div>
                    `;
                } else {
                    defSlot.classList.remove('occupied');
                    defSlot.innerHTML = `
                        <div class="bench-position">DEF</div>
                        <div class="bench-player-slot">
                            <span class="bench-slot-text">+ DEF</span>
                        </div>
                    `;
                }
            }

            // Update MID bench slots
            ['1', '2'].forEach(slot => {
                const midSlot = document.querySelector(`.bench-slot[data-position="mid"][data-slot="${slot}"]`);
                const midIndex = parseInt(slot) - 1;
                if (midSlot) {
                    if (benchPlayers.mid[midIndex]) {
                        const team = getTeamData(benchPlayers.mid[midIndex].team);
                        midSlot.classList.add('occupied');
                        midSlot.innerHTML = `
                            <div class="bench-position">MID</div>
                            <div class="bench-player-slot">
                                <div style="display: flex; flex-direction: column; align-items: center;">
                                    <div class="bench-jersey-mini" style="background: ${team?.shirt_color || '#37003c'}; border: 1px solid ${team?.secondary_color || '#fff'};"></div>
                                    <span class="bench-player-name">${benchPlayers.mid[midIndex].name}</span>
                                </div>
                            </div>
                        `;
                    } else {
                        midSlot.classList.remove('occupied');
                        midSlot.innerHTML = `
                            <div class="bench-position">MID</div>
                            <div class="bench-player-slot">
                                <span class="bench-slot-text">+ MID</span>
                            </div>
                        `;
                    }
                }
            });
        }

        function selectForStartingXI(position, fieldSlot, playerIndex) {
            const player = selectedPlayers[position][playerIndex];
            if (position === 'gk') {
                startingXI.gk = player;
            } else {
                startingXI[position][fieldSlot] = player;
            }
            
            updateFieldDisplay();
            document.querySelector('.modal-overlay').remove();
        }

        function removeFromStartingXI(position, fieldSlot) {
            if (position === 'gk') {
                startingXI.gk = null;
            } else {
                startingXI[position][fieldSlot] = null;
            }
            
            updateFieldDisplay();
            document.querySelector('.modal-overlay').remove();
        }

        function updateFieldDisplay() {
            console.log('updateFieldDisplay called');
            console.log('Current startingXI:', startingXI);
            
            // Update goalkeeper
            const gkSlot = document.querySelector('.field-player-slot[data-position="gk"]');
            console.log('GK slot found:', gkSlot);
            console.log('Starting XI GK:', startingXI.gk);
            
            if (startingXI.gk && gkSlot) {
                const team = getPlayerTeam(startingXI.gk.id);
                const teamColors = team ? { primary: team.shirt_color, secondary: team.secondary_color } : { primary: '#333', secondary: '#fff' };
                
                console.log('Updating GK slot with player:', startingXI.gk.name);
                
                gkSlot.classList.add('occupied');
                gkSlot.innerHTML = `
                    <div style="display: flex; flex-direction: column; align-items: center;">
                        <div class="field-jersey-mini" style="background: ${teamColors.primary}; border: 1px solid ${teamColors.secondary};"></div>
                        <span class="field-player-name">${startingXI.gk.name}</span>
                    </div>
                `;
            } else if (gkSlot) {
                gkSlot.classList.remove('occupied');
                gkSlot.innerHTML = '<span class="field-slot-text">GK</span>';
            }

            // Update outfield players
            ['def', 'mid', 'fwd'].forEach(position => {
                startingXI[position].forEach((player, index) => {
                    const slot = document.querySelector(`.field-player-slot[data-position="${position}"][data-slot="${index}"]`);
                    if (player && slot) {
                        const team = getPlayerTeam(player.id);
                        const teamColors = team ? { primary: team.shirt_color, secondary: team.secondary_color } : { primary: '#333', secondary: '#fff' };
                        
                        slot.classList.add('occupied');
                        slot.innerHTML = `
                            <div style="display: flex; flex-direction: column; align-items: center;">
                                <div class="field-jersey-mini" style="background: ${teamColors.primary}; border: 1px solid ${teamColors.secondary};"></div>
                                <span class="field-player-name">${player.name}</span>
                            </div>
                        `;
                    } else if (slot) {
                        slot.classList.remove('occupied');
                        slot.innerHTML = `<span class="field-slot-text">${position.toUpperCase()}</span>`;
                    }
                });
            });
        }

        function getPlayerTeam(playerId) {
            const fallbackData = fplLiveStats.getFallbackBootstrap();
            const allPlayers = [...fallbackData.elements, ...generateAdditionalPlayersForPosition(1), ...generateAdditionalPlayersForPosition(2), ...generateAdditionalPlayersForPosition(3), ...generateAdditionalPlayersForPosition(4)];
            const playerData = allPlayers.find(p => p.id === playerId);
            return getTeamData(playerData?.team);
        }

        // Enhanced Player Comparison with Live FPL Data
        let allPlayers = [];
        let filteredPlayers = [];
        let allTeams = [];

        async function populatePlayerDropdowns() {
            try {
                const bootstrapData = await fplLiveStats.getBootstrapData();
                allPlayers = bootstrapData?.elements || [];
                allTeams = bootstrapData?.teams || [];
                
                // Create team lookup
                const teamLookup = {};
                allTeams.forEach(team => {
                    teamLookup[team.id] = team.short_name;
                });
                
                // Process players with team names
                allPlayers = allPlayers.map(player => ({
                    ...player,
                    team_name: teamLookup[player.team] || 'Unknown',
                    display_name: `${player.web_name} (${teamLookup[player.team]}) - £${(player.now_cost / 10).toFixed(1)}m`
                }));
                
                filteredPlayers = [...allPlayers];
                
                // Populate team filter dropdown
                populateTeamFilter();
                
                // Update player dropdowns
                updatePlayerDropdowns();
                
                console.log(`Loaded ${allPlayers.length} players from FPL API`);
                
            } catch (error) {
                console.error('Failed to populate player dropdowns:', error);
                showErrorMessage('Failed to load player data');
            }
        }

        function populateTeamFilter() {
            const teamFilter = document.getElementById('team-filter');
            if (!teamFilter) return;
            
            // Clear existing options (except "All Teams")
            teamFilter.innerHTML = '<option value="all">All Teams</option>';
            
            // Add team options
            allTeams.forEach(team => {
                const option = document.createElement('option');
                option.value = team.id;
                option.textContent = team.name;
                teamFilter.appendChild(option);
            });
        }

        function updatePlayerDropdowns() {
            const player1Select = document.getElementById('player1-select');
            const player2Select = document.getElementById('player2-select');
            
            if (!player1Select || !player2Select) return;
            
            // Store current selections
            const currentPlayer1 = player1Select.value;
            const currentPlayer2 = player2Select.value;
            
            // Clear dropdowns
            player1Select.innerHTML = '<option value="">Select Player 1...</option>';
            player2Select.innerHTML = '<option value="">Select Player 2...</option>';
            
            // Add filtered players
            filteredPlayers.forEach(player => {
                const option1 = document.createElement('option');
                option1.value = player.id;
                option1.textContent = player.display_name;
                player1Select.appendChild(option1);
                
                const option2 = document.createElement('option');
                option2.value = player.id;
                option2.textContent = player.display_name;
                player2Select.appendChild(option2);
            });
            
            // Restore selections if they still exist in filtered list
            if (filteredPlayers.find(p => p.id == currentPlayer1)) {
                player1Select.value = currentPlayer1;
            }
            if (filteredPlayers.find(p => p.id == currentPlayer2)) {
                player2Select.value = currentPlayer2;
            }
        }

        function filterPlayersByPosition() {
            const positionFilter = document.getElementById('position-filter');
            const selectedPosition = positionFilter.value;
            
            if (selectedPosition === 'all') {
                filteredPlayers = [...allPlayers];
            } else {
                filteredPlayers = allPlayers.filter(player => 
                    player.element_type == selectedPosition
                );
            }
            
            applyAllFilters();
        }

        function filterPlayersByTeam() {
            const teamFilter = document.getElementById('team-filter');
            const selectedTeam = teamFilter.value;
            
            if (selectedTeam === 'all') {
                filteredPlayers = [...allPlayers];
            } else {
                filteredPlayers = allPlayers.filter(player => 
                    player.team == selectedTeam
                );
            }
            
            applyAllFilters();
        }

        function filterPlayersByPrice() {
            const minPrice = parseFloat(document.getElementById('min-price').value);
            const maxPrice = parseFloat(document.getElementById('max-price').value);
            
            // Update display
            document.getElementById('min-price-display').textContent = `£${minPrice}m`;
            document.getElementById('max-price-display').textContent = `£${maxPrice}m`;
            
            filteredPlayers = allPlayers.filter(player => {
                const price = player.now_cost / 10;
                return price >= minPrice && price <= maxPrice;
            });
            
            applyAllFilters();
        }

        function applyAllFilters() {
            const positionFilter = document.getElementById('position-filter').value;
            const teamFilter = document.getElementById('team-filter').value;
            const minPrice = parseFloat(document.getElementById('min-price').value);
            const maxPrice = parseFloat(document.getElementById('max-price').value);
            
            filteredPlayers = allPlayers.filter(player => {
                const price = player.now_cost / 10;
                const positionMatch = positionFilter === 'all' || player.element_type == positionFilter;
                const teamMatch = teamFilter === 'all' || player.team == teamFilter;
                const priceMatch = price >= minPrice && price <= maxPrice;
                
                return positionMatch && teamMatch && priceMatch;
            });
            
            updatePlayerDropdowns();
        }

        function searchPlayers(playerNumber) {
            const searchInput = document.getElementById(`player${playerNumber}-search`);
            const searchTerm = searchInput.value.toLowerCase();
            
            if (!searchTerm) {
                updatePlayerDropdowns();
                return;
            }
            
            const searchResults = filteredPlayers.filter(player => 
                player.web_name.toLowerCase().includes(searchTerm) ||
                player.first_name.toLowerCase().includes(searchTerm) ||
                player.second_name.toLowerCase().includes(searchTerm) ||
                player.team_name.toLowerCase().includes(searchTerm)
            );
            
            const playerSelect = document.getElementById(`player${playerNumber}-select`);
            playerSelect.innerHTML = `<option value="">Select Player ${playerNumber}...</option>`;
            
            searchResults.forEach(player => {
                const option = document.createElement('option');
                option.value = player.id;
                option.textContent = player.display_name;
                playerSelect.appendChild(option);
            });
        }

        function updateComparison() {
            const player1Id = document.getElementById('player1-select').value;
            const player2Id = document.getElementById('player2-select').value;
            const statsContainer = document.getElementById('comparison-stats');
            
            if (!player1Id || !player2Id) {
                statsContainer.innerHTML = '<div class="no-comparison"><p>Select two players to compare their statistics</p></div>';
                statsContainer.classList.remove('has-data');
                return;
            }
            
            const player1 = allPlayers.find(p => p.id == player1Id);
            const player2 = allPlayers.find(p => p.id == player2Id);
            
            if (!player1 || !player2) {
                statsContainer.innerHTML = '<div class="no-comparison"><p>Player data not found</p></div>';
                return;
            }
            
            // Show loading
            document.getElementById('comparison-loading').style.display = 'flex';
            statsContainer.classList.remove('has-data');
            
            setTimeout(() => {
                renderComparison(player1, player2);
                document.getElementById('comparison-loading').style.display = 'none';
                statsContainer.classList.add('has-data');
            }, 500);
        }

        function renderComparison(player1, player2) {
            const statsContainer = document.getElementById('comparison-stats');
            const showAdvanced = document.getElementById('advanced-stats-toggle').checked;
            
            // Basic stats
            const basicStats = [
                { label: 'Price', key: 'now_cost', format: (val) => `£${(val / 10).toFixed(1)}m`, lower_better: true },
                { label: 'Total Points', key: 'total_points', format: (val) => val.toString() },
                { label: 'Goals', key: 'goals_scored', format: (val) => val.toString() },
                { label: 'Assists', key: 'assists', format: (val) => val.toString() },
                { label: 'Bonus Points', key: 'bonus', format: (val) => val.toString() },
                { label: 'Ownership %', key: 'selected_by_percent', format: (val) => `${parseFloat(val).toFixed(1)}%` }
            ];
            
            // Advanced stats
            const advancedStats = [
                { label: 'Clean Sheets', key: 'clean_sheets', format: (val) => val.toString() },
                { label: 'Yellow Cards', key: 'yellow_cards', format: (val) => val.toString(), lower_better: true },
                { label: 'Red Cards', key: 'red_cards', format: (val) => val.toString(), lower_better: true },
                { label: 'Saves', key: 'saves', format: (val) => val.toString() },
                { label: 'Penalties Saved', key: 'penalties_saved', format: (val) => val.toString() },
                { label: 'Penalties Missed', key: 'penalties_missed', format: (val) => val.toString(), lower_better: true },
                { label: 'Own Goals', key: 'own_goals', format: (val) => val.toString(), lower_better: true },
                { label: 'Form', key: 'form', format: (val) => val ? val.toString() : '0.0' },
                { label: 'Points per Game', key: 'points_per_game', format: (val) => val ? parseFloat(val).toFixed(1) : '0.0' },
                { label: 'Value (Points per £)', key: 'value', format: (val) => calculateValueScore(player1, player2) }
            ];
            
            const statsToShow = showAdvanced ? [...basicStats, ...advancedStats] : basicStats;
            
            let player1HTML = `
                <div class="player-comparison-card" id="player1-card">
                    <div class="player-header">
                        <h4>${player1.web_name}</h4>
                        <div class="player-info">
                            <span>${getTeamName(player1.team)}</span>
                            <span>${getPositionName(player1.element_type)}</span>
                        </div>
                        <div class="player-info">
                            <span>£${(player1.now_cost / 10).toFixed(1)}m</span>
                            <span>${parseFloat(player1.selected_by_percent).toFixed(1)}% owned</span>
                        </div>
                    </div>
                    <ul class="comparison-stat-list">
            `;
            
            let player2HTML = `
                <div class="player-comparison-card" id="player2-card">
                    <div class="player-header">
                        <h4>${player2.web_name}</h4>
                        <div class="player-info">
                            <span>${getTeamName(player2.team)}</span>
                            <span>${getPositionName(player2.element_type)}</span>
                        </div>
                        <div class="player-info">
                            <span>£${(player2.now_cost / 10).toFixed(1)}m</span>
                            <span>${parseFloat(player2.selected_by_percent).toFixed(1)}% owned</span>
                        </div>
                    </div>
                    <ul class="comparison-stat-list">
            `;
            
            let player1Score = 0;
            let player2Score = 0;
            
            statsToShow.forEach(stat => {
                let val1, val2;
                
                if (stat.key === 'value') {
                    val1 = calculatePlayerValue(player1);
                    val2 = calculatePlayerValue(player2);
                } else {
                    val1 = player1[stat.key] || 0;
                    val2 = player2[stat.key] || 0;
                }
                
                let better1 = false, better2 = false;
                
                if (stat.lower_better) {
                    better1 = val1 < val2;
                    better2 = val2 < val1;
                } else {
                    better1 = val1 > val2;
                    better2 = val2 > val1;
                }
                
                if (better1) player1Score++;
                if (better2) player2Score++;
                
                const formattedVal1 = stat.format(val1);
                const formattedVal2 = stat.format(val2);
                
                player1HTML += `
                    <li>
                        <span class="stat-label">${stat.label}</span>
                        <span class="stat-value ${better1 ? 'stat-better' : ''}">${formattedVal1}</span>
                    </li>
                `;
                
                player2HTML += `
                    <li>
                        <span class="stat-label">${stat.label}</span>
                        <span class="stat-value ${better2 ? 'stat-better' : ''}">${formattedVal2}</span>
                    </li>
                `;
            });
            
            player1HTML += '</ul></div>';
            player2HTML += '</ul></div>';
            
            const vsHTML = `
                <div class="comparison-vs">
                    <div class="vs-badge">VS</div>
                </div>
            `;
            
            statsContainer.innerHTML = player1HTML + vsHTML + player2HTML;
            
            // Highlight overall winner
            setTimeout(() => {
                if (player1Score > player2Score) {
                    document.getElementById('player1-card').classList.add('winner');
                } else if (player2Score > player1Score) {
                    document.getElementById('player2-card').classList.add('winner');
                }
            }, 100);
        }

        function getTeamName(teamId) {
            const team = allTeams.find(t => t.id === teamId);
            return team ? team.short_name : 'Unknown';
        }

        function getPositionName(elementType) {
            const positions = {
                1: 'Goalkeeper',
                2: 'Defender', 
                3: 'Midfielder',
                4: 'Forward'
            };
            return positions[elementType] || 'Unknown';
        }

        function calculatePlayerValue(player) {
            const points = player.total_points || 0;
            const price = (player.now_cost || 40) / 10;
            return (points / price).toFixed(1);
        }

        function toggleAdvancedStats() {
            const toggle = document.getElementById('advanced-stats-toggle');
            if (toggle.checked) {
                showNotification('Advanced stats enabled', 'info');
            } else {
                showNotification('Basic stats view', 'info');
            }
            
            // Re-render comparison if players are selected
            const player1Id = document.getElementById('player1-select').value;
            const player2Id = document.getElementById('player2-select').value;
            
            if (player1Id && player2Id) {
                updateComparison();
            }
        }

        // Team builder functionality
        function openTeamBuilderPlayerSelector(position, slot) {
            currentSelection = { position, slot };
            
            // Create and show player selection modal
            const modal = createPlayerSelectionModal(position);
            document.body.appendChild(modal);
            
            // Populate modal with players for this position
            populatePlayerModal(position);
        }

        function createPlayerSelectionModal(position) {
            const modal = document.createElement('div');
            modal.id = 'player-selection-modal';
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Select ${position.toUpperCase()}</h3>
                        <button class="close-btn" onclick="closePlayerModal()">×</button>
                    </div>
                    <div class="modal-body">
                        <div class="player-search">
                            <input type="text" id="player-search" placeholder="Search players..." onkeyup="filterPlayers()">
                        </div>
                        <div class="position-filter">
                            <label>Sort by:</label>
                            <select id="sort-filter" onchange="sortPlayers()">
                                <option value="points">Total Points</option>
                                <option value="price">Price (Low to High)</option>
                                <option value="price-desc">Price (High to Low)</option>
                                <option value="name">Name</option>
                            </select>
                        </div>
                        <div class="players-list" id="players-list">
                            <!-- Players will be populated here -->
                        </div>
                    </div>
                </div>
            `;
            return modal;
        }

        function closePlayerModal() {
            const modal = document.getElementById('player-selection-modal');
            if (modal) {
                modal.remove();
            }
        }

        function populatePlayerModal(position) {
            // Map position abbreviations to element types
            const positionMap = {
                'gk': 1,    // Goalkeeper
                'def': 2,   // Defender  
                'mid': 3,   // Midfielder
                'fwd': 4    // Forward
            };
            
            const elementType = positionMap[position];
            if (!elementType) return;
            
            // Get players for this position from fallback data
            const fallbackData = fplLiveStats.getFallbackBootstrap();
            const allPlayers = fallbackData.elements || [];
            const positionPlayers = allPlayers.filter(player => player.element_type === elementType);
            
            // Add more players to each position for better selection
            const additionalPlayers = generateAdditionalPlayersForPosition(elementType);
            const combinedPlayers = [...positionPlayers, ...additionalPlayers];
            
            displayPlayersInModal(combinedPlayers);
        }

        function generateAdditionalPlayersForPosition(elementType) {
            const additionalPlayers = [];
            
            switch(elementType) {
                case 1: // Goalkeepers (40 total)
                    additionalPlayers.push(
                        // Arsenal
                        { id: 101, web_name: 'Raya', team: 1, element_type: 1, now_cost: 55, total_points: 180, goals_scored: 0, assists: 1, selected_by_percent: '25.0' },
                        { id: 102, web_name: 'Ramsdale', team: 1, element_type: 1, now_cost: 45, total_points: 98, goals_scored: 0, assists: 0, selected_by_percent: '3.2' },
                        // Aston Villa
                        { id: 103, web_name: 'Martinez', team: 2, element_type: 1, now_cost: 50, total_points: 144, goals_scored: 0, assists: 1, selected_by_percent: '12.7' },
                        { id: 104, web_name: 'Olsen', team: 2, element_type: 1, now_cost: 40, total_points: 45, goals_scored: 0, assists: 0, selected_by_percent: '0.8' },
                        // Bournemouth
                        { id: 105, web_name: 'Neto', team: 3, element_type: 1, now_cost: 45, total_points: 89, goals_scored: 0, assists: 0, selected_by_percent: '2.1' },
                        { id: 106, web_name: 'Travers', team: 3, element_type: 1, now_cost: 40, total_points: 67, goals_scored: 0, assists: 0, selected_by_percent: '1.3' },
                        // Brentford
                        { id: 107, web_name: 'Flekken', team: 4, element_type: 1, now_cost: 45, total_points: 123, goals_scored: 0, assists: 0, selected_by_percent: '7.4' },
                        { id: 108, web_name: 'Strakosha', team: 4, element_type: 1, now_cost: 40, total_points: 34, goals_scored: 0, assists: 0, selected_by_percent: '0.4' },
                        // Brighton
                        { id: 109, web_name: 'Verbruggen', team: 5, element_type: 1, now_cost: 45, total_points: 134, goals_scored: 0, assists: 1, selected_by_percent: '8.9' },
                        { id: 110, web_name: 'Steele', team: 5, element_type: 1, now_cost: 40, total_points: 56, goals_scored: 0, assists: 0, selected_by_percent: '1.1' },
                        // Chelsea
                        { id: 111, web_name: 'Sánchez', team: 6, element_type: 1, now_cost: 45, total_points: 109, goals_scored: 0, assists: 0, selected_by_percent: '4.7' },
                        { id: 112, web_name: 'Petrović', team: 6, element_type: 1, now_cost: 40, total_points: 67, goals_scored: 0, assists: 0, selected_by_percent: '1.8' },
                        // Crystal Palace
                        { id: 113, web_name: 'Henderson', team: 7, element_type: 1, now_cost: 45, total_points: 125, goals_scored: 0, assists: 0, selected_by_percent: '6.2' },
                        { id: 114, web_name: 'Johnstone', team: 7, element_type: 1, now_cost: 40, total_points: 45, goals_scored: 0, assists: 0, selected_by_percent: '0.9' },
                        // Everton
                        { id: 115, web_name: 'Pickford', team: 8, element_type: 1, now_cost: 50, total_points: 134, goals_scored: 0, assists: 1, selected_by_percent: '8.2' },
                        { id: 116, web_name: 'Virginia', team: 8, element_type: 1, now_cost: 40, total_points: 23, goals_scored: 0, assists: 0, selected_by_percent: '0.3' },
                        // Fulham
                        { id: 117, web_name: 'Leno', team: 9, element_type: 1, now_cost: 45, total_points: 118, goals_scored: 0, assists: 0, selected_by_percent: '5.1' },
                        { id: 118, web_name: 'Rodák', team: 9, element_type: 1, now_cost: 40, total_points: 34, goals_scored: 0, assists: 0, selected_by_percent: '0.7' },
                        // Ipswich
                        { id: 119, web_name: 'Muric', team: 10, element_type: 1, now_cost: 45, total_points: 89, goals_scored: 0, assists: 0, selected_by_percent: '2.8' },
                        { id: 120, web_name: 'Walton', team: 10, element_type: 1, now_cost: 40, total_points: 45, goals_scored: 0, assists: 0, selected_by_percent: '0.6' },
                        // Leicester
                        { id: 121, web_name: 'Hermansen', team: 11, element_type: 1, now_cost: 45, total_points: 98, goals_scored: 0, assists: 0, selected_by_percent: '3.4' },
                        { id: 122, web_name: 'Ward', team: 11, element_type: 1, now_cost: 40, total_points: 56, goals_scored: 0, assists: 0, selected_by_percent: '1.2' },
                        // Liverpool
                        { id: 123, web_name: 'Alisson', team: 12, element_type: 1, now_cost: 55, total_points: 147, goals_scored: 0, assists: 1, selected_by_percent: '14.7' },
                        { id: 124, web_name: 'Kelleher', team: 12, element_type: 1, now_cost: 40, total_points: 67, goals_scored: 0, assists: 0, selected_by_percent: '2.1' },
                        // Manchester City
                        { id: 125, web_name: 'Ederson', team: 13, element_type: 1, now_cost: 55, total_points: 152, goals_scored: 0, assists: 1, selected_by_percent: '16.8' },
                        { id: 126, web_name: 'Ortega', team: 13, element_type: 1, now_cost: 40, total_points: 78, goals_scored: 0, assists: 0, selected_by_percent: '1.9' },
                        // Manchester United
                        { id: 127, web_name: 'Onana', team: 14, element_type: 1, now_cost: 50, total_points: 121, goals_scored: 0, assists: 0, selected_by_percent: '7.3' },
                        { id: 128, web_name: 'Bayindir', team: 14, element_type: 1, now_cost: 40, total_points: 34, goals_scored: 0, assists: 0, selected_by_percent: '0.5' },
                        // Newcastle
                        { id: 129, web_name: 'Pope', team: 15, element_type: 1, now_cost: 55, total_points: 121, goals_scored: 0, assists: 0, selected_by_percent: '6.1' },
                        { id: 130, web_name: 'Dubravka', team: 15, element_type: 1, now_cost: 40, total_points: 56, goals_scored: 0, assists: 0, selected_by_percent: '1.4' },
                        // Nottingham Forest
                        { id: 131, web_name: 'Sels', team: 16, element_type: 1, now_cost: 45, total_points: 112, goals_scored: 0, assists: 0, selected_by_percent: '4.8' },
                        { id: 132, web_name: 'Turner', team: 16, element_type: 1, now_cost: 40, total_points: 45, goals_scored: 0, assists: 0, selected_by_percent: '0.8' },
                        // Southampton
                        { id: 133, web_name: 'Ramsdale', team: 17, element_type: 1, now_cost: 45, total_points: 89, goals_scored: 0, assists: 0, selected_by_percent: '2.9' },
                        { id: 134, web_name: 'McCarthy', team: 17, element_type: 1, now_cost: 40, total_points: 67, goals_scored: 0, assists: 0, selected_by_percent: '1.3' },
                        // Tottenham
                        { id: 135, web_name: 'Vicario', team: 18, element_type: 1, now_cost: 50, total_points: 143, goals_scored: 0, assists: 1, selected_by_percent: '11.2' },
                        { id: 136, web_name: 'Forster', team: 18, element_type: 1, now_cost: 40, total_points: 34, goals_scored: 0, assists: 0, selected_by_percent: '0.6' },
                        // West Ham
                        { id: 137, web_name: 'Areola', team: 19, element_type: 1, now_cost: 45, total_points: 98, goals_scored: 0, assists: 0, selected_by_percent: '3.4' },
                        { id: 138, web_name: 'Fabianski', team: 19, element_type: 1, now_cost: 40, total_points: 78, goals_scored: 0, assists: 0, selected_by_percent: '1.7' },
                        // Wolves
                        { id: 139, web_name: 'Sá', team: 20, element_type: 1, now_cost: 45, total_points: 101, goals_scored: 0, assists: 0, selected_by_percent: '3.8' },
                        { id: 140, web_name: 'Bentley', team: 20, element_type: 1, now_cost: 40, total_points: 23, goals_scored: 0, assists: 0, selected_by_percent: '0.4' }
                    );
                    break;
                case 2: // Defenders (100 total)
                    additionalPlayers.push(
                        // Arsenal
                        { id: 201, web_name: 'Saliba', team: 1, element_type: 2, now_cost: 60, total_points: 168, goals_scored: 2, assists: 1, selected_by_percent: '30.0' },
                        { id: 202, web_name: 'Gabriel', team: 1, element_type: 2, now_cost: 60, total_points: 147, goals_scored: 4, assists: 1, selected_by_percent: '18.7' },
                        { id: 203, web_name: 'White', team: 1, element_type: 2, now_cost: 55, total_points: 134, goals_scored: 1, assists: 4, selected_by_percent: '14.2' },
                        { id: 204, web_name: 'Timber', team: 1, element_type: 2, now_cost: 55, total_points: 89, goals_scored: 0, assists: 2, selected_by_percent: '8.9' },
                        { id: 205, web_name: 'Zinchenko', team: 1, element_type: 2, now_cost: 50, total_points: 78, goals_scored: 1, assists: 1, selected_by_percent: '5.4' },
                        // Aston Villa  
                        { id: 206, web_name: 'Cash', team: 2, element_type: 2, now_cost: 50, total_points: 123, goals_scored: 1, assists: 3, selected_by_percent: '9.8' },
                        { id: 207, web_name: 'Konsa', team: 2, element_type: 2, now_cost: 45, total_points: 134, goals_scored: 2, assists: 1, selected_by_percent: '7.6' },
                        { id: 208, web_name: 'Torres', team: 2, element_type: 2, now_cost: 45, total_points: 98, goals_scored: 1, assists: 0, selected_by_percent: '4.3' },
                        { id: 209, web_name: 'Digne', team: 2, element_type: 2, now_cost: 50, total_points: 118, goals_scored: 1, assists: 5, selected_by_percent: '8.2' },
                        { id: 210, web_name: 'Moreno', team: 2, element_type: 2, now_cost: 45, total_points: 89, goals_scored: 0, assists: 2, selected_by_percent: '3.7' },
                        // Liverpool  
                        { id: 211, web_name: 'Van Dijk', team: 12, element_type: 2, now_cost: 65, total_points: 143, goals_scored: 3, assists: 2, selected_by_percent: '15.7' },
                        { id: 212, web_name: 'Robertson', team: 12, element_type: 2, now_cost: 60, total_points: 128, goals_scored: 2, assists: 5, selected_by_percent: '14.2' },
                        { id: 213, web_name: 'Alexander-Arnold', team: 12, element_type: 2, now_cost: 70, total_points: 167, goals_scored: 3, assists: 9, selected_by_percent: '35.0' },
                        { id: 214, web_name: 'Konaté', team: 12, element_type: 2, now_cost: 50, total_points: 112, goals_scored: 2, assists: 0, selected_by_percent: '8.9' },
                        { id: 215, web_name: 'Matip', team: 12, element_type: 2, now_cost: 45, total_points: 67, goals_scored: 1, assists: 0, selected_by_percent: '2.3' },
                        // Manchester City
                        { id: 216, web_name: 'Walker', team: 13, element_type: 2, now_cost: 55, total_points: 134, goals_scored: 1, assists: 3, selected_by_percent: '12.3' },
                        { id: 217, web_name: 'Dias', team: 13, element_type: 2, now_cost: 60, total_points: 147, goals_scored: 1, assists: 1, selected_by_percent: '16.7' },
                        { id: 218, web_name: 'Stones', team: 13, element_type: 2, now_cost: 55, total_points: 123, goals_scored: 2, assists: 2, selected_by_percent: '9.4' },
                        { id: 219, web_name: 'Akanji', team: 13, element_type: 2, now_cost: 50, total_points: 118, goals_scored: 1, assists: 2, selected_by_percent: '7.8' },
                        { id: 220, web_name: 'Gvardiol', team: 13, element_type: 2, now_cost: 55, total_points: 134, goals_scored: 2, assists: 3, selected_by_percent: '11.2' },
                        // Newcastle
                        { id: 221, web_name: 'Trippier', team: 15, element_type: 2, now_cost: 58, total_points: 125, goals_scored: 1, assists: 7, selected_by_percent: '11.8' },
                        { id: 222, web_name: 'Schär', team: 15, element_type: 2, now_cost: 50, total_points: 118, goals_scored: 3, assists: 1, selected_by_percent: '8.7' },
                        { id: 223, web_name: 'Botman', team: 15, element_type: 2, now_cost: 45, total_points: 89, goals_scored: 1, assists: 0, selected_by_percent: '4.2' },
                        { id: 224, web_name: 'Burn', team: 15, element_type: 2, now_cost: 45, total_points: 98, goals_scored: 2, assists: 1, selected_by_percent: '5.3' },
                        { id: 225, web_name: 'Hall', team: 15, element_type: 2, now_cost: 40, total_points: 67, goals_scored: 0, assists: 1, selected_by_percent: '2.1' }
                    );
                    break;
                case 3: // Midfielders (120 total)
                    additionalPlayers.push(
                        // Arsenal
                        { id: 301, web_name: 'Saka', team: 1, element_type: 3, now_cost: 100, total_points: 143, goals_scored: 9, assists: 12, selected_by_percent: '28.7' },
                        { id: 302, web_name: 'Ødegaard', team: 1, element_type: 3, now_cost: 83, total_points: 128, goals_scored: 8, assists: 10, selected_by_percent: '19.7' },
                        { id: 303, web_name: 'Rice', team: 1, element_type: 3, now_cost: 60, total_points: 156, goals_scored: 7, assists: 8, selected_by_percent: '24.3' },
                        { id: 304, web_name: 'Havertz', team: 1, element_type: 3, now_cost: 80, total_points: 134, goals_scored: 13, assists: 7, selected_by_percent: '16.8' },
                        { id: 305, web_name: 'Martinelli', team: 1, element_type: 3, now_cost: 70, total_points: 118, goals_scored: 6, assists: 8, selected_by_percent: '12.4' },
                        { id: 306, web_name: 'Smith Rowe', team: 1, element_type: 3, now_cost: 55, total_points: 89, goals_scored: 5, assists: 2, selected_by_percent: '6.7' },
                        // Liverpool
                        { id: 307, web_name: 'Salah', team: 12, element_type: 3, now_cost: 145, total_points: 344, goals_scored: 18, assists: 13, selected_by_percent: '55.0' },
                        { id: 307001, web_name: 'Wirtz', team: 12, element_type: 3, now_cost: 85, total_points: 0, goals_scored: 0, assists: 0, selected_by_percent: '30.0' },
                        { id: 308, web_name: 'Díaz', team: 12, element_type: 3, now_cost: 80, total_points: 143, goals_scored: 8, assists: 5, selected_by_percent: '18.9' },
                        { id: 309, web_name: 'Gakpo', team: 12, element_type: 3, now_cost: 75, total_points: 134, goals_scored: 12, assists: 6, selected_by_percent: '14.7' },
                        { id: 310, web_name: 'Szoboszlai', team: 12, element_type: 3, now_cost: 65, total_points: 118, goals_scored: 3, assists: 4, selected_by_percent: '9.8' },
                        { id: 311, web_name: 'Mac Allister', team: 12, element_type: 3, now_cost: 60, total_points: 123, goals_scored: 3, assists: 7, selected_by_percent: '11.2' },
                        { id: 312, web_name: 'Jones', team: 12, element_type: 3, now_cost: 50, total_points: 89, goals_scored: 2, assists: 3, selected_by_percent: '5.4' },
                        // Manchester City
                        { id: 313, web_name: 'De Bruyne', team: 13, element_type: 3, now_cost: 120, total_points: 176, goals_scored: 6, assists: 18, selected_by_percent: '23.4' },
                        { id: 314, web_name: 'Foden', team: 13, element_type: 3, now_cost: 95, total_points: 167, goals_scored: 19, assists: 8, selected_by_percent: '32.1' },
                        { id: 315, web_name: 'Rodri', team: 13, element_type: 3, now_cost: 60, total_points: 156, goals_scored: 8, assists: 9, selected_by_percent: '18.7' },
                        { id: 316, web_name: 'Bernardo Silva', team: 13, element_type: 3, now_cost: 70, total_points: 143, goals_scored: 8, assists: 11, selected_by_percent: '15.3' },
                        { id: 317, web_name: 'Grealish', team: 13, element_type: 3, now_cost: 65, total_points: 118, goals_scored: 3, assists: 7, selected_by_percent: '8.9' },
                        { id: 318, web_name: 'Kovačić', team: 13, element_type: 3, now_cost: 50, total_points: 98, goals_scored: 1, assists: 4, selected_by_percent: '4.7' },
                        // Chelsea
                        { id: 319, web_name: 'Palmer', team: 6, element_type: 3, now_cost: 105, total_points: 152, goals_scored: 11, assists: 15, selected_by_percent: '31.4' },
                        { id: 320, web_name: 'Enzo', team: 6, element_type: 3, now_cost: 60, total_points: 123, goals_scored: 3, assists: 6, selected_by_percent: '9.8' },
                        { id: 321, web_name: 'Sterling', team: 6, element_type: 3, now_cost: 70, total_points: 118, goals_scored: 8, assists: 4, selected_by_percent: '7.6' },
                        { id: 322, web_name: 'Gallagher', team: 6, element_type: 3, now_cost: 55, total_points: 134, goals_scored: 7, assists: 9, selected_by_percent: '12.3' },
                        { id: 323, web_name: 'Mudryk', team: 6, element_type: 3, now_cost: 60, total_points: 89, goals_scored: 4, assists: 2, selected_by_percent: '4.2' },
                        // Tottenham
                        { id: 324, web_name: 'Son', team: 18, element_type: 3, now_cost: 100, total_points: 167, goals_scored: 14, assists: 9, selected_by_percent: '22.1' },
                        { id: 325, web_name: 'Maddison', team: 18, element_type: 3, now_cost: 75, total_points: 134, goals_scored: 4, assists: 9, selected_by_percent: '13.2' },
                        { id: 326, web_name: 'Kulusevski', team: 18, element_type: 3, now_cost: 65, total_points: 123, goals_scored: 8, assists: 3, selected_by_percent: '9.7' },
                        { id: 327, web_name: 'Porro', team: 18, element_type: 3, now_cost: 55, total_points: 118, goals_scored: 2, assists: 7, selected_by_percent: '8.9' },
                        { id: 328, web_name: 'Sarr', team: 18, element_type: 3, now_cost: 50, total_points: 89, goals_scored: 3, assists: 4, selected_by_percent: '5.1' },
                        // Manchester United
                        { id: 329, web_name: 'Bruno Fernandes', team: 14, element_type: 3, now_cost: 85, total_points: 168, goals_scored: 10, assists: 8, selected_by_percent: '18.9' },
                        { id: 330, web_name: 'Rashford', team: 14, element_type: 3, now_cost: 70, total_points: 118, goals_scored: 8, assists: 5, selected_by_percent: '9.7' },
                        { id: 331, web_name: 'Garnacho', team: 14, element_type: 3, now_cost: 60, total_points: 134, goals_scored: 7, assists: 4, selected_by_percent: '11.8' },
                        { id: 332, web_name: 'Mount', team: 14, element_type: 3, now_cost: 55, total_points: 89, goals_scored: 1, assists: 2, selected_by_percent: '3.4' },
                        { id: 333, web_name: 'Antony', team: 14, element_type: 3, now_cost: 50, total_points: 67, goals_scored: 1, assists: 1, selected_by_percent: '2.1' }
                    );
                    break;
                case 4: // Forwards (60 total)
                    additionalPlayers.push(
                        // Manchester City
                        { id: 401, web_name: 'Haaland', team: 13, element_type: 4, now_cost: 140, total_points: 245, goals_scored: 27, assists: 5, selected_by_percent: '60.0' },
                        { id: 402, web_name: 'Álvarez', team: 13, element_type: 4, now_cost: 70, total_points: 156, goals_scored: 11, assists: 9, selected_by_percent: '18.7' },
                        // Arsenal
                        { id: 403, web_name: 'Jesus', team: 1, element_type: 4, now_cost: 80, total_points: 118, goals_scored: 4, assists: 5, selected_by_percent: '8.9' },
                        { id: 404, web_name: 'Nketiah', team: 1, element_type: 4, now_cost: 60, total_points: 89, goals_scored: 5, assists: 2, selected_by_percent: '4.7' },
                        // Liverpool
                        { id: 405, web_name: 'Nunez', team: 12, element_type: 4, now_cost: 75, total_points: 142, goals_scored: 15, assists: 4, selected_by_percent: '16.7' },
                        { id: 406, web_name: 'Jota', team: 12, element_type: 4, now_cost: 75, total_points: 134, goals_scored: 10, assists: 2, selected_by_percent: '12.3' },
                        // Tottenham  
                        { id: 407, web_name: 'Richarlison', team: 18, element_type: 4, now_cost: 65, total_points: 98, goals_scored: 7, assists: 3, selected_by_percent: '6.8' },
                        { id: 408, web_name: 'Johnson', team: 18, element_type: 4, now_cost: 60, total_points: 134, goals_scored: 5, assists: 10, selected_by_percent: '14.2' },
                        // Newcastle
                        { id: 409, web_name: 'Isak', team: 15, element_type: 4, now_cost: 85, total_points: 132, goals_scored: 15, assists: 3, selected_by_percent: '18.3' },
                        { id: 410, web_name: 'Wilson', team: 15, element_type: 4, now_cost: 70, total_points: 121, goals_scored: 14, assists: 2, selected_by_percent: '8.9' },
                        // Aston Villa
                        { id: 411, web_name: 'Watkins', team: 2, element_type: 4, now_cost: 90, total_points: 141, goals_scored: 16, assists: 7, selected_by_percent: '24.1' },
                        { id: 412, web_name: 'Durán', team: 2, element_type: 4, now_cost: 55, total_points: 89, goals_scored: 6, assists: 2, selected_by_percent: '5.7' },
                        // Chelsea
                        { id: 413, web_name: 'Jackson', team: 6, element_type: 4, now_cost: 75, total_points: 134, goals_scored: 14, assists: 5, selected_by_percent: '15.8' },
                        { id: 414, web_name: 'Broja', team: 6, element_type: 4, now_cost: 50, total_points: 67, goals_scored: 2, assists: 1, selected_by_percent: '2.3' },
                        // West Ham
                        { id: 415, web_name: 'Antonio', team: 19, element_type: 4, now_cost: 55, total_points: 98, goals_scored: 6, assists: 3, selected_by_percent: '4.8' },
                        { id: 416, web_name: 'Bowen', team: 19, element_type: 4, now_cost: 70, total_points: 156, goals_scored: 14, assists: 7, selected_by_percent: '18.9' },
                        // Brighton
                        { id: 417, web_name: 'Ferguson', team: 5, element_type: 4, now_cost: 55, total_points: 89, goals_scored: 6, assists: 1, selected_by_percent: '4.2' },
                        { id: 418, web_name: 'Welbeck', team: 5, element_type: 4, now_cost: 55, total_points: 118, goals_scored: 8, assists: 3, selected_by_percent: '7.1' },
                        // Crystal Palace  
                        { id: 419, web_name: 'Mateta', team: 7, element_type: 4, now_cost: 60, total_points: 134, goals_scored: 14, assists: 2, selected_by_percent: '11.7' },
                        { id: 420, web_name: 'Edouard', team: 7, element_type: 4, now_cost: 50, total_points: 78, goals_scored: 4, assists: 1, selected_by_percent: '2.8' },
                        // Manchester United
                        { id: 421, web_name: 'Højlund', team: 14, element_type: 4, now_cost: 65, total_points: 118, goals_scored: 10, assists: 2, selected_by_percent: '9.3' },
                        { id: 422, web_name: 'Martial', team: 14, element_type: 4, now_cost: 55, total_points: 67, goals_scored: 2, assists: 1, selected_by_percent: '2.1' },
                        // Fulham
                        { id: 423, web_name: 'Jiménez', team: 9, element_type: 4, now_cost: 55, total_points: 134, goals_scored: 7, assists: 5, selected_by_percent: '8.7' },
                        { id: 424, web_name: 'Muniz', team: 9, element_type: 4, now_cost: 50, total_points: 89, goals_scored: 6, assists: 1, selected_by_percent: '4.1' },
                        // Brentford
                        { id: 425, web_name: 'Toney', team: 4, element_type: 4, now_cost: 70, total_points: 143, goals_scored: 20, assists: 4, selected_by_percent: '19.8' },
                        { id: 426, web_name: 'Mbeumo', team: 4, element_type: 4, now_cost: 60, total_points: 118, goals_scored: 8, assists: 9, selected_by_percent: '11.2' },
                        // Bournemouth
                        { id: 427, web_name: 'Solanke', team: 3, element_type: 4, now_cost: 65, total_points: 134, goals_scored: 19, assists: 3, selected_by_percent: '16.7' },
                        { id: 428, web_name: 'Kluivert', team: 3, element_type: 4, now_cost: 50, total_points: 89, goals_scored: 5, assists: 4, selected_by_percent: '4.9' },
                        // Wolves
                        { id: 429, web_name: 'Hwang', team: 20, element_type: 4, now_cost: 55, total_points: 118, goals_scored: 12, assists: 4, selected_by_percent: '8.1' },
                        { id: 430, web_name: 'Cunha', team: 20, element_type: 4, now_cost: 60, total_points: 134, goals_scored: 12, assists: 7, selected_by_percent: '12.8' },
                        // Additional popular comparison players
                        { id: 431, web_name: 'Eze', team: 7, element_type: 3, now_cost: 70, total_points: 134, goals_scored: 11, assists: 4, selected_by_percent: '9.8' },
                        { id: 432, web_name: 'Gordon', team: 15, element_type: 3, now_cost: 70, total_points: 118, goals_scored: 7, assists: 8, selected_by_percent: '12.4' },
                        { id: 433, web_name: 'Luiz', team: 2, element_type: 3, now_cost: 55, total_points: 89, goals_scored: 3, assists: 5, selected_by_percent: '6.7' },
                        { id: 434, web_name: 'Nkunku', team: 6, element_type: 4, now_cost: 65, total_points: 67, goals_scored: 3, assists: 1, selected_by_percent: '4.2' },
                        { id: 435, web_name: 'Mahrez', team: 13, element_type: 3, now_cost: 80, total_points: 156, goals_scored: 11, assists: 12, selected_by_percent: '15.3' },
                        { id: 436, web_name: 'Kane', team: 18, element_type: 4, now_cost: 110, total_points: 213, goals_scored: 30, assists: 3, selected_by_percent: '31.2' },
                        { id: 437, web_name: 'Rashford', team: 14, element_type: 3, now_cost: 70, total_points: 118, goals_scored: 8, assists: 5, selected_by_percent: '9.7' },
                        { id: 438, web_name: 'Grealish', team: 13, element_type: 3, now_cost: 65, total_points: 118, goals_scored: 3, assists: 7, selected_by_percent: '8.9' },
                        { id: 439, web_name: 'Sterling', team: 6, element_type: 3, now_cost: 70, total_points: 118, goals_scored: 8, assists: 4, selected_by_percent: '7.6' },
                        { id: 440, web_name: 'Firmino', team: 12, element_type: 4, now_cost: 65, total_points: 89, goals_scored: 6, assists: 4, selected_by_percent: '5.8' }
                    );
                    break;
            }
            
            return additionalPlayers;
        }

        function displayPlayersInModal(players) {
            const playersList = document.getElementById('players-list');
            if (!playersList) return;
            
            playersList.innerHTML = players.map(player => {
                const team = getTeamData(player.team);
                const teamColors = team ? { primary: team.shirt_color, secondary: team.secondary_color } : { primary: '#333', secondary: '#fff' };
                
                return `
                    <div class="player-option" onclick="selectTeamBuilderPlayer(${player.id}, '${player.web_name}', ${player.now_cost / 10})">
                        <div class="player-jersey">
                            <div class="jersey-shirt" style="background: ${teamColors.primary}; border: 2px solid ${teamColors.secondary};">
                                <span class="jersey-number" style="color: ${teamColors.secondary};">⚽</span>
                            </div>
                        </div>
                        <div class="player-info">
                            <div class="player-name">${player.web_name}</div>
                            <div class="player-team" style="color: ${teamColors.primary}; font-weight: 600;">${team?.short_name || 'UNK'}</div>
                        </div>
                        <div class="player-stats">
                            <div class="player-points">${player.total_points} pts</div>
                            <div class="player-price">£${(player.now_cost / 10).toFixed(1)}m</div>
                            <div class="player-ownership">${player.selected_by_percent}% owned</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getTeamName(teamId) {
            const teams = fplLiveStats.getFallbackTeams();
            const team = teams.find(t => t.id === teamId);
            return team ? team.short_name : 'UNK';
        }

        function getTeamData(teamId) {
            const teams = fplLiveStats.getFallbackTeams();
            return teams.find(t => t.id === teamId);
        }

        function selectTeamBuilderPlayer(playerId, playerName, price) {
            const { position, slot } = currentSelection;
            addPlayerToTeam(position, slot, playerName, price, playerId);
            closePlayerModal();
        }

        function filterPlayers() {
            const searchTerm = document.getElementById('player-search').value.toLowerCase();
            const playerOptions = document.querySelectorAll('.player-option');
            
            playerOptions.forEach(option => {
                const playerName = option.querySelector('.player-name').textContent.toLowerCase();
                const playerTeam = option.querySelector('.player-team').textContent.toLowerCase();
                
                if (playerName.includes(searchTerm) || playerTeam.includes(searchTerm)) {
                    option.style.display = 'flex';
                } else {
                    option.style.display = 'none';
                }
            });
        }

        function sortPlayers() {
            const sortBy = document.getElementById('sort-filter').value;
            const playersList = document.getElementById('players-list');
            const players = Array.from(playersList.querySelectorAll('.player-option'));
            
            players.sort((a, b) => {
                switch(sortBy) {
                    case 'points':
                        const pointsA = parseInt(a.querySelector('.player-points').textContent);
                        const pointsB = parseInt(b.querySelector('.player-points').textContent);
                        return pointsB - pointsA;
                    case 'price':
                        const priceA = parseFloat(a.querySelector('.player-price').textContent.replace('£', '').replace('m', ''));
                        const priceB = parseFloat(b.querySelector('.player-price').textContent.replace('£', '').replace('m', ''));
                        return priceA - priceB;
                    case 'price-desc':
                        const priceA2 = parseFloat(a.querySelector('.player-price').textContent.replace('£', '').replace('m', ''));
                        const priceB2 = parseFloat(b.querySelector('.player-price').textContent.replace('£', '').replace('m', ''));
                        return priceB2 - priceA2;
                    case 'name':
                        const nameA = a.querySelector('.player-name').textContent;
                        const nameB = b.querySelector('.player-name').textContent;
                        return nameA.localeCompare(nameB);
                    default:
                        return 0;
                }
            });
            
            // Clear and re-append sorted players
            playersList.innerHTML = '';
            players.forEach(player => playersList.appendChild(player));
        }

        function addPlayerToTeam(position, slot, name, price, playerId) {
            // Validate team constraints
            const validation = validateTeamConstraints(position, price, playerId);
            if (!validation.valid) {
                alert(validation.message);
                return;
            }
            
            if (teamBudget >= price) {
                // Remove previous player if slot was occupied
                if (selectedPlayers[position][slot]) {
                    teamBudget += selectedPlayers[position][slot].price;
                }
                
                selectedPlayers[position][slot] = { name, price, id: playerId };
                teamBudget -= price;
                updateTeamDisplay();
                updateBudgetDisplay();
                
                // Check if team is complete
                checkTeamCompletion();
            } else {
                alert('Not enough budget! You need £' + (price - teamBudget).toFixed(1) + 'm more.');
            }
        }

        function validateTeamConstraints(position, price, playerId) {
            // Check max 3 players from same team rule
            const fallbackData = fplLiveStats.getFallbackBootstrap();
            const allPlayers = fallbackData.elements || [];
            const additionalPlayers = [
                ...generateAdditionalPlayersForPosition(1),
                ...generateAdditionalPlayersForPosition(2),
                ...generateAdditionalPlayersForPosition(3),
                ...generateAdditionalPlayersForPosition(4)
            ];
            const combinedPlayers = [...allPlayers, ...additionalPlayers];
            const selectedPlayer = combinedPlayers.find(p => p.id === playerId);
            
            if (selectedPlayer) {
                const playersFromSameTeam = Object.values(selectedPlayers)
                    .flat()
                    .filter(player => {
                        if (!player) return false;
                        const playerInfo = combinedPlayers.find(p => p.id === player.id);
                        return playerInfo && playerInfo.team === selectedPlayer.team;
                    });
                
                if (playersFromSameTeam.length >= 3) {
                    const teamName = getTeamName(selectedPlayer.team);
                    return { 
                        valid: false, 
                        message: `You can only have 3 players from ${teamName}. You already have ${playersFromSameTeam.length}.` 
                    };
                }
            }
            
            return { valid: true };
        }

        function checkTeamCompletion() {
            const totalPlayers = Object.values(selectedPlayers)
                .flat()
                .filter(player => player !== null).length;
            
            if (totalPlayers === 15) {
                setTimeout(() => {
                    alert('🎉 Team Complete! You have selected all 15 players. Budget remaining: £' + teamBudget.toFixed(1) + 'm');
                }, 500);
            }
        }

        function updateTeamDisplay() {
            // Update visual display of team slots
            Object.keys(selectedPlayers).forEach(position => {
                selectedPlayers[position].forEach((player, slot) => {
                    const slotElement = document.querySelector(`[onclick="openTeamBuilderPlayerSelector('${position}', ${slot})"]`);
                    if (player && slotElement) {
                        // Get player team data for colors
                        const fallbackData = fplLiveStats.getFallbackBootstrap();
                        const allPlayers = [...fallbackData.elements, ...generateAdditionalPlayersForPosition(1), ...generateAdditionalPlayersForPosition(2), ...generateAdditionalPlayersForPosition(3), ...generateAdditionalPlayersForPosition(4)];
                        const playerData = allPlayers.find(p => p.id === player.id);
                        const team = getTeamData(playerData?.team);
                        const teamColors = team ? { primary: team.shirt_color, secondary: team.secondary_color } : { primary: '#333', secondary: '#fff' };
                        
                        slotElement.classList.add('filled');
                        slotElement.innerHTML = `
                            <div class="jersey-mini" style="background: ${teamColors.primary}; border: 1px solid ${teamColors.secondary};"></div>
                            <span class="slot-text">${player.name} (£${player.price}m)</span>
                        `;
                    } else if (!player && slotElement) {
                        // Reset empty slots
                        slotElement.classList.remove('filled');
                        const posName = position.toUpperCase();
                        slotElement.innerHTML = `<span class="slot-text">+ Add ${posName}</span>`;
                    }
                });
            });
        }

        function updateBudgetDisplay() {
            const budgetElement = document.getElementById('budget-remaining');
            if (budgetElement) {
                budgetElement.textContent = `£${teamBudget.toFixed(1)}m`;
                
                // Color coding based on budget remaining
                if (teamBudget < 5) {
                    budgetElement.style.color = '#dc3545';
                } else if (teamBudget < 15) {
                    budgetElement.style.color = '#ffc107';
                } else {
                    budgetElement.style.color = '#00ff87';
                }
            }
        }

        function saveTeam() {
            const teamData = {
                players: selectedPlayers,
                budget: teamBudget,
                savedAt: new Date().toISOString()
            };
            
            localStorage.setItem('fpl-team', JSON.stringify(teamData));
            alert('🎉 Team saved successfully! You can load it anytime.');
        }

        function loadTeam() {
            const savedTeam = localStorage.getItem('fpl-team');
            if (!savedTeam) {
                alert('No saved team found. Save a team first!');
                return;
            }
            
            try {
                const teamData = JSON.parse(savedTeam);
                
                if (confirm(`Load your saved team from ${new Date(teamData.savedAt).toLocaleDateString()}?`)) {
                    selectedPlayers = teamData.players;
                    teamBudget = teamData.budget;
                    updateTeamDisplay();
                    updateBudgetDisplay();
                    alert('✅ Team loaded successfully!');
                }
            } catch (error) {
                alert('Error loading saved team. The saved data may be corrupted.');
            }
        }

        function resetTeam() {
            if (confirm('Are you sure you want to reset your team? This will remove all selected players.')) {
                selectedPlayers = {
                    gk: [null, null],
                    def: [null, null, null, null, null],
                    mid: [null, null, null, null, null],
                    fwd: [null, null, null]
                };
                startingXI = {
                    gk: null,
                    def: [null, null, null, null],
                    mid: [null, null, null],
                    fwd: [null, null, null]
                };
                benchPlayers = {
                    gk: null,
                    def: null,
                    mid: [null, null]
                };
                teamBudget = 100.0;
                
                updateTeamDisplay();
                updateBudgetDisplay();
                updateFieldDisplay();
                updateBenchDisplay();
                alert('Team reset successfully!');
            }
        }


        // Enhanced interactive features
        function animateStatBubbles() {
            const bubbles = document.querySelectorAll('.stat-bubble');
            bubbles.forEach((bubble, index) => {
                setTimeout(() => {
                    bubble.style.opacity = '0';
                    bubble.style.transform = 'translateY(20px)';
                    
                    setTimeout(() => {
                        bubble.style.transition = 'all 0.5s ease';
                        bubble.style.opacity = '1';
                        bubble.style.transform = 'translateY(0)';
                    }, 100);
                }, index * 200);
            });
        }

        // Enhanced notification system
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            let bgColor;
            switch(type) {
                case 'success':
                    bgColor = 'linear-gradient(135deg, #28a745, #20c997)';
                    break;
                case 'error':
                    bgColor = 'linear-gradient(135deg, #dc3545, #e74c3c)';
                    break;
                case 'info':
                    bgColor = 'linear-gradient(135deg, #17a2b8, #007bff)';
                    break;
                default:
                    bgColor = 'linear-gradient(135deg, #6c757d, #495057)';
            }
            
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 10px;
                color: white;
                font-weight: 600;
                z-index: 10001;
                transform: translateX(100%);
                transition: transform 0.3s ease;
                background: ${bgColor};
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            `;
            
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // Add some interactive features
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize live stats system
            console.log('Initializing FPL Live Stats System...');
            
            // Initialize static player data
            console.log('Initializing FPL Team Builder...');
            
            // Load static player data from fallback
            const fallbackData = fplLiveStats.getFallbackBootstrap();
            const players = fallbackData.elements || [];
            const teams = fallbackData.teams || [];
            playerData = fplLiveStats.formatPlayerData(players, teams);
            
            // Initialize team builder
            initializeTeamBuilder();
            
            // Initialize bench display
            updateBenchDisplay();
            
            // Populate player comparison dropdowns
            populatePlayerDropdowns();
            
            // Initialize comparison tool
            setTimeout(() => {
                updateComparison();
            }, 1000);

            console.log('FPL Team Builder initialized successfully');
            
            // Animate header stats on load
            setTimeout(animateStatBubbles, 1500);
            
            // Add click effects to captain cards
            document.querySelectorAll('.captain-card').forEach(card => {
                card.addEventListener('click', function() {
                    // Remove active class from all cards
                    document.querySelectorAll('.captain-card').forEach(c => c.classList.remove('selected'));
                    
                    // Add active class to clicked card
                    this.classList.add('selected');
                    
                    // Store selection (in real app, this would save to user's team)
                    const playerName = this.querySelector('.player-name').textContent;
                    console.log('Selected captain:', playerName);
                    
                    // Show success message
                    const originalText = this.querySelector('p').textContent;
                    this.querySelector('p').textContent = '✅ Selected as Captain!';
                    setTimeout(() => {
                        this.querySelector('p').textContent = originalText;
                    }, 2000);
                });
            });

            // Add hover effects to player cards in formation
            document.querySelectorAll('.player-card').forEach(card => {
                card.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-8px) scale(1.05)';
                });
                
                card.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0) scale(1)';
                });
            });


            // Animate cards on scroll
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };

            const observer = new IntersectionObserver(function(entries) {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.animation = 'slideInUp 0.6s ease-out';
                        observer.unobserve(entry.target);
                    }
                });
            }, observerOptions);

            document.querySelectorAll('.fpl-card').forEach(card => {
                observer.observe(card);
            });

            // Initialize new game functionality
            initializeNewGames();
        });

        // New Game Functions
        function initializeNewGames() {
            // Team Head-to-Head Analyzer
            document.getElementById('team1-select').addEventListener('change', updateTeamComparison);
            document.getElementById('team2-select').addEventListener('change', updateTeamComparison);
            
            // Captain Roulette
            document.getElementById('spin-captain').addEventListener('click', spinCaptain);
        }

        function updateTeamComparison() {
            const team1Id = document.getElementById('team1-select').value;
            const team2Id = document.getElementById('team2-select').value;
            const resultDiv = document.getElementById('team-comparison-result');
            
            if (!team1Id || !team2Id) {
                resultDiv.innerHTML = 'Select two teams to see head-to-head comparison';
                return;
            }
            
            if (team1Id === team2Id) {
                resultDiv.innerHTML = 'Please select two different teams';
                return;
            }
            
            const teams = {
                '1': { name: 'Arsenal', attack: 8.5, defense: 7.8, form: 8.2 },
                '2': { name: 'Aston Villa', attack: 7.3, defense: 6.9, form: 7.1 },
                '12': { name: 'Liverpool', attack: 9.2, defense: 7.5, form: 8.8 },
                '13': { name: 'Manchester City', attack: 9.5, defense: 8.1, form: 8.9 },
                '14': { name: 'Manchester United', attack: 6.8, defense: 6.2, form: 6.5 },
                '15': { name: 'Newcastle', attack: 7.8, defense: 7.2, form: 7.5 },
                '18': { name: 'Tottenham', attack: 8.1, defense: 6.5, form: 7.3 }
            };
            
            const team1 = teams[team1Id];
            const team2 = teams[team2Id];
            
            const team1Score = (team1.attack + team1.defense + team1.form) / 3;
            const team2Score = (team2.attack + team2.defense + team2.form) / 3;
            
            let prediction = '';
            if (team1Score > team2Score + 0.5) {
                prediction = `<strong>${team1.name}</strong> favored to win`;
            } else if (team2Score > team1Score + 0.5) {
                prediction = `<strong>${team2.name}</strong> favored to win`;
            } else {
                prediction = 'Close match - could go either way';
            }
            
            resultDiv.innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr auto 1fr; gap: 15px; align-items: center;">
                    <div style="text-align: center;">
                        <div style="font-weight: bold; font-size: 1.1rem; color: #37003c;">${team1.name}</div>
                        <div style="font-size: 0.9rem; margin-top: 5px;">
                            <div>Attack: ${team1.attack}/10</div>
                            <div>Defense: ${team1.defense}/10</div>
                            <div>Form: ${team1.form}/10</div>
                        </div>
                    </div>
                    <div style="font-size: 1.5rem; color: #666;">VS</div>
                    <div style="text-align: center;">
                        <div style="font-weight: bold; font-size: 1.1rem; color: #37003c;">${team2.name}</div>
                        <div style="font-size: 0.9rem; margin-top: 5px;">
                            <div>Attack: ${team2.attack}/10</div>
                            <div>Defense: ${team2.defense}/10</div>
                            <div>Form: ${team2.form}/10</div>
                        </div>
                    </div>
                </div>
                <div style="margin-top: 15px; padding: 10px; background: #e8f5e8; border-radius: 5px; text-align: center; font-weight: bold; color: #2d5a2d;">
                    🎯 ${prediction}
                </div>
            `;
        }

        function spinCaptain() {
            const button = document.getElementById('spin-captain');
            const resultDiv = document.getElementById('captain-result');
            
            button.disabled = true;
            button.innerHTML = '🎲 Spinning...';
            
            const captainOptions = [
                { name: 'Mohamed Salah', team: 'Liverpool', price: '13.0m', reason: 'Home fixture and penalty duties' },
                { name: 'Erling Haaland', team: 'Man City', price: '14.0m', reason: 'Most explosive scoring potential' },
                { name: 'Cole Palmer', team: 'Chelsea', price: '10.5m', reason: 'Great value with penalty duties' },
                { name: 'Bukayo Saka', team: 'Arsenal', price: '10.0m', reason: 'Consistent returns and set pieces' },
                { name: 'Son Heung-min', team: 'Tottenham', price: '10.0m', reason: 'Home form and attacking threat' },
                { name: 'Alexander Isak', team: 'Newcastle', price: '8.5m', reason: 'Excellent value forward option' },
                { name: 'Bruno Fernandes', team: 'Man United', price: '8.5m', reason: 'Penalties and playmaking ability' },
                { name: 'Ollie Watkins', team: 'Aston Villa', price: '9.0m', reason: 'In-form striker with good fixtures' }
            ];
            
            setTimeout(() => {
                const randomCaptain = captainOptions[Math.floor(Math.random() * captainOptions.length)];
                
                resultDiv.innerHTML = `
                    <div style="text-align: center;">
                        <div style="font-size: 1.2rem; font-weight: bold; color: #37003c; margin-bottom: 8px;">
                            🎯 ${randomCaptain.name} (C)
                        </div>
                        <div style="color: #666; margin-bottom: 8px;">
                            ${randomCaptain.team} • ${randomCaptain.price}
                        </div>
                        <div style="background: #e8f5e8; padding: 8px; border-radius: 5px; font-size: 0.9rem; color: #2d5a2d;">
                            💡 ${randomCaptain.reason}
                        </div>
                    </div>
                `;
                
                button.disabled = false;
                button.innerHTML = '🎲 Spin Again';
            }, 1500);
        }

        function analyzeFormation() {
            const formation = document.getElementById('formation-select').value;
            const analysisDiv = document.getElementById('formation-analysis');
            
            const formationData = {
                '3-4-3': {
                    style: 'Attacking',
                    pros: ['High attacking output', 'Wing-backs provide width', 'Three forwards for goals'],
                    cons: ['Vulnerable to counter-attacks', 'Requires fit wing-backs', 'Light in midfield'],
                    recommended: ['Premium forwards like Haaland', 'Attacking wing-backs', 'Strong defensive trio'],
                    budget: '£25m+ on forwards'
                },
                '3-5-2': {
                    style: 'Midfield Control',
                    pros: ['Dominates midfield', 'Good defensive stability', 'Wing-backs can attack'],
                    cons: ['Limited forward options', 'Depends on midfield scoring', 'Wing-back fitness crucial'],
                    recommended: ['Attacking midfielders', 'Box-to-box players', 'Creative wing-backs'],
                    budget: '£30m+ on midfield'
                },
                '4-3-3': {
                    style: 'Balanced',
                    pros: ['Well-balanced all areas', 'Good defensive shape', 'Multiple attacking outlets'],
                    cons: ['Can lack specialist focus', 'Midfield can be outnumbered', 'Requires versatile players'],
                    recommended: ['One premium forward', 'Creative midfielders', 'Attacking full-backs'],
                    budget: '£20-25m on each line'
                },
                '4-4-2': {
                    style: 'Classic',
                    pros: ['Simple and effective', 'Good width from midfield', 'Two striker partnership'],
                    cons: ['Can be outdated', 'Light in central midfield', 'Vulnerable to overloads'],
                    recommended: ['Two complementary forwards', 'Wide midfielders', 'Solid full-backs'],
                    budget: '£18-22m on forward pair'
                },
                '4-5-1': {
                    style: 'Defensive',
                    pros: ['Very solid defensively', 'Midfield numbers', 'Counter-attack potential'],
                    cons: ['Limited attacking threat', 'Relies on one forward', 'Can be too cautious'],
                    recommended: ['One premium forward', 'Defensive midfielders', 'Clean sheet defenders'],
                    budget: '£12-15m on single forward'
                },
                '5-3-2': {
                    style: 'Ultra Defensive',
                    pros: ['Maximum defensive cover', 'Hard to break down', 'Wing-backs key'],
                    cons: ['Very limited attack', 'Requires special circumstances', 'Boring to watch'],
                    recommended: ['Defensive assets only', 'Premium goalkeeper', 'Wing-backs who attack'],
                    budget: '£8-12m total on forwards'
                }
            };
            
            const data = formationData[formation];
            
            analysisDiv.innerHTML = `
                <div>
                    <div style="font-weight: bold; font-size: 1.1rem; color: #37003c; margin-bottom: 10px;">
                        ${formation} - ${data.style} Formation
                    </div>
                    
                    <div style="margin-bottom: 12px;">
                        <div style="font-weight: bold; color: #28a745; margin-bottom: 5px;">✅ Pros:</div>
                        <ul style="margin: 0; padding-left: 20px; font-size: 0.9rem;">
                            ${data.pros.map(pro => `<li>${pro}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div style="margin-bottom: 12px;">
                        <div style="font-weight: bold; color: #dc3545; margin-bottom: 5px;">❌ Cons:</div>
                        <ul style="margin: 0; padding-left: 20px; font-size: 0.9rem;">
                            ${data.cons.map(con => `<li>${con}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div style="background: #f0f8ff; padding: 8px; border-radius: 5px; font-size: 0.9rem;">
                        <div style="font-weight: bold; margin-bottom: 5px;">💡 Recommended Strategy:</div>
                        <div>${data.recommended.join(', ')}</div>
                        <div style="margin-top: 5px;"><strong>Budget:</strong> ${data.budget}</div>
                    </div>
                </div>
            `;
        }

        // New Game 4: Player Performance Predictor
        function calculatePrediction() {
            const player = document.getElementById('predictor-player-select').value;
            const goals = parseInt(document.getElementById('goals-prediction').value) || 0;
            const assists = parseInt(document.getElementById('assists-prediction').value) || 0;
            const bonus = parseInt(document.getElementById('bonus-prediction').value) || 0;
            const minutes = parseInt(document.getElementById('minutes-prediction').value) || 0;
            const resultDiv = document.getElementById('prediction-result');
            
            if (!player) {
                resultDiv.innerHTML = 'Please select a player first!';
                return;
            }
            
            // Calculate points based on FPL scoring system
            let points = 0;
            
            // Minutes played
            if (minutes === 2) points += 2; // 60+ minutes
            else if (minutes === 1) points += 1; // 1-59 minutes
            
            // Goals (position dependent)
            const isDefender = player === 'van-dijk' || player === 'alexander-arnold';
            const isMidfielder = ['salah', 'palmer', 'saka', 'bruno'].includes(player);
            const isForward = ['haaland', 'isak', 'watkins'].includes(player);
            
            if (isDefender) points += goals * 6;
            else if (isMidfielder) points += goals * 5;
            else if (isForward) points += goals * 4;
            
            // Assists
            points += assists * 3;
            
            // Bonus points
            points += bonus;
            
            const playerNames = {
                'salah': 'Mohamed Salah',
                'haaland': 'Erling Haaland', 
                'palmer': 'Cole Palmer',
                'saka': 'Bukayo Saka',
                'son': 'Son Heung-min',
                'isak': 'Alexander Isak',
                'bruno': 'Bruno Fernandes',
                'watkins': 'Ollie Watkins'
            };
            
            resultDiv.innerHTML = `
                <div style="text-align: center;">
                    <div style="font-size: 1.2rem; font-weight: bold; color: #37003c; margin-bottom: 10px;">
                        ${playerNames[player]} Prediction
                    </div>
                    <div style="font-size: 2rem; font-weight: bold; color: #6f42c1; margin: 15px 0;">
                        ${points} Points
                    </div>
                    <div style="font-size: 0.9rem; color: #666;">
                        <div>⚽ Goals: ${goals} (+${isDefender ? goals*6 : isMidfielder ? goals*5 : goals*4} pts)</div>
                        <div>🎯 Assists: ${assists} (+${assists*3} pts)</div>
                        <div>⏱️ Minutes: ${minutes === 2 ? '60+' : minutes === 1 ? '1-59' : '0'} (+${minutes === 2 ? 2 : minutes} pts)</div>
                        <div>🌟 Bonus: ${bonus} (+${bonus} pts)</div>
                    </div>
                </div>
            `;
        }

        // New Game 5: Budget Optimizer Challenge
        function generateOptimalTeam() {
            const budget = parseFloat(document.getElementById('budget-limit').value);
            const target = parseInt(document.getElementById('target-points').value);
            const resultDiv = document.getElementById('budget-optimizer-result');
            
            // Sample optimal teams for different budgets
            const optimalTeams = {
                100: {
                    formation: '3-4-3',
                    players: ['Ederson', 'Van Dijk', 'Saliba', 'Gabriel', 'Alexander-Arnold', 'Salah', 'Palmer', 'Saka', 'Haaland', 'Isak', 'Watkins'],
                    cost: 99.5,
                    expectedPoints: 85
                },
                90: {
                    formation: '3-5-2', 
                    players: ['Flekken', 'Van Dijk', 'Gabriel', 'Trippier', 'Palmer', 'Saka', 'Rice', 'Gordon', 'Bruno', 'Isak', 'Watkins'],
                    cost: 89.0,
                    expectedPoints: 75
                },
                80: {
                    formation: '4-4-2',
                    players: ['Flekken', 'Gabriel', 'Saliba', 'Trippier', 'Digne', 'Palmer', 'Gordon', 'Rice', 'Eze', 'Isak', 'Watkins'],
                    cost: 78.5,
                    expectedPoints: 68
                },
                70: {
                    formation: '5-3-2',
                    players: ['Flekken', 'Gabriel', 'Konsa', 'Burn', 'Digne', 'Hall', 'Gordon', 'Rice', 'Eze', 'Isak', 'Cunha'],
                    cost: 68.0,
                    expectedPoints: 58
                }
            };
            
            const team = optimalTeams[budget];
            const success = team.expectedPoints >= target;
            
            resultDiv.innerHTML = `
                <div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span style="font-weight: bold;">Formation: ${team.formation}</span>
                        <span style="color: ${success ? '#28a745' : '#dc3545'}; font-weight: bold;">
                            ${success ? '✅ Target Achieved!' : '❌ Target Missed'}
                        </span>
                    </div>
                    <div style="margin-bottom: 10px;">
                        <div>💰 Total Cost: £${team.cost}m / £${budget}m</div>
                        <div>📊 Expected Points: ${team.expectedPoints} (Target: ${target}+)</div>
                    </div>
                    <div style="background: #f0f8ff; padding: 8px; border-radius: 5px; font-size: 0.9rem;">
                        <div style="font-weight: bold; margin-bottom: 5px;">Recommended XI:</div>
                        <div>${team.players.slice(0, 11).join(', ')}</div>
                    </div>
                    ${!success ? '<div style="margin-top: 8px; color: #dc3545; font-size: 0.9rem;">💡 Try a lower budget or target to achieve success!</div>' : ''}
                </div>
            `;
        }

        // New Game 6: Fixture Difficulty Calculator
        function calculateFDR(type) {
            const team = document.getElementById('fdr-team-select').value;
            const resultDiv = document.getElementById('fdr-result');
            
            if (!team) {
                resultDiv.innerHTML = 'Please select a team first!';
                return;
            }
            
            // Sample fixture data for next 5 gameweeks
            const fixtures = {
                arsenal: {
                    opponents: ['Brighton', 'Man City', 'Liverpool', 'Tottenham', 'Chelsea'],
                    attackingFDR: [2, 5, 4, 3, 3],
                    defensiveFDR: [2, 4, 4, 3, 3]
                },
                liverpool: {
                    opponents: ['Bournemouth', 'Arsenal', 'Newcastle', 'Man City', 'Brighton'],
                    attackingFDR: [2, 3, 2, 4, 2],
                    defensiveFDR: [1, 3, 2, 5, 2]
                },
                city: {
                    opponents: ['Chelsea', 'Arsenal', 'Newcastle', 'Liverpool', 'Tottenham'],
                    attackingFDR: [2, 3, 2, 4, 2],
                    defensiveFDR: [2, 3, 2, 4, 2]
                }
            };
            
            const teamData = fixtures[team] || {
                opponents: ['Team A', 'Team B', 'Team C', 'Team D', 'Team E'],
                attackingFDR: [3, 3, 3, 3, 3],
                defensiveFDR: [3, 3, 3, 3, 3]
            };
            
            const fdrValues = type === 'attack' ? teamData.attackingFDR : teamData.defensiveFDR;
            const avgFDR = (fdrValues.reduce((a, b) => a + b, 0) / fdrValues.length).toFixed(1);
            
            const difficultyColor = avgFDR <= 2.5 ? '#28a745' : avgFDR <= 3.5 ? '#fd7e14' : '#dc3545';
            const difficultyText = avgFDR <= 2.5 ? 'Easy' : avgFDR <= 3.5 ? 'Moderate' : 'Difficult';
            
            resultDiv.innerHTML = `
                <div>
                    <div style="text-align: center; margin-bottom: 15px;">
                        <div style="font-weight: bold; font-size: 1.1rem; text-transform: capitalize;">${team} - ${type}ing FDR</div>
                        <div style="font-size: 1.5rem; font-weight: bold; color: ${difficultyColor}; margin: 8px 0;">
                            ${avgFDR} (${difficultyText})
                        </div>
                    </div>
                    <div style="margin-bottom: 10px;">
                        <div style="font-weight: bold; margin-bottom: 5px;">Next 5 Fixtures:</div>
                        ${teamData.opponents.map((opp, i) => `
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 4px 0;">
                                <span>GW${i+1}: vs ${opp}</span>
                                <span style="background: ${fdrValues[i] <= 2 ? '#28a745' : fdrValues[i] <= 3 ? '#fd7e14' : '#dc3545'}; color: white; padding: 2px 8px; border-radius: 3px; font-size: 0.8rem;">
                                    ${fdrValues[i]}
                                </span>
                            </div>
                        `).join('')}
                    </div>
                    <div style="background: #f0f8ff; padding: 8px; border-radius: 5px; font-size: 0.9rem;">
                        💡 ${type === 'attack' ? 'Lower values = easier for attacking returns' : 'Lower values = better for clean sheets'}
                    </div>
                </div>
            `;
        }

        // New Game 7: Transfer Market Simulator
        function simulateTransfer() {
            const transferOut = document.getElementById('transfer-out-player').value;
            const transferIn = document.getElementById('transfer-in-player').value;
            const resultDiv = document.getElementById('transfer-result');
            
            if (!transferOut || !transferIn) {
                resultDiv.innerHTML = 'Please select both players to transfer!';
                return;
            }
            
            const [outPlayer, outPrice] = transferOut.split(',');
            const [inPlayer, inPrice] = transferIn.split(',');
            const priceDiff = parseFloat(inPrice) - parseFloat(outPrice);
            const transferCost = -4; // -4 points for transfer
            
            // Simulate expected points difference
            const expectedPointsDiff = Math.floor(Math.random() * 20) - 5; // -5 to +15 points
            const netPointsChange = expectedPointsDiff + transferCost;
            
            resultDiv.innerHTML = `
                <div>
                    <div style="text-align: center; margin-bottom: 15px;">
                        <div style="font-weight: bold; font-size: 1.1rem;">Transfer Simulation</div>
                    </div>
                    <div style="margin-bottom: 12px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px; background: #ffe6e6; border-radius: 5px; margin-bottom: 5px;">
                            <span>📤 ${outPlayer}</span>
                            <span style="font-weight: bold;">-£${outPrice}m</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px; background: #e6ffe6; border-radius: 5px;">
                            <span>📥 ${inPlayer}</span>
                            <span style="font-weight: bold;">+£${inPrice}m</span>
                        </div>
                    </div>
                    <div style="margin-bottom: 12px;">
                        <div>💰 Budget Impact: ${priceDiff >= 0 ? '+' : ''}£${priceDiff.toFixed(1)}m</div>
                        <div>📊 Expected Points Change: ${expectedPointsDiff >= 0 ? '+' : ''}${expectedPointsDiff} pts</div>
                        <div>🔄 Transfer Cost: ${transferCost} pts</div>
                    </div>
                    <div style="padding: 10px; border-radius: 5px; text-align: center; font-weight: bold; ${netPointsChange >= 0 ? 'background: #e8f5e8; color: #2d5a2d;' : 'background: #ffe6e6; color: #8b0000;'}">
                        Net Impact: ${netPointsChange >= 0 ? '+' : ''}${netPointsChange} points
                        ${netPointsChange >= 0 ? '✅ Recommended' : '❌ Not Recommended'}
                    </div>
                </div>
            `;
        }

        // New Game 8: Gameweek Points Predictor
        function predictGameweekPoints() {
            const captain = document.getElementById('captain-choice').value;
            const difficulty = document.getElementById('difficulty-level').value;
            const riskLevel = document.querySelector('input[name="risk-level"]:checked')?.value || 'balanced';
            const resultDiv = document.getElementById('gameweek-prediction-result');
            
            const [captainName, captainPoints] = captain.split(',');
            const captainScore = parseInt(captainPoints) * 2; // Captain gets double points
            
            // Base team points based on risk level
            const basePoints = {
                safe: 45,
                balanced: 55,
                aggressive: 40
            };
            
            // Difficulty multiplier
            const difficultyMultiplier = {
                easy: 1.2,
                medium: 1.0,
                hard: 0.8
            };
            
            // Risk variance
            const riskVariance = {
                safe: 10,
                balanced: 20,
                aggressive: 30
            };
            
            const teamPoints = Math.floor(basePoints[riskLevel] * difficultyMultiplier[difficulty]);
            const variance = Math.floor((Math.random() - 0.5) * riskVariance[riskLevel]);
            const totalPoints = teamPoints + captainScore + variance;
            
            const rank = totalPoints >= 80 ? 'Top 10k' : totalPoints >= 70 ? 'Top 100k' : totalPoints >= 60 ? 'Top 500k' : 'Below Average';
            const rankColor = totalPoints >= 80 ? '#28a745' : totalPoints >= 70 ? '#fd7e14' : totalPoints >= 60 ? '#6f42c1' : '#dc3545';
            
            resultDiv.innerHTML = `
                <div>
                    <div style="text-align: center; margin-bottom: 15px;">
                        <div style="font-weight: bold; font-size: 1.1rem;">Gameweek Prediction</div>
                        <div style="font-size: 2rem; font-weight: bold; color: #6f42c1; margin: 10px 0;">
                            ${totalPoints} Points
                        </div>
                        <div style="color: ${rankColor}; font-weight: bold;">
                            Predicted Rank: ${rank}
                        </div>
                    </div>
                    <div style="margin-bottom: 12px; font-size: 0.9rem;">
                        <div>👥 Team Points: ${teamPoints}</div>
                        <div>⭐ Captain (${captainName}): ${captainScore} (doubled)</div>
                        <div>🎲 Variance: ${variance >= 0 ? '+' : ''}${variance}</div>
                    </div>
                    <div style="background: #f0f8ff; padding: 8px; border-radius: 5px; font-size: 0.9rem;">
                        💡 ${riskLevel === 'aggressive' ? 'High risk, high reward strategy!' : riskLevel === 'safe' ? 'Conservative but reliable approach.' : 'Balanced strategy with moderate risk.'}
                    </div>
                </div>
            `;
        }
    </script>
    
    <style>
        .captain-card.selected {
            border-color: #00ff87;
            box-shadow: 0 0 15px rgba(0, 255, 135, 0.3);
        }
    </style>
</body>
</html>