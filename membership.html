<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-TVPLGM5QY9"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-TVPLGM5QY9');
    </script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Join EPL News Hub Premium for exclusive Premier League content, analysis, and insider access. Choose from our flexible membership plans.">
    <meta name="keywords" content="EPL News Hub membership, Premium Premier League content, exclusive football analysis, subscription">
    <meta name="author" content="EPL News Hub">
    <title>Premium Membership | EPL News Hub - Exclusive Premier League Content</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="apple-touch-icon" href="reidsnbest.webp">
    <link rel="icon" type="image/webp" href="reidsnbest.webp">
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        
        const firebaseConfig = {
            apiKey: "AIzaSyCyOey0l27yQP68oybpoodMVcvayhIHt2I",
            authDomain: "epl-news-hub-94c09.firebaseapp.com",
            projectId: "epl-news-hub-94c09",
            storageBucket: "epl-news-hub-94c09.firebasestorage.app",
            messagingSenderId: "674703933278",
            appId: "1:674703933278:web:90c6dd4aa9f1ace73099cf",
            measurementId: "G-ECM6BCQCS8"
        };
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        
        window.auth = auth;
        window.onAuthStateChanged = onAuthStateChanged;
    </script>
    
    <!-- Stripe SDK -->
    <script src="https://js.stripe.com/v3/"></script>
</head>
<body>
    <!-- Header -->
    <div class="header" include="./header.html"></div>

    <!-- Membership Hero Section -->
    <section class="membership-hero">
        <div class="hero-content">
            <h1>üèÜ Join EPL News Hub Premium</h1>
            <p class="hero-subtitle">Get exclusive access to in-depth analysis, insider content, and premium Premier League coverage</p>
            <div class="hero-features">
                <div class="feature-item">üì∞ Exclusive Articles</div>
                <div class="feature-item">üéØ Transfer Insider Info</div>
                <div class="feature-item">üìä Advanced Analytics</div>
                <div class="feature-item">üé• Premium Video Content</div>
            </div>
        </div>
    </section>

    <!-- Auth Check Message -->
    <div id="auth-check" class="auth-check" style="display: none;">
        <div class="auth-message">
            <h3>üîê Sign In Required</h3>
            <p>Please <a href="/signin.html">sign in</a> or <a href="/create-account.html">create an account</a> to purchase a membership.</p>
        </div>
    </div>

    <!-- Membership Plans -->
    <section class="membership-plans" id="membership-plans" style="display: none;">
        <div class="plans-container">
            <div class="section-header">
                <h2>Choose Your Plan</h2>
                <p>Select the perfect membership for your Premier League passion</p>
            </div>
            
            <div class="plans-grid">
                <!-- Starter Plan -->
                <div class="plan-card starter">
                    <div class="plan-badge">Most Popular</div>
                    <div class="plan-header">
                        <h3>‚öΩ Starter</h3>
                        <div class="plan-price">
                            <span class="currency">$</span>
                            <span class="amount">2.00</span>
                            <span class="period">/month</span>
                        </div>
                    </div>
                    
                    <div class="plan-description">
                        <p>With the starter membership for EPL News Hub you will get: 5 exclusive articles per week, the latest transfer rumors, weekly team and match analysis, access to all articles, FPL pro advice and suggested teams, and best of all, ad free browsing!</p>
                    </div>
                    
                    <div class="plan-features">
                        <ul>
                            <li>‚úÖ 5 exclusive articles per week</li>
                            <li>‚úÖ Latest transfer rumors</li>
                            <li>‚úÖ Weekly team and match analysis</li>
                            <li>‚úÖ Access to all articles</li>
                            <li>‚úÖ FPL pro advice and suggested teams</li>
                            <li>‚úÖ Ad-free browsing</li>
                        </ul>
                    </div>
                    
                    <button class="plan-button" onclick="selectPlan('starter', 'price_1RoaG1R10Q6bz3BHC2hDRKLv')">
                        Choose Starter
                    </button>
                </div>
                
                <!-- Pro Plan -->
                <div class="plan-card pro featured">
                    <div class="plan-badge premium">Best Value</div>
                    <div class="plan-header">
                        <h3>üèÜ Pro</h3>
                        <div class="plan-price">
                            <span class="currency">$</span>
                            <span class="amount">7.00</span>
                            <span class="period">/month</span>
                        </div>
                    </div>
                    
                    <div class="plan-description">
                        <p>This subscription includes everything included in starter and, unlimited exclusive articles, premium transfer insider info, early access to content, and fantasy premier league exclusive team of the week to get you the most points possible in fpl.</p>
                    </div>
                    
                    <div class="plan-features">
                        <ul>
                            <li>‚úÖ Everything included in Starter</li>
                            <li>‚úÖ Unlimited exclusive articles</li>
                            <li>‚úÖ Premium transfer insider info</li>
                            <li>‚úÖ Early access to content</li>
                            <li>‚úÖ Fantasy Premier League exclusive team of the week</li>
                        </ul>
                    </div>
                    
                    <button class="plan-button" onclick="selectPlan('pro', 'price_1Rox4aR10Q6bz3BHxohJtpcO')">
                        Choose Pro
                    </button>
                </div>
                
            </div>
            
            <!-- Annual Plans -->
            <div class="annual-plans">
                <div class="annual-header">
                    <h3>üí∞ Save with Annual Plans</h3>
                    <p>Get 2 months free when you pay annually</p>
                </div>
                
                <div class="annual-grid">
                    <div class="annual-plan">
                        <h4>Starter Annual</h4>
                        <div class="annual-price">$20.00/year <span class="savings">Save $4.00</span></div>
                        <button class="annual-button" onclick="selectPlan('starter-annual', 'price_1RoxK6R10Q6bz3BHdZkxAn3p')">
                            Choose Annual
                        </button>
                    </div>
                    
                    <div class="annual-plan featured">
                        <h4>Pro Annual</h4>
                        <div class="annual-price">$70.00/year <span class="savings">Save $14.00</span></div>
                        <button class="annual-button" onclick="selectPlan('pro-annual', 'price_1RoxmQR10Q6bz3BHQKy7G89g')">
                            Choose Annual
                        </button>
                    </div>
                    
                </div>
            </div>
        </div>
    </section>

    <!-- Current Membership Status -->
    <section class="current-membership" id="current-membership" style="display: none;">
        <div class="membership-status">
            <h2>Your Current Membership</h2>
            <div class="status-card">
                <div class="status-info">
                    <h3 id="current-plan">Loading...</h3>
                    <p id="membership-details">Checking membership status...</p>
                </div>
                <div class="status-actions">
                    <button class="manage-button" onclick="manageMembership()">
                        Manage Subscription
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Features Showcase -->
    <section class="features-showcase">
        <div class="showcase-container">
            <h2>What You Get with Premium</h2>
            
            <div class="features-grid">
                <div class="feature-showcase">
                    <div class="feature-icon">üì∞</div>
                    <h3>Exclusive Articles</h3>
                    <p>In-depth analysis and exclusive stories you won't find anywhere else. Our writers have inside access to clubs and players.</p>
                </div>
                
                <div class="feature-showcase">
                    <div class="feature-icon">üéØ</div>
                    <h3>Transfer Insider</h3>
                    <p>Get the real story behind transfers before they hit mainstream media. Our network of contacts brings you the inside scoop.</p>
                </div>
                
                <div class="feature-showcase">
                    <div class="feature-icon">üìä</div>
                    <h3>Advanced Analytics</h3>
                    <p>Professional-grade statistics and analysis tools that give you deeper insights into team and player performance.</p>
                </div>
                
                <div class="feature-showcase">
                    <div class="feature-icon">üé•</div>
                    <h3>Premium Videos</h3>
                    <p>Tactical breakdowns, match analysis, and exclusive interviews with former players and managers.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <div class="footer" include="./footer.html"></div>

    <script src="./index.js"></script>
    <script src="./ad-target-blank.js"></script>
    
    <style>
        /* Membership Hero Section */
        .membership-hero {
            background: linear-gradient(135deg, #37003c 0%, #6f42c1 50%, #20c997 100%);
            color: white;
            padding: 80px 20px;
            text-align: center;
        }
        
        .hero-content h1 {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 20px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .hero-subtitle {
            font-size: 1.3rem;
            margin-bottom: 40px;
            opacity: 0.95;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .hero-features {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
        }
        
        .feature-item {
            background: rgba(255,255,255,0.1);
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: 600;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        /* Auth Check */
        .auth-check {
            background: #f8f9fa;
            padding: 60px 20px;
            text-align: center;
        }
        
        .auth-message {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.1);
        }
        
        .auth-message h3 {
            color: #37003c;
            margin-bottom: 15px;
        }
        
        .auth-message a {
            color: #37003c;
            text-decoration: none;
            font-weight: 600;
        }
        
        .auth-message a:hover {
            text-decoration: underline;
        }
        
        /* Membership Plans */
        .membership-plans {
            padding: 80px 20px;
            background: #f8f9fa;
        }
        
        .plans-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .section-header {
            text-align: center;
            margin-bottom: 60px;
        }
        
        .section-header h2 {
            font-size: 2.5rem;
            color: #37003c;
            margin-bottom: 15px;
        }
        
        .section-header p {
            font-size: 1.1rem;
            color: #666;
        }
        
        .plans-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 30px;
            margin-bottom: 80px;
        }
        
        .plan-card {
            background: white;
            border-radius: 20px;
            padding: 40px 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            position: relative;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .plan-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
        }
        
        .plan-card.featured {
            border-color: #37003c;
            transform: scale(1.05);
        }
        
        .plan-badge {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            background: #37003c;
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }
        
        .plan-badge.premium {
            background: linear-gradient(135deg, #37003c, #6f42c1);
        }
        
        .plan-badge.elite {
            background: linear-gradient(135deg, #ff6b35, #f7931e);
        }
        
        .plan-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .plan-header h3 {
            font-size: 1.8rem;
            color: #37003c;
            margin-bottom: 15px;
        }
        
        .plan-price {
            display: flex;
            align-items: baseline;
            justify-content: center;
            gap: 5px;
        }
        
        .currency {
            font-size: 1.5rem;
            color: #666;
        }
        
        .amount {
            font-size: 3rem;
            font-weight: 800;
            color: #37003c;
        }
        
        .period {
            font-size: 1.2rem;
            color: #666;
        }
        
        .plan-description {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #37003c;
        }
        
        .plan-description p {
            margin: 0;
            font-size: 0.95rem;
            line-height: 1.5;
            color: #555;
            font-style: italic;
        }
        
        .plan-features ul {
            list-style: none;
            padding: 0;
            margin: 0 0 40px 0;
        }
        
        .plan-features li {
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
            font-size: 1rem;
            display: flex;
            align-items: center;
        }
        
        .plan-features li:last-child {
            border-bottom: none;
        }
        
        .plan-button {
            width: 100%;
            background: linear-gradient(135deg, #37003c, #6f42c1);
            color: white;
            border: none;
            padding: 16px 24px;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .plan-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(55,0,60,0.3);
        }
        
        /* Annual Plans */
        .annual-plans {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
        
        .annual-header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .annual-header h3 {
            color: #37003c;
            margin-bottom: 10px;
        }
        
        .annual-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .annual-plan {
            text-align: center;
            padding: 30px 20px;
            border: 2px solid #f0f0f0;
            border-radius: 12px;
            transition: all 0.3s ease;
        }
        
        .annual-plan:hover {
            border-color: #37003c;
        }
        
        .annual-plan.featured {
            border-color: #37003c;
            background: linear-gradient(135deg, #f8f9ff, #fff);
        }
        
        .annual-price {
            font-size: 1.5rem;
            font-weight: 700;
            color: #37003c;
            margin: 15px 0;
        }
        
        .savings {
            display: block;
            font-size: 0.9rem;
            color: #28a745;
            font-weight: 600;
        }
        
        .annual-button {
            background: #37003c;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .annual-button:hover {
            background: #6f42c1;
        }
        
        /* Current Membership */
        .current-membership {
            padding: 60px 20px;
            background: white;
        }
        
        .membership-status {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }
        
        .status-card {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 40px;
            border-radius: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .manage-button {
            background: #37003c;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .manage-button:hover {
            background: #6f42c1;
        }
        
        /* Features Showcase */
        .features-showcase {
            padding: 80px 20px;
            background: white;
        }
        
        .showcase-container {
            max-width: 1200px;
            margin: 0 auto;
            text-align: center;
        }
        
        .showcase-container h2 {
            font-size: 2.5rem;
            color: #37003c;
            margin-bottom: 60px;
        }
        
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 40px;
        }
        
        .feature-showcase {
            padding: 40px 20px;
            background: #f8f9fa;
            border-radius: 16px;
            transition: all 0.3s ease;
        }
        
        .feature-showcase:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .feature-icon {
            font-size: 3rem;
            margin-bottom: 20px;
        }
        
        .feature-showcase h3 {
            color: #37003c;
            margin-bottom: 15px;
        }
        
        .feature-showcase p {
            color: #666;
            line-height: 1.6;
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .hero-content h1 {
                font-size: 2rem;
            }
            
            .hero-subtitle {
                font-size: 1.1rem;
            }
            
            .hero-features {
                flex-direction: column;
                align-items: center;
            }
            
            .plans-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .plan-card.featured {
                transform: none;
            }
            
            .status-card {
                flex-direction: column;
                text-align: center;
            }
            
            .annual-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
    
    <script>
        // Initialize Stripe with live publishable key
        const stripe = Stripe('pk_live_51RSKcBR10Q6bz3BHDJ7b0hniY7eCnnakbMNBlpEVyOVWDiA8A0MI22YMaaSpGaAMIv8NnaK6bLfGdNM0Xt8rpK1200itJbMZNm');
        
        // Make stripe accessible globally for debugging
        window.stripe = stripe;
        
        document.addEventListener('DOMContentLoaded', function() {
            checkAuthState();
        });
        
        function checkAuthState() {
            if (window.onAuthStateChanged && window.auth) {
                window.onAuthStateChanged(window.auth, (user) => {
                    if (user) {
                        // User is signed in
                        document.getElementById('auth-check').style.display = 'none';
                        document.getElementById('membership-plans').style.display = 'block';
                        
                        // Check if user has existing membership
                        checkMembershipStatus(user);
                    } else {
                        // User is not signed in
                        document.getElementById('auth-check').style.display = 'block';
                        document.getElementById('membership-plans').style.display = 'none';
                        document.getElementById('current-membership').style.display = 'none';
                    }
                });
            } else {
                // Firebase not loaded, show auth check
                document.getElementById('auth-check').style.display = 'block';
            }
        }
        
        function checkMembershipStatus(user) {
            // Check localStorage for membership info (in production, check with your backend)
            const membershipInfo = localStorage.getItem('membership');
            
            if (membershipInfo) {
                const membership = JSON.parse(membershipInfo);
                showCurrentMembership(membership);
            }
        }
        
        function showCurrentMembership(membership) {
            document.getElementById('current-membership').style.display = 'block';
            document.getElementById('current-plan').textContent = `${membership.plan} Member`;
            document.getElementById('membership-details').textContent = 
                `Active since ${new Date(membership.startDate).toLocaleDateString()}. Next billing: ${new Date(membership.nextBilling).toLocaleDateString()}`;
        }
        
        async function selectPlan(planType, priceId) {
            console.log('selectPlan called with:', { planType, priceId });
            
            if (!window.auth || !window.auth.currentUser) {
                // Enhanced authentication prompt
                const userChoice = confirm('You need to create an account or sign in to purchase a membership. Click OK to create an account, or Cancel to sign in with an existing account.');
                
                if (userChoice) {
                    // User chose to create account
                    window.location.href = '/create-account.html';
                } else {
                    // User chose to sign in
                    window.location.href = '/signin.html';
                }
                return;
            }
            
            // Show loading state
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = 'Processing...';
            button.disabled = true;
            
            try {
                // For all subscription plans, redirect to Stripe Checkout
                if (priceId === 'price_1RoaG1R10Q6bz3BHC2hDRKLv' || priceId === 'price_1Rox4aR10Q6bz3BHxohJtpcO' || priceId === 'price_1RoxK6R10Q6bz3BHdZkxAn3p' || priceId === 'price_1RoxmQR10Q6bz3BHQKy7G89g') {
                    let planName;
                    if (priceId === 'price_1RoaG1R10Q6bz3BHC2hDRKLv') {
                        planName = 'Starter';
                    } else if (priceId === 'price_1Rox4aR10Q6bz3BHxohJtpcO') {
                        planName = 'Pro';
                    } else if (priceId === 'price_1RoxK6R10Q6bz3BHdZkxAn3p') {
                        planName = 'Starter Annual';
                    } else if (priceId === 'price_1RoxmQR10Q6bz3BHQKy7G89g') {
                        planName = 'Pro Annual';
                    }
                    console.log(`Starting Stripe checkout for ${planName} plan`);
                    
                    // Check if stripe is loaded
                    if (!window.stripe) {
                        throw new Error('Stripe not loaded');
                    }
                    
                    const checkoutOptions = {
                        lineItems: [{
                            price: priceId,
                            quantity: 1,
                        }],
                        mode: 'subscription',
                        successUrl: window.location.protocol + '//' + window.location.host + `/membership-success.html?plan=${planType}&email=${encodeURIComponent(window.auth.currentUser.email)}`,
                        cancelUrl: window.location.protocol + '//' + window.location.host + '/membership.html',
                        customerEmail: window.auth.currentUser.email,
                        clientReferenceId: window.auth.currentUser.uid // Firebase user ID for tracking
                    };
                    
                    console.log('Checkout options:', checkoutOptions);
                    
                    const result = await stripe.redirectToCheckout(checkoutOptions);
                    
                    if (result.error) {
                        console.error('Stripe checkout error:', result.error);
                        alert('Payment processing failed: ' + result.error.message);
                    }
                } else {
                    // For other plans that don't have price IDs yet
                    alert('This plan is coming soon! Please contact support for early access.');
                }
                
            } catch (error) {
                console.error('Error in selectPlan:', error);
                alert('Payment processing failed. Please try again. Error: ' + error.message);
            } finally {
                button.textContent = originalText;
                button.disabled = false;
            }
        }
        
        
        async function manageMembership() {
            if (!window.auth || !window.auth.currentUser) {
                alert('Please sign in first to manage your subscription.');
                window.location.href = '/signin.html';
                return;
            }

            const user = window.auth.currentUser;
            
            try {
                // Show loading state
                const button = document.querySelector('.manage-button');
                const originalText = button.textContent;
                button.textContent = 'Loading...';
                button.disabled = true;

                // For a full implementation, you would create a backend endpoint that:
                // 1. Finds the customer in Stripe using the user's email
                // 2. Creates a Stripe Customer Portal session
                // 3. Returns the portal URL

                // For now, we'll create a simple management page
                const customerEmail = user.email;
                const portalUrl = createCustomerPortalUrl(customerEmail);
                
                if (portalUrl) {
                    window.location.href = portalUrl;
                } else {
                    // Fallback to basic management
                    window.location.href = `/manage-subscription.html?email=${encodeURIComponent(customerEmail)}`;
                }

            } catch (error) {
                console.error('Error managing membership:', error);
                alert('Unable to open subscription management. Please contact support.');
            } finally {
                // Reset button state
                const button = document.querySelector('.manage-button');
                if (button) {
                    button.textContent = 'Manage Subscription';
                    button.disabled = false;
                }
            }
        }

        function createCustomerPortalUrl(email) {
            // In a full implementation, this would call your backend to create a Stripe Customer Portal URL
            // For now, we'll return null to use the fallback
            
            // Example of what your backend endpoint would do:
            // 1. Call Stripe API to find customer by email
            // 2. Create a billing portal session
            // 3. Return the portal URL
            
            // Backend code would look like:
            // const session = await stripe.billingPortal.sessions.create({
            //     customer: customerId,
            //     return_url: 'https://eplnewshub.com/membership',
            // });
            // return session.url;
            
            return null; // Use fallback for now
        }
    </script>
</body>
</html>