<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-TVPLGM5QY9"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-TVPLGM5QY9');
    </script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Advanced Premier League team analysis tool with head-to-head comparisons, performance metrics, and FPL insights.">
    <meta name="keywords" content="Premier League teams, team analysis, team comparison, FPL team stats, football analytics">
    <meta name="author" content="EPL News Hub">
    <title>Team Analysis & Comparison Tool | EPL News Hub</title>
    <link rel="stylesheet" href="styles.css">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6480210605786899" crossorigin="anonymous"></script>
    <script src="./fpl-data-service.js"></script>
    
    <style>
        .analyzer-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            border-radius: 16px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.08);
        }

        .analyzer-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 30px;
            background: linear-gradient(135deg, #6f42c1 0%, #fd7e14 100%);
            color: white;
            border-radius: 12px;
        }

        .analyzer-header h1 {
            font-size: 2.5rem;
            margin-bottom: 15px;
            font-weight: 800;
        }

        .team-selector-panel {
            background: white;
            padding: 25px;
            border-radius: 12px;
            border: 1px solid #e9ecef;
            margin-bottom: 30px;
        }

        .team-selectors {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 30px;
            align-items: center;
        }

        .team-selection {
            text-align: center;
        }

        .team-selection h3 {
            color: #37003c;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .team-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .team-option {
            padding: 12px 8px;
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .team-option:hover {
            background: #e9ecef;
            border-color: #37003c;
        }

        .team-option.selected {
            background: #37003c;
            color: white;
            border-color: #37003c;
        }

        .vs-divider {
            font-size: 2rem;
            font-weight: 800;
            color: #dc3545;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .analysis-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .control-btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, #6f42c1, #fd7e14);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(55, 0, 60, 0.3);
        }

        .control-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .comparison-results {
            display: none;
        }

        .team-overview {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .team-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            border: 2px solid #e9ecef;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        .team-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f8f9fa;
        }

        .team-badge {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #f8f9fa, #ffffff);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 800;
            color: #37003c;
            border: 2px solid #e9ecef;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .team-info h3 {
            color: #37003c;
            margin: 0 0 5px 0;
            font-size: 1.4rem;
        }

        .team-meta {
            color: #666;
            font-size: 0.9rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .stat-item {
            text-align: center;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .stat-value {
            font-size: 1.3rem;
            font-weight: 800;
            color: #37003c;
            display: block;
            margin-bottom: 3px;
        }

        .stat-label {
            font-size: 0.8rem;
            color: #666;
            text-transform: uppercase;
        }

        .head-to-head {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            border: 2px solid #e9ecef;
        }

        .h2h-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .h2h-stats {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 20px;
            align-items: center;
            margin-bottom: 25px;
        }

        .h2h-team-stat {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .h2h-value {
            font-size: 2rem;
            font-weight: 800;
            color: #37003c;
            display: block;
            margin-bottom: 5px;
        }

        .h2h-label {
            color: #666;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .h2h-divider {
            width: 3px;
            height: 80px;
            background: linear-gradient(to bottom, #dc3545, #fd7e14);
            border-radius: 2px;
        }

        .performance-charts {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            border: 2px solid #e9ecef;
        }

        .chart-header {
            color: #37003c;
            margin-bottom: 15px;
            font-size: 1.1rem;
            font-weight: 600;
            text-align: center;
        }

        .performance-bar {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            gap: 10px;
        }

        .bar-label {
            min-width: 80px;
            font-size: 0.9rem;
            color: #333;
            font-weight: 600;
        }

        .bar-container {
            flex: 1;
            height: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .bar-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.8s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 8px;
            color: white;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .bar-team1 { background: linear-gradient(135deg, #37003c, #6f42c1); }
        .bar-team2 { background: linear-gradient(135deg, #dc3545, #fd7e14); }

        .player-analysis {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            border: 2px solid #e9ecef;
        }

        .player-sections {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .player-section h4 {
            color: #37003c;
            margin-bottom: 15px;
            font-size: 1.1rem;
            text-align: center;
        }

        .player-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .player-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .player-info {
            display: flex;
            flex-direction: column;
        }

        .player-name {
            font-weight: 600;
            color: #333;
            font-size: 0.9rem;
        }

        .player-stats {
            font-size: 0.8rem;
            color: #666;
        }

        .player-value {
            font-weight: 700;
            color: #37003c;
            font-size: 0.9rem;
        }

        .fpl-insights {
            background: linear-gradient(135deg, #17a2b8 0%, #20c997 100%);
            color: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .insights-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .insight-card {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .insight-title {
            font-weight: 700;
            margin-bottom: 8px;
            font-size: 1rem;
        }

        .insight-description {
            font-size: 0.9rem;
            opacity: 0.9;
            line-height: 1.4;
        }

        @media (max-width: 768px) {
            .analyzer-container {
                padding: 10px;
                border-radius: 12px;
            }
            
            .analyzer-header {
                padding: 20px 15px;
            }
            
            .analyzer-header h1 {
                font-size: 1.8rem;
            }
            
            .analyzer-header p {
                font-size: 0.9rem;
            }
            
            .premium-features {
                padding: 20px 15px;
            }
            
            .team-selector-panel {
                padding: 15px;
            }
            
            .team-selectors {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .vs-divider {
                font-size: 1.5rem;
                margin: 15px 0;
            }
            
            .team-grid {
                grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
                gap: 8px;
            }
            
            .team-option {
                padding: 10px 5px;
                font-size: 0.85rem;
            }
            
            .control-btn {
                padding: 10px 16px;
                font-size: 0.9rem;
                width: 100%;
            }
            
            .team-overview {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .team-card {
                padding: 20px;
            }
            
            .h2h-stats {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .h2h-divider {
                width: 80%;
                height: 3px;
                margin: 0 auto;
            }
            
            .performance-charts {
                grid-template-columns: 1fr;
            }
            
            .player-sections {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .insights-grid {
                grid-template-columns: 1fr;
            }
            
            #live-indicator {
                flex-direction: column;
                gap: 10px !important;
            }
            
            #live-indicator > span,
            #live-indicator > button {
                width: 100%;
                justify-content: center;
            }
        }
        
        @media (max-width: 480px) {
            .analyzer-header h1 {
                font-size: 1.4rem;
            }
            
            .analyzer-header p {
                font-size: 0.85rem;
            }
            
            .team-selector-panel h2 {
                font-size: 1.2rem;
            }
            
            .team-option {
                padding: 8px 4px;
                font-size: 0.75rem;
            }
            
            .control-btn {
                padding: 8px 12px;
                font-size: 0.85rem;
            }
            
            .stat-value {
                font-size: 1.1rem;
            }
            
            .stat-label {
                font-size: 0.7rem;
            }
            
            .player-name {
                font-size: 0.85rem;
            }
            
            .player-stats {
                font-size: 0.75rem;
            }
            
            .insight-card {
                padding: 12px;
            }
            
            .insight-title {
                font-size: 0.9rem;
            }
            
            .insight-description {
                font-size: 0.85rem;
            }
        }

        .loading-spinner {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
            font-size: 1.2rem;
            color: #666;
        }

        .loading-spinner::after {
            content: "";
            width: 30px;
            height: 30px;
            margin-left: 15px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #dc3545;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes slideDown {
            from { transform: translate(-50%, -100%); opacity: 0; }
            to { transform: translate(-50%, 0); opacity: 1; }
        }
        
        @keyframes slideUp {
            from { transform: translate(-50%, 0); opacity: 1; }
            to { transform: translate(-50%, -100%); opacity: 0; }
        }
    </style>
</head>
<body>
    <div class="header" include="./header.html"></div>
    
    <main class="main-content">
        <div class="analyzer-container">
            <div class="analyzer-header">
                <h1>⚔️ Team Analysis & Comparison Tool</h1>
                <p>Deep-dive team performance analysis with head-to-head comparisons and FPL insights</p>
                <div id="live-indicator" style="margin-top: 15px; display: flex; justify-content: center; align-items: center; gap: 15px;">
                    <span style="display: inline-flex; align-items: center; background: rgba(255,255,255,0.2); padding: 5px 15px; border-radius: 20px;">
                        <span id="live-dot" style="width: 8px; height: 8px; background: #00ff00; border-radius: 50%; margin-right: 8px; animation: pulse 2s infinite;"></span>
                        <span id="data-status">LIVE DATA</span>
                    </span>
                    <span style="background: rgba(255,255,255,0.2); padding: 5px 15px; border-radius: 20px;">
                        Last Update: <span id="last-update">Never</span>
                    </span>
                    <button onclick="refreshData()" style="background: rgba(255,255,255,0.3); border: none; padding: 5px 15px; border-radius: 20px; color: white; cursor: pointer; font-weight: 600;">
                        🔄 Refresh
                    </button>
                </div>
                <style>
                    @keyframes pulse {
                        0% { opacity: 1; }
                        50% { opacity: 0.5; }
                        100% { opacity: 1; }
                    }
                </style>
            </div>

            <!-- Premium Features Section -->
            <div class="premium-features" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; padding: 25px; border-radius: 12px; margin-bottom: 30px;">
                <h2 style="text-align: center; margin-bottom: 20px;">⭐ Premium Features</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; backdrop-filter: blur(10px);">
                        <h4 style="margin: 0 0 10px 0;">🔍 Deep Analysis</h4>
                        <p style="margin: 0; font-size: 0.9rem; opacity: 0.9;">Compare any two teams with comprehensive metrics including form, value, and player quality.</p>
                    </div>
                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; backdrop-filter: blur(10px);">
                        <h4 style="margin: 0 0 10px 0;">📊 League Overview</h4>
                        <p style="margin: 0; font-size: 0.9rem; opacity: 0.9;">View all 20 teams ranked by overall performance with detailed statistics and insights.</p>
                    </div>
                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; backdrop-filter: blur(10px);">
                        <h4 style="margin: 0 0 10px 0;">🎯 FPL Insights</h4>
                        <p style="margin: 0; font-size: 0.9rem; opacity: 0.9;">Get strategic recommendations for transfers, captaincy, and differential picks.</p>
                    </div>
                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; backdrop-filter: blur(10px);">
                        <h4 style="margin: 0 0 10px 0;">🔄 Live Data</h4>
                        <p style="margin: 0; font-size: 0.9rem; opacity: 0.9;">Real-time updates from official FPL API with automatic refresh every 2 minutes.</p>
                    </div>
                </div>
            </div>

            <!-- Team Selector Panel -->
            <div class="team-selector-panel">
                <h2 style="text-align: center; color: #37003c; margin-bottom: 25px;">
                    🎯 Select Teams to Compare
                </h2>
                
                <div class="team-selectors">
                    <div class="team-selection">
                        <h3>Team 1</h3>
                        <div class="team-grid" id="team1-grid">
                            <!-- Teams will be populated here -->
                        </div>
                        <div id="team1-selected" style="margin-top: 10px; font-weight: 600; color: #37003c;">
                            No team selected
                        </div>
                    </div>
                    
                    <div class="vs-divider">VS</div>
                    
                    <div class="team-selection">
                        <h3>Team 2</h3>
                        <div class="team-grid" id="team2-grid">
                            <!-- Teams will be populated here -->
                        </div>
                        <div id="team2-selected" style="margin-top: 10px; font-weight: 600; color: #dc3545;">
                            No team selected
                        </div>
                    </div>
                </div>
                
                <div class="analysis-controls">
                    <button class="control-btn" onclick="analyzeTeams()" id="analyze-btn" disabled>
                        🔍 Analyze Teams
                    </button>
                    <button class="control-btn" onclick="compareAll()">
                        📊 League Overview
                    </button>
                    <button class="control-btn" onclick="showQuickTips()">
                        💡 Quick Tips
                    </button>
                </div>
            </div>

            <!-- Loading State -->
            <div id="loading" class="loading-spinner" style="display: none;">
                Analyzing team performance...
            </div>

            <!-- Comparison Results -->
            <div class="comparison-results" id="comparison-results">
                <!-- Team Overview -->
                <div class="team-overview" id="team-overview">
                    <!-- Team cards will be populated here -->
                </div>

                <!-- Head-to-Head Stats -->
                <div class="head-to-head" id="head-to-head">
                    <div class="h2h-header">
                        <h3 style="color: #37003c; margin: 0;">🏆 Head-to-Head Performance</h3>
                        <p style="color: #666; margin: 5px 0 0 0;">Comparative analysis across key metrics</p>
                    </div>
                    <div class="h2h-stats" id="h2h-stats">
                        <!-- H2H stats will be populated here -->
                    </div>
                </div>

                <!-- Performance Charts -->
                <div class="performance-charts" id="performance-charts">
                    <!-- Charts will be populated here -->
                </div>

                <!-- Player Analysis -->
                <div class="player-analysis" id="player-analysis">
                    <h3 style="color: #37003c; text-align: center; margin-bottom: 20px;">
                        👑 Key Players Comparison
                    </h3>
                    <div class="player-sections" id="player-sections">
                        <!-- Player sections will be populated here -->
                    </div>
                </div>

                <!-- FPL Insights -->
                <div class="fpl-insights" id="fpl-insights">
                    <div class="insights-header">
                        <h3 style="margin: 0;">🎯 FPL Strategy Insights</h3>
                        <p style="margin: 5px 0 0 0; opacity: 0.9;">
                            Strategic recommendations based on team analysis
                        </p>
                    </div>
                    <div class="insights-grid" id="insights-grid">
                        <!-- Insights will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div class="footer" include="./footer.html"></div>
    <script src="./index.js"></script>

    <script>
        class TeamAnalyzer {
            constructor() {
                this.fplService = new FPLDataServiceEnhanced();
                this.teams = [];
                this.allPlayers = [];
                this.selectedTeam1 = null;
                this.selectedTeam2 = null;
                this.teamStats = {};
            }

            async initialize() {
                try {
                    const data = await this.fplService.getPlayerData();
                    this.teams = data.teams || this.getDefaultTeams();
                    this.allPlayers = data.elements || [];
                    
                    // If no players in data, generate comprehensive mock data
                    if (this.allPlayers.length === 0) {
                        const mockData = this.fplService.generateFullPlayerList();
                        this.allPlayers = mockData.elements;
                        this.teams = mockData.teams;
                    }
                    
                    this.populateTeamGrids();
                    this.calculateTeamStats();
                    this.updateLiveIndicator(true);
                    
                    // Auto-refresh every 2 minutes
                    setInterval(() => this.refreshData(), 2 * 60 * 1000);
                } catch (error) {
                    console.error('Failed to initialize team analyzer:', error);
                    // Use mock data
                    this.updateLiveIndicator(false);
                    this.initializeMockData();
                }
            }
            
            initializeMockData() {
                // Use mock data from FPL service
                const mockData = this.fplService.getMockPlayerData();
                this.teams = this.getDefaultTeams();
                this.allPlayers = mockData.elements || [];
                
                // If still no players, generate them
                if (this.allPlayers.length === 0) {
                    const fullMockData = this.fplService.generateFullPlayerList();
                    this.allPlayers = fullMockData.elements;
                    this.teams = fullMockData.teams;
                }
                
                this.populateTeamGrids();
                this.calculateTeamStats();
                this.updateLiveIndicator(false);
            }
            
            getDefaultTeams() {
                return [
                    { id: 1, name: "Arsenal", short_name: "ARS", strength: 1300 },
                    { id: 2, name: "Aston Villa", short_name: "AVL", strength: 1150 },
                    { id: 3, name: "Bournemouth", short_name: "BOU", strength: 1050 },
                    { id: 4, name: "Brentford", short_name: "BRE", strength: 1100 },
                    { id: 5, name: "Brighton", short_name: "BHA", strength: 1150 },
                    { id: 6, name: "Chelsea", short_name: "CHE", strength: 1250 },
                    { id: 7, name: "Crystal Palace", short_name: "CRY", strength: 1080 },
                    { id: 8, name: "Everton", short_name: "EVE", strength: 1020 },
                    { id: 9, name: "Fulham", short_name: "FUL", strength: 1090 },
                    { id: 10, name: "Ipswich", short_name: "IPS", strength: 950 },
                    { id: 11, name: "Leicester", short_name: "LEI", strength: 980 },
                    { id: 12, name: "Liverpool", short_name: "LIV", strength: 1350 },
                    { id: 13, name: "Man City", short_name: "MCI", strength: 1400 },
                    { id: 14, name: "Newcastle", short_name: "NEW", strength: 1200 },
                    { id: 15, name: "Nottingham Forest", short_name: "NFO", strength: 1060 },
                    { id: 16, name: "Southampton", short_name: "SOU", strength: 970 },
                    { id: 17, name: "Spurs", short_name: "TOT", strength: 1250 },
                    { id: 18, name: "West Ham", short_name: "WHU", strength: 1130 },
                    { id: 19, name: "Wolves", short_name: "WOL", strength: 1040 },
                    { id: 20, name: "Man Utd", short_name: "MUN", strength: 1220 }
                ];
            }
            async refreshData() {
                console.log('Refreshing live data...');
                document.getElementById('data-status').textContent = 'REFRESHING...';
                
                try {
                    const data = await this.fplService.getPlayerData();
                    this.teams = data.teams || this.getDefaultTeams();
                    this.allPlayers = data.elements || [];
                    
                    if (this.allPlayers.length === 0) {
                        const mockData = this.fplService.generateFullPlayerList();
                        this.allPlayers = mockData.elements;
                        this.teams = mockData.teams;
                    }
                    
                    this.calculateTeamStats();
                    this.updateLiveIndicator(true);
                    
                    console.log('Data refreshed successfully');
                } catch (error) {
                    console.error('Failed to refresh data:', error);
                    this.updateLiveIndicator(false);
                }
            }

            updateLiveIndicator(isLive = null) {
                const statusEl = document.getElementById('data-status');
                const dotEl = document.getElementById('live-dot');
                const updateEl = document.getElementById('last-update');
                
                if (isLive) {
                    statusEl.textContent = 'LIVE DATA';
                    dotEl.style.background = '#00ff00';
                } else {
                    statusEl.textContent = 'CACHED DATA';
                    dotEl.style.background = '#ffa500';
                }
                
                const now = new Date();
                updateEl.textContent = now.toLocaleTimeString();
            }

            populateTeamGrids() {
                const team1Grid = document.getElementById('team1-grid');
                const team2Grid = document.getElementById('team2-grid');
                
                this.teams.forEach(team => {
                    // Team 1 option
                    const option1 = document.createElement('div');
                    option1.className = 'team-option';
                    option1.textContent = team.short_name;
                    option1.onclick = () => this.selectTeam(1, team);
                    team1Grid.appendChild(option1);
                    
                    // Team 2 option
                    const option2 = document.createElement('div');
                    option2.className = 'team-option';
                    option2.textContent = team.short_name;
                    option2.onclick = () => this.selectTeam(2, team);
                    team2Grid.appendChild(option2);
                });
            }

            calculateTeamStats() {
                this.teams.forEach(team => {
                    const teamPlayers = this.allPlayers.filter(p => p.team === team.id);
                    
                    const stats = {
                        totalPlayers: teamPlayers.length,
                        totalPoints: teamPlayers.reduce((sum, p) => sum + p.total_points, 0),
                        averagePoints: teamPlayers.length > 0 ? teamPlayers.reduce((sum, p) => sum + p.total_points, 0) / teamPlayers.length : 0,
                        totalValue: teamPlayers.reduce((sum, p) => sum + p.now_cost, 0),
                        averageValue: teamPlayers.length > 0 ? teamPlayers.reduce((sum, p) => sum + p.now_cost, 0) / teamPlayers.length : 0,
                        topScorer: teamPlayers.sort((a, b) => b.total_points - a.total_points)[0],
                        mostValuable: teamPlayers.sort((a, b) => b.now_cost - a.now_cost)[0],
                        bestValue: teamPlayers.sort((a, b) => (b.total_points / b.now_cost) - (a.total_points / a.now_cost))[0],
                        inFormPlayers: teamPlayers.filter(p => parseFloat(p.form) > 5).length,
                        averageForm: teamPlayers.length > 0 ? teamPlayers.reduce((sum, p) => sum + parseFloat(p.form), 0) / teamPlayers.length : 0,
                        totalOwnership: teamPlayers.reduce((sum, p) => sum + p.selected_by_percent, 0),
                        popularPlayers: teamPlayers.filter(p => p.selected_by_percent > 20).length
                    };
                    
                    this.teamStats[team.id] = stats;
                });
            }

            selectTeam(teamNumber, team) {
                if (teamNumber === 1) {
                    this.selectedTeam1 = team;
                    document.getElementById('team1-selected').textContent = team.name;
                    
                    // Update UI
                    document.querySelectorAll('#team1-grid .team-option').forEach(option => {
                        option.classList.remove('selected');
                    });
                    event.target.classList.add('selected');
                } else {
                    this.selectedTeam2 = team;
                    document.getElementById('team2-selected').textContent = team.name;
                    
                    // Update UI
                    document.querySelectorAll('#team2-grid .team-option').forEach(option => {
                        option.classList.remove('selected');
                    });
                    event.target.classList.add('selected');
                }
                
                // Enable analyze button if both teams selected
                document.getElementById('analyze-btn').disabled = !(this.selectedTeam1 && this.selectedTeam2);
            }

            async analyzeTeams() {
                if (!this.selectedTeam1 || !this.selectedTeam2) {
                    // Show inline message instead of alert
                    this.showMessage('Please select both teams to compare');
                    return;
                }

                document.getElementById('loading').style.display = 'flex';
                
                try {
                    // Add delay for UX
                    await new Promise(resolve => setTimeout(resolve, 1500));
                    
                    this.displayTeamOverview();
                    this.displayHeadToHead();
                    this.displayPerformanceCharts();
                    this.displayPlayerAnalysis();
                    this.displayFPLInsights();
                    
                    document.getElementById('comparison-results').style.display = 'block';
                    document.getElementById('comparison-results').scrollIntoView({ behavior: 'smooth' });
                } catch (error) {
                    console.error('Analysis failed:', error);
                    // Continue with available data - no alert
                    this.showMessage('Using cached data for analysis');
                } finally {
                    document.getElementById('loading').style.display = 'none';
                }
            }

            displayTeamOverview() {
                const container = document.getElementById('team-overview');
                const team1Stats = this.teamStats[this.selectedTeam1.id];
                const team2Stats = this.teamStats[this.selectedTeam2.id];
                
                container.innerHTML = `
                    <div class="team-card">
                        <div class="team-header">
                            <div class="team-badge">${this.selectedTeam1.short_name}</div>
                            <div class="team-info">
                                <h3>${this.selectedTeam1.name}</h3>
                                <div class="team-meta">Strength: ${this.selectedTeam1.strength} • Position: ${this.selectedTeam1.position || 'TBD'}</div>
                            </div>
                        </div>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <span class="stat-value">${team1Stats.totalPoints}</span>
                                <span class="stat-label">Total Points</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-value">${team1Stats.averagePoints.toFixed(1)}</span>
                                <span class="stat-label">Avg per Player</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-value">£${(team1Stats.totalValue / 10).toFixed(1)}m</span>
                                <span class="stat-label">Total Value</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-value">${team1Stats.averageForm.toFixed(1)}</span>
                                <span class="stat-label">Avg Form</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="team-card">
                        <div class="team-header">
                            <div class="team-badge">${this.selectedTeam2.short_name}</div>
                            <div class="team-info">
                                <h3>${this.selectedTeam2.name}</h3>
                                <div class="team-meta">Strength: ${this.selectedTeam2.strength} • Position: ${this.selectedTeam2.position || 'TBD'}</div>
                            </div>
                        </div>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <span class="stat-value">${team2Stats.totalPoints}</span>
                                <span class="stat-label">Total Points</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-value">${team2Stats.averagePoints.toFixed(1)}</span>
                                <span class="stat-label">Avg per Player</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-value">£${(team2Stats.totalValue / 10).toFixed(1)}m</span>
                                <span class="stat-label">Total Value</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-value">${team2Stats.averageForm.toFixed(1)}</span>
                                <span class="stat-label">Avg Form</span>
                            </div>
                        </div>
                    </div>
                `;
            }

            displayHeadToHead() {
                const container = document.getElementById('h2h-stats');
                const team1Stats = this.teamStats[this.selectedTeam1.id];
                const team2Stats = this.teamStats[this.selectedTeam2.id];
                
                const comparisons = [
                    {
                        label: 'Squad Strength',
                        team1Value: this.selectedTeam1.strength,
                        team2Value: this.selectedTeam2.strength,
                        format: (val) => val
                    },
                    {
                        label: 'Total FPL Points',
                        team1Value: team1Stats.totalPoints,
                        team2Value: team2Stats.totalPoints,
                        format: (val) => val.toLocaleString()
                    },
                    {
                        label: 'Average Form',
                        team1Value: team1Stats.averageForm,
                        team2Value: team2Stats.averageForm,
                        format: (val) => val.toFixed(1)
                    }
                ];
                
                container.innerHTML = comparisons.map(comp => `
                    <div class="h2h-team-stat">
                        <span class="h2h-value">${comp.format(comp.team1Value)}</span>
                        <span class="h2h-label">${comp.label}</span>
                    </div>
                    <div class="h2h-divider"></div>
                    <div class="h2h-team-stat">
                        <span class="h2h-value">${comp.format(comp.team2Value)}</span>
                        <span class="h2h-label">${comp.label}</span>
                    </div>
                `).join('');
            }

            displayPerformanceCharts() {
                const container = document.getElementById('performance-charts');
                const team1Stats = this.teamStats[this.selectedTeam1.id];
                const team2Stats = this.teamStats[this.selectedTeam2.id];
                
                const charts = [
                    {
                        title: '📊 Squad Performance',
                        metrics: [
                            { label: 'Points', team1: team1Stats.totalPoints, team2: team2Stats.totalPoints },
                            { label: 'Form', team1: team1Stats.averageForm * 100, team2: team2Stats.averageForm * 100 },
                            { label: 'Value', team1: team1Stats.totalValue / 10, team2: team2Stats.totalValue / 10 }
                        ]
                    },
                    {
                        title: '⭐ Player Quality',
                        metrics: [
                            { label: 'In Form', team1: team1Stats.inFormPlayers, team2: team2Stats.inFormPlayers },
                            { label: 'Popular', team1: team1Stats.popularPlayers, team2: team2Stats.popularPlayers },
                            { label: 'Squad Size', team1: team1Stats.totalPlayers, team2: team2Stats.totalPlayers }
                        ]
                    }
                ];
                
                container.innerHTML = charts.map(chart => {
                    const maxValues = chart.metrics.map(m => Math.max(m.team1, m.team2));
                    const overallMax = Math.max(...maxValues);
                    
                    return `
                        <div class="chart-card">
                            <div class="chart-header">${chart.title}</div>
                            ${chart.metrics.map(metric => {
                                const team1Percent = (metric.team1 / overallMax) * 100;
                                const team2Percent = (metric.team2 / overallMax) * 100;
                                
                                return `
                                    <div class="performance-bar">
                                        <div class="bar-label">${metric.label}</div>
                                        <div class="bar-container">
                                            <div class="bar-fill bar-team1" style="width: ${team1Percent}%">
                                                ${metric.team1.toFixed(metric.label === 'Value' ? 1 : 0)}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="performance-bar">
                                        <div class="bar-label"></div>
                                        <div class="bar-container">
                                            <div class="bar-fill bar-team2" style="width: ${team2Percent}%">
                                                ${metric.team2.toFixed(metric.label === 'Value' ? 1 : 0)}
                                            </div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    `;
                }).join('');
            }

            displayPlayerAnalysis() {
                const container = document.getElementById('player-sections');
                const team1Players = this.allPlayers.filter(p => p.team === this.selectedTeam1.id);
                const team2Players = this.allPlayers.filter(p => p.team === this.selectedTeam2.id);
                
                const getTopPlayers = (players, sortFn, count = 5) => {
                    return players.sort(sortFn).slice(0, count);
                };
                
                const team1Top = getTopPlayers(team1Players, (a, b) => b.total_points - a.total_points);
                const team2Top = getTopPlayers(team2Players, (a, b) => b.total_points - a.total_points);
                
                container.innerHTML = `
                    <div class="player-section">
                        <h4>🏆 ${this.selectedTeam1.short_name} Top Performers</h4>
                        <div class="player-list">
                            ${team1Top.map(player => `
                                <div class="player-item">
                                    <div class="player-info">
                                        <div class="player-name">${player.first_name} ${player.second_name}</div>
                                        <div class="player-stats">Points: ${player.total_points} • Form: ${player.form}</div>
                                    </div>
                                    <div class="player-value">£${(player.now_cost / 10).toFixed(1)}m</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="player-section">
                        <h4>🏆 ${this.selectedTeam2.short_name} Top Performers</h4>
                        <div class="player-list">
                            ${team2Top.map(player => `
                                <div class="player-item">
                                    <div class="player-info">
                                        <div class="player-name">${player.first_name} ${player.second_name}</div>
                                        <div class="player-stats">Points: ${player.total_points} • Form: ${player.form}</div>
                                    </div>
                                    <div class="player-value">£${(player.now_cost / 10).toFixed(1)}m</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            displayFPLInsights() {
                const container = document.getElementById('insights-grid');
                const team1Stats = this.teamStats[this.selectedTeam1.id];
                const team2Stats = this.teamStats[this.selectedTeam2.id];
                
                const insights = [];
                
                // Determine better value team
                const team1Value = team1Stats.totalPoints / (team1Stats.totalValue / 10);
                const team2Value = team2Stats.totalPoints / (team2Stats.totalValue / 10);
                const betterValue = team1Value > team2Value ? this.selectedTeam1 : this.selectedTeam2;
                const valueDiff = Math.abs(team1Value - team2Value).toFixed(1);
                
                insights.push({
                    title: '💰 Better Value for Money',
                    description: `${betterValue.name} offers ${valueDiff} more points per million. Consider their mid-priced options for your squad.`
                });
                
                // Form analysis
                const betterForm = team1Stats.averageForm > team2Stats.averageForm ? this.selectedTeam1 : this.selectedTeam2;
                const formDiff = Math.abs(team1Stats.averageForm - team2Stats.averageForm).toFixed(1);
                insights.push({
                    title: '📈 Current Form Leaders',
                    description: `${betterForm.name} players average ${formDiff} higher form rating. Good for short-term transfers and captaincy.`
                });
                
                // Squad depth
                const deeperSquad = team1Stats.inFormPlayers > team2Stats.inFormPlayers ? this.selectedTeam1 : this.selectedTeam2;
                const depthDiff = Math.abs(team1Stats.inFormPlayers - team2Stats.inFormPlayers);
                insights.push({
                    title: '🏃‍♂️ Squad Depth Advantage',
                    description: `${deeperSquad.name} has ${depthDiff} more players in good form, providing better rotation options and coverage.`
                });
                
                // Popularity insight
                const lessPopular = team1Stats.totalOwnership < team2Stats.totalOwnership ? this.selectedTeam1 : this.selectedTeam2;
                const ownershipDiff = Math.abs(team1Stats.totalOwnership - team2Stats.totalOwnership).toFixed(1);
                insights.push({
                    title: '🎯 Differential Opportunity',
                    description: `${lessPopular.name} players are ${ownershipDiff}% less owned overall. Great for gaining rank through differential picks.`
                });
                
                // Premium picks
                const team1Premium = team1Stats.topScorer;
                const team2Premium = team2Stats.topScorer;
                insights.push({
                    title: '⭐ Premium Asset Comparison',
                    description: `${this.selectedTeam1.short_name}: ${team1Premium ? team1Premium.second_name : 'N/A'} (${team1Premium ? team1Premium.total_points : 0}pts) vs ${this.selectedTeam2.short_name}: ${team2Premium ? team2Premium.second_name : 'N/A'} (${team2Premium ? team2Premium.total_points : 0}pts)`
                });
                
                // Best budget options
                const team1Budget = team1Stats.bestValue;
                const team2Budget = team2Stats.bestValue;
                insights.push({
                    title: '💸 Budget Gems',
                    description: `Best value: ${this.selectedTeam1.short_name} - ${team1Budget ? team1Budget.second_name : 'N/A'} (${team1Budget ? this.fplService.formatPrice(team1Budget.now_cost) : 'N/A'}) | ${this.selectedTeam2.short_name} - ${team2Budget ? team2Budget.second_name : 'N/A'} (${team2Budget ? this.fplService.formatPrice(team2Budget.now_cost) : 'N/A'})`
                });
                
                container.innerHTML = insights.map(insight => `
                    <div class="insight-card">
                        <div class="insight-title">${insight.title}</div>
                        <div class="insight-description">${insight.description}</div>
                    </div>
                `).join('');
            }

            async compareAll() {
                // Show all teams in a league table format
                document.getElementById('loading').style.display = 'flex';
                document.getElementById('loading').textContent = 'Analyzing all 20 teams...';
                
                try {
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    // Create league overview
                    const leagueContainer = document.getElementById('comparison-results');
                    
                    // Sort teams by various metrics
                    const teamRankings = this.teams.map(team => {
                        const stats = this.teamStats[team.id];
                        return {
                            team: team,
                            stats: stats,
                            overallRating: (stats.totalPoints * 0.4 + stats.averageForm * 100 * 0.3 + team.strength * 0.3) / 100
                        };
                    }).sort((a, b) => b.overallRating - a.overallRating);
                    
                    leagueContainer.innerHTML = `
                        <div style="background: white; border-radius: 12px; padding: 30px; margin-bottom: 30px;">
                            <h2 style="color: #37003c; text-align: center; margin-bottom: 30px;">🏆 League Team Rankings</h2>
                            
                            <div style="overflow-x: auto;">
                                <table style="width: 100%; border-collapse: collapse; background: white;">
                                    <thead>
                                        <tr style="background: linear-gradient(135deg, #37003c, #6f42c1); color: white;">
                                            <th style="padding: 15px; text-align: left;">Rank</th>
                                            <th style="padding: 15px; text-align: left;">Team</th>
                                            <th style="padding: 15px; text-align: center;">Overall Rating</th>
                                            <th style="padding: 15px; text-align: center;">Total Points</th>
                                            <th style="padding: 15px; text-align: center;">Avg Form</th>
                                            <th style="padding: 15px; text-align: center;">Squad Value</th>
                                            <th style="padding: 15px; text-align: center;">Top Scorer</th>
                                            <th style="padding: 15px; text-align: center;">FPL Picks</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${teamRankings.map((item, index) => {
                                            const rankColor = index < 3 ? '#ffd700' : index < 6 ? '#c0c0c0' : index > 16 ? '#ff6b6b' : '#333';
                                            const topScorer = item.stats.topScorer;
                                            
                                            return `
                                                <tr style="border-bottom: 1px solid #e9ecef; transition: background 0.3s;" 
                                                    onmouseover="this.style.background='#f8f9fa'" 
                                                    onmouseout="this.style.background='white'">
                                                    <td style="padding: 12px; font-weight: bold; color: ${rankColor};">
                                                        ${index + 1}${index === 0 ? ' 🥇' : index === 1 ? ' 🥈' : index === 2 ? ' 🥉' : ''}
                                                    </td>
                                                    <td style="padding: 12px; font-weight: 600; color: #37003c;">
                                                        ${item.team.name}
                                                    </td>
                                                    <td style="padding: 12px; text-align: center;">
                                                        <div style="background: linear-gradient(135deg, #28a745, #20c997); 
                                                                    width: ${item.overallRating}%; 
                                                                    color: white; 
                                                                    padding: 5px; 
                                                                    border-radius: 20px; 
                                                                    font-weight: bold; 
                                                                    min-width: 50px; 
                                                                    text-align: center;">
                                                            ${item.overallRating.toFixed(1)}
                                                        </div>
                                                    </td>
                                                    <td style="padding: 12px; text-align: center; font-weight: 600;">
                                                        ${item.stats.totalPoints}
                                                    </td>
                                                    <td style="padding: 12px; text-align: center;">
                                                        <span style="background: ${item.stats.averageForm > 5 ? '#28a745' : item.stats.averageForm > 3 ? '#ffc107' : '#dc3545'}; 
                                                                     color: white; 
                                                                     padding: 3px 8px; 
                                                                     border-radius: 12px; 
                                                                     font-weight: 600;">
                                                            ${item.stats.averageForm.toFixed(1)}
                                                        </span>
                                                    </td>
                                                    <td style="padding: 12px; text-align: center; font-weight: 600;">
                                                        £${(item.stats.totalValue / 10).toFixed(1)}m
                                                    </td>
                                                    <td style="padding: 12px; text-align: center;">
                                                        ${topScorer ? `${topScorer.second_name} (${topScorer.total_points})` : 'N/A'}
                                                    </td>
                                                    <td style="padding: 12px; text-align: center;">
                                                        <span style="background: #6f42c1; color: white; padding: 3px 8px; border-radius: 12px; font-weight: 600;">
                                                            ${item.stats.inFormPlayers}
                                                        </span>
                                                    </td>
                                                </tr>
                                            `;
                                        }).join('')}
                                    </tbody>
                                </table>
                            </div>
                            
                            <div style="margin-top: 30px; padding: 20px; background: linear-gradient(135deg, #f8f9fa, #ffffff); border-radius: 10px; border-left: 4px solid #37003c;">
                                <h4 style="color: #37003c; margin-bottom: 10px;">📊 Key Insights</h4>
                                <ul style="margin: 0; padding-left: 20px; color: #666; line-height: 1.8;">
                                    <li><strong>${teamRankings[0].team.name}</strong> leads the league with the highest overall rating</li>
                                    <li>Top 3 teams for FPL assets: ${teamRankings.slice(0, 3).map(t => t.team.name).join(', ')}</li>
                                    <li>Best value teams: ${teamRankings.sort((a, b) => {
                                        const aValue = a.stats.totalPoints / (a.stats.totalValue / 10);
                                        const bValue = b.stats.totalPoints / (b.stats.totalValue / 10);
                                        return bValue - aValue;
                                    }).slice(0, 3).map(t => t.team.name).join(', ')}</li>
                                    <li>Avoid players from: ${teamRankings.slice(-3).map(t => t.team.name).join(', ')}</li>
                                </ul>
                            </div>
                        </div>
                    `;
                    
                    leagueContainer.style.display = 'block';
                    leagueContainer.scrollIntoView({ behavior: 'smooth' });
                    
                } catch (error) {
                    console.error('Failed to generate league overview:', error);
                    this.showMessage('Error generating league overview', 'error');
                } finally {
                    document.getElementById('loading').style.display = 'none';
                }
            }
            
            showMessage(message, type = 'info') {
                // Create inline message instead of alert
                const messageDiv = document.createElement('div');
                messageDiv.style.cssText = `
                    position: fixed;
                    top: 20px;
                    left: 50%;
                    transform: translateX(-50%);
                    padding: 15px 25px;
                    background: ${type === 'error' ? '#dc3545' : '#17a2b8'};
                    color: white;
                    border-radius: 8px;
                    font-weight: 600;
                    z-index: 10000;
                    animation: slideDown 0.3s ease;
                `;
                messageDiv.textContent = message;
                document.body.appendChild(messageDiv);
                
                setTimeout(() => {
                    messageDiv.style.animation = 'slideUp 0.3s ease';
                    setTimeout(() => messageDiv.remove(), 300);
                }, 3000);
            }
        }

        function analyzeTeams() {
            analyzer.analyzeTeams();
        }

        function compareAll() {
            analyzer.compareAll();
        }

        function refreshData() {
            if (analyzer) {
                analyzer.refreshData();
            }
        }

        function showQuickTips() {
            const tipsHtml = `
                <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
                            background: white; padding: 30px; border-radius: 12px; 
                            box-shadow: 0 10px 40px rgba(0,0,0,0.2); max-width: 600px; z-index: 10001;">
                    <h2 style="color: #37003c; margin-bottom: 20px;">💡 Quick Tips</h2>
                    <div style="max-height: 400px; overflow-y: auto;">
                        <div style="margin-bottom: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #6f42c1;">
                            <h4 style="margin: 0 0 8px 0; color: #37003c;">🎯 Team Selection</h4>
                            <p style="margin: 0; color: #666; font-size: 0.9rem;">Click on team badges to select them for comparison. Choose teams with contrasting styles for the most insightful analysis.</p>
                        </div>
                        <div style="margin-bottom: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #28a745;">
                            <h4 style="margin: 0 0 8px 0; color: #37003c;">📊 League Overview</h4>
                            <p style="margin: 0; color: #666; font-size: 0.9rem;">Use the League Overview to quickly identify top-performing teams and find hidden gems for FPL transfers.</p>
                        </div>
                        <div style="margin-bottom: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #fd7e14;">
                            <h4 style="margin: 0 0 8px 0; color: #37003c;">⚡ Form Analysis</h4>
                            <p style="margin: 0; color: #666; font-size: 0.9rem;">Teams with average form above 5.0 are in excellent shape. Consider their players for short-term transfers.</p>
                        </div>
                        <div style="margin-bottom: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #17a2b8;">
                            <h4 style="margin: 0 0 8px 0; color: #37003c;">💰 Value Picks</h4>
                            <p style="margin: 0; color: #666; font-size: 0.9rem;">Look for teams with high points-per-million ratios. Their budget players often provide excellent FPL value.</p>
                        </div>
                        <div style="margin-bottom: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #dc3545;">
                            <h4 style="margin: 0 0 8px 0; color: #37003c;">🔄 Auto-Refresh</h4>
                            <p style="margin: 0; color: #666; font-size: 0.9rem;">Data automatically refreshes every 2 minutes and when you return to the tab. Manual refresh available anytime.</p>
                        </div>
                    </div>
                    <button onclick="this.parentElement.remove()" 
                            style="margin-top: 20px; padding: 10px 20px; background: linear-gradient(135deg, #6f42c1, #fd7e14); 
                                   color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">
                        Got it!
                    </button>
                </div>
                <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; 
                            background: rgba(0,0,0,0.5); z-index: 10000;" 
                     onclick="this.remove(); document.querySelector('[style*=z-index]').remove();">
                </div>
            `;
            
            const tipsContainer = document.createElement('div');
            tipsContainer.innerHTML = tipsHtml;
            document.body.appendChild(tipsContainer);
        }

        // Initialize the analyzer
        let analyzer;
        document.addEventListener('DOMContentLoaded', async function() {
            analyzer = new TeamAnalyzer();
            await analyzer.initialize();
        });
        
        // Auto-refresh data when tab becomes visible
        document.addEventListener('visibilitychange', async function() {
            if (!document.hidden && analyzer) {
                console.log('Tab became visible, refreshing team analyzer data...');
                await analyzer.refreshData();
            }
        });
        
        // Also refresh when window gains focus
        window.addEventListener('focus', async function() {
            if (analyzer) {
                console.log('Window focused, refreshing team analyzer data...');
                await analyzer.refreshData();
            }
        });
    </script>
</body>
</html>