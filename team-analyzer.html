<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-TVPLGM5QY9"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-TVPLGM5QY9');
    </script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Advanced Premier League team analysis tool with head-to-head comparisons, performance metrics, and FPL insights.">
    <meta name="keywords" content="Premier League teams, team analysis, team comparison, FPL team stats, football analytics">
    <meta name="author" content="EPL News Hub">
    <title>Team Analysis & Comparison Tool | EPL News Hub</title>
    <link rel="stylesheet" href="styles.css">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6480210605786899" crossorigin="anonymous"></script>
    <script src="./fpl-api.js"></script>
    
    <style>
        .analyzer-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            border-radius: 16px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.08);
        }

        .analyzer-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 30px;
            background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);
            color: white;
            border-radius: 12px;
        }

        .analyzer-header h1 {
            font-size: 2.5rem;
            margin-bottom: 15px;
            font-weight: 800;
        }

        .team-selector-panel {
            background: white;
            padding: 25px;
            border-radius: 12px;
            border: 1px solid #e9ecef;
            margin-bottom: 30px;
        }

        .team-selectors {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 30px;
            align-items: center;
        }

        .team-selection {
            text-align: center;
        }

        .team-selection h3 {
            color: #37003c;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .team-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .team-option {
            padding: 12px 8px;
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .team-option:hover {
            background: #e9ecef;
            border-color: #37003c;
        }

        .team-option.selected {
            background: #37003c;
            color: white;
            border-color: #37003c;
        }

        .vs-divider {
            font-size: 2rem;
            font-weight: 800;
            color: #dc3545;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .analysis-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .control-btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, #37003c, #6f42c1);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(55, 0, 60, 0.3);
        }

        .control-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .comparison-results {
            display: none;
        }

        .team-overview {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .team-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            border: 2px solid #e9ecef;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        .team-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f8f9fa;
        }

        .team-badge {
            width: 60px;
            height: 60px;
            background: #f8f9fa;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 800;
            color: #37003c;
            border: 2px solid #e9ecef;
        }

        .team-info h3 {
            color: #37003c;
            margin: 0 0 5px 0;
            font-size: 1.4rem;
        }

        .team-meta {
            color: #666;
            font-size: 0.9rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .stat-item {
            text-align: center;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .stat-value {
            font-size: 1.3rem;
            font-weight: 800;
            color: #37003c;
            display: block;
            margin-bottom: 3px;
        }

        .stat-label {
            font-size: 0.8rem;
            color: #666;
            text-transform: uppercase;
        }

        .head-to-head {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            border: 2px solid #e9ecef;
        }

        .h2h-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .h2h-stats {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 20px;
            align-items: center;
            margin-bottom: 25px;
        }

        .h2h-team-stat {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .h2h-value {
            font-size: 2rem;
            font-weight: 800;
            color: #37003c;
            display: block;
            margin-bottom: 5px;
        }

        .h2h-label {
            color: #666;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .h2h-divider {
            width: 3px;
            height: 80px;
            background: linear-gradient(to bottom, #dc3545, #fd7e14);
            border-radius: 2px;
        }

        .performance-charts {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            border: 2px solid #e9ecef;
        }

        .chart-header {
            color: #37003c;
            margin-bottom: 15px;
            font-size: 1.1rem;
            font-weight: 600;
            text-align: center;
        }

        .performance-bar {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            gap: 10px;
        }

        .bar-label {
            min-width: 80px;
            font-size: 0.9rem;
            color: #333;
            font-weight: 600;
        }

        .bar-container {
            flex: 1;
            height: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .bar-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.8s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 8px;
            color: white;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .bar-team1 { background: linear-gradient(135deg, #37003c, #6f42c1); }
        .bar-team2 { background: linear-gradient(135deg, #dc3545, #fd7e14); }

        .player-analysis {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            border: 2px solid #e9ecef;
        }

        .player-sections {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .player-section h4 {
            color: #37003c;
            margin-bottom: 15px;
            font-size: 1.1rem;
            text-align: center;
        }

        .player-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .player-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .player-info {
            display: flex;
            flex-direction: column;
        }

        .player-name {
            font-weight: 600;
            color: #333;
            font-size: 0.9rem;
        }

        .player-stats {
            font-size: 0.8rem;
            color: #666;
        }

        .player-value {
            font-weight: 700;
            color: #37003c;
            font-size: 0.9rem;
        }

        .fpl-insights {
            background: linear-gradient(135deg, #20c997, #17a2b8);
            color: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .insights-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .insight-card {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .insight-title {
            font-weight: 700;
            margin-bottom: 8px;
            font-size: 1rem;
        }

        .insight-description {
            font-size: 0.9rem;
            opacity: 0.9;
            line-height: 1.4;
        }

        @media (max-width: 768px) {
            .analyzer-header h1 {
                font-size: 2rem;
            }
            
            .team-selectors {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .vs-divider {
                font-size: 1.5rem;
            }
            
            .team-overview {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .h2h-stats {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .h2h-divider {
                width: 80%;
                height: 3px;
                margin: 0 auto;
            }
            
            .player-sections {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        .loading-spinner {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
            font-size: 1.2rem;
            color: #666;
        }

        .loading-spinner::after {
            content: "";
            width: 30px;
            height: 30px;
            margin-left: 15px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #dc3545;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="header" include="./header.html"></div>
    
    <main class="main-content">
        <div class="analyzer-container">
            <div class="analyzer-header">
                <h1>⚔️ Team Analysis & Comparison</h1>
                <p>Deep-dive team performance analysis with head-to-head comparisons and FPL insights</p>
            </div>

            <!-- Team Selector Panel -->
            <div class="team-selector-panel">
                <h2 style="text-align: center; color: #37003c; margin-bottom: 25px;">
                    🎯 Select Teams to Compare
                </h2>
                
                <div class="team-selectors">
                    <div class="team-selection">
                        <h3>Team 1</h3>
                        <div class="team-grid" id="team1-grid">
                            <!-- Teams will be populated here -->
                        </div>
                        <div id="team1-selected" style="margin-top: 10px; font-weight: 600; color: #37003c;">
                            No team selected
                        </div>
                    </div>
                    
                    <div class="vs-divider">VS</div>
                    
                    <div class="team-selection">
                        <h3>Team 2</h3>
                        <div class="team-grid" id="team2-grid">
                            <!-- Teams will be populated here -->
                        </div>
                        <div id="team2-selected" style="margin-top: 10px; font-weight: 600; color: #dc3545;">
                            No team selected
                        </div>
                    </div>
                </div>
                
                <div class="analysis-controls">
                    <button class="control-btn" onclick="analyzeTeams()" id="analyze-btn" disabled>
                        🔍 Analyze Teams
                    </button>
                    <button class="control-btn" onclick="compareAll()" style="background: linear-gradient(135deg, #28a745, #20c997);">
                        📊 League Overview
                    </button>
                </div>
            </div>

            <!-- Loading State -->
            <div id="loading" class="loading-spinner" style="display: none;">
                Analyzing team performance...
            </div>

            <!-- Comparison Results -->
            <div class="comparison-results" id="comparison-results">
                <!-- Team Overview -->
                <div class="team-overview" id="team-overview">
                    <!-- Team cards will be populated here -->
                </div>

                <!-- Head-to-Head Stats -->
                <div class="head-to-head" id="head-to-head">
                    <div class="h2h-header">
                        <h3 style="color: #37003c; margin: 0;">🏆 Head-to-Head Performance</h3>
                        <p style="color: #666; margin: 5px 0 0 0;">Comparative analysis across key metrics</p>
                    </div>
                    <div class="h2h-stats" id="h2h-stats">
                        <!-- H2H stats will be populated here -->
                    </div>
                </div>

                <!-- Performance Charts -->
                <div class="performance-charts" id="performance-charts">
                    <!-- Charts will be populated here -->
                </div>

                <!-- Player Analysis -->
                <div class="player-analysis" id="player-analysis">
                    <h3 style="color: #37003c; text-align: center; margin-bottom: 20px;">
                        👑 Key Players Comparison
                    </h3>
                    <div class="player-sections" id="player-sections">
                        <!-- Player sections will be populated here -->
                    </div>
                </div>

                <!-- FPL Insights -->
                <div class="fpl-insights" id="fpl-insights">
                    <div class="insights-header">
                        <h3 style="margin: 0;">🎯 FPL Strategy Insights</h3>
                        <p style="margin: 5px 0 0 0; opacity: 0.9;">
                            Strategic recommendations based on team analysis
                        </p>
                    </div>
                    <div class="insights-grid" id="insights-grid">
                        <!-- Insights will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div class="footer" include="./footer.html"></div>
    <script src="./index.js"></script>

    <script>
        class TeamAnalyzer {
            constructor() {
                this.fplService = new FPLDataService();
                this.teams = [];
                this.allPlayers = [];
                this.selectedTeam1 = null;
                this.selectedTeam2 = null;
                this.teamStats = {};
            }

            async initialize() {
                try {
                    const bootstrap = await this.fplService.getBootstrapData();
                    this.teams = bootstrap.teams;
                    this.allPlayers = bootstrap.elements;
                    
                    this.populateTeamGrids();
                    this.calculateTeamStats();
                } catch (error) {
                    console.error('Failed to initialize team analyzer:', error);
                    alert('Failed to load team data. Please refresh the page.');
                }
            }

            populateTeamGrids() {
                const team1Grid = document.getElementById('team1-grid');
                const team2Grid = document.getElementById('team2-grid');
                
                this.teams.forEach(team => {
                    // Team 1 option
                    const option1 = document.createElement('div');
                    option1.className = 'team-option';
                    option1.textContent = team.short_name;
                    option1.onclick = () => this.selectTeam(1, team);
                    team1Grid.appendChild(option1);
                    
                    // Team 2 option
                    const option2 = document.createElement('div');
                    option2.className = 'team-option';
                    option2.textContent = team.short_name;
                    option2.onclick = () => this.selectTeam(2, team);
                    team2Grid.appendChild(option2);
                });
            }

            calculateTeamStats() {
                this.teams.forEach(team => {
                    const teamPlayers = this.allPlayers.filter(p => p.team === team.id);
                    
                    const stats = {
                        totalPlayers: teamPlayers.length,
                        totalPoints: teamPlayers.reduce((sum, p) => sum + p.total_points, 0),
                        averagePoints: teamPlayers.length > 0 ? teamPlayers.reduce((sum, p) => sum + p.total_points, 0) / teamPlayers.length : 0,
                        totalValue: teamPlayers.reduce((sum, p) => sum + p.now_cost, 0),
                        averageValue: teamPlayers.length > 0 ? teamPlayers.reduce((sum, p) => sum + p.now_cost, 0) / teamPlayers.length : 0,
                        topScorer: teamPlayers.sort((a, b) => b.total_points - a.total_points)[0],
                        mostValuable: teamPlayers.sort((a, b) => b.now_cost - a.now_cost)[0],
                        bestValue: teamPlayers.sort((a, b) => (b.total_points / b.now_cost) - (a.total_points / a.now_cost))[0],
                        inFormPlayers: teamPlayers.filter(p => parseFloat(p.form) > 5).length,
                        averageForm: teamPlayers.length > 0 ? teamPlayers.reduce((sum, p) => sum + parseFloat(p.form), 0) / teamPlayers.length : 0,
                        totalOwnership: teamPlayers.reduce((sum, p) => sum + p.selected_by_percent, 0),
                        popularPlayers: teamPlayers.filter(p => p.selected_by_percent > 20).length
                    };
                    
                    this.teamStats[team.id] = stats;
                });
            }

            selectTeam(teamNumber, team) {
                if (teamNumber === 1) {
                    this.selectedTeam1 = team;
                    document.getElementById('team1-selected').textContent = team.name;
                    
                    // Update UI
                    document.querySelectorAll('#team1-grid .team-option').forEach(option => {
                        option.classList.remove('selected');
                    });
                    event.target.classList.add('selected');
                } else {
                    this.selectedTeam2 = team;
                    document.getElementById('team2-selected').textContent = team.name;
                    
                    // Update UI
                    document.querySelectorAll('#team2-grid .team-option').forEach(option => {
                        option.classList.remove('selected');
                    });
                    event.target.classList.add('selected');
                }
                
                // Enable analyze button if both teams selected
                document.getElementById('analyze-btn').disabled = !(this.selectedTeam1 && this.selectedTeam2);
            }

            async analyzeTeams() {
                if (!this.selectedTeam1 || !this.selectedTeam2) {
                    alert('Please select both teams to compare');
                    return;
                }

                document.getElementById('loading').style.display = 'flex';
                
                try {
                    // Add delay for UX
                    await new Promise(resolve => setTimeout(resolve, 1500));
                    
                    this.displayTeamOverview();
                    this.displayHeadToHead();
                    this.displayPerformanceCharts();
                    this.displayPlayerAnalysis();
                    this.displayFPLInsights();
                    
                    document.getElementById('comparison-results').style.display = 'block';
                    document.getElementById('comparison-results').scrollIntoView({ behavior: 'smooth' });
                } catch (error) {
                    console.error('Analysis failed:', error);
                    alert('Analysis failed. Please try again.');
                } finally {
                    document.getElementById('loading').style.display = 'none';
                }
            }

            displayTeamOverview() {
                const container = document.getElementById('team-overview');
                const team1Stats = this.teamStats[this.selectedTeam1.id];
                const team2Stats = this.teamStats[this.selectedTeam2.id];
                
                container.innerHTML = `
                    <div class="team-card">
                        <div class="team-header">
                            <div class="team-badge">${this.selectedTeam1.short_name}</div>
                            <div class="team-info">
                                <h3>${this.selectedTeam1.name}</h3>
                                <div class="team-meta">Strength: ${this.selectedTeam1.strength} • Position: ${this.selectedTeam1.position || 'TBD'}</div>
                            </div>
                        </div>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <span class="stat-value">${team1Stats.totalPoints}</span>
                                <span class="stat-label">Total Points</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-value">${team1Stats.averagePoints.toFixed(1)}</span>
                                <span class="stat-label">Avg per Player</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-value">£${(team1Stats.totalValue / 10).toFixed(1)}m</span>
                                <span class="stat-label">Total Value</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-value">${team1Stats.averageForm.toFixed(1)}</span>
                                <span class="stat-label">Avg Form</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="team-card">
                        <div class="team-header">
                            <div class="team-badge">${this.selectedTeam2.short_name}</div>
                            <div class="team-info">
                                <h3>${this.selectedTeam2.name}</h3>
                                <div class="team-meta">Strength: ${this.selectedTeam2.strength} • Position: ${this.selectedTeam2.position || 'TBD'}</div>
                            </div>
                        </div>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <span class="stat-value">${team2Stats.totalPoints}</span>
                                <span class="stat-label">Total Points</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-value">${team2Stats.averagePoints.toFixed(1)}</span>
                                <span class="stat-label">Avg per Player</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-value">£${(team2Stats.totalValue / 10).toFixed(1)}m</span>
                                <span class="stat-label">Total Value</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-value">${team2Stats.averageForm.toFixed(1)}</span>
                                <span class="stat-label">Avg Form</span>
                            </div>
                        </div>
                    </div>
                `;
            }

            displayHeadToHead() {
                const container = document.getElementById('h2h-stats');
                const team1Stats = this.teamStats[this.selectedTeam1.id];
                const team2Stats = this.teamStats[this.selectedTeam2.id];
                
                const comparisons = [
                    {
                        label: 'Squad Strength',
                        team1Value: this.selectedTeam1.strength,
                        team2Value: this.selectedTeam2.strength,
                        format: (val) => val
                    },
                    {
                        label: 'Total FPL Points',
                        team1Value: team1Stats.totalPoints,
                        team2Value: team2Stats.totalPoints,
                        format: (val) => val.toLocaleString()
                    },
                    {
                        label: 'Average Form',
                        team1Value: team1Stats.averageForm,
                        team2Value: team2Stats.averageForm,
                        format: (val) => val.toFixed(1)
                    }
                ];
                
                container.innerHTML = comparisons.map(comp => `
                    <div class="h2h-team-stat">
                        <span class="h2h-value">${comp.format(comp.team1Value)}</span>
                        <span class="h2h-label">${comp.label}</span>
                    </div>
                    <div class="h2h-divider"></div>
                    <div class="h2h-team-stat">
                        <span class="h2h-value">${comp.format(comp.team2Value)}</span>
                        <span class="h2h-label">${comp.label}</span>
                    </div>
                `).join('');
            }

            displayPerformanceCharts() {
                const container = document.getElementById('performance-charts');
                const team1Stats = this.teamStats[this.selectedTeam1.id];
                const team2Stats = this.teamStats[this.selectedTeam2.id];
                
                const charts = [
                    {
                        title: '📊 Squad Performance',
                        metrics: [
                            { label: 'Points', team1: team1Stats.totalPoints, team2: team2Stats.totalPoints },
                            { label: 'Form', team1: team1Stats.averageForm * 100, team2: team2Stats.averageForm * 100 },
                            { label: 'Value', team1: team1Stats.totalValue / 10, team2: team2Stats.totalValue / 10 }
                        ]
                    },
                    {
                        title: '⭐ Player Quality',
                        metrics: [
                            { label: 'In Form', team1: team1Stats.inFormPlayers, team2: team2Stats.inFormPlayers },
                            { label: 'Popular', team1: team1Stats.popularPlayers, team2: team2Stats.popularPlayers },
                            { label: 'Squad Size', team1: team1Stats.totalPlayers, team2: team2Stats.totalPlayers }
                        ]
                    }
                ];
                
                container.innerHTML = charts.map(chart => {
                    const maxValues = chart.metrics.map(m => Math.max(m.team1, m.team2));
                    const overallMax = Math.max(...maxValues);
                    
                    return `
                        <div class="chart-card">
                            <div class="chart-header">${chart.title}</div>
                            ${chart.metrics.map(metric => {
                                const team1Percent = (metric.team1 / overallMax) * 100;
                                const team2Percent = (metric.team2 / overallMax) * 100;
                                
                                return `
                                    <div class="performance-bar">
                                        <div class="bar-label">${metric.label}</div>
                                        <div class="bar-container">
                                            <div class="bar-fill bar-team1" style="width: ${team1Percent}%">
                                                ${metric.team1.toFixed(metric.label === 'Value' ? 1 : 0)}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="performance-bar">
                                        <div class="bar-label"></div>
                                        <div class="bar-container">
                                            <div class="bar-fill bar-team2" style="width: ${team2Percent}%">
                                                ${metric.team2.toFixed(metric.label === 'Value' ? 1 : 0)}
                                            </div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    `;
                }).join('');
            }

            displayPlayerAnalysis() {
                const container = document.getElementById('player-sections');
                const team1Players = this.allPlayers.filter(p => p.team === this.selectedTeam1.id);
                const team2Players = this.allPlayers.filter(p => p.team === this.selectedTeam2.id);
                
                const getTopPlayers = (players, sortFn, count = 5) => {
                    return players.sort(sortFn).slice(0, count);
                };
                
                const team1Top = getTopPlayers(team1Players, (a, b) => b.total_points - a.total_points);
                const team2Top = getTopPlayers(team2Players, (a, b) => b.total_points - a.total_points);
                
                container.innerHTML = `
                    <div class="player-section">
                        <h4>🏆 ${this.selectedTeam1.short_name} Top Performers</h4>
                        <div class="player-list">
                            ${team1Top.map(player => `
                                <div class="player-item">
                                    <div class="player-info">
                                        <div class="player-name">${player.first_name} ${player.second_name}</div>
                                        <div class="player-stats">Points: ${player.total_points} • Form: ${player.form}</div>
                                    </div>
                                    <div class="player-value">${this.fplService.formatPrice(player.now_cost)}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="player-section">
                        <h4>🏆 ${this.selectedTeam2.short_name} Top Performers</h4>
                        <div class="player-list">
                            ${team2Top.map(player => `
                                <div class="player-item">
                                    <div class="player-info">
                                        <div class="player-name">${player.first_name} ${player.second_name}</div>
                                        <div class="player-stats">Points: ${player.total_points} • Form: ${player.form}</div>
                                    </div>
                                    <div class="player-value">${this.fplService.formatPrice(player.now_cost)}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            displayFPLInsights() {
                const container = document.getElementById('insights-grid');
                const team1Stats = this.teamStats[this.selectedTeam1.id];
                const team2Stats = this.teamStats[this.selectedTeam2.id];
                
                const insights = [];
                
                // Determine better value team
                const team1Value = team1Stats.totalPoints / (team1Stats.totalValue / 10);
                const team2Value = team2Stats.totalPoints / (team2Stats.totalValue / 10);
                const betterValue = team1Value > team2Value ? this.selectedTeam1 : this.selectedTeam2;
                
                insights.push({
                    title: '💰 Better Value for Money',
                    description: `${betterValue.name} offers better points per million ratio. Consider their mid-priced options for your squad.`
                });
                
                // Form analysis
                const betterForm = team1Stats.averageForm > team2Stats.averageForm ? this.selectedTeam1 : this.selectedTeam2;
                insights.push({
                    title: '📈 Current Form Leaders',
                    description: `${betterForm.name} players are in better form on average. Good for short-term transfers and captaincy.`
                });
                
                // Squad depth
                const deeperSquad = team1Stats.inFormPlayers > team2Stats.inFormPlayers ? this.selectedTeam1 : this.selectedTeam2;
                insights.push({
                    title: '🏃‍♂️ Squad Depth Advantage',
                    description: `${deeperSquad.name} has more players in good form, providing better rotation options and coverage.`
                });
                
                // Popularity insight
                const lessPopular = team1Stats.totalOwnership < team2Stats.totalOwnership ? this.selectedTeam1 : this.selectedTeam2;
                insights.push({
                    title: '🎯 Differential Opportunity',
                    description: `${lessPopular.name} players are less owned on average. Great for gaining rank through differential picks.`
                });
                
                container.innerHTML = insights.map(insight => `
                    <div class="insight-card">
                        <div class="insight-title">${insight.title}</div>
                        <div class="insight-description">${insight.description}</div>
                    </div>
                `).join('');
            }

            async compareAll() {
                // Show all teams in a league table format
                alert('League overview feature coming soon! This will show all 20 teams ranked by various metrics.');
            }
        }

        function analyzeTeams() {
            analyzer.analyzeTeams();
        }

        function compareAll() {
            analyzer.compareAll();
        }

        // Initialize the analyzer
        let analyzer;
        document.addEventListener('DOMContentLoaded', async function() {
            analyzer = new TeamAnalyzer();
            await analyzer.initialize();
        });
    </script>
</body>
</html>