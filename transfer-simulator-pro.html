<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-TVPLGM5QY9"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-TVPLGM5QY9');
    </script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Professional FPL Transfer Simulator with AI predictions, what-if scenarios, and advanced analytics">
    <meta name="keywords" content="FPL transfer simulator, Fantasy Premier League, transfer planner, AI predictions">
    <meta name="author" content="EPL News Hub">
    <title>Transfer Simulator Pro - Advanced FPL Transfer Planning | EPL News Hub</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="dark-mode.css">
    <link rel="stylesheet" href="/mobile-master-optimize.css">
    <link rel="stylesheet" href="fpl-mobile-optimize.css">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6480210605786899" crossorigin="anonymous"></script>
    <script src="dark-mode.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Load FPL Data Service from player-data-2.html -->
    <script src="fpl-api.js"></script>
    
    <!-- Alternative data loading: load JSON as script -->
    <script>
        // Try to load player data as script to avoid CORS issues
        function loadPlayerDataAsScript() {
            return new Promise((resolve, reject) => {
                // First try to load as text via script tag injection
                const script = document.createElement('script');
                script.textContent = `
                    fetch('./player-data-2.html')
                        .then(response => response.text())
                        .then(text => {
                            try {
                                window.PLAYER_DATA_FROM_SCRIPT = JSON.parse(text);
                                console.log('Successfully loaded player data via script approach');
                                window.dispatchEvent(new CustomEvent('playerDataLoaded'));
                            } catch (e) {
                                console.error('Failed to parse player data:', e);
                            }
                        })
                        .catch(e => {
                            console.error('Failed to fetch player data via script:', e);
                        });
                `;
                document.head.appendChild(script);
                
                // Listen for the custom event
                window.addEventListener('playerDataLoaded', () => {
                    resolve(window.PLAYER_DATA_FROM_SCRIPT);
                }, { once: true });
                
                // Timeout after 5 seconds
                setTimeout(() => {
                    reject(new Error('Script loading timeout'));
                }, 5000);
            });
        }
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            min-height: 100vh;
            color: #333;
        }

        .pro-container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        .pro-header {
            background: linear-gradient(135deg, rgba(55, 0, 60, 0.95) 0%, rgba(111, 66, 193, 0.95) 100%);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            text-align: center;
            color: white;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .pro-header h1 {
            font-size: 3rem;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #fff, #f0f0f0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 4px 15px rgba(255,255,255,0.2);
        }

        .live-status {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: rgba(255,255,255,0.1);
            padding: 10px 20px;
            border-radius: 50px;
            margin-top: 20px;
            backdrop-filter: blur(10px);
        }

        .live-dot {
            width: 10px;
            height: 10px;
            background: #00ff88;
            border-radius: 50%;
            animation: pulse 2s infinite;
            box-shadow: 0 0 10px #00ff88;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(30px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .panel {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            width: 100%;
            box-sizing: border-box;
        }

        .panel h2 {
            color: #37003c;
            margin-bottom: 20px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .squad-section {
            margin-bottom: 25px;
        }

        .squad-section h3 {
            color: #6f42c1;
            font-size: 1.1rem;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }

        /* Football Pitch Styles for Transfer Simulator Pro */
        .football-pitch {
            background: linear-gradient(180deg, #2d7a2d 0%, #3a8f3a 50%, #2d7a2d 100%);
            background-size: 100% 40px;
            border: 3px solid white;
            border-radius: 15px;
            padding: 30px 20px;
            position: relative;
            min-height: 500px;
            box-shadow: inset 0 0 50px rgba(0,0,0,0.3), 0 10px 30px rgba(0,0,0,0.5);
            margin: 20px 0;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        .pitch-row {
            display: flex;
            justify-content: space-around;
            align-items: center;
            width: 100%;
            margin: 15px 0;
        }
        
        .goalkeeper-row {
            justify-content: center;
        }
        
        .position-circle {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.95), rgba(248, 249, 250, 0.95));
            border: 3px solid #37003c;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 6px 20px rgba(55, 0, 60, 0.2), inset 0 1px 3px rgba(255, 255, 255, 0.3);
            position: relative;
            backdrop-filter: blur(10px);
        }
        
        .position-circle:hover {
            transform: scale(1.15) translateY(-2px);
            box-shadow: 0 12px 30px rgba(111, 66, 193, 0.4), 0 4px 15px rgba(55, 0, 60, 0.3);
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            border-color: #6f42c1;
            border-width: 4px;
            cursor: pointer; /* Ensure cursor shows pointer */
        }
        
        .position-circle:active {
            transform: scale(1.05);
            transition: all 0.1s ease;
            background: linear-gradient(145deg, #e8f5e9, #c8e6c9);
        }
        
        /* Click animation */
        .position-circle.clicked {
            animation: clickPulse 0.3s ease-out;
        }
        
        @keyframes clickPulse {
            0% { 
                transform: scale(1.15) translateY(-2px);
                background: linear-gradient(145deg, #e8f5e9, #c8e6c9);
            }
            50% { 
                transform: scale(1.25) translateY(-4px);
                background: linear-gradient(145deg, #81c784, #4caf50);
            }
            100% { 
                transform: scale(1.15) translateY(-2px);
                background: linear-gradient(145deg, #ffffff, #f8f9fa);
            }
        }
        
        .position-circle.filled {
            background: linear-gradient(145deg, #37003c, #6f42c1, #ff6b35);
            color: white;
            border-color: #ffffff;
            box-shadow: 0 8px 25px rgba(55, 0, 60, 0.4), inset 0 1px 3px rgba(255, 255, 255, 0.2);
        }
        
        .position-circle.filled:hover {
            background: linear-gradient(145deg, #4a0e4e, #8b5cbb, #ff8c5a);
            transform: scale(1.15) translateY(-3px);
            box-shadow: 0 15px 35px rgba(55, 0, 60, 0.5);
        }
        
        .position-label {
            font-size: 0.65rem;
            font-weight: 800;
            color: #37003c;
            margin-bottom: 1px;
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.8);
            letter-spacing: 0.5px;
            pointer-events: none; /* Allow clicks to pass through to parent */
        }
        
        .position-circle.filled .position-label {
            color: white;
        }
        
        .player-name-display {
            font-size: 0.7rem;
            font-weight: 700;
            text-align: center;
            line-height: 1.1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 60px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            pointer-events: none; /* Allow clicks to pass through to parent */
        }
        
        .position-circle:not(.filled) .player-name-display {
            font-size: 1.5rem;
            color: #37003c;
            font-weight: 300;
            opacity: 0.7;
        }
        
        .position-circle.filled .player-name-display {
            color: white;
        }

        .football-pitch::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 120px;
            height: 120px;
            border: 2px solid rgba(255,255,255,0.6);
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
        }

        .football-pitch::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 8px;
            height: 8px;
            background: rgba(255,255,255,0.8);
            border-radius: 50%;
        }

        .pitch-line {
            position: absolute;
            background: rgba(255,255,255,0.6);
        }

        .center-line {
            top: 0;
            left: 50%;
            width: 2px;
            height: 100%;
            transform: translateX(-50%);
        }

        .penalty-area {
            position: absolute;
            border: 2px solid rgba(255,255,255,0.4);
            background: rgba(255,255,255,0.05);
        }

        .top-penalty-area {
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 40%;
            height: 18%;
        }

        .bottom-penalty-area {
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 40%;
            height: 18%;
        }

        .formation-line {
            position: absolute;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            padding: 0 20px;
            box-sizing: border-box;
        }

        .goalkeeper-line {
            bottom: 5%;
        }

        .defender-line {
            bottom: 25%;
        }

        .midfielder-line {
            bottom: 50%;
        }

        .forward-line {
            bottom: 75%;
        }

        .player-slot {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: 3px solid white;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
            font-size: 0.75rem;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            position: relative;
            overflow: hidden;
        }

        .player-slot:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(0,0,0,0.4);
            border-color: #00ff88;
        }

        .player-slot.selected {
            background: linear-gradient(135deg, #00ff88, #00d4ff);
            border-color: #00ff88;
            color: white;
            transform: scale(1.05);
        }

        .player-slot.empty {
            background: linear-gradient(135deg, rgba(255,255,255,0.2), rgba(255,255,255,0.1));
            border: 3px dashed rgba(255,255,255,0.5);
            color: rgba(255,255,255,0.7);
        }

        .player-slot.empty:hover {
            background: linear-gradient(135deg, rgba(255,255,255,0.3), rgba(255,255,255,0.2));
            border-color: rgba(255,255,255,0.8);
            color: white;
        }

        .player-info {
            flex: 1;
        }

        .player-name {
            font-weight: 700;
            font-size: 1rem;
            margin-bottom: 3px;
        }

        .player-details {
            font-size: 0.85rem;
            color: #666;
        }

        .player-price {
            font-weight: 700;
            color: #37003c;
            font-size: 1.1rem;
        }

        .player-slot.selected .player-price {
            color: white;
        }

        .budget-tracker {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .budget-amount {
            font-size: 2.5rem;
            font-weight: 800;
            text-align: center;
            margin-bottom: 10px;
        }

        .budget-bar {
            background: rgba(255,255,255,0.3);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        .budget-fill {
            background: white;
            height: 100%;
            transition: width 0.5s ease;
        }

        .player-market {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .market-filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .filter-group label {
            font-weight: 600;
            color: #37003c;
            font-size: 0.9rem;
        }

        .filter-group input,
        .filter-group select {
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }

        .filter-group input:focus,
        .filter-group select:focus {
            outline: none;
            border-color: #6f42c1;
            box-shadow: 0 0 0 3px rgba(111, 66, 193, 0.1);
        }


        .search-instructions {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            border: 2px dashed #6f42c1;
        }

        .search-prompt h3 {
            color: #37003c;
            font-size: 1.8rem;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .search-prompt p {
            color: #666;
            font-size: 1.1rem;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .search-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.7;
        }

        .position-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .position-btn {
            background: linear-gradient(135deg, #6f42c1, #37003c);
            color: white;
            border: none;
            padding: 20px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            font-size: 1rem;
        }

        .position-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(111, 66, 193, 0.3);
            background: linear-gradient(135deg, #37003c, #6f42c1);
        }

        .position-emoji {
            font-size: 2rem;
        }

        .position-btn span:last-child {
            font-size: 1rem;
        }

        .market-player-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            border: 2px solid #e0e0e0;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .market-player-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #37003c, #6f42c1);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .market-player-card:hover::before {
            transform: scaleX(1);
        }

        .market-player-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .player-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .player-card-name {
            font-size: 1.2rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 5px;
        }

        .player-card-team {
            color: #666;
            font-size: 0.9rem;
        }

        .player-card-price {
            background: linear-gradient(135deg, #37003c, #6f42c1);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: 700;
        }

        .player-stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .stat-box {
            text-align: center;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .stat-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: #37003c;
        }

        .stat-label {
            font-size: 0.75rem;
            color: #666;
            text-transform: uppercase;
            margin-top: 2px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            text-align: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, #37003c, #6f42c1);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(55, 0, 60, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
        }

        .scenario-panel {
            background: linear-gradient(135deg, #6f42c1, #37003c);
            color: white;
            padding: 25px;
            border-radius: 16px;
            margin-bottom: 30px;
        }

        .scenario-panel h2 {
            color: white;
            margin-bottom: 20px;
        }

        .scenario-item {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .scenario-item:hover {
            background: rgba(255,255,255,0.2);
            transform: translateX(5px);
        }

        .scenario-title {
            font-weight: 700;
            margin-bottom: 5px;
        }

        .scenario-description {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .analytics-section {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .chart-container h3 {
            color: #37003c;
            margin-bottom: 15px;
        }

        .ai-recommendations {
            background: linear-gradient(135deg, #00d4ff, #00ff88);
            padding: 25px;
            border-radius: 16px;
            margin-bottom: 30px;
        }

        .ai-recommendations h2 {
            color: white;
            margin-bottom: 20px;
        }

        .recommendation-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .recommendation-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #37003c, #6f42c1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }

        .recommendation-content {
            flex: 1;
        }

        .recommendation-title {
            font-weight: 700;
            color: #333;
            margin-bottom: 5px;
        }

        .recommendation-details {
            color: #666;
            font-size: 0.9rem;
        }

        .transfer-history {
            background: rgba(255,255,255,0.95);
            padding: 25px;
            border-radius: 16px;
            margin-bottom: 30px;
        }

        .history-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .history-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 1.2rem;
        }

        .history-in {
            background: #d4edda;
            color: #155724;
        }

        .history-out {
            background: #f8d7da;
            color: #721c24;
        }

        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            .analytics-section {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .pro-container {
                padding: 10px;
            }
            
            .pro-header {
                padding: 25px 15px;
                border-radius: 12px;
            }
            
            .pro-header h1 {
                font-size: 1.8rem;
            }
            
            .pro-header p {
                font-size: 0.9rem;
            }
            
            .live-status {
                padding: 8px 15px;
                font-size: 0.8rem;
            }
            
            .main-grid {
                gap: 15px;
            }
            
            .panel {
                padding: 15px;
                border-radius: 12px;
            }
            
            .panel h2 {
                font-size: 1.2rem;
            }
            
            .squad-section h3 {
                font-size: 1rem;
            }
            
            .player-slot {
                padding: 10px;
                margin-bottom: 8px;
            }
            
            .player-name {
                font-size: 0.9rem;
            }
            
            .player-price {
                font-size: 0.95rem;
            }
            
            .budget-amount {
                font-size: 2rem;
            }
            
            
            .search-instructions {
                padding: 25px 15px;
            }
            
            .search-prompt h3 {
                font-size: 1.4rem;
            }
            
            .search-prompt p {
                font-size: 1rem;
            }
            
            .search-icon {
                font-size: 3rem;
            }
            
            .position-buttons {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
            
            .position-btn {
                padding: 15px 10px;
                font-size: 0.9rem;
            }
            
            .position-emoji {
                font-size: 1.5rem;
            }
            
            .market-player-card {
                padding: 15px;
            }
            
            .player-card-name {
                font-size: 1.1rem;
            }
            
            .player-stats-grid {
                gap: 8px;
            }
            
            .stat-box {
                padding: 6px;
            }
            
            .stat-value {
                font-size: 1rem;
            }
            
            .stat-label {
                font-size: 0.65rem;
            }
            
            .market-filters {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .filter-group input,
            .filter-group select {
                width: 100%;
                padding: 10px;
            }
            
            .btn {
                padding: 10px 15px;
                font-size: 0.9rem;
            }
            
            .scenario-panel {
                padding: 20px 15px;
            }
            
            .scenario-item {
                padding: 12px;
                margin-bottom: 12px;
            }
            
            .scenario-title {
                font-size: 0.95rem;
            }
            
            .scenario-description {
                font-size: 0.85rem;
            }
            
            .recommendation-card {
                padding: 12px;
                margin-bottom: 12px;
            }
            
            .recommendation-icon {
                width: 40px;
                height: 40px;
                font-size: 1.2rem;
            }
            
            .recommendation-title {
                font-size: 0.9rem;
            }
            
            .recommendation-details {
                font-size: 0.85rem;
            }
            
            .history-item {
                padding: 12px;
                margin-bottom: 8px;
            }
            
            .history-icon {
                width: 35px;
                height: 35px;
                font-size: 1rem;
            }
        }
        
        @media (max-width: 480px) {
            .pro-header h1 {
                font-size: 1.4rem;
            }
            
            .panel {
                padding: 12px;
            }
            
            .panel h2 {
                font-size: 1.1rem;
            }
            
            .squad-section h3 {
                font-size: 0.9rem;
            }
            
            .player-slot {
                padding: 8px;
            }
            
            .player-name {
                font-size: 0.85rem;
            }
            
            .player-details {
                font-size: 0.75rem;
            }
            
            .player-price {
                font-size: 0.9rem;
            }
            
            .budget-amount {
                font-size: 1.6rem;
            }
            
            .market-player-card {
                padding: 12px;
            }
            
            .player-card-name {
                font-size: 1rem;
            }
            
            .player-card-team {
                font-size: 0.8rem;
            }
            
            .player-card-price {
                padding: 4px 10px;
                font-size: 0.85rem;
            }
            
            .stat-value {
                font-size: 0.9rem;
            }
            
            .btn {
                padding: 8px 12px;
                font-size: 0.85rem;
            }
            
            .action-buttons {
                flex-direction: column;
                gap: 8px;
            }
            
            .position-badge {
                padding: 2px 5px;
                font-size: 0.65rem;
            }
            
            .scenario-panel h2 {
                font-size: 1.1rem;
            }
            
            .ai-recommendations h2 {
                font-size: 1.1rem;
            }
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .position-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 5px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .badge-gkp { background: #ffd700; color: #333; }
        .badge-def { background: #00ff87; color: #333; }
        .badge-mid { background: #00d4ff; color: #333; }
        .badge-fwd { background: #ff1744; color: white; }

        .form-indicator {
            display: flex;
            gap: 3px;
            margin-top: 10px;
        }

        .form-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .form-good { background: #28a745; }
        .form-average { background: #ffc107; }
        .form-bad { background: #dc3545; }

        .scenario-result {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            display: none;
        }

        .scenario-result.active {
            display: block;
        }

        .result-stat {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .result-label {
            opacity: 0.9;
        }

        .result-value {
            font-weight: 700;
            color: #00ff88;
        }
        /* Transfer Statistics Section */
        .transfer-stats-section {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 40px;
            margin: 30px 0;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .transfer-stats-section h2 {
            font-size: 2.5rem;
            color: #37003c;
            margin-bottom: 30px;
            text-align: center;
        }

        .stat-panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border: 2px solid #f0f0f0;
        }

        .stat-panel h3 {
            color: #6f42c1;
            font-size: 1.3rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .spending-list {
            list-style: none;
        }

        .spending-item {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .spending-item:last-child {
            border-bottom: none;
        }

        .club-rank {
            font-size: 1.5rem;
            font-weight: bold;
            color: #6f42c1;
            margin-right: 15px;
            width: 30px;
        }

        .club-info {
            flex: 1;
        }

        .club-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .spending-bar {
            background: #f0f0f0;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 5px;
        }

        .spending-fill {
            height: 100%;
            background: linear-gradient(90deg, #6f42c1, #00ff88);
            border-radius: 4px;
            transition: width 1s ease;
        }

        .spending-amount {
            font-size: 1.2rem;
            font-weight: bold;
            color: #37003c;
            margin-left: auto;
        }

        .trend-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .trend-item {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .trend-value {
            font-size: 2rem;
            font-weight: bold;
            color: #6f42c1;
            display: block;
            margin-bottom: 5px;
        }

        .trend-label {
            color: #666;
            font-size: 0.9rem;
        }

        .routes-chart {
            display: grid;
            gap: 15px;
        }

        .route-item {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .route-icon {
            font-size: 2rem;
        }

        .route-info {
            flex: 1;
        }

        .route-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .route-bar {
            background: #f0f0f0;
            height: 25px;
            border-radius: 12px;
            position: relative;
            overflow: hidden;
        }

        .route-fill {
            height: 100%;
            background: linear-gradient(90deg, #37003c, #6f42c1);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            color: white;
            font-weight: bold;
            transition: width 1s ease;
        }

        /* Fixture Difficulty Analysis */
        .fixture-analysis-section {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 40px;
            margin: 30px 0;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
        }

        .fixture-analysis-section h2 {
            font-size: 2.2rem;
            color: #37003c;
            margin-bottom: 30px;
            text-align: center;
        }

        .fixture-filter {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
        }

        .fixture-btn {
            padding: 12px 24px;
            border: 2px solid #6f42c1;
            background: transparent;
            color: #6f42c1;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .fixture-btn.active,
        .fixture-btn:hover {
            background: linear-gradient(135deg, #6f42c1, #37003c);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(111, 66, 193, 0.3);
        }

        .fixture-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .team-fixture-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            border: 2px solid #f0f0f0;
            transition: all 0.3s ease;
        }

        .team-fixture-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border-color: #6f42c1;
        }

        .team-name {
            font-size: 1.3rem;
            font-weight: 700;
            color: #37003c;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .fixture-list {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .fixture-opponent {
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            color: white;
            text-align: center;
            min-width: 45px;
        }

        .difficulty-1 { background: #28a745; }
        .difficulty-2 { background: #20c997; }
        .difficulty-3 { background: #ffc107; color: #333; }
        .difficulty-4 { background: #fd7e14; }
        .difficulty-5 { background: #dc3545; }

        .fixture-score {
            font-size: 1.2rem;
            font-weight: bold;
            color: #37003c;
            margin-left: 15px;
        }

        /* Player Comparison Matrix */
        .comparison-section {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 40px;
            margin: 30px 0;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
        }

        .comparison-section h2 {
            font-size: 2.2rem;
            color: #37003c;
            margin-bottom: 30px;
            text-align: center;
        }

        .comparison-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .comparison-controls select {
            padding: 12px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            background: white;
            color: #37003c;
            min-width: 150px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .comparison-controls select:focus {
            outline: none;
            border-color: #6f42c1;
            box-shadow: 0 0 0 3px rgba(111, 66, 193, 0.1);
        }

        .comparison-table {
            background: white;
            border-radius: 15px;
            padding: 25px;
            border: 2px solid #f0f0f0;
            overflow-x: auto;
        }

        .comparison-placeholder {
            text-align: center;
            color: #666;
            font-size: 1.1rem;
            padding: 40px;
        }

        .comparison-matrix {
            width: 100%;
            border-collapse: collapse;
        }

        .comparison-matrix th,
        .comparison-matrix td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #f0f0f0;
        }

        .comparison-matrix th {
            background: linear-gradient(135deg, #6f42c1, #37003c);
            color: white;
            font-weight: 700;
            position: sticky;
            top: 0;
        }

        .comparison-matrix .stat-name {
            text-align: left;
            font-weight: 600;
            color: #37003c;
            background: #f8f9fa;
        }

        .stat-best {
            background: #d4edda;
            color: #155724;
            font-weight: 700;
        }

        /* Price Change Predictions */
        .price-change-section {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 40px;
            margin: 30px 0;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
        }

        .price-change-section h2 {
            font-size: 2.2rem;
            color: #37003c;
            margin-bottom: 30px;
            text-align: center;
        }

        .price-change-tabs {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
        }

        .price-tab {
            padding: 12px 24px;
            border: 2px solid #6f42c1;
            background: transparent;
            color: #6f42c1;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .price-tab.active,
        .price-tab:hover {
            background: linear-gradient(135deg, #6f42c1, #37003c);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(111, 66, 193, 0.3);
        }

        .price-change-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .price-change-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            border: 2px solid #f0f0f0;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .price-change-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
        }

        .price-change-card.riser::before {
            background: linear-gradient(90deg, #28a745, #20c997);
        }

        .price-change-card.faller::before {
            background: linear-gradient(90deg, #dc3545, #c82333);
        }

        .price-change-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border-color: #6f42c1;
        }

        .price-player-name {
            font-size: 1.2rem;
            font-weight: 700;
            color: #37003c;
            margin-bottom: 5px;
        }

        .price-player-team {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }

        .price-change-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .current-price {
            font-size: 1.1rem;
            font-weight: 600;
            color: #37003c;
        }

        .price-prediction {
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: 700;
        }

        .price-prediction.rise {
            color: #28a745;
        }

        .price-prediction.fall {
            color: #dc3545;
        }

        .ownership-change {
            font-size: 0.8rem;
            color: #666;
            margin-top: 5px;
        }

        /* Captain Prediction */
        .captain-section {
            background: linear-gradient(135deg, #6f42c1, #37003c);
            color: white;
            border-radius: 20px;
            padding: 40px;
            margin: 30px 0;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .captain-section h2 {
            font-size: 2.2rem;
            color: white;
            margin-bottom: 30px;
            text-align: center;
        }

        .captain-analysis {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .captain-card {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 20px;
            transition: all 0.3s ease;
        }

        .captain-card:hover {
            background: rgba(255,255,255,0.2);
            transform: translateX(10px);
        }

        .top-captain {
            background: rgba(255,215,0,0.2);
            border: 2px solid rgba(255,215,0,0.5);
        }

        .captain-rank {
            font-size: 2rem;
            font-weight: 800;
            color: #ffd700;
            min-width: 60px;
            text-align: center;
        }

        .captain-info {
            flex: 1;
        }

        .captain-name {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .captain-details {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .captain-stats {
            display: flex;
            gap: 15px;
            font-size: 0.8rem;
            opacity: 0.8;
        }

        .captain-confidence {
            font-size: 1.5rem;
            font-weight: 800;
            color: #ffd700;
            text-align: center;
            min-width: 80px;
        }

        .captain-alternatives {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }

        /* Responsive Design for New Features */
        @media (max-width: 768px) {
            .fixture-analysis-section,
            .comparison-section,
            .price-change-section,
            .captain-section {
                padding: 25px 15px;
                margin: 20px 0;
            }

            .fixture-analysis-section h2,
            .comparison-section h2,
            .price-change-section h2,
            .captain-section h2 {
                font-size: 1.8rem;
            }

            .fixture-filter,
            .price-change-tabs {
                flex-direction: column;
                align-items: center;
            }

            .fixture-btn,
            .price-tab {
                width: 200px;
            }

            .comparison-controls {
                flex-direction: column;
                align-items: center;
            }

            .comparison-controls select {
                width: 100%;
                max-width: 300px;
            }

            .fixture-grid,
            .price-change-grid {
                grid-template-columns: 1fr;
            }

            .captain-alternatives {
                grid-template-columns: 1fr;
            }

            .captain-card {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }

            .captain-stats {
                justify-content: center;
            }
        }
        /* ðŸš€ ADVANCED FEATURES STYLING */
        
        .advanced-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            overflow-y: auto;
            backdrop-filter: blur(10px);
        }

        .advanced-modal-content {
            background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(240,240,240,0.95));
            border-radius: 20px;
            padding: 40px;
            max-width: 900px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .close-modal {
            position: absolute;
            top: 20px;
            right: 30px;
            font-size: 2rem;
            cursor: pointer;
            color: #666;
            transition: color 0.3s;
        }

        .close-modal:hover {
            color: #333;
        }

        .advanced-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .analysis-card {
            background: rgba(255,255,255,0.8);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border: 2px solid rgba(55,0,60,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .analysis-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .analysis-card.full-width {
            grid-column: 1 / -1;
        }

        .prediction-value {
            font-size: 2.5rem;
            font-weight: 800;
            color: #37003c;
            margin: 15px 0;
        }

        .confidence-meter {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin: 15px 0;
        }

        .confidence-bar {
            height: 100%;
            background: linear-gradient(90deg, #dc3545, #ffc107, #28a745);
            transition: width 0.5s ease;
        }

        .difficulty-rating {
            font-size: 2rem;
            font-weight: 700;
            margin: 15px 0;
        }

        .risk-percentage {
            font-size: 2.5rem;
            font-weight: 800;
            margin: 15px 0;
        }

        .risk-percentage.low { color: #28a745; }
        .risk-percentage.medium { color: #ffc107; }
        .risk-percentage.high { color: #dc3545; }

        .sentiment-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            margin: 15px 0;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .sentiment-badge.bullish { background: #28a745; color: white; }
        .sentiment-badge.bearish { background: #dc3545; color: white; }
        .sentiment-badge.neutral { background: #6c757d; color: white; }
        .sentiment-badge.fomo { background: #ff6b35; color: white; }
        .sentiment-badge.value { background: #17a2b8; color: white; }

        .trend-indicator {
            font-size: 2rem;
            font-weight: 700;
            margin: 15px 0;
        }

        /* Advanced Features Panel */
        .advanced-features-panel {
            background: linear-gradient(135deg, rgba(55,0,60,0.95), rgba(111,66,193,0.95));
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            color: white;
        }

        .advanced-features-panel h2 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2rem;
            background: linear-gradient(135deg, #fff, #f0f0f0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .feature-card {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            transition: transform 0.3s, background 0.3s;
            cursor: pointer;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            background: rgba(255,255,255,0.2);
        }

        .feature-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .feature-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .feature-description {
            font-size: 0.9rem;
            opacity: 0.9;
            line-height: 1.4;
        }

        /* Chemistry Display */
        .chemistry-display {
            background: linear-gradient(135deg, #00d4ff, #00ff88);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            margin: 20px 0;
            color: white;
        }

        .chemistry-score {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 10px;
        }

        .synergy-bonuses {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
        }

        .synergy-badge {
            background: rgba(255,255,255,0.2);
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            backdrop-filter: blur(5px);
        }

        /* Market Sentiment Widget */
        .market-sentiment-widget {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .trending-players {
            display: grid;
            gap: 10px;
            margin-top: 15px;
        }

        .trending-player {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: rgba(55,0,60,0.05);
            border-radius: 8px;
        }

        .trending-change {
            font-weight: 600;
            color: #28a745;
        }

        /* Wildcard Planner */
        .wildcard-planner {
            background: linear-gradient(135deg, #6f42c1, #37003c);
            border-radius: 15px;
            padding: 25px;
            color: white;
            margin: 20px 0;
        }

        .optimal-timing {
            text-align: center;
            margin-bottom: 20px;
        }

        .gameweek-recommendation {
            font-size: 2rem;
            font-weight: 800;
            color: #00ff88;
            margin: 10px 0;
        }

        .template-selector {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        .template-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .template-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .template-btn.active {
            background: rgba(255,255,255,0.4);
        }

        /* Enhanced Buttons */
        .btn-advanced {
            background: linear-gradient(135deg, #6f42c1, #37003c);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin: 5px;
        }

        .btn-advanced:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(111,66,193,0.4);
        }

        .btn-glow {
            box-shadow: 0 0 20px rgba(111,66,193,0.6);
            animation: glow-pulse 2s infinite;
        }

        @keyframes glow-pulse {
            0%, 100% { box-shadow: 0 0 20px rgba(111,66,193,0.6); }
            50% { box-shadow: 0 0 30px rgba(111,66,193,0.8); }
        }

        /* Responsive Updates for Advanced Features */
        /* Floating Action Button */
        .floating-menu {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
        }

        .fab-main {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            transition: transform 0.3s, box-shadow 0.3s;
            position: relative;
        }

        .fab-main:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .fab-menu {
            position: absolute;
            bottom: 70px;
            right: 0;
            display: none;
            flex-direction: column;
            gap: 10px;
        }

        .fab-menu.active {
            display: flex;
        }

        .fab-item {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: white;
            color: #37003c;
            border: 2px solid #667eea;
            font-size: 1.2rem;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.2s;
            position: relative;
        }

        .fab-item:hover {
            transform: scale(1.1);
            background: #667eea;
            color: white;
        }

        .fab-tooltip {
            position: absolute;
            right: 60px;
            top: 50%;
            transform: translateY(-50%);
            background: #333;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            white-space: nowrap;
            font-size: 0.9rem;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .fab-item:hover .fab-tooltip {
            opacity: 1;
        }

        /* Quick Feature Button Hover Effects */
        .quick-feature-btn:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        /* Advanced Features Panel Enhancement */
        .advanced-features-panel {
            background: linear-gradient(135deg, rgba(255,255,255,0.98), rgba(240,240,255,0.98));
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 2px solid #667eea;
        }

        .advanced-features-panel h2 {
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 2rem;
            margin-bottom: 20px;
            text-align: center;
        }

        @media (max-width: 768px) {
            .advanced-modal-content {
                width: 95%;
                padding: 20px;
            }

            .advanced-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .feature-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }

            .prediction-value,
            .chemistry-score {
                font-size: 2rem;
            }

            .feature-icon {
                font-size: 2rem;
            }

            .template-selector {
                flex-direction: column;
                align-items: center;
            }

            .floating-menu {
                bottom: 20px;
                right: 20px;
            }

            .fab-main {
                width: 50px;
                height: 50px;
            }
        }

        /* Player Selection Modal Styles */
        .player-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            display: flex;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .player-modal-content {
            background: white;
            border-radius: 20px;
            width: 90%;
            max-width: 1000px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.7) translateY(-50px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .player-modal-header {
            background: linear-gradient(135deg, #37003c, #6f42c1);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .player-modal-header h3 {
            margin: 0;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .player-modal-close {
            cursor: pointer;
            font-size: 2rem;
            font-weight: bold;
            padding: 5px;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s ease;
        }

        .player-modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .player-modal-body {
            padding: 20px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .player-selection-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }

        .modal-player-card {
            background: linear-gradient(135deg, #ffffff, #f8f9fa);
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .modal-player-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(111, 66, 193, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .modal-player-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(111, 66, 193, 0.2);
            border-color: #6f42c1;
        }

        .modal-player-card:hover::before {
            left: 100%;
        }

        .modal-player-info {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .modal-player-name {
            font-size: 1.2rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 5px;
        }

        .modal-player-team {
            color: #666;
            font-size: 0.9rem;
        }

        .modal-player-price {
            background: linear-gradient(135deg, #37003c, #6f42c1);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .modal-player-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .modal-stat-box {
            background: rgba(111, 66, 193, 0.1);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }

        .modal-stat-value {
            font-weight: 700;
            font-size: 1.1rem;
            color: #37003c;
            display: block;
        }

        .modal-stat-label {
            font-size: 0.8rem;
            color: #666;
            margin-top: 2px;
        }

        /* Mobile responsive */
        @media (max-width: 768px) {
            .player-modal-content {
                width: 95%;
                max-height: 85vh;
            }
            
            .player-selection-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .modal-player-card {
                padding: 15px;
            }
            
            .modal-player-name {
                font-size: 1.1rem;
            }
        }
    </style>
    <!-- Tesseract.js for OCR -->
    <script src='https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js'></script>
    <!-- OCR Processing Scripts -->
    <script src="basic-ocr-processor.js"></script>
    <script src="simple-ocr-processor.js"></script>
    <script src="advanced-screenshot-processor.js"></script>
</head>
<body>
    <div class="header" include="./header.html"></div>
    
    <div class="pro-container">
        <div class="pro-header">
            <h1>âš¡ Transfer Simulator Pro</h1>
            <p>Advanced AI-Powered Transfer Planning with What-If Scenarios</p>
            <div class="live-status">
                <span class="live-dot"></span>
                <span>LIVE FPL DATA</span>
                <span style="margin-left: 20px;">Last Update: <span id="lastUpdate">Loading...</span></span>
                <button onclick="window.forceLoadPlayers()" style="margin-left: 15px; padding: 5px 10px; background: #f39c12; color: white; border: none; border-radius: 4px; cursor: pointer;">ðŸ”„ Reload Players</button>
                <button onclick="refreshPlayerData()" style="margin-left: 20px; padding: 5px 15px; background: linear-gradient(135deg, #00ff88, #00c851); color: #333; border: none; border-radius: 5px; cursor: pointer; font-weight: 600; transition: transform 0.2s;">
                    ðŸ”„ Refresh Data
                </button>
                <button onclick="forceLoadPlayerData()" style="margin-left: 10px; padding: 5px 15px; background: linear-gradient(135deg, #ff6b6b, #ee5a24); color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: 600; transition: transform 0.2s;">
                    âš ï¸ Force Load
                </button>
                <button onclick="window.testPlayerDataAndModal()" style="margin-left: 10px; padding: 5px 15px; background: linear-gradient(135deg, #9b59b6, #8e44ad); color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: 600; transition: transform 0.2s;">
                    ðŸ§ª Test Modal
                </button>
                <button onclick="window.testModalDirectly()" style="margin-left: 10px; padding: 5px 15px; background: linear-gradient(135deg, #3498db, #2980b9); color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: 600; transition: transform 0.2s;">
                    ðŸŽ­ Direct Modal
                </button>
                <button onclick="window.testPositionClick('GK')" style="margin-left: 10px; padding: 5px 15px; background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: 600; transition: transform 0.2s;">
                    ðŸ¥… Test GK Click
                </button>
            </div>
            
            <!-- NEW: Quick Access Advanced Features Hero -->
            <div class="advanced-features-hero" style="margin-top: 30px; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 15px; backdrop-filter: blur(10px);">
                <h2 style="color: #00ff88; margin-bottom: 15px; font-size: 1.5rem;">ðŸš€ Advanced AI Tools - Quick Access</h2>
                <button onclick="testAllFeatures(); alert('Check browser console for feature status')" style="position: absolute; top: 20px; right: 20px; padding: 5px 10px; background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3); border-radius: 5px; cursor: pointer; font-size: 0.8rem;">
                    ðŸ§ª Test Features
                </button>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
                    <button onclick="showPriceTracker()" class="quick-feature-btn" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 12px; border-radius: 10px; cursor: pointer; font-weight: 600; transition: transform 0.2s;">
                        ðŸ’¹ Price Alerts
                    </button>
                    <button onclick="showCaptainOptimizer()" class="quick-feature-btn" style="background: linear-gradient(135deg, #f093fb, #f5576c); color: white; border: none; padding: 12px; border-radius: 10px; cursor: pointer; font-weight: 600; transition: transform 0.2s;">
                        ðŸ‘‘ Captain AI
                    </button>
                    <button onclick="showSquadComparison()" class="quick-feature-btn" style="background: linear-gradient(135deg, #4facfe, #00f2fe); color: white; border: none; padding: 12px; border-radius: 10px; cursor: pointer; font-weight: 600; transition: transform 0.2s;">
                        âš”ï¸ Squad Compare
                    </button>
                    <button onclick="showStrategySimulator()" class="quick-feature-btn" style="background: linear-gradient(135deg, #43e97b, #38f9d7); color: white; border: none; padding: 12px; border-radius: 10px; cursor: pointer; font-weight: 600; transition: transform 0.2s;">
                        ðŸŽ® Transfer Plan
                    </button>
                    <button onclick="showXGStats()" class="quick-feature-btn" style="background: linear-gradient(135deg, #fa709a, #fee140); color: white; border: none; padding: 12px; border-radius: 10px; cursor: pointer; font-weight: 600; transition: transform 0.2s;">
                        ðŸ“Š xG Stats
                    </button>
                    <button onclick="showChipOptimizer()" class="quick-feature-btn" style="background: linear-gradient(135deg, #30cfd0, #330867); color: white; border: none; padding: 12px; border-radius: 10px; cursor: pointer; font-weight: 600; transition: transform 0.2s;">
                        ðŸŽ¯ Chip Strategy
                    </button>
                </div>
                <p style="color: #fff; opacity: 0.9; margin-top: 10px; font-size: 0.9rem;">Click any tool above or scroll down for all 16 advanced features</p>
            </div>
        </div>

        
        <!-- Main Grid Layout -->
        <div class="main-grid">
            <!-- Left Panel - Current Squad -->
            <div class="panel">
                <h2>ðŸ“‹ Current Squad</h2>
                
                <div class="budget-tracker">
                    <div class="budget-amount" id="remainingBudget">Â£100.0m</div>
                    <div style="text-align: center; opacity: 0.9;">Remaining Budget</div>
                    <div class="budget-bar">
                        <div class="budget-fill" id="budgetFill" style="width: 100%"></div>
                    </div>
                </div>

                <!-- Interactive Football Pitch Layout -->
                <div class="football-pitch" id="pitch-container">
                    <!-- Goalkeeper -->
                    <div class="pitch-row goalkeeper-row">
                        <div class="position-circle" data-position="GK" onclick="selectPlayerForPosition('GK', 1)" style="cursor: pointer;">
                            <span class="position-label">GK</span>
                            <span class="player-name-display" id="player-GK-0">+</span>
                        </div>
                    </div>
                    
                    <!-- Defenders -->
                    <div class="pitch-row defenders-row">
                        <div class="position-circle" data-position="DEF" onclick="selectPlayerForPosition('DEF', 2)" style="cursor: pointer;">
                            <span class="position-label">DEF</span>
                            <span class="player-name-display" id="player-DEF-0">+</span>
                        </div>
                        <div class="position-circle" data-position="DEF" onclick="selectPlayerForPosition('DEF', 2)" style="cursor: pointer;">
                            <span class="position-label">DEF</span>
                            <span class="player-name-display" id="player-DEF-1">+</span>
                        </div>
                        <div class="position-circle" data-position="DEF" onclick="selectPlayerForPosition('DEF', 2)" style="cursor: pointer;">
                            <span class="position-label">DEF</span>
                            <span class="player-name-display" id="player-DEF-2">+</span>
                        </div>
                        <div class="position-circle" data-position="DEF" onclick="selectPlayerForPosition('DEF', 2)" style="cursor: pointer;">
                            <span class="position-label">DEF</span>
                            <span class="player-name-display" id="player-DEF-3">+</span>
                        </div>
                        <div class="position-circle" data-position="DEF" onclick="selectPlayerForPosition('DEF', 2)" style="cursor: pointer;">
                            <span class="position-label">DEF</span>
                            <span class="player-name-display" id="player-DEF-4">+</span>
                        </div>
                    </div>
                    
                    <!-- Midfielders -->
                    <div class="pitch-row midfielders-row">
                        <div class="position-circle" data-position="MID" onclick="selectPlayerForPosition('MID', 3)" style="cursor: pointer;">
                            <span class="position-label">MID</span>
                            <span class="player-name-display" id="player-MID-0">+</span>
                        </div>
                        <div class="position-circle" data-position="MID" onclick="selectPlayerForPosition('MID', 3)" style="cursor: pointer;">
                            <span class="position-label">MID</span>
                            <span class="player-name-display" id="player-MID-1">+</span>
                        </div>
                        <div class="position-circle" data-position="MID" onclick="selectPlayerForPosition('MID', 3)" style="cursor: pointer;">
                            <span class="position-label">MID</span>
                            <span class="player-name-display" id="player-MID-2">+</span>
                        </div>
                        <div class="position-circle" data-position="MID" onclick="selectPlayerForPosition('MID', 3)" style="cursor: pointer;">
                            <span class="position-label">MID</span>
                            <span class="player-name-display" id="player-MID-3">+</span>
                        </div>
                        <div class="position-circle" data-position="MID" onclick="selectPlayerForPosition('MID', 3)" style="cursor: pointer;">
                            <span class="position-label">MID</span>
                            <span class="player-name-display" id="player-MID-4">+</span>
                        </div>
                    </div>
                    
                    <!-- Forwards -->
                    <div class="pitch-row forwards-row">
                        <div class="position-circle" data-position="FWD" onclick="selectPlayerForPosition('FWD', 4)" style="cursor: pointer;">
                            <span class="position-label">FWD</span>
                            <span class="player-name-display" id="player-FWD-0">+</span>
                        </div>
                        <div class="position-circle" data-position="FWD" onclick="selectPlayerForPosition('FWD', 4)" style="cursor: pointer;">
                            <span class="position-label">FWD</span>
                            <span class="player-name-display" id="player-FWD-1">+</span>
                        </div>
                        <div class="position-circle" data-position="FWD" onclick="selectPlayerForPosition('FWD', 4)" style="cursor: pointer;">
                            <span class="position-label">FWD</span>
                            <span class="player-name-display" id="player-FWD-2">+</span>
                        </div>
                    </div>
                </div>
                
                <!-- Position Labels -->
                <div class="position-labels">
                    <div class="position-label">GKP (2)</div>
                    <div class="position-label">DEF (5)</div>
                    <div class="position-label">MID (5)</div>
                    <div class="position-label">FWD (3)</div>
                </div>

                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="btn btn-primary" onclick="optimizeTeam()" style="flex: 1;">
                        ðŸ¤– AI Optimize Squad
                    </button>
                    <button class="btn btn-danger" onclick="resetTeam()" style="flex: 1; background: linear-gradient(135deg, #dc3545, #c82333);">
                        ðŸ”„ Reset Team
                    </button>
                </div>
                
                <!-- Save/Load Team Feature -->
                <div style="display: flex; gap: 10px; margin-top: 10px;">
                    <button class="btn btn-success" onclick="saveCurrentTeam()" style="flex: 1; background: linear-gradient(135deg, #28a745, #218838); color: white; border: none; padding: 10px; border-radius: 5px; cursor: pointer; font-weight: 600;">
                        ðŸ’¾ Save Team
                    </button>
                    <button class="btn btn-info" onclick="showSavedTeams()" style="flex: 1; background: linear-gradient(135deg, #17a2b8, #138496); color: white; border: none; padding: 10px; border-radius: 5px; cursor: pointer; font-weight: 600;">
                        ðŸ“‚ Load Team
                    </button>
                </div>
                
                <!-- Image Upload Feature -->
                <div style="margin-top: 20px; padding: 15px; background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 10px;">
                    <h3 style="color: white; margin-bottom: 10px; font-size: 1rem;">ðŸ“¸ Import Your Team</h3>
                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                        <button onclick="createManualTeamBuilder()" style="flex: 1; padding: 10px; background: white; color: #667eea; border: none; border-radius: 5px; cursor: pointer; font-weight: 600;">
                            ðŸ—ï¸ Build Team Manually
                        </button>
                        <input type="file" id="teamImageUpload" accept="image/*" style="display: none;" onchange="processTeamImage(event)">
                        <button onclick="document.getElementById('teamImageUpload').click()" style="flex: 1; padding: 10px; background: rgba(255,255,255,0.9); color: #667eea; border: none; border-radius: 5px; cursor: pointer; font-weight: 600;">
                            ðŸ“· Upload Screenshot
                        </button>
                    </div>
                    <div id="imageProcessingStatus" style="margin-top: 10px; color: white; font-size: 0.9rem; display: none;">
                        <div class="spinner" style="width: 20px; height: 20px; margin: 0 auto;"></div>
                        <p style="margin-top: 5px;">Processing image...</p>
                    </div>
                    <div style="margin-top: 10px;">
                        <button onclick="showManualPlayerEntry()" style="width: 100%; padding: 8px; background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3); border-radius: 5px; cursor: pointer; font-size: 0.9rem;">
                            âœï¸ Or Enter Players Manually
                        </button>
                    </div>
                </div>
            </div>

            <!-- Center Panel - Player Market -->
            <div>
                <div class="player-market panel" style="width: 100%; max-width: 100%;">
                    <h2>ðŸª Transfer Market</h2>
                    
                    <div class="market-filters" style="width: 100%; margin-bottom: 20px;">
                        <div class="filter-group">
                            <label>Position</label>
                            <select id="positionFilter" onchange="filterPlayers()">
                                <option value="">All Positions</option>
                                <option value="1">Goalkeepers</option>
                                <option value="2">Defenders</option>
                                <option value="3">Midfielders</option>
                                <option value="4">Forwards</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label>Max Price</label>
                            <input type="range" id="priceFilter" min="40" max="150" value="150" onchange="filterPlayers()">
                            <span id="priceValue">Â£15.0m</span>
                        </div>
                        
                        <div class="filter-group">
                            <label>Min Form</label>
                            <input type="range" id="formFilter" min="0" max="10" value="0" step="0.5" onchange="filterPlayers()">
                            <span id="formValue">0.0</span>
                        </div>
                        
                    </div>

                    
                </div>

                <!-- Analytics Section -->
                <div class="analytics-section">
                    <div class="chart-container">
                        <h3>ðŸ“Š Squad Value Distribution</h3>
                        <canvas id="valueChart"></canvas>
                    </div>
                    
                    <div class="chart-container">
                        <h3>ðŸ“ˆ Expected Points by Position</h3>
                        <canvas id="pointsChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Right Panel - What-If Scenarios -->
            <div>
                <div class="scenario-panel">
                    <h2>ðŸŽ¯ What-If Scenarios</h2>
                    
                    <div class="scenario-item" onclick="runScenario('wildcard')">
                        <div class="scenario-title">ðŸƒ Wildcard Optimization</div>
                        <div class="scenario-description">Build the best possible team within budget</div>
                        <div class="scenario-result" id="wildcard-result"></div>
                    </div>
                    
                    <div class="scenario-item" onclick="runScenario('differential')">
                        <div class="scenario-title">ðŸŽ² Differential Team</div>
                        <div class="scenario-description">Low ownership, high potential players</div>
                        <div class="scenario-result" id="differential-result"></div>
                    </div>
                    
                    <div class="scenario-item" onclick="runScenario('budget')">
                        <div class="scenario-title">ðŸ’° Budget Team</div>
                        <div class="scenario-description">Maximum value for money</div>
                        <div class="scenario-result" id="budget-result"></div>
                    </div>
                    
                    <div class="scenario-item" onclick="runScenario('premium')">
                        <div class="scenario-title">â­ Premium Heavy</div>
                        <div class="scenario-description">Focus on expensive star players</div>
                        <div class="scenario-result" id="premium-result"></div>
                    </div>
                    
                    <div class="scenario-item" onclick="runScenario('rotation')">
                        <div class="scenario-title">ðŸ”„ Rotation Strategy</div>
                        <div class="scenario-description">Optimize for fixture rotation</div>
                        <div class="scenario-result" id="rotation-result"></div>
                    </div>
                </div>

                <!-- Transfer History -->
                <div class="transfer-history panel">
                    <h2>ðŸ“œ Transfer History</h2>
                    <div id="transferHistory">
                        <div class="history-item">
                            <div class="history-icon history-in">âž•</div>
                            <div>
                                <div style="font-weight: 700;">No transfers yet</div>
                                <div style="color: #666; font-size: 0.9rem;">Start building your team</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Fixture Difficulty Analysis -->
        <div class="fixture-analysis-section">
            <h2>ðŸ“… Fixture Difficulty Analysis (Next 5 GWs)</h2>
            <div class="fixture-filter">
                <button class="fixture-btn active" onclick="showFixtures('all')">All Teams</button>
                <button class="fixture-btn" onclick="showFixtures('easy')">Easy Fixtures</button>
                <button class="fixture-btn" onclick="showFixtures('hard')">Hard Fixtures</button>
            </div>
            <div class="fixture-grid" id="fixtureGrid">
                <!-- Fixture difficulty will be loaded here -->
            </div>
        </div>

        <!-- Player Comparison Matrix -->
        <div class="comparison-section">
            <h2>âš–ï¸ Player Comparison Matrix</h2>
            <div class="comparison-controls">
                <select id="comparePosition" onchange="updateComparisonPlayers()">
                    <option value="">Select Position</option>
                    <option value="1">Goalkeepers</option>
                    <option value="2">Defenders</option>
                    <option value="3">Midfielders</option>
                    <option value="4">Forwards</option>
                </select>
                <select id="comparePlayer1" onchange="updateComparison()">
                    <option value="">Player 1</option>
                </select>
                <select id="comparePlayer2" onchange="updateComparison()">
                    <option value="">Player 2</option>
                </select>
                <select id="comparePlayer3" onchange="updateComparison()">
                    <option value="">Player 3</option>
                </select>
            </div>
            <div class="comparison-table" id="comparisonTable">
                <div class="comparison-placeholder">Select position and players to compare</div>
            </div>
        </div>

        <!-- Price Change Predictions -->
        <div class="price-change-section">
            <h2>ðŸ“ˆ Price Change Predictions</h2>
            <div class="price-change-tabs">
                <button class="price-tab active" onclick="showPriceChanges('risers')">ðŸ”¥ Likely Risers</button>
                <button class="price-tab" onclick="showPriceChanges('fallers')">ðŸ“‰ Likely Fallers</button>
            </div>
            <div class="price-change-grid" id="priceChangeGrid">
                <!-- Price predictions will be loaded here -->
            </div>
        </div>

        <!-- Captain Prediction -->
        <div class="captain-section">
            <h2>ðŸ‘‘ Captain Prediction Algorithm</h2>
            <div class="captain-analysis">
                <div class="captain-card top-captain">
                    <div class="captain-rank">#1</div>
                    <div class="captain-info">
                        <div class="captain-name">Erling Haaland</div>
                        <div class="captain-details">vs Southampton (H) â€¢ 89% confidence</div>
                        <div class="captain-stats">
                            <span>xPts: 12.4</span>
                            <span>Form: 9.2</span>
                            <span>Fixture: 2/5</span>
                        </div>
                    </div>
                    <div class="captain-confidence">89%</div>
                </div>
                <div class="captain-alternatives">
                    <div class="captain-card">
                        <div class="captain-rank">#2</div>
                        <div class="captain-info">
                            <div class="captain-name">Mohamed Salah</div>
                            <div class="captain-details">vs Brighton (A) â€¢ 76% confidence</div>
                        </div>
                        <div class="captain-confidence">76%</div>
                    </div>
                    <div class="captain-card">
                        <div class="captain-rank">#3</div>
                        <div class="captain-info">
                            <div class="captain-name">Cole Palmer</div>
                            <div class="captain-details">vs Wolves (H) â€¢ 68% confidence</div>
                        </div>
                        <div class="captain-confidence">68%</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- AI Recommendations -->
        <div class="ai-recommendations">
            <h2>ðŸ¤– AI Transfer Recommendations</h2>
            <div id="aiRecommendations">
                <div class="recommendation-card">
                    <div class="recommendation-icon">ðŸ’¡</div>
                    <div class="recommendation-content">
                        <div class="recommendation-title">Loading AI insights...</div>
                        <div class="recommendation-details">Analyzing player data and fixtures</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ðŸš€ ADVANCED FEATURES PANEL -->
        <div class="advanced-features-panel">
            <h2>ðŸš€ Advanced Analytics Suite</h2>
            <div class="feature-grid">
                <div class="feature-card" onclick="showChemistryAnalysis()">
                    <div class="feature-icon">ðŸ§ª</div>
                    <div class="feature-title">Squad Chemistry</div>
                    <div class="feature-description">Analyze team synergy and nationality bonuses</div>
                </div>
                
                <div class="feature-card" onclick="showMarketSentiment()">
                    <div class="feature-icon">ðŸ“Š</div>
                    <div class="feature-title">Market Sentiment</div>
                    <div class="feature-description">Real-time social buzz and trending players</div>
                </div>
                
                <div class="feature-card" onclick="showWildcardPlanner()">
                    <div class="feature-icon">ðŸŽ¯</div>
                    <div class="feature-title">Wildcard Planner</div>
                    <div class="feature-description">Optimal timing and template strategies</div>
                </div>
                
                <div class="feature-card" onclick="showInjuryRisk()">
                    <div class="feature-icon">ðŸ¥</div>
                    <div class="feature-title">Injury Risk</div>
                    <div class="feature-description">Assess player fitness and return dates</div>
                </div>
                
                <div class="feature-card" onclick="showHistoricalTrends()">
                    <div class="feature-icon">ðŸ“ˆ</div>
                    <div class="feature-title">Historical Analysis</div>
                    <div class="feature-description">Multi-season performance trends</div>
                </div>
                
                <div class="feature-card" onclick="showAdvancedOptimizer()">
                    <div class="feature-icon">ðŸ¤–</div>
                    <div class="feature-title">AI Optimizer Pro</div>
                    <div class="feature-description">Next-gen team building with ML predictions</div>
                </div>
                
                <div class="feature-card" onclick="showPriceTracker()">
                    <div class="feature-icon">ðŸ’¹</div>
                    <div class="feature-title">Price Tracker</div>
                    <div class="feature-description">Real-time price alerts & predictions</div>
                </div>
                
                <div class="feature-card" onclick="showSquadComparison()">
                    <div class="feature-icon">âš”ï¸</div>
                    <div class="feature-title">Squad Comparison</div>
                    <div class="feature-description">Compare with top managers & find differentials</div>
                </div>
                
                <div class="feature-card" onclick="showFDRAnalysis()">
                    <div class="feature-icon">ðŸ“…</div>
                    <div class="feature-title">FDR Calculator</div>
                    <div class="feature-description">Advanced fixture difficulty analysis</div>
                </div>
                
                <div class="feature-card" onclick="showStrategySimulator()">
                    <div class="feature-icon">ðŸŽ®</div>
                    <div class="feature-title">Strategy Simulator</div>
                    <div class="feature-description">Multi-week transfer planning</div>
                </div>
                
                <div class="feature-card" onclick="showXGStats()">
                    <div class="feature-icon">ðŸ“Š</div>
                    <div class="feature-title">xG Analytics</div>
                    <div class="feature-description">Expected goals & advanced metrics</div>
                </div>
                
                <div class="feature-card" onclick="showCompetitorAnalysis()">
                    <div class="feature-icon">ðŸ†</div>
                    <div class="feature-title">League Analysis</div>
                    <div class="feature-description">Mini-league competitor tracking</div>
                </div>
                
                <div class="feature-card" onclick="showChipOptimizer()">
                    <div class="feature-icon">ðŸŽ¯</div>
                    <div class="feature-title">Chip Strategy</div>
                    <div class="feature-description">Optimize TC, BB, FH timing</div>
                </div>
                
                <div class="feature-card" onclick="showOwnershipHeatmap()">
                    <div class="feature-icon">ðŸ—ºï¸</div>
                    <div class="feature-title">Ownership Map</div>
                    <div class="feature-description">Find hidden gems & differentials</div>
                </div>
                
                <div class="feature-card" onclick="showCaptainOptimizer()">
                    <div class="feature-icon">ðŸ‘‘</div>
                    <div class="feature-title">Captain AI</div>
                    <div class="feature-description">ML-powered captaincy picks</div>
                </div>
            </div>
            
            <!-- Quick Analytics Display -->
            <div id="quickAnalytics" style="margin-top: 30px;">
                <div class="chemistry-display" style="display: none;" id="chemistryDisplay">
                    <h3>âš—ï¸ Squad Chemistry Score</h3>
                    <div class="chemistry-score" id="chemistryScore">0</div>
                    <div class="synergy-bonuses" id="synergyBonuses"></div>
                </div>
                
                <div class="market-sentiment-widget" style="display: none;" id="sentimentWidget">
                    <h3>ðŸ“Š Market Sentiment Dashboard</h3>
                    <div class="trending-players" id="trendingPlayers"></div>
                </div>
                
                <div class="wildcard-planner" style="display: none;" id="wildcardWidget">
                    <h3>ðŸŽ¯ Wildcard Strategy Planner</h3>
                    <div class="optimal-timing">
                        <div>Optimal Timing:</div>
                        <div class="gameweek-recommendation" id="optimalGW">GW 18</div>
                        <div>Based on fixture analysis and DGW schedule</div>
                    </div>
                    <div class="template-selector">
                        <button class="template-btn active" onclick="selectTemplate('balanced')">Balanced</button>
                        <button class="template-btn" onclick="selectTemplate('aggressive')">Aggressive</button>
                        <button class="template-btn" onclick="selectTemplate('defensive')">Defensive</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Transfer Market Statistics -->
        <div class="transfer-stats-section">
            <h2>ðŸ“Š Transfer Market Statistics 2024/25</h2>
            
            <div class="stats-grid">
                <!-- Top Spending Clubs -->
                <div class="stat-panel">
                    <h3>ðŸ’° Top Spending Clubs</h3>
                    <div class="spending-list">
                        <div class="spending-item">
                            <div class="club-rank">1</div>
                            <div class="club-info">
                                <div class="club-name">Liverpool</div>
                                <div class="club-spending">Â£252.2M</div>
                            </div>
                            <div class="spending-bar" style="width: 100%;"></div>
                        </div>
                        <div class="spending-item">
                            <div class="club-rank">2</div>
                            <div class="club-info">
                                <div class="club-name">Chelsea</div>
                                <div class="club-spending">Â£240.2M</div>
                            </div>
                            <div class="spending-bar" style="width: 95%;"></div>
                        </div>
                        <div class="spending-item">
                            <div class="club-rank">3</div>
                            <div class="club-info">
                                <div class="club-name">Manchester United</div>
                                <div class="club-spending">Â£205.2M</div>
                            </div>
                            <div class="spending-bar" style="width: 81%;"></div>
                        </div>
                        <div class="spending-item">
                            <div class="club-rank">4</div>
                            <div class="club-info">
                                <div class="club-name">Arsenal</div>
                                <div class="club-spending">Â£192.8M</div>
                            </div>
                            <div class="spending-bar" style="width: 76%;"></div>
                        </div>
                        <div class="spending-item">
                            <div class="club-rank">5</div>
                            <div class="club-info">
                                <div class="club-name">Manchester City</div>
                                <div class="club-spending">Â£153.4M</div>
                            </div>
                            <div class="spending-bar" style="width: 61%;"></div>
                        </div>
                    </div>
                </div>

                <!-- Transfer Trends -->
                <div class="stat-panel">
                    <h3>ðŸ“ˆ Transfer Trends</h3>
                    <div class="trend-stats">
                        <div class="trend-item">
                            <div class="trend-label">Average Transfer Fee</div>
                            <div class="trend-value">Â£42.3M</div>
                            <div class="trend-detail">for deals over Â£20M</div>
                        </div>
                        <div class="trend-item">
                            <div class="trend-label">Most Active Club</div>
                            <div class="trend-value">Burnley</div>
                            <div class="trend-detail">10 transfers</div>
                        </div>
                        <div class="trend-item">
                            <div class="trend-label">Biggest Sale</div>
                            <div class="trend-value">Mbeumo Â£71M</div>
                            <div class="trend-detail">Brentford â†’ Liverpool</div>
                        </div>
                        <div class="trend-item">
                            <div class="trend-label">Free Transfers</div>
                            <div class="trend-value">12 Deals</div>
                            <div class="trend-detail">High-profile free agents</div>
                        </div>
                        <div class="trend-item">
                            <div class="trend-label">Loan Deals</div>
                            <div class="trend-value">31 Active</div>
                            <div class="trend-detail">Including buy options</div>
                        </div>
                    </div>
                </div>

                <!-- Transfer Routes -->
                <div class="stat-panel">
                    <h3>ðŸŒ Transfer Routes</h3>
                    <div class="routes-chart">
                        <div class="route-item">
                            <div class="route-name">From Abroad</div>
                            <div class="route-bar-container">
                                <div class="route-bar" style="width: 43%;">
                                    <span>43%</span>
                                </div>
                            </div>
                        </div>
                        <div class="route-item">
                            <div class="route-name">Domestic</div>
                            <div class="route-bar-container">
                                <div class="route-bar" style="width: 38%;">
                                    <span>38%</span>
                                </div>
                            </div>
                        </div>
                        <div class="route-item">
                            <div class="route-name">To Saudi League</div>
                            <div class="route-bar-container">
                                <div class="route-bar saudi" style="width: 12%;">
                                    <span>12%</span>
                                </div>
                            </div>
                        </div>
                        <div class="route-item">
                            <div class="route-name">To MLS</div>
                            <div class="route-bar-container">
                                <div class="route-bar mls" style="width: 7%;">
                                    <span>7%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="route-legend">
                        <div class="legend-item">
                            <span class="legend-color" style="background: #37003c;"></span>
                            <span>Premier League</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-color" style="background: #00c851;"></span>
                            <span>Saudi Pro League</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-color" style="background: #ff4444;"></span>
                            <span>MLS</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- SEO Content Section -->
    <section class="seo-content-section" style="max-width: 1600px; margin: 60px auto 40px; padding: 40px 20px; background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); border-radius: 16px; box-shadow: 0 8px 30px rgba(0,0,0,0.08);">
        <div style="max-width: 1200px; margin: 0 auto;">
            <h2 style="font-size: 2.5rem; color: #37003c; text-align: center; margin-bottom: 30px; font-weight: 800;">Master Your FPL Transfers with the Ultimate Transfer Simulator Pro</h2>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 30px; margin-bottom: 40px;">
                <div style="background: white; padding: 30px; border-radius: 12px; border-left: 4px solid #6f42c1; box-shadow: 0 4px 15px rgba(0,0,0,0.05);">
                    <h3 style="color: #37003c; margin-bottom: 15px; font-size: 1.4rem;">ðŸŽ¯ Advanced Transfer Planning</h3>
                    <p style="color: #666; line-height: 1.6; margin-bottom: 15px;">The Transfer Simulator Pro revolutionizes how you approach FPL transfers. Unlike basic transfer tools, our simulator uses artificial intelligence to analyze player performance data, fixture difficulty, and form trends to provide actionable transfer recommendations.</p>
                    <p style="color: #666; line-height: 1.6;">Plan your transfers weeks in advance with our what-if scenario engine. Test different transfer combinations, compare expected points, and identify the optimal timing for each move.</p>
                </div>
                
                <div style="background: white; padding: 30px; border-radius: 12px; border-left: 4px solid #17a2b8; box-shadow: 0 4px 15px rgba(0,0,0,0.05);">
                    <h3 style="color: #37003c; margin-bottom: 15px; font-size: 1.4rem;">ðŸ“Š AI-Powered Analytics</h3>
                    <p style="color: #666; line-height: 1.6; margin-bottom: 15px;">Our proprietary algorithm analyzes millions of data points including historical performance, current form, fixture difficulty ratings, injury status, and price trends to generate accurate transfer predictions.</p>
                    <p style="color: #666; line-height: 1.6;">Get detailed insights into why specific transfers are recommended, including expected points gain, risk assessment, and optimal timing for maximum impact on your overall rank.</p>
                </div>
            </div>

            <h3 style="color: #37003c; margin-bottom: 25px; font-size: 2rem; text-align: center;">Essential Transfer Strategies for FPL Success</h3>
            
            <div style="background: white; padding: 35px; border-radius: 12px; margin-bottom: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.05);">
                <h4 style="color: #6f42c1; margin-bottom: 20px; font-size: 1.3rem;">1. Strategic Transfer Timing</h4>
                <p style="color: #666; line-height: 1.7; margin-bottom: 15px;">The Transfer Simulator Pro helps you identify the perfect timing for each transfer. Avoid knee-jerk reactions by planning transfers around fixture swings, double gameweeks, and blank gameweeks. Our tool analyzes upcoming fixtures for the next 8 gameweeks to show you when players will deliver maximum points.</p>
                <p style="color: #666; line-height: 1.7;">Use the simulator to test whether taking a -4 point hit is worthwhile. The tool calculates break-even points and shows you exactly how many additional points your new player needs to score to justify the transfer cost.</p>
            </div>

            <div style="background: white; padding: 35px; border-radius: 12px; margin-bottom: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.05);">
                <h4 style="color: #6f42c1; margin-bottom: 20px; font-size: 1.3rem;">2. Value Optimization Techniques</h4>
                <p style="color: #666; line-height: 1.7; margin-bottom: 15px;">Maximize your team's value by identifying players likely to rise in price. The simulator tracks ownership trends, transfer activity, and performance metrics to predict price changes. This allows you to bank profit on rising players while avoiding potential price drops.</p>
                <p style="color: #666; line-height: 1.7;">Learn advanced strategies like the "template pivot" where you temporarily move away from highly-owned players to unique differentials, then return when fixtures improve. This approach can significantly boost your rank during specific gameweeks.</p>
            </div>

            <div style="background: white; padding: 35px; border-radius: 12px; margin-bottom: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.05);">
                <h4 style="color: #6f42c1; margin-bottom: 20px; font-size: 1.3rem;">3. Risk Management & Differential Picks</h4>
                <p style="color: #666; line-height: 1.7; margin-bottom: 15px;">Balance risk and reward with our comprehensive risk assessment tools. The simulator categorizes players by risk level, helping you maintain a balanced squad with reliable performers and calculated differential picks.</p>
                <p style="color: #666; line-height: 1.7;">Identify low-ownership gems before they become popular. Our algorithm spots players with favorable upcoming fixtures, improving form, and low ownership percentage â€“ the perfect combination for rank-climbing differentials.</p>
            </div>

            <h3 style="color: #37003c; margin-bottom: 25px; font-size: 2rem; text-align: center;">How to Use the Transfer Simulator Effectively</h3>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; margin-bottom: 30px;">
                <div style="background: linear-gradient(135deg, #28a745, #20c997); padding: 25px; border-radius: 12px; color: white;">
                    <h4 style="margin-bottom: 15px; font-size: 1.2rem;">Step 1: Import Your Squad</h4>
                    <p style="opacity: 0.9; line-height: 1.6;">Connect your FPL team ID to automatically import your current squad. The simulator will analyze each player's upcoming fixtures and current form to provide personalized recommendations.</p>
                </div>
                
                <div style="background: linear-gradient(135deg, #6f42c1, #667eea); padding: 25px; border-radius: 12px; color: white;">
                    <h4 style="margin-bottom: 15px; font-size: 1.2rem;">Step 2: Set Your Strategy</h4>
                    <p style="opacity: 0.9; line-height: 1.6;">Define your transfer strategy: aggressive (multiple hits), balanced (1-2 transfers per week), or conservative (free transfers only). The simulator adjusts recommendations based on your approach.</p>
                </div>
                
                <div style="background: linear-gradient(135deg, #fd7e14, #e83e8c); padding: 25px; border-radius: 12px; color: white;">
                    <h4 style="margin-bottom: 15px; font-size: 1.2rem;">Step 3: Simulate & Execute</h4>
                    <p style="opacity: 0.9; line-height: 1.6;">Test multiple transfer scenarios and compare projected points. Execute the highest-scoring combination with confidence, knowing you've analyzed all possibilities.</p>
                </div>
            </div>

            <div style="background: linear-gradient(135deg, #f8f9fa, #ffffff); padding: 35px; border-radius: 12px; border: 2px solid #e9ecef;">
                <h4 style="color: #37003c; margin-bottom: 20px; font-size: 1.4rem; text-align: center;">ðŸ† Pro Tips for Advanced FPL Managers</h4>
                <ul style="list-style: none; padding: 0; margin: 0;">
                    <li style="margin-bottom: 15px; padding: 15px; background: white; border-radius: 8px; border-left: 4px solid #28a745;">
                        <strong style="color: #37003c;">Fixture Rotation Strategy:</strong> Use the simulator to identify players with complementary fixtures. When one player has tough games, the other should have easier matchups.
                    </li>
                    <li style="margin-bottom: 15px; padding: 15px; background: white; border-radius: 8px; border-left: 4px solid #6f42c1;">
                        <strong style="color: #37003c;">Form vs Fixtures:</strong> Weight recent form (last 5 games) against upcoming fixture difficulty. A player in poor form with easy fixtures might outperform a player in good form with tough games.
                    </li>
                    <li style="margin-bottom: 15px; padding: 15px; background: white; border-radius: 8px; border-left: 4px solid #17a2b8;">
                        <strong style="color: #37003c;">Price Point Optimization:</strong> Use the 0.1m rule â€“ always maintain 0.1m extra budget to afford price rises on players you want to buy.
                    </li>
                    <li style="padding: 15px; background: white; border-radius: 8px; border-left: 4px solid #fd7e14;">
                        <strong style="color: #37003c;">Template Breaking:</strong> Identify moments when the template (most popular players) has poor fixtures. This is when differentials can provide the biggest rank gains.
                    </li>
                </ul>
            </div>
        </div>
    </section>

    <div class="footer" include="./footer.html"></div>
    
    <div class="loading-overlay" id="loadingOverlay" style="display: none;">
        <div class="loading-spinner"></div>
    </div>

    <!-- Floating Action Button Menu -->
    <div class="floating-menu">
        <div class="fab-menu" id="fabMenu">
            <button class="fab-item" onclick="showCaptainOptimizer()">
                ðŸ‘‘
                <span class="fab-tooltip">Captain AI</span>
            </button>
            <button class="fab-item" onclick="showPriceTracker()">
                ðŸ’¹
                <span class="fab-tooltip">Price Tracker</span>
            </button>
            <button class="fab-item" onclick="showSquadComparison()">
                âš”ï¸
                <span class="fab-tooltip">Squad Compare</span>
            </button>
            <button class="fab-item" onclick="showStrategySimulator()">
                ðŸŽ®
                <span class="fab-tooltip">Transfer Plan</span>
            </button>
            <button class="fab-item" onclick="showXGStats()">
                ðŸ“Š
                <span class="fab-tooltip">xG Stats</span>
            </button>
        </div>
        <button class="fab-main" onclick="toggleFabMenu()">
            ðŸš€
        </button>
    </div>

    <!-- Player Selection Modal -->
    <div id="playerSelectionModal" class="player-modal" style="display: none;" onclick="closePlayerModal()">
        <div class="player-modal-content" onclick="event.stopPropagation()">
            <div class="player-modal-header">
                <h3 id="modalTitle">Select a Player</h3>
                <span class="player-modal-close" onclick="closePlayerModal()">&times;</span>
            </div>
            <div class="player-modal-body">
                <div id="playerSelectionGrid" class="player-selection-grid">
                    <!-- Player cards will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <script src="./index.js"></script>
    <script>
        // Embedded FPL Data - Simple fallback
        const EMBEDDED_FPL_DATA = {
            elements: [],
            teams: []
        };
        
        // Initialize Transfer Simulator Pro object
        window.transferSimPro = {
            allPlayers: [],
            teams: [],
            
            // Initialize function to load player data
            async init() {
                console.log('Initializing Transfer Simulator Pro...');
                
                try {
                    // Try to load player data from player-data-2.html
                    const response = await fetch('./player-data-2.html');
                    if (response.ok) {
                        const text = await response.text();
                        const playerData = JSON.parse(text);
                        
                        if (playerData.elements && playerData.elements.length > 0) {
                            this.allPlayers = playerData.elements.map(player => ({
                                ...player,
                                name: `${player.first_name} ${player.second_name}`,
                                position: player.element_type,
                                team: player.team,
                                price: player.now_cost / 10
                            }));
                            
                            if (playerData.teams) {
                                this.teams = playerData.teams;
                            }
                            
                            console.log(`Loaded ${this.allPlayers.length} players from player-data-2.html`);
                            return true;
                        }
                    }
                } catch (error) {
                    console.error('Failed to load player data from player-data-2.html:', error);
                }
                
                // Fallback to FPL API service if available
                if (typeof FPLDataService !== 'undefined') {
                    try {
                        const fplService = new FPLDataService();
                        const data = await fplService.getBootstrapData();
                        
                        if (data && data.elements && data.elements.length > 0) {
                            this.allPlayers = data.elements.map(player => ({
                                ...player,
                                name: `${player.first_name} ${player.second_name}`,
                                position: player.element_type,
                                team: player.team,
                                price: player.now_cost / 10
                            }));
                            
                            if (data.teams) {
                                this.teams = data.teams;
                            }
                            
                            console.log(`Loaded ${this.allPlayers.length} players from FPL API`);
                            return true;
                        }
                    } catch (error) {
                        console.error('Failed to load from FPL API:', error);
                    }
                }
                
                // If all else fails, use mock data
                if (this.allPlayers.length === 0) {
                    console.warn('Using mock data as fallback');
                    if (typeof FPLDataService !== 'undefined') {
                        const fplService = new FPLDataService();
                        const mockData = fplService.getMockBootstrapData();
                        if (mockData && mockData.elements) {
                            this.allPlayers = mockData.elements.map(player => ({
                                ...player,
                                name: `${player.first_name} ${player.second_name}`,
                                position: player.element_type,
                                team: player.team,
                                price: player.now_cost / 10
                            }));
                        }
                    }
                }
                
                return this.allPlayers.length > 0;
            }
        };
        
        // Ensure FPLDataService is available globally
        if (typeof FPLDataService === 'undefined') {
            console.error('FPLDataService not found! Loading fallback...');
            // Define a minimal FPLDataService if not available
            window.FPLDataService = class {
                getMockBootstrapData() {
                    return {
                        elements: [],
                        teams: []
                    };
                }
            };
        }
        
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('DOM Content Loaded - Initializing Transfer Simulator Pro...');
            
            try {
                // Initialize immediately with embedded data - await the async init
                const success = await window.transferSimPro.init();
                
                if (!success || !window.transferSimPro.allPlayers || window.transferSimPro.allPlayers.length === 0) {
                    console.warn('No player data available yet, trying force load');
                    // Try force loading
                    await window.forceLoadPlayers();
                }
                
                console.log(`Transfer Simulator Pro initialized with ${window.transferSimPro.allPlayers.length} players`);
                
                // Immediate verification that everything is ready for clicking
                console.log('ðŸ” IMMEDIATE VERIFICATION - Checking click system readiness...');
                
                // Check if modal exists
                const modalCheck = document.getElementById('playerSelectionModal');
                console.log('Modal element exists:', modalCheck ? 'âœ… YES' : 'âŒ NO');
                
                // Check if position circles exist
                const circleCheck = document.querySelectorAll('.position-circle');
                console.log(`Position circles found: ${circleCheck.length} (should be 15)`);
                
                // Check if functions exist
                console.log('selectPlayerForPosition function exists:', typeof window.selectPlayerForPosition === 'function' ? 'âœ… YES' : 'âŒ NO');
                console.log('showPlayerModal function exists:', typeof window.showPlayerModal === 'function' ? 'âœ… YES' : 'âŒ NO');
                
                // Test a simple function call
                if (typeof window.selectPlayerForPosition === 'function') {
                    console.log('ðŸ§ª TESTING: Attempting to call selectPlayerForPosition directly...');
                    try {
                        // Don't actually call it, just verify it's callable
                        console.log('âœ… Function is callable');
                    } catch (e) {
                        console.error('âŒ Function call failed:', e);
                    }
                }
                
                // Enhanced logging for debugging
                if (window.transferSimPro.allPlayers.length > 0) {
                    console.log('âœ… Player data successfully loaded!');
                    console.log('Sample players:', window.transferSimPro.allPlayers.slice(0, 3).map(p => p.name));
                    console.log('Teams available:', window.transferSimPro.teams.length);
                    
                    // Test position distribution
                    const positionCounts = {};
                    window.transferSimPro.allPlayers.forEach(player => {
                        positionCounts[player.position] = (positionCounts[player.position] || 0) + 1;
                    });
                    console.log('Players by position:', positionCounts);
                } else {
                    console.warn('âŒ No player data loaded - modal will not work properly');
                }
                
                // Update UI to show data is loaded
                const loadDataMessage = document.getElementById('loadDataMessage');
                if (loadDataMessage && window.transferSimPro.allPlayers.length > 0) {
                    loadDataMessage.style.display = 'none';
                }
                
                // Update last update timestamp to show data is loaded
                const lastUpdateEl = document.getElementById('lastUpdate');
                if (lastUpdateEl && window.transferSimPro.allPlayers.length > 0) {
                    lastUpdateEl.textContent = new Date().toLocaleTimeString();
                }
                
                // Verify modal functionality is ready
                console.log('ðŸ”§ Verifying modal functionality...');
                const modalTest = document.getElementById('playerSelectionModal');
                if (modalTest) {
                    console.log('âœ… Modal element found in DOM');
                } else {
                    console.error('âŒ Modal element NOT found in DOM!');
                }
                
                if (typeof window.selectPlayerForPosition === 'function') {
                    console.log('âœ… selectPlayerForPosition function is available');
                } else {
                    console.error('âŒ selectPlayerForPosition function NOT available!');
                }
                
                if (typeof window.showPlayerModal === 'function') {
                    console.log('âœ… showPlayerModal function is available');
                } else {
                    console.error('âŒ showPlayerModal function NOT available!');
                }
                
                // Add programmatic event listeners as backup - with slight delay to ensure DOM is ready
                setTimeout(() => {
                    console.log('ðŸ”§ Adding programmatic event listeners to position circles...');
                    const positionCircles = document.querySelectorAll('.position-circle');
                    console.log(`Found ${positionCircles.length} position circles`);
                
                positionCircles.forEach((circle, index) => {
                    const position = circle.getAttribute('data-position');
                    let positionId;
                    let positionLabel;
                    
                    switch(position) {
                        case 'GK':
                            positionId = 1;
                            positionLabel = 'GK';
                            break;
                        case 'DEF':
                            positionId = 2;
                            positionLabel = 'DEF';
                            break;
                        case 'MID':
                            positionId = 3;
                            positionLabel = 'MID';
                            break;
                        case 'FWD':
                            positionId = 4;
                            positionLabel = 'FWD';
                            break;
                        default:
                            return;
                    }
                    
                    // Remove any existing onclick to avoid duplicate calls
                    circle.removeAttribute('onclick');
                    
                    // Add event listener
                    circle.addEventListener('click', function(event) {
                        event.preventDefault();
                        event.stopPropagation();
                        console.log(`ðŸŽ¯ Programmatic click detected on ${positionLabel} circle`);
                        
                        // Add visual feedback
                        circle.classList.add('clicked');
                        setTimeout(() => {
                            circle.classList.remove('clicked');
                        }, 300);
                        
                        window.selectPlayerForPosition(positionLabel, positionId);
                    });
                    
                    console.log(`âœ… Added event listener to ${positionLabel} circle`);
                });
                
                console.log('ðŸ”§ All event listeners added successfully!');
                
                // Immediate test after event listeners are added
                setTimeout(() => {
                    console.log('ðŸ§ª IMMEDIATE TEST: Trying to trigger GK modal...');
                    if (typeof window.selectPlayerForPosition === 'function') {
                        try {
                            window.selectPlayerForPosition('GK', 1);
                        } catch (e) {
                            console.error('âŒ Immediate test failed:', e);
                        }
                    }
                }, 100);
                
                }, 500); // 500ms delay to ensure DOM is fully ready
                
                // Additional event delegation approach for robustness
                setTimeout(() => {
                    console.log('ðŸ”§ Adding event delegation to football pitch...');
                    const pitchContainer = document.getElementById('pitch-container');
                    if (pitchContainer) {
                        pitchContainer.addEventListener('click', function(event) {
                            const target = event.target;
                            const circle = target.closest('.position-circle');
                            
                            if (circle) {
                                event.preventDefault();
                                event.stopPropagation();
                                
                                const position = circle.getAttribute('data-position');
                                console.log(`ðŸŽ¯ Event delegation click detected on ${position} circle`);
                                
                                let positionId, positionLabel;
                                switch(position) {
                                    case 'GK': positionId = 1; positionLabel = 'GK'; break;
                                    case 'DEF': positionId = 2; positionLabel = 'DEF'; break;
                                    case 'MID': positionId = 3; positionLabel = 'MID'; break;
                                    case 'FWD': positionId = 4; positionLabel = 'FWD'; break;
                                    default: return;
                                }
                                
                                // Add visual feedback
                                circle.classList.add('clicked');
                                setTimeout(() => {
                                    circle.classList.remove('clicked');
                                }, 300);
                                
                                window.selectPlayerForPosition(positionLabel, positionId);
                            }
                        });
                        console.log('âœ… Event delegation added to football pitch container');
                    } else {
                        console.error('âŒ Football pitch container not found for event delegation');
                    }
                }, 1000); // 1 second delay to ensure everything is ready
                
                // Player data loaded successfully
                
            } catch (error) {
                console.error('Failed to initialize Transfer Simulator Pro:', error);
                // Try force load as fallback
                await window.forceLoadPlayers();
                
                // Update UI after fallback load
                if (window.transferSimPro.allPlayers.length > 0) {
                    const lastUpdateEl = document.getElementById('lastUpdate');
                    if (lastUpdateEl) {
                        lastUpdateEl.textContent = new Date().toLocaleTimeString();
                    }
                }
            }
            
            // Test features in development mode
            if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                setTimeout(() => {
                    console.log('Running feature test in development mode...');
                    if (typeof testAllFeatures === 'function') {
                        testAllFeatures();
                    }
                }, 2000);
            }
        });
        // Animate transfer statistics on scroll
        function animateTransferStats() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        // Animate spending bars
                        const spendingBars = entry.target.querySelectorAll('.spending-fill');
                        spendingBars.forEach((bar, index) => {
                            const widths = ['100%', '95%', '88%', '82%', '75%'];
                            setTimeout(() => {
                                bar.style.width = widths[index] || '70%';
                            }, index * 100);
                        });
                        
                        // Animate route bars
                        const routeBars = entry.target.querySelectorAll('.route-fill');
                        routeBars.forEach((bar, index) => {
                            const widths = ['43%', '38%', '12%', '7%'];
                            setTimeout(() => {
                                bar.style.width = widths[index] || '5%';
                            }, index * 150);
                        });
                        
                        // Animate numbers
                        const statNumbers = entry.target.querySelectorAll('.trend-value');
                        statNumbers.forEach(num => {
                            const finalValue = num.textContent;
                            let currentValue = 0;
                            const increment = parseFloat(finalValue) / 20;
                            const timer = setInterval(() => {
                                currentValue += increment;
                                if (currentValue >= parseFloat(finalValue)) {
                                    num.textContent = finalValue;
                                    clearInterval(timer);
                                } else {
                                    num.textContent = finalValue.includes('Â£') ? 
                                        `Â£${currentValue.toFixed(1)}M` : 
                                        Math.floor(currentValue).toString();
                                }
                            }, 50);
                        });
                        
                        observer.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.3 });
            
            const statsSection = document.querySelector('.transfer-stats-section');
            if (statsSection) {
                observer.observe(statsSection);
            }
        }
        
        // Initialize animations when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', animateTransferStats);
        } else {
            animateTransferStats();
        }
        
        // Player data loading functions
        window.forceLoadPlayers = async function() {
            console.log('Force loading players from player-data-2.html...');
            try {
                const response = await fetch('./player-data-2.html');
                const text = await response.text();
                const playerData = JSON.parse(text);
                
                if (window.transferSimPro && playerData.elements) {
                    window.transferSimPro.allPlayers = playerData.elements.map(player => ({
                        ...player,
                        name: `${player.first_name} ${player.second_name}`,
                        position: player.element_type,
                        team: player.team,
                        price: player.now_cost / 10
                    }));
                    
                    console.log(`Successfully loaded ${window.transferSimPro.allPlayers.length} players`);
                    
                    // Update last update timestamp
                    const lastUpdateEl = document.getElementById('lastUpdate');
                    if (lastUpdateEl) {
                        lastUpdateEl.textContent = new Date().toLocaleTimeString();
                    }
                    
                    // Trigger a refresh of the player search if it's active
                }
            } catch (error) {
                console.error('Failed to force load players:', error);
                alert('Failed to load player data. Please try again.');
            }
        };
        
        window.refreshPlayerData = function() {
            console.log('Refreshing player data...');
            window.forceLoadPlayers();
        };
        
        window.forceLoadPlayerData = function() {
            console.log('Force loading player data...');
            window.forceLoadPlayers();
        };
        
        // Player display functions
        
        window.showPositionPlayers = function(positionId) {
            if (!window.transferSimPro || !window.transferSimPro.allPlayers) {
                console.warn('Player data not loaded yet');
                const loadDataMessage = document.getElementById('loadDataMessage');
                if (loadDataMessage) {
                    loadDataMessage.style.display = 'block';
                }
                return;
            }
            
            const positionNames = {
                1: 'Goalkeepers',
                2: 'Defenders', 
                3: 'Midfielders',
                4: 'Forwards'
            };
            
            const players = window.transferSimPro.allPlayers.filter(player => 
                player.position === positionId
            );
            
            // Sort by price descending
            players.sort((a, b) => b.price - a.price);
            
            displayPlayerResults(players, positionNames[positionId]);
        };
        
        // Function to handle position circle clicks
        window.selectPlayerForPosition = function(positionLabel, positionId) {
            console.log(`ðŸ”˜ Position circle clicked: ${positionLabel} (ID: ${positionId})`);
            
            if (!window.transferSimPro || !window.transferSimPro.allPlayers) {
                console.warn('Player data not loaded yet');
                alert('Player data is still loading. Please wait a moment and try again.');
                return;
            }
            
            console.log(`ðŸ“Š Found ${window.transferSimPro.allPlayers.length} total players`);
            
            const players = window.transferSimPro.allPlayers.filter(player => 
                player.position === positionId
            );
            
            if (players.length === 0) {
                alert(`No ${positionLabel} players found.`);
                return;
            }
            
            // Sort by price descending for better selection
            players.sort((a, b) => b.price - a.price);
            
            // Show player selection modal
            showPlayerModal(players, positionLabel);
        };
        
        // Modal control functions
        window.showPlayerModal = function(players, positionLabel) {
            console.log(`ðŸŽ­ Opening modal for ${positionLabel} with ${players.length} players`);
            
            const modal = document.getElementById('playerSelectionModal');
            const modalTitle = document.getElementById('modalTitle');
            const playerGrid = document.getElementById('playerSelectionGrid');
            
            if (!modal) {
                console.error('âŒ Modal element not found!');
                return;
            }
            
            if (!modalTitle) {
                console.error('âŒ Modal title element not found!');
                return;
            }
            
            if (!playerGrid) {
                console.error('âŒ Player grid element not found!');
                return;
            }
            
            modalTitle.textContent = `Select a ${positionLabel} Player`;
            console.log(`ðŸ“ Modal title set to: ${modalTitle.textContent}`);
            
            // Get team data for displaying team names
            const teams = window.transferSimPro?.teams || [];
            
            // Create player cards HTML
            const playerCardsHtml = players.slice(0, 20).map(player => {
                const teamInfo = teams.find(team => team.id === player.team);
                const teamName = teamInfo ? teamInfo.name : 'Unknown';
                
                return `
                    <div class="modal-player-card" onclick="selectPlayerFromModal(${player.id})">
                        <div class="modal-player-info">
                            <div>
                                <div class="modal-player-name">${player.name}</div>
                                <div class="modal-player-team">${teamName}</div>
                            </div>
                            <div class="modal-player-price">Â£${player.price.toFixed(1)}m</div>
                        </div>
                        <div class="modal-player-stats">
                            <div class="modal-stat-box">
                                <span class="modal-stat-value">${player.total_points || 0}</span>
                                <span class="modal-stat-label">Points</span>
                            </div>
                            <div class="modal-stat-box">
                                <span class="modal-stat-value">${player.form || '0.0'}</span>
                                <span class="modal-stat-label">Form</span>
                            </div>
                            <div class="modal-stat-box">
                                <span class="modal-stat-value">${player.selected_by_percent || '0.0'}%</span>
                                <span class="modal-stat-label">Selected</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            playerGrid.innerHTML = playerCardsHtml;
            console.log(`ðŸŽ¨ Generated HTML for ${players.slice(0, 20).length} player cards`);
            
            modal.style.display = 'flex';
            console.log(`âœ… Modal display set to 'flex' - should now be visible!`);
            
            // Add escape key handler
            document.addEventListener('keydown', modalEscapeHandler);
            console.log(`âŒ¨ï¸ Escape key handler added`);
        };
        
        window.closePlayerModal = function() {
            const modal = document.getElementById('playerSelectionModal');
            modal.style.display = 'none';
            document.removeEventListener('keydown', modalEscapeHandler);
        };
        
        window.selectPlayerFromModal = function(playerId) {
            addPlayerToSquad(playerId);
            closePlayerModal();
        };
        
        // Helper function for escape key
        function modalEscapeHandler(event) {
            if (event.key === 'Escape') {
                closePlayerModal();
            }
        }
        
        // Test function to verify player data and modal functionality
        window.testPlayerDataAndModal = function() {
            console.log('ðŸ§ª Testing player data and modal functionality...');
            
            if (!window.transferSimPro || !window.transferSimPro.allPlayers) {
                console.error('âŒ transferSimPro not initialized');
                return false;
            }
            
            if (window.transferSimPro.allPlayers.length === 0) {
                console.error('âŒ No players loaded');
                return false;
            }
            
            console.log(`âœ… ${window.transferSimPro.allPlayers.length} players loaded`);
            
            // Test each position
            const positions = [
                {id: 1, label: 'GK', name: 'Goalkeepers'},
                {id: 2, label: 'DEF', name: 'Defenders'},
                {id: 3, label: 'MID', name: 'Midfielders'},
                {id: 4, label: 'FWD', name: 'Forwards'}
            ];
            
            positions.forEach(pos => {
                const posPlayers = window.transferSimPro.allPlayers.filter(p => p.position === pos.id);
                console.log(`âœ… ${pos.name}: ${posPlayers.length} players available`);
                if (posPlayers.length > 0) {
                    console.log(`   Sample: ${posPlayers[0].name} (Â£${posPlayers[0].price}m)`);
                }
            });
            
            // Test modal opening for midfielders
            console.log('ðŸ§ª Testing modal for midfielders...');
            try {
                selectPlayerForPosition('MID', 3);
                console.log('âœ… Modal should now be visible');
                
                // Close modal after test
                setTimeout(() => {
                    closePlayerModal();
                    console.log('âœ… Test completed - modal closed');
                }, 2000);
            } catch (error) {
                console.error('âŒ Modal test failed:', error);
            }
            
            return true;
        };
        
        // Alternative test function that directly calls the modal
        window.testModalDirectly = function() {
            console.log('ðŸ§ª Testing modal directly...');
            
            if (!window.transferSimPro || !window.transferSimPro.allPlayers || window.transferSimPro.allPlayers.length === 0) {
                console.error('âŒ No player data available for test');
                return;
            }
            
            const midfielders = window.transferSimPro.allPlayers.filter(player => player.position === 3);
            console.log(`Found ${midfielders.length} midfielders for test`);
            
            if (midfielders.length > 0) {
                window.showPlayerModal(midfielders, 'MID');
                console.log('âœ… Direct modal test completed');
            } else {
                console.error('âŒ No midfielders found for test');
            }
        };
        
        // Simple click test function
        window.testPositionClick = function(position) {
            console.log(`ðŸ§ª Testing position click for: ${position}`);
            const circles = document.querySelectorAll(`[data-position="${position}"]`);
            console.log(`Found ${circles.length} circles for position ${position}`);
            
            if (circles.length > 0) {
                const circle = circles[0]; // Test first circle
                console.log('ðŸŽ¯ Simulating click on first circle...');
                circle.click();
                console.log('âœ… Click simulation completed');
            } else {
                console.error('âŒ No circles found for position');
            }
        };
        
        // Manual modal trigger for console testing
        window.openGKModal = function() {
            console.log('ðŸ¥… Opening GK modal manually...');
            if (typeof window.selectPlayerForPosition === 'function') {
                window.selectPlayerForPosition('GK', 1);
            } else {
                console.error('âŒ selectPlayerForPosition function not available');
            }
        };
        
        window.openMIDModal = function() {
            console.log('âš½ Opening MID modal manually...');
            if (typeof window.selectPlayerForPosition === 'function') {
                window.selectPlayerForPosition('MID', 3);
            } else {
                console.error('âŒ selectPlayerForPosition function not available');
            }
        };
        
        // Missing functions that were causing JavaScript errors
        window.optimizeTeam = function() {
            console.log('ðŸ¤– AI Optimize Squad clicked');
            alert('AI Squad Optimization feature coming soon! For now, use the position circles to manually select players.');
        };
        
        window.resetTeam = function() {
            console.log('ðŸ”„ Reset Team clicked');
            if (confirm('Are you sure you want to reset your entire team?')) {
                // Clear all squad positions
                const squadDisplay = document.getElementById('squad-display');
                if (squadDisplay) {
                    squadDisplay.innerHTML = '<p>Your squad is empty. Click position circles to add players!</p>';
                }
                
                // Reset position circles to empty state
                const positionCircles = document.querySelectorAll('.position-circle');
                positionCircles.forEach(circle => {
                    circle.classList.remove('filled');
                    const playerDisplay = circle.querySelector('.player-name-display');
                    if (playerDisplay) {
                        playerDisplay.textContent = '+';
                    }
                });
                
                console.log('âœ… Team reset completed');
            }
        };
        
        function displayPlayerResults(players, title) {
            const resultsContainer = document.getElementById('playerSearchResults');
            if (!resultsContainer) {
                // Container intentionally removed - player cards no longer displayed at top
                return;
            }
            
            if (players.length === 0) {
                resultsContainer.innerHTML = '<p>No players found</p>';
                return;
            }
            
            let html = title ? `<h4>${title}</h4>` : '';
            html += '<div class="player-grid">';
            
            players.slice(0, 50).forEach((player, index) => {
                const positionLabels = {
                    1: 'GK',
                    2: 'DEF',
                    3: 'MID',
                    4: 'FWD'
                };
                
                const teamInfo = window.transferSimPro?.teams?.find(t => t.id === player.team);
                const teamName = teamInfo ? teamInfo.name : 'Unknown';
                
                html += `
                    <div class="player-card enhanced-card" data-player-id="${player.id}" tabindex="${index}">
                        <div class="player-main-section" onclick="addPlayerToSquad(${player.id})">
                            <div class="player-info">
                                <div class="player-primary">
                                    <span class="player-name">${player.name}</span>
                                    <span class="player-team">${teamName}</span>
                                </div>
                                <div class="player-stats">
                                    <span class="player-position position-${positionLabels[player.position]}">${positionLabels[player.position]}</span>
                                    <span class="player-price">Â£${player.price.toFixed(1)}m</span>
                                    <span class="player-points">${player.total_points || 0} pts</span>
                                </div>
                            </div>
                            <div class="quick-add-section">
                                <button class="quick-add-btn pulse-effect" onclick="event.stopPropagation(); quickAddPlayer(${player.id})" title="Quick Add">
                                    <span class="add-icon">âš¡</span>
                                    <span class="add-text">Add</span>
                                </button>
                            </div>
                        </div>
                        <div class="player-hover-info">
                            <span>Form: ${player.form || 'N/A'}</span>
                            <span>Selected: ${player.selected_by_percent || 0}%</span>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            resultsContainer.innerHTML = html;
            
            // Add keyboard navigation
            setupKeyboardNavigation();
        }
        
        // Squad management function
        window.addPlayerToSquad = function(playerId) {
            if (!window.transferSimPro || !window.transferSimPro.allPlayers) {
                console.warn('Player data not loaded');
                return;
            }
            
            const player = window.transferSimPro.allPlayers.find(p => p.id === playerId);
            if (!player) {
                console.warn('Player not found:', playerId);
                return;
            }
            
            console.log('Adding player to squad:', player.name);
            
            // Add visual feedback
            const playerCard = document.querySelector(`[data-player-id="${playerId}"]`);
            if (playerCard) {
                playerCard.classList.add('adding-player');
                setTimeout(() => {
                    playerCard.classList.remove('adding-player');
                    playerCard.classList.add('player-added');
                }, 300);
            }
            
            // Show success notification
            showNotification(`âœ… ${player.name} added to squad!`, 'success');
            
            // Update squad display (if exists)
            updateSquadDisplay();
        };
        
        // Quick add function with enhanced feedback
        window.quickAddPlayer = function(playerId) {
            if (!window.transferSimPro || !window.transferSimPro.allPlayers) {
                showNotification('âš ï¸ Player data not loaded', 'warning');
                return;
            }
            
            const player = window.transferSimPro.allPlayers.find(p => p.id === playerId);
            if (!player) {
                showNotification('âŒ Player not found', 'error');
                return;
            }
            
            // Instant visual feedback
            const button = event.target.closest('.quick-add-btn');
            if (button) {
                button.classList.add('added');
                button.innerHTML = '<span class="add-icon">âœ“</span><span class="add-text">Added!</span>';
                setTimeout(() => {
                    button.classList.remove('added');
                    button.innerHTML = '<span class="add-icon">âš¡</span><span class="add-text">Add</span>';
                }, 1500);
            }
            
            console.log('Quick adding player:', player.name);
            showNotification(`âš¡ ${player.name} added instantly!`, 'success');
            updateSquadDisplay();
        };
        
        // Notification system
        window.showNotification = function(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 25px;
                background: ${type === 'success' ? 'linear-gradient(135deg, #28a745, #20c997)' : 
                             type === 'warning' ? 'linear-gradient(135deg, #ffc107, #ff9800)' :
                             type === 'error' ? 'linear-gradient(135deg, #dc3545, #c82333)' :
                             'linear-gradient(135deg, #17a2b8, #138496)'};
                color: white;
                border-radius: 10px;
                box-shadow: 0 5px 20px rgba(0,0,0,0.2);
                font-weight: 600;
                z-index: 10000;
                animation: slideInRight 0.3s ease, slideOutRight 0.3s ease 2s forwards;
            `;
            
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 2500);
        };
        
        // Keyboard navigation
        window.setupKeyboardNavigation = function() {
            const cards = document.querySelectorAll('.player-card');
            let currentIndex = -1;
            
            document.addEventListener('keydown', (e) => {
                if (!cards.length) return;
                
                switch(e.key) {
                    case 'ArrowDown':
                        e.preventDefault();
                        currentIndex = Math.min(currentIndex + 1, cards.length - 1);
                        cards[currentIndex]?.focus();
                        break;
                    case 'ArrowUp':
                        e.preventDefault();
                        currentIndex = Math.max(currentIndex - 1, 0);
                        cards[currentIndex]?.focus();
                        break;
                    case 'Enter':
                    case ' ':
                        if (document.activeElement?.classList.contains('player-card')) {
                            e.preventDefault();
                            const playerId = document.activeElement.dataset.playerId;
                            if (playerId) {
                                if (e.shiftKey) {
                                    quickAddPlayer(parseInt(playerId));
                                } else {
                                    addPlayerToSquad(parseInt(playerId));
                                }
                            }
                        }
                        break;
                    case 'a':
                    case 'A':
                        if (document.activeElement?.classList.contains('player-card')) {
                            e.preventDefault();
                            const playerId = document.activeElement.dataset.playerId;
                            if (playerId) {
                                quickAddPlayer(parseInt(playerId));
                            }
                        }
                        break;
                }
            });
        };
        
        // Update squad display (placeholder)
        window.updateSquadDisplay = function() {
            // This will be implemented based on your squad display logic
            console.log('Squad display updated');
        };
        
        // Drag and Drop functionality
        window.setupDragAndDrop = function() {
            // Make player cards draggable
            document.addEventListener('dragstart', (e) => {
                if (e.target.closest('.player-card')) {
                    const card = e.target.closest('.player-card');
                    card.classList.add('dragging');
                    e.dataTransfer.effectAllowed = 'copy';
                    e.dataTransfer.setData('playerId', card.dataset.playerId);
                }
            });
            
            document.addEventListener('dragend', (e) => {
                if (e.target.closest('.player-card')) {
                    e.target.closest('.player-card').classList.remove('dragging');
                }
            });
            
            // Create drop zones for squad positions
            const squadSection = document.querySelector('.squad-section');
            if (squadSection && !document.querySelector('.drop-zone')) {
                const dropZone = document.createElement('div');
                dropZone.className = 'drop-zone';
                dropZone.innerHTML = '<span style="color: #6f42c1; font-weight: 600;">ðŸŽ¯ Drag players here to add to squad</span>';
                squadSection.appendChild(dropZone);
                
                dropZone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    dropZone.classList.add('drag-over');
                });
                
                dropZone.addEventListener('dragleave', () => {
                    dropZone.classList.remove('drag-over');
                });
                
                dropZone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    dropZone.classList.remove('drag-over');
                    const playerId = e.dataTransfer.getData('playerId');
                    if (playerId) {
                        quickAddPlayer(parseInt(playerId));
                        dropZone.innerHTML = '<span style="color: #4caf50; font-weight: 600;">âœ… Player added!</span>';
                        setTimeout(() => {
                            dropZone.innerHTML = '<span style="color: #6f42c1; font-weight: 600;">ðŸŽ¯ Drag players here to add to squad</span>';
                        }, 2000);
                    }
                });
            }
        };
        
        // Initialize drag and drop when players are displayed
        const originalDisplayPlayerResults = window.displayPlayerResults;
        window.displayPlayerResults = function(players, title) {
            originalDisplayPlayerResults.call(this, players, title);
            
            // Make cards draggable
            setTimeout(() => {
                document.querySelectorAll('.player-card').forEach(card => {
                    card.draggable = true;
                });
                setupDragAndDrop();
            }, 100);
        };
        
        // Filter functions for remaining filters (position, price, form)
        window.filterPlayers = function() {
            // This function can be used for position/price/form filtering if needed
            // For now it's a placeholder since we removed search functionality
            console.log('Filter triggered - search functionality removed');
        };
        
        
        // Add CSS for player cards
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInRight {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            
            @keyframes slideOutRight {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
            
            @keyframes pulseAdd {
                0%, 100% { transform: scale(1); }
                50% { transform: scale(1.1); }
            }
            
            @keyframes addSuccess {
                0% { transform: scale(1) rotate(0deg); }
                50% { transform: scale(1.2) rotate(180deg); }
                100% { transform: scale(1) rotate(360deg); }
            }
            
            .player-grid {
                display: grid;
                grid-template-columns: repeat(3, minmax(0, 1fr));
                gap: 20px;
                margin: 0;
                padding: 20px;
                width: 100%;
                box-sizing: border-box;
                background: rgba(255,255,255,0.95);
                border-radius: 15px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            }
            
            .player-card {
                background: #ffffff;
                border: 1px solid #e0e0e0;
                border-radius: 10px;
                transition: all 0.3s ease;
                cursor: pointer;
                position: relative;
                overflow: hidden;
                outline: none;
                min-height: 200px;
                display: flex;
                flex-direction: column;
                box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            }
            
            .player-card.enhanced-card {
                box-shadow: 0 3px 12px rgba(0,0,0,0.08);
            }
            
            .player-card:hover {
                transform: translateY(-3px);
                box-shadow: 0 8px 25px rgba(111, 66, 193, 0.15);
                border-color: #6f42c1;
                background: linear-gradient(135deg, #ffffff 0%, #f0ebff 100%);
            }
            
            .player-card:focus {
                border-color: #37003c;
                box-shadow: 0 0 0 3px rgba(111, 66, 193, 0.2);
            }
            
            .player-card.adding-player {
                animation: pulseAdd 0.3s ease;
                background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            }
            
            .player-card.player-added {
                background: linear-gradient(135deg, #e8f5e9 0%, #a5d6a7 100%);
                border-color: #4caf50;
            }
            
            .player-main-section {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 15px;
                position: relative;
                z-index: 2;
                flex: 1;
            }
            
            .player-info {
                flex: 1;
                display: flex;
                flex-direction: column;
                gap: 8px;
            }
            
            .player-primary {
                display: flex;
                flex-direction: column;
                gap: 4px;
            }
            
            .player-name {
                font-size: 1.1rem;
                font-weight: 700;
                color: #37003c;
                transition: color 0.2s;
                margin-bottom: 3px;
            }
            
            .player-card:hover .player-name {
                color: #6f42c1;
            }
            
            .player-team {
                font-size: 0.85rem;
                color: #666;
                font-weight: 500;
                margin-bottom: 8px;
            }
            
            .player-stats {
                display: flex;
                gap: 12px;
                align-items: center;
                flex-wrap: wrap;
            }
            
            .player-position {
                padding: 3px 8px;
                border-radius: 12px;
                font-size: 0.75rem;
                font-weight: 700;
                text-transform: uppercase;
            }
            
            .position-GK {
                background: linear-gradient(135deg, #ffd700, #ffed4e);
                color: #333;
            }
            
            .position-DEF {
                background: linear-gradient(135deg, #4caf50, #66bb6a);
                color: white;
            }
            
            .position-MID {
                background: linear-gradient(135deg, #2196f3, #42a5f5);
                color: white;
            }
            
            .position-FWD {
                background: linear-gradient(135deg, #f44336, #ef5350);
                color: white;
            }
            
            .player-price {
                font-weight: 700;
                color: #37003c;
                font-size: 1rem;
            }
            
            .player-points {
                font-size: 0.85rem;
                color: #666;
                font-weight: 600;
            }
            
            .quick-add-section {
                display: flex;
                gap: 8px;
            }
            
            .quick-add-btn {
                background: linear-gradient(135deg, #6f42c1, #37003c);
                color: white;
                border: none;
                padding: 8px 16px;
                border-radius: 20px;
                cursor: pointer;
                font-weight: 700;
                display: flex;
                align-items: center;
                gap: 5px;
                transition: all 0.3s ease;
                position: relative;
                overflow: hidden;
                font-size: 0.9rem;
            }
            
            .quick-add-btn:hover {
                transform: scale(1.05);
                box-shadow: 0 5px 15px rgba(111, 66, 193, 0.3);
            }
            
            .quick-add-btn.pulse-effect {
                animation: pulseAdd 2s infinite;
            }
            
            .quick-add-btn.added {
                background: linear-gradient(135deg, #4caf50, #66bb6a);
                animation: addSuccess 0.5s ease;
            }
            
            .add-icon {
                font-size: 1rem;
            }
            
            .add-text {
                font-size: 0.85rem;
            }
            
            .player-hover-info {
                display: flex;
                justify-content: space-around;
                padding: 8px 10px;
                background: rgba(111, 66, 193, 0.05);
                border-top: 1px solid rgba(111, 66, 193, 0.1);
                font-size: 0.75rem;
                color: #666;
                opacity: 0;
                transition: opacity 0.3s ease;
            }
            
            .player-card:hover .player-hover-info {
                opacity: 1;
            }
            
            .add-player-btn {
                background: linear-gradient(135deg, #37003c, #6f42c1);
                color: white;
                border: none;
                padding: 8px 16px;
                border-radius: 5px;
                cursor: pointer;
                font-weight: 600;
                transition: transform 0.2s;
            }
            
            .add-player-btn:hover {
                transform: scale(1.05);
            }
            
            /* Drag and drop styles */
            .player-card.dragging {
                opacity: 0.5;
                transform: rotate(2deg);
                cursor: grabbing;
            }
            
            .drop-zone {
                border: 2px dashed #6f42c1;
                background: rgba(111, 66, 193, 0.05);
                border-radius: 12px;
                min-height: 60px;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.3s ease;
            }
            
            .drop-zone.drag-over {
                background: rgba(111, 66, 193, 0.15);
                border-color: #37003c;
                transform: scale(1.02);
            }
            
            /* Responsive grid layouts */
            @media (max-width: 1400px) {
                .player-grid {
                    grid-template-columns: repeat(3, 1fr);
                    gap: 15px;
                }
            }
            
            @media (max-width: 1024px) {
                .player-grid {
                    grid-template-columns: repeat(2, 1fr);
                    gap: 12px;
                }
            }
            
            /* Mobile responsive */
            @media (max-width: 768px) {
                .player-grid {
                    grid-template-columns: 1fr;
                    gap: 12px;
                    padding: 5px;
                }
                
                .player-main-section {
                    flex-direction: column;
                    gap: 10px;
                }
                
                .quick-add-section {
                    width: 100%;
                }
                
                .quick-add-btn {
                    width: 100%;
                    justify-content: center;
                }
                
                .player-stats {
                    justify-content: space-between;
                    width: 100%;
                }
            }
            
            .player-name {
                font-weight: 600;
                flex: 1;
            }
            
            .player-position {
                padding: 2px 8px;
                background: #667eea;
                color: white;
                border-radius: 4px;
                font-size: 12px;
                font-weight: bold;
            }
            
            .player-price {
                font-weight: 600;
                color: #667eea;
            }
            
            .add-player-btn {
                padding: 5px 12px;
                background: linear-gradient(135deg, #667eea, #764ba2);
                color: white;
                border: none;
                border-radius: 5px;
                cursor: pointer;
                font-weight: 600;
                transition: transform 0.2s;
            }
            
            .add-player-btn:hover {
                transform: scale(1.05);
            }
        `;
        document.head.appendChild(style);
    </script>
    <script src="./auth-service.js"></script>
    
    
    <script>
        // Position circles are now interactive - clicking opens player selection
    </script>
</body>
</html>