<!DOCTYPE html>
<html lang="en-GB">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-TVPLGM5QY9"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-TVPLGM5QY9');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Predict Premier League match scores and earn points! Play the EPL Predictor game with real fixtures and live scoring.">
    <meta name="keywords" content="EPL predictor, Premier League predictions, football prediction game, match predictions, score predictor">
    <title>EPL Match Predictor Game - Predict Premier League Scores | EPL News Hub</title>

    <link rel="icon" type="image/png" href="/eplnewshubnewlogo.png">
    <link rel="stylesheet" href="/styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif:wght@400;700;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: #f5f5f5;
            color: #121212;
            line-height: 1.6;
        }

        .predictor-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        /* Header */
        .predictor-header {
            background: linear-gradient(135deg, #37003c 0%, #4a0d4e 100%);
            color: white;
            padding: 50px 30px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 40px;
            box-shadow: 0 4px 20px rgba(55, 0, 60, 0.3);
        }

        .predictor-title {
            font-family: 'Noto Serif', Georgia, serif;
            font-size: 3rem;
            font-weight: 900;
            margin-bottom: 15px;
            letter-spacing: -1px;
        }

        .predictor-subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 30px;
        }

        .user-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            max-width: 800px;
            margin: 0 auto;
        }

        .stat-card {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .stat-label {
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.8;
            margin-bottom: 8px;
        }

        .stat-value {
            font-family: 'Noto Serif', Georgia, serif;
            font-size: 2rem;
            font-weight: 700;
        }

        /* Loading State */
        .loading {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #37003c;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Tabs */
        .tabs-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .tab-btn {
            background: white;
            border: 2px solid #e0e0e0;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.95rem;
        }

        .tab-btn:hover {
            border-color: #37003c;
            color: #37003c;
        }

        .tab-btn.active {
            background: #37003c;
            color: white;
            border-color: #37003c;
        }

        /* Content Sections */
        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        /* Gameweek Info */
        .gameweek-info {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .gameweek-title {
            font-family: 'Noto Serif', Georgia, serif;
            font-size: 1.8rem;
            font-weight: 700;
            color: #37003c;
            margin-bottom: 10px;
        }

        .deadline-info {
            color: #666;
            margin-bottom: 15px;
        }

        .countdown-timer {
            font-size: 1.3rem;
            font-weight: 700;
            color: #dc3545;
            padding: 15px;
            background: #fff3cd;
            border-radius: 8px;
            text-align: center;
        }

        /* Matches Grid */
        .matches-grid {
            display: grid;
            gap: 25px;
        }

        .match-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            position: relative;
            border: 2px solid transparent;
        }

        .match-card:hover {
            box-shadow: 0 4px 20px rgba(0,0,0,0.12);
            transform: translateY(-2px);
        }

        .match-card.predicted {
            border-color: #28a745;
            background: linear-gradient(to right, #f0fff4 0%, white 100%);
        }

        .match-card.scored {
            border-color: #007bff;
            background: linear-gradient(to right, #e7f3ff 0%, white 100%);
        }

        .predicted-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #28a745;
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .points-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #007bff;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 700;
        }

        .match-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .match-datetime {
            color: #666;
            font-size: 0.9rem;
        }

        .match-status {
            background: #37003c;
            color: white;
            padding: 5px 12px;
            border-radius: 5px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .match-status.finished {
            background: #6c757d;
        }

        .teams-section {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 20px;
            align-items: center;
            margin-bottom: 25px;
        }

        .team-section {
            text-align: center;
        }

        .team-name {
            font-weight: 700;
            font-size: 1.1rem;
            color: #121212;
            margin-bottom: 15px;
        }

        .team-badge {
            width: 60px;
            height: 60px;
            margin: 0 auto 10px;
        }

        .score-input {
            width: 70px;
            height: 60px;
            text-align: center;
            font-family: 'Noto Serif', Georgia, serif;
            font-size: 1.8rem;
            font-weight: 700;
            border: 3px solid #e0e0e0;
            border-radius: 12px;
            transition: all 0.3s ease;
            background: white;
        }

        .score-input:focus {
            outline: none;
            border-color: #37003c;
            box-shadow: 0 0 0 3px rgba(55,0,60,0.1);
        }

        .score-input:disabled {
            background: #f5f5f5;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .actual-score {
            width: 70px;
            height: 60px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-family: 'Noto Serif', Georgia, serif;
            font-size: 2rem;
            font-weight: 700;
            background: #f8f9fa;
            border-radius: 12px;
            color: #121212;
        }

        .vs-divider {
            font-size: 1.5rem;
            font-weight: 700;
            color: #999;
        }

        .prediction-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        .predict-btn {
            background: linear-gradient(135deg, #37003c 0%, #4a0d4e 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .predict-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(55,0,60,0.3);
        }

        .predict-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .clear-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .points-breakdown {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 0.85rem;
        }

        .points-breakdown h4 {
            margin-bottom: 10px;
            color: #37003c;
        }

        .points-list {
            list-style: none;
            padding-left: 0;
        }

        .points-list li {
            padding: 5px 0;
            color: #666;
        }

        .points-list li strong {
            color: #121212;
        }

        /* Results Display */
        .result-display {
            margin-top: 15px;
            padding: 15px;
            background: #e7f3ff;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }

        .result-display h4 {
            color: #007bff;
            margin-bottom: 10px;
        }

        .result-comparison {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin-top: 10px;
        }

        .comparison-item {
            text-align: center;
        }

        .comparison-label {
            font-size: 0.8rem;
            color: #666;
            text-transform: uppercase;
            margin-bottom: 5px;
        }

        .comparison-value {
            font-size: 1.2rem;
            font-weight: 700;
        }

        /* History */
        .history-filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-btn {
            background: white;
            border: 2px solid #e0e0e0;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .filter-btn.active {
            background: #37003c;
            color: white;
            border-color: #37003c;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .predictor-title {
                font-size: 2rem;
            }

            .teams-section {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .vs-divider {
                display: none;
            }

            .score-input, .actual-score {
                width: 60px;
                height: 50px;
                font-size: 1.5rem;
            }
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #121212;
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            z-index: 10000;
            display: none;
            animation: slideIn 0.3s ease;
        }

        .toast.success {
            background: #28a745;
        }

        .toast.error {
            background: #dc3545;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* How to Play */
        .how-to-play {
            background: white;
            padding: 30px;
            border-radius: 10px;
        }

        .how-to-play h3 {
            color: #37003c;
            margin-top: 25px;
            margin-bottom: 15px;
        }

        .how-to-play ul {
            line-height: 2;
            padding-left: 20px;
        }

        .how-to-play li {
            margin-bottom: 10px;
        }

        .scoring-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .scoring-table th,
        .scoring-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .scoring-table th {
            background: #f8f9fa;
            font-weight: 700;
            color: #37003c;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header" include="./header.html"></div>

    <div class="predictor-container">
        <!-- Header Section -->
        <div class="predictor-header">
            <h1 class="predictor-title">⚽ EPL Score Predictor</h1>
            <p class="predictor-subtitle">Predict Premier League match scores and earn points!</p>

            <div class="user-stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Total Points</div>
                    <div class="stat-value" id="userTotalPoints">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Predictions Made</div>
                    <div class="stat-value" id="userPredictions">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Accuracy</div>
                    <div class="stat-value" id="userAccuracy">0%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Best Week</div>
                    <div class="stat-value" id="userBestWeek">0</div>
                </div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs-container">
            <button class="tab-btn active" onclick="PredictorGame.switchTab('upcoming')">
                📅 Upcoming Matches
            </button>
            <button class="tab-btn" onclick="PredictorGame.switchTab('results')">
                📊 Results & Points
            </button>
            <button class="tab-btn" onclick="PredictorGame.switchTab('history')">
                📜 My History
            </button>
            <button class="tab-btn" onclick="PredictorGame.switchTab('howto')">
                ❓ How to Play
            </button>
        </div>

        <!-- Loading State -->
        <div id="loadingState" class="loading">
            <div class="spinner"></div>
            <p>Loading Premier League fixtures...</p>
        </div>

        <!-- Upcoming Matches Tab -->
        <div id="upcoming" class="content-section active" style="display:none;">
            <div class="gameweek-info">
                <h2 class="gameweek-title" id="upcomingTitle">Upcoming Matches</h2>
                <p class="deadline-info" id="deadlineInfo">Make your predictions before kickoff!</p>
                <div class="countdown-timer" id="nextMatchCountdown"></div>
            </div>
            <div class="matches-grid" id="upcomingMatches"></div>
        </div>

        <!-- Results Tab -->
        <div id="results" class="content-section">
            <div class="gameweek-info">
                <h2 class="gameweek-title">Recent Results</h2>
                <p class="deadline-info">See how your predictions scored</p>
            </div>
            <div class="matches-grid" id="resultsMatches"></div>
        </div>

        <!-- History Tab -->
        <div id="history" class="content-section">
            <div class="gameweek-info">
                <h2 class="gameweek-title">Prediction History</h2>
                <p class="deadline-info">Your complete prediction record</p>
            </div>
            <div class="history-filters">
                <button class="filter-btn active" onclick="PredictorGame.filterHistory('all')">All Time</button>
                <button class="filter-btn" onclick="PredictorGame.filterHistory('month')">This Month</button>
                <button class="filter-btn" onclick="PredictorGame.filterHistory('week')">This Week</button>
            </div>
            <div id="historyContent"></div>
        </div>

        <!-- How to Play Tab -->
        <div id="howto" class="content-section">
            <div class="how-to-play">
                <h2>🎮 How to Play</h2>
                <p>Welcome to the EPL Score Predictor! Predict match scores and earn points based on accuracy.</p>

                <h3>📝 Making Predictions</h3>
                <ul>
                    <li>Predictions can be made for any upcoming Premier League match</li>
                    <li>Enter your predicted scores for both teams</li>
                    <li>Submit before the match kicks off</li>
                    <li>You can change predictions until kickoff</li>
                </ul>

                <h3>⚡ Scoring System</h3>
                <table class="scoring-table">
                    <thead>
                        <tr>
                            <th>Achievement</th>
                            <th>Points</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Exact Score (e.g., predicted 2-1, actual 2-1)</td>
                            <td><strong>10 points</strong></td>
                        </tr>
                        <tr>
                            <td>Correct Result + Goal Difference (e.g., predicted 3-1, actual 2-0)</td>
                            <td><strong>7 points</strong></td>
                        </tr>
                        <tr>
                            <td>Correct Result (e.g., predicted 2-0, actual 3-1)</td>
                            <td><strong>5 points</strong></td>
                        </tr>
                        <tr>
                            <td>Incorrect Prediction</td>
                            <td><strong>0 points</strong></td>
                        </tr>
                    </tbody>
                </table>

                <h3>📊 Examples</h3>
                <ul>
                    <li><strong>Exact Score:</strong> Predict 2-1, actual 2-1 → 10 points</li>
                    <li><strong>Correct Result + GD:</strong> Predict 3-1 (GD +2), actual 2-0 (GD +2) → 7 points</li>
                    <li><strong>Correct Result Only:</strong> Predict 2-0 (win), actual 3-1 (win) → 5 points</li>
                    <li><strong>Wrong:</strong> Predict 2-1, actual 0-0 → 0 points</li>
                </ul>

                <h3>🏆 Tips for Success</h3>
                <ul>
                    <li>Research team form and head-to-head records</li>
                    <li>Consider injuries and suspensions</li>
                    <li>Home advantage matters in the Premier League</li>
                    <li>Weather and kickoff time can affect scores</li>
                    <li>Derby matches are often unpredictable!</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer" include="./footer.html"></div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <!-- Scripts -->
    <script src="/index.js"></script>

    <script>
        const PredictorGame = {
            // State
            fixtures: [],
            predictions: {},
            userStats: {
                totalPoints: 0,
                totalPredictions: 0,
                correctPredictions: 0,
                exactScores: 0,
                correctResults: 0,
                bestWeekPoints: 0
            },
            currentSeason: '2025-2026',
            leagueId: 4328, // Premier League ID

            // Initialize
            async init() {
                this.loadUserData();
                await this.fetchFixtures();
                this.updateStats();
                this.startCountdowns();
                this.showUpcomingTab();
            },

            // Load user data from localStorage
            loadUserData() {
                const saved = localStorage.getItem('eplPredictorData');
                if (saved) {
                    const data = JSON.parse(saved);
                    this.predictions = data.predictions || {};
                    this.userStats = data.stats || this.userStats;
                }
            },

            // Save user data
            saveUserData() {
                const data = {
                    predictions: this.predictions,
                    stats: this.userStats,
                    lastUpdated: new Date().toISOString()
                };
                localStorage.setItem('eplPredictorData', JSON.stringify(data));
            },

            // Fetch fixtures from TheSportsDB API
            async fetchFixtures() {
                try {
                    document.getElementById('loadingState').style.display = 'block';

                    // Fetch current season fixtures
                    const response = await fetch(
                        `https://www.thesportsdb.com/api/v1/json/3/eventsseason.php?id=${this.leagueId}&s=${this.currentSeason}`
                    );
                    const data = await response.json();

                    if (data.events) {
                        this.fixtures = data.events
                            .map(event => this.parseEvent(event))
                            .sort((a, b) => new Date(a.dateTime) - new Date(b.dateTime));

                        // Calculate points for finished matches
                        this.calculateAllPoints();

                        // Render
                        this.renderUpcoming();
                        this.renderResults();
                        this.renderHistory();

                        document.getElementById('loadingState').style.display = 'none';
                    }
                } catch (error) {
                    console.error('Error fetching fixtures:', error);
                    this.showToast('Error loading fixtures', 'error');
                    document.getElementById('loadingState').style.display = 'none';
                }
            },

            // Parse API event to our format
            parseEvent(event) {
                return {
                    id: event.idEvent,
                    homeTeam: event.strHomeTeam,
                    awayTeam: event.strAwayTeam,
                    homeScore: event.intHomeScore ? parseInt(event.intHomeScore) : null,
                    awayScore: event.intAwayScore ? parseInt(event.intAwayScore) : null,
                    dateTime: event.strTimestamp || `${event.dateEvent} ${event.strTime}`,
                    status: event.strStatus,
                    round: event.intRound,
                    venue: event.strVenue
                };
            },

            // Check if match is upcoming (not started yet)
            isUpcoming(match) {
                const matchDate = new Date(match.dateTime);
                const now = new Date();
                return matchDate > now && !match.homeScore && !match.awayScore;
            },

            // Check if match is finished
            isFinished(match) {
                return match.homeScore !== null && match.awayScore !== null;
            },

            // Render upcoming matches
            renderUpcoming() {
                const container = document.getElementById('upcomingMatches');
                const upcoming = this.fixtures.filter(m => this.isUpcoming(m));

                if (upcoming.length === 0) {
                    container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">📅</div><p>No upcoming matches at the moment</p></div>';
                    return;
                }

                container.innerHTML = upcoming.map(match => {
                    const prediction = this.predictions[match.id];
                    const hasPrediction = prediction && prediction.homeScore !== undefined;

                    return `
                        <div class="match-card ${hasPrediction ? 'predicted' : ''}">
                            ${hasPrediction ? '<div class="predicted-badge">✓ Predicted</div>' : ''}

                            <div class="match-header">
                                <div class="match-datetime">
                                    ${new Date(match.dateTime).toLocaleDateString('en-GB', {
                                        weekday: 'short',
                                        day: 'numeric',
                                        month: 'short',
                                        hour: '2-digit',
                                        minute: '2-digit'
                                    })}
                                </div>
                                <div class="match-status">Round ${match.round}</div>
                            </div>

                            <div class="teams-section">
                                <div class="team-section">
                                    <div class="team-name">${match.homeTeam}</div>
                                    <input
                                        type="number"
                                        class="score-input"
                                        id="home_${match.id}"
                                        min="0"
                                        max="10"
                                        value="${prediction?.homeScore ?? ''}"
                                        placeholder="0"
                                    >
                                </div>

                                <div class="vs-divider">VS</div>

                                <div class="team-section">
                                    <div class="team-name">${match.awayTeam}</div>
                                    <input
                                        type="number"
                                        class="score-input"
                                        id="away_${match.id}"
                                        min="0"
                                        max="10"
                                        value="${prediction?.awayScore ?? ''}"
                                        placeholder="0"
                                    >
                                </div>
                            </div>

                            <div class="prediction-actions">
                                <button class="predict-btn" onclick="PredictorGame.savePrediction('${match.id}')">
                                    ${hasPrediction ? 'Update Prediction' : 'Save Prediction'}
                                </button>
                                ${hasPrediction ? `<button class="clear-btn" onclick="PredictorGame.clearPrediction('${match.id}')">Clear</button>` : ''}
                            </div>

                            <div class="points-breakdown">
                                <h4>🎯 Points Available</h4>
                                <ul class="points-list">
                                    <li><strong>10 pts</strong> - Exact score</li>
                                    <li><strong>7 pts</strong> - Correct result + goal difference</li>
                                    <li><strong>5 pts</strong> - Correct result only</li>
                                </ul>
                            </div>
                        </div>
                    `;
                }).join('');
            },

            // Render finished matches with results
            renderResults() {
                const container = document.getElementById('resultsMatches');
                const finished = this.fixtures
                    .filter(m => this.isFinished(m))
                    .sort((a, b) => new Date(b.dateTime) - new Date(a.dateTime))
                    .slice(0, 20); // Show last 20 results

                if (finished.length === 0) {
                    container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">📊</div><p>No results available yet</p></div>';
                    return;
                }

                container.innerHTML = finished.map(match => {
                    const prediction = this.predictions[match.id];
                    const points = prediction?.points || 0;

                    return `
                        <div class="match-card ${prediction ? 'scored' : ''}">
                            ${prediction ? `<div class="points-badge">+${points} pts</div>` : ''}

                            <div class="match-header">
                                <div class="match-datetime">
                                    ${new Date(match.dateTime).toLocaleDateString('en-GB', {
                                        weekday: 'short',
                                        day: 'numeric',
                                        month: 'short'
                                    })}
                                </div>
                                <div class="match-status finished">Finished</div>
                            </div>

                            <div class="teams-section">
                                <div class="team-section">
                                    <div class="team-name">${match.homeTeam}</div>
                                    <div class="actual-score">${match.homeScore}</div>
                                </div>

                                <div class="vs-divider">-</div>

                                <div class="team-section">
                                    <div class="team-name">${match.awayTeam}</div>
                                    <div class="actual-score">${match.awayScore}</div>
                                </div>
                            </div>

                            ${prediction ? `
                                <div class="result-display">
                                    <h4>Your Prediction: ${prediction.homeScore}-${prediction.awayScore}</h4>
                                    <div class="result-comparison">
                                        <div class="comparison-item">
                                            <div class="comparison-label">Predicted</div>
                                            <div class="comparison-value">${prediction.homeScore}-${prediction.awayScore}</div>
                                        </div>
                                        <div class="comparison-item">
                                            <div class="comparison-label">Actual</div>
                                            <div class="comparison-value">${match.homeScore}-${match.awayScore}</div>
                                        </div>
                                        <div class="comparison-item">
                                            <div class="comparison-label">Points</div>
                                            <div class="comparison-value" style="color: #007bff;">+${points}</div>
                                        </div>
                                    </div>
                                </div>
                            ` : `
                                <div style="text-align: center; padding: 15px; color: #999;">
                                    No prediction made for this match
                                </div>
                            `}
                        </div>
                    `;
                }).join('');
            },

            // Render history
            renderHistory() {
                const container = document.getElementById('historyContent');
                const predictions = Object.entries(this.predictions)
                    .filter(([_, p]) => p.points !== undefined)
                    .sort((a, b) => new Date(b[1].timestamp) - new Date(a[1].timestamp));

                if (predictions.length === 0) {
                    container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">📜</div><p>No prediction history yet. Start predicting to build your record!</p></div>';
                    return;
                }

                const totalPoints = predictions.reduce((sum, [_, p]) => sum + (p.points || 0), 0);
                const exactScores = predictions.filter(([_, p]) => p.points === 10).length;

                container.innerHTML = `
                    <div class="gameweek-info">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 20px;">
                            <div style="text-align: center; padding: 20px; background: white; border-radius: 8px;">
                                <div style="font-size: 2rem; font-weight: 700; color: #37003c;">${totalPoints}</div>
                                <div style="color: #666; margin-top: 5px;">Total Points</div>
                            </div>
                            <div style="text-align: center; padding: 20px; background: white; border-radius: 8px;">
                                <div style="font-size: 2rem; font-weight: 700; color: #37003c;">${predictions.length}</div>
                                <div style="color: #666; margin-top: 5px;">Predictions</div>
                            </div>
                            <div style="text-align: center; padding: 20px; background: white; border-radius: 8px;">
                                <div style="font-size: 2rem; font-weight: 700; color: #37003c;">${exactScores}</div>
                                <div style="color: #666; margin-top: 5px;">Exact Scores</div>
                            </div>
                            <div style="text-align: center; padding: 20px; background: white; border-radius: 8px;">
                                <div style="font-size: 2rem; font-weight: 700; color: #37003c;">${(totalPoints / predictions.length).toFixed(1)}</div>
                                <div style="color: #666; margin-top: 5px;">Avg Points</div>
                            </div>
                        </div>
                    </div>

                    <div class="matches-grid">
                        ${predictions.map(([matchId, pred]) => {
                            const match = this.fixtures.find(m => m.id === matchId);
                            if (!match) return '';

                            return `
                                <div class="match-card scored">
                                    <div class="points-badge">+${pred.points} pts</div>

                                    <div class="match-header">
                                        <div class="match-datetime">
                                            ${new Date(match.dateTime).toLocaleDateString('en-GB', {
                                                weekday: 'short',
                                                day: 'numeric',
                                                month: 'short',
                                                year: 'numeric'
                                            })}
                                        </div>
                                    </div>

                                    <div style="margin-bottom: 15px;">
                                        <div style="font-weight: 700; margin-bottom: 10px;">${match.homeTeam} vs ${match.awayTeam}</div>
                                        <div style="color: #666;">
                                            Predicted: ${pred.homeScore}-${pred.awayScore} |
                                            Actual: ${match.homeScore}-${match.awayScore}
                                        </div>
                                    </div>

                                    ${pred.points === 10 ? '<div style="background: #d4edda; padding: 10px; border-radius: 6px; color: #155724; font-weight: 600;">🎯 Exact Score!</div>' : ''}
                                    ${pred.points === 7 ? '<div style="background: #cce5ff; padding: 10px; border-radius: 6px; color: #004085; font-weight: 600;">👍 Correct Result + Goal Difference</div>' : ''}
                                    ${pred.points === 5 ? '<div style="background: #fff3cd; padding: 10px; border-radius: 6px; color: #856404; font-weight: 600;">✓ Correct Result</div>' : ''}
                                    ${pred.points === 0 ? '<div style="background: #f8d7da; padding: 10px; border-radius: 6px; color: #721c24; font-weight: 600;">✗ Incorrect</div>' : ''}
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
            },

            // Save prediction
            savePrediction(matchId) {
                const homeInput = document.getElementById(`home_${matchId}`);
                const awayInput = document.getElementById(`away_${matchId}`);

                const homeScore = parseInt(homeInput.value);
                const awayScore = parseInt(awayInput.value);

                if (isNaN(homeScore) || isNaN(awayScore) || homeScore < 0 || awayScore < 0) {
                    this.showToast('Please enter valid scores', 'error');
                    return;
                }

                this.predictions[matchId] = {
                    homeScore,
                    awayScore,
                    timestamp: new Date().toISOString()
                };

                this.saveUserData();
                this.renderUpcoming();
                this.showToast('✅ Prediction saved!', 'success');
            },

            // Clear prediction
            clearPrediction(matchId) {
                delete this.predictions[matchId];
                this.saveUserData();
                this.renderUpcoming();
                this.showToast('Prediction cleared', 'success');
            },

            // Calculate points for a prediction
            calculatePoints(prediction, actual) {
                if (!prediction || actual.homeScore === null) return 0;

                const predHome = prediction.homeScore;
                const predAway = prediction.awayScore;
                const actHome = actual.homeScore;
                const actAway = actual.awayScore;

                // Exact score
                if (predHome === actHome && predAway === actAway) {
                    return 10;
                }

                // Correct result and goal difference
                const predGD = predHome - predAway;
                const actGD = actHome - actAway;
                const predResult = predGD > 0 ? 'H' : predGD < 0 ? 'A' : 'D';
                const actResult = actGD > 0 ? 'H' : actGD < 0 ? 'A' : 'D';

                if (predResult === actResult && predGD === actGD) {
                    return 7;
                }

                // Correct result only
                if (predResult === actResult) {
                    return 5;
                }

                return 0;
            },

            // Calculate points for all predictions
            calculateAllPoints() {
                let totalPoints = 0;
                let exactScores = 0;

                this.fixtures.forEach(match => {
                    if (this.isFinished(match) && this.predictions[match.id]) {
                        const points = this.calculatePoints(this.predictions[match.id], match);
                        this.predictions[match.id].points = points;
                        totalPoints += points;
                        if (points === 10) exactScores++;
                    }
                });

                this.userStats.totalPoints = totalPoints;
                this.userStats.exactScores = exactScores;
                this.saveUserData();
            },

            // Update stats display
            updateStats() {
                document.getElementById('userTotalPoints').textContent = this.userStats.totalPoints;
                document.getElementById('userPredictions').textContent = Object.keys(this.predictions).length;

                const totalPredictions = Object.keys(this.predictions).filter(id => this.predictions[id].points !== undefined).length;
                const correctPredictions = Object.keys(this.predictions).filter(id => (this.predictions[id].points || 0) > 0).length;
                const accuracy = totalPredictions > 0 ? Math.round((correctPredictions / totalPredictions) * 100) : 0;

                document.getElementById('userAccuracy').textContent = accuracy + '%';
                document.getElementById('userBestWeek').textContent = this.userStats.bestWeekPoints || 0;
            },

            // Switch tabs
            switchTab(tabName) {
                document.querySelectorAll('.content-section').forEach(section => {
                    section.classList.remove('active');
                    section.style.display = 'none';
                });

                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.classList.remove('active');
                });

                document.getElementById(tabName).classList.add('active');
                document.getElementById(tabName).style.display = 'block';
                event.target.classList.add('active');
            },

            // Show upcoming tab on load
            showUpcomingTab() {
                document.getElementById('upcoming').style.display = 'block';
            },

            // Start countdowns
            startCountdowns() {
                setInterval(() => {
                    const upcoming = this.fixtures.filter(m => this.isUpcoming(m));
                    if (upcoming.length > 0) {
                        const nextMatch = upcoming[0];
                        const countdown = this.getCountdown(new Date(nextMatch.dateTime));
                        const timer = document.getElementById('nextMatchCountdown');
                        if (timer) {
                            timer.textContent = `⏰ Next match: ${nextMatch.homeTeam} vs ${nextMatch.awayTeam} in ${countdown}`;
                        }
                    }
                }, 1000);
            },

            // Get countdown string
            getCountdown(targetDate) {
                const now = new Date();
                const diff = targetDate - now;

                if (diff <= 0) return 'Starting now!';

                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);

                if (days > 0) return `${days}d ${hours}h ${minutes}m`;
                if (hours > 0) return `${hours}h ${minutes}m ${seconds}s`;
                return `${minutes}m ${seconds}s`;
            },

            // Filter history
            filterHistory(filter) {
                document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
                event.target.classList.add('active');
                // Re-render with filter applied (simplified for now)
                this.renderHistory();
            },

            // Show toast notification
            showToast(message, type = 'success') {
                const toast = document.getElementById('toast');
                toast.textContent = message;
                toast.className = `toast ${type}`;
                toast.style.display = 'block';

                setTimeout(() => {
                    toast.style.display = 'none';
                }, 3000);
            }
        };

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            PredictorGame.init();
        });
    </script>
</body>
</html>
