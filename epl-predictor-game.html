<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-TVPLGM5QY9"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-TVPLGM5QY9');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EPL Betting Game - EPL News Hub</title>
    <meta name="description" content="Bet coins on Premier League matches. Predict match outcomes, build your streak, and climb the leaderboard!">
    <link rel="icon" type="image/png" href="/eplnewshubnewlogo.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Noto+Serif:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="/supabase-config.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 50%, #0f0f0f 100%);
            color: #f5f5f5;
            min-height: 100vh;
        }

        /* Header Styles */
        .betting-header {
            background: rgba(20, 20, 20, 0.95);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 16px 24px;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 16px;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 24px;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
            color: inherit;
        }

        .logo-section img {
            height: 40px;
            width: auto;
        }

        .logo-text h1 {
            font-size: 20px;
            font-weight: 700;
            color: #00ff87;
        }

        .logo-text span {
            font-size: 12px;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .wallet-display {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .coin-balance {
            display: flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(135deg, rgba(0, 255, 135, 0.15), rgba(0, 255, 135, 0.05));
            padding: 10px 20px;
            border-radius: 50px;
            border: 1px solid rgba(0, 255, 135, 0.3);
        }

        .coin-icon {
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, #ffd700, #ffaa00);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 14px;
            color: #000;
            box-shadow: 0 2px 8px rgba(255, 215, 0, 0.4);
        }

        .coin-amount {
            font-size: 18px;
            font-weight: 700;
            color: #00ff87;
        }

        .streak-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            background: rgba(255, 100, 50, 0.15);
            padding: 8px 14px;
            border-radius: 50px;
            border: 1px solid rgba(255, 100, 50, 0.3);
        }

        .streak-badge.active {
            background: rgba(255, 100, 50, 0.25);
            border-color: rgba(255, 100, 50, 0.5);
        }

        .streak-icon {
            font-size: 16px;
        }

        .streak-count {
            font-size: 14px;
            font-weight: 600;
            color: #ff6432;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .nav-btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            border: none;
        }

        .nav-btn.primary {
            background: #00ff87;
            color: #000;
        }

        .nav-btn.primary:hover {
            background: #00dd75;
            transform: translateY(-2px);
        }

        .nav-btn.secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .nav-btn.secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        /* Tab Navigation */
        .tab-nav {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px 24px;
            display: flex;
            gap: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .tab-btn {
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            background: transparent;
            color: #888;
            border: none;
            transition: all 0.2s;
        }

        .tab-btn:hover {
            color: #fff;
            background: rgba(255, 255, 255, 0.05);
        }

        .tab-btn.active {
            background: rgba(0, 255, 135, 0.15);
            color: #00ff87;
            border: 1px solid rgba(0, 255, 135, 0.3);
        }

        /* Main Content */
        .main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px;
            display: grid;
            grid-template-columns: 1fr 360px;
            gap: 24px;
        }

        /* Match Grid */
        .matches-section {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .section-title {
            font-size: 24px;
            font-weight: 700;
            color: #fff;
        }

        .match-count {
            font-size: 14px;
            color: #888;
        }

        .matches-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
            gap: 16px;
        }

        /* Match Card */
        .match-card {
            background: rgba(30, 30, 30, 0.8);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            transition: all 0.3s;
        }

        .match-card:hover {
            border-color: rgba(0, 255, 135, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .match-card.has-bet {
            border-color: rgba(0, 255, 135, 0.5);
            background: rgba(0, 255, 135, 0.05);
        }

        .match-date {
            font-size: 12px;
            color: #888;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .match-date svg {
            width: 14px;
            height: 14px;
            opacity: 0.6;
        }

        .match-teams {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .team {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            flex: 1;
        }

        .team-badge {
            width: 48px;
            height: 48px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .team-badge img {
            width: 36px;
            height: 36px;
            object-fit: contain;
        }

        .team-name {
            font-size: 13px;
            font-weight: 600;
            color: #fff;
            text-align: center;
            max-width: 100px;
        }

        .team-position {
            font-size: 11px;
            color: #666;
        }

        .vs-badge {
            font-size: 12px;
            color: #666;
            font-weight: 600;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }

        /* Betting Options */
        .betting-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .bet-option {
            padding: 14px 8px;
            border-radius: 10px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
            text-align: center;
            background: rgba(255, 255, 255, 0.05);
        }

        .bet-option:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .bet-option.home {
            border-color: rgba(59, 130, 246, 0.3);
        }

        .bet-option.home:hover, .bet-option.home.selected {
            background: rgba(59, 130, 246, 0.2);
            border-color: #3b82f6;
        }

        .bet-option.draw {
            border-color: rgba(107, 114, 128, 0.3);
        }

        .bet-option.draw:hover, .bet-option.draw.selected {
            background: rgba(107, 114, 128, 0.2);
            border-color: #6b7280;
        }

        .bet-option.away {
            border-color: rgba(239, 68, 68, 0.3);
        }

        .bet-option.away:hover, .bet-option.away.selected {
            background: rgba(239, 68, 68, 0.2);
            border-color: #ef4444;
        }

        .bet-option.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }

        .bet-label {
            font-size: 11px;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .bet-odds {
            font-size: 18px;
            font-weight: 700;
            color: #fff;
        }

        .bet-option.home .bet-odds { color: #3b82f6; }
        .bet-option.draw .bet-odds { color: #9ca3af; }
        .bet-option.away .bet-odds { color: #ef4444; }

        .bet-placed-badge {
            margin-top: 12px;
            padding: 8px 12px;
            background: rgba(0, 255, 135, 0.15);
            border-radius: 8px;
            font-size: 12px;
            color: #00ff87;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        /* Bet Slip Sidebar */
        .bet-slip-container {
            position: sticky;
            top: 100px;
        }

        .bet-slip {
            background: rgba(30, 30, 30, 0.95);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            overflow: hidden;
        }

        .bet-slip-header {
            padding: 16px 20px;
            background: rgba(0, 255, 135, 0.1);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .bet-slip-title {
            font-size: 16px;
            font-weight: 700;
            color: #00ff87;
        }

        .clear-slip-btn {
            background: none;
            border: none;
            color: #888;
            font-size: 13px;
            cursor: pointer;
            transition: color 0.2s;
        }

        .clear-slip-btn:hover {
            color: #ef4444;
        }

        .bet-slip-empty {
            padding: 40px 20px;
            text-align: center;
            color: #666;
        }

        .bet-slip-empty svg {
            width: 48px;
            height: 48px;
            margin-bottom: 12px;
            opacity: 0.3;
        }

        .bet-slip-content {
            padding: 16px;
        }

        .slip-match {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 12px;
        }

        .slip-match-teams {
            font-size: 14px;
            font-weight: 600;
            color: #fff;
            margin-bottom: 8px;
        }

        .slip-selection {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .slip-bet-type {
            font-size: 13px;
            color: #888;
        }

        .slip-odds {
            font-size: 16px;
            font-weight: 700;
            color: #00ff87;
        }

        .stake-input-section {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stake-label {
            font-size: 13px;
            color: #888;
            margin-bottom: 8px;
        }

        .stake-input-wrapper {
            position: relative;
            margin-bottom: 12px;
        }

        .stake-input {
            width: 100%;
            padding: 14px 16px;
            padding-left: 40px;
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: #fff;
            font-size: 18px;
            font-weight: 600;
            transition: border-color 0.2s;
        }

        .stake-input:focus {
            outline: none;
            border-color: #00ff87;
        }

        .stake-coin-icon {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, #ffd700, #ffaa00);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 11px;
            color: #000;
        }

        .quick-stakes {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 16px;
        }

        .quick-stake-btn {
            padding: 10px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #fff;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .quick-stake-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .quick-stake-btn.all-in {
            background: rgba(239, 68, 68, 0.15);
            border-color: rgba(239, 68, 68, 0.3);
            color: #ef4444;
        }

        .quick-stake-btn.all-in:hover {
            background: rgba(239, 68, 68, 0.25);
        }

        .potential-return {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px;
            background: rgba(0, 255, 135, 0.1);
            border-radius: 10px;
            margin-bottom: 16px;
        }

        .return-label {
            font-size: 13px;
            color: #888;
        }

        .return-amount {
            font-size: 20px;
            font-weight: 700;
            color: #00ff87;
        }

        .place-bet-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #00ff87, #00dd75);
            border: none;
            border-radius: 10px;
            color: #000;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
        }

        .place-bet-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 255, 135, 0.3);
        }

        .place-bet-btn:disabled {
            background: #444;
            color: #888;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* My Bets Tab */
        .bets-section {
            display: none;
        }

        .bets-section.active {
            display: block;
        }

        .bets-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
        }

        .bets-tab {
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            background: transparent;
            color: #888;
            border: none;
            transition: all 0.2s;
        }

        .bets-tab.active {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }

        .bet-history-card {
            background: rgba(30, 30, 30, 0.8);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .bet-history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .bet-history-match {
            font-size: 15px;
            font-weight: 600;
            color: #fff;
        }

        .bet-status {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .bet-status.pending {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
        }

        .bet-status.won {
            background: rgba(0, 255, 135, 0.2);
            color: #00ff87;
        }

        .bet-status.lost {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .bet-history-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .bet-history-selection {
            font-size: 13px;
            color: #888;
        }

        .bet-history-stake {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .bet-history-stake span {
            font-size: 14px;
            color: #666;
        }

        .bet-history-return {
            font-size: 16px;
            font-weight: 700;
            color: #00ff87;
        }

        .bet-history-return.lost {
            color: #ef4444;
            text-decoration: line-through;
        }

        /* Leaderboard */
        .leaderboard-section {
            display: none;
        }

        .leaderboard-section.active {
            display: block;
        }

        .leaderboard-card {
            background: rgba(30, 30, 30, 0.8);
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .leaderboard-header-row {
            display: grid;
            grid-template-columns: 60px 1fr 100px 100px 80px;
            padding: 14px 20px;
            background: rgba(255, 255, 255, 0.05);
            font-size: 12px;
            font-weight: 600;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .leaderboard-row {
            display: grid;
            grid-template-columns: 60px 1fr 100px 100px 80px;
            padding: 16px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            align-items: center;
            transition: background 0.2s;
        }

        .leaderboard-row:hover {
            background: rgba(255, 255, 255, 0.03);
        }

        .leaderboard-row:last-child {
            border-bottom: none;
        }

        .leaderboard-rank {
            font-size: 18px;
            font-weight: 700;
            color: #888;
        }

        .leaderboard-row:nth-child(2) .leaderboard-rank { color: #ffd700; }
        .leaderboard-row:nth-child(3) .leaderboard-rank { color: #c0c0c0; }
        .leaderboard-row:nth-child(4) .leaderboard-rank { color: #cd7f32; }

        .leaderboard-user {
            font-size: 15px;
            font-weight: 600;
            color: #fff;
        }

        .leaderboard-profit {
            font-size: 15px;
            font-weight: 700;
            color: #00ff87;
        }

        .leaderboard-profit.negative {
            color: #ef4444;
        }

        .leaderboard-bets {
            font-size: 14px;
            color: #888;
        }

        .leaderboard-winrate {
            font-size: 14px;
            font-weight: 600;
            color: #fff;
        }

        /* Daily Bonus Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .modal-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .modal {
            background: linear-gradient(135deg, #1a1a1a, #252525);
            border-radius: 20px;
            padding: 32px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transform: scale(0.9);
            transition: transform 0.3s;
        }

        .modal-overlay.active .modal {
            transform: scale(1);
        }

        .modal-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #ffd700, #ffaa00);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 40px;
            box-shadow: 0 8px 32px rgba(255, 215, 0, 0.4);
        }

        .modal-title {
            font-size: 24px;
            font-weight: 700;
            color: #fff;
            margin-bottom: 8px;
        }

        .modal-subtitle {
            font-size: 14px;
            color: #888;
            margin-bottom: 24px;
        }

        .bonus-amount {
            font-size: 48px;
            font-weight: 800;
            color: #00ff87;
            margin-bottom: 8px;
        }

        .bonus-day {
            font-size: 14px;
            color: #888;
            margin-bottom: 24px;
        }

        .claim-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #00ff87, #00dd75);
            border: none;
            border-radius: 10px;
            color: #000;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
        }

        .claim-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 255, 135, 0.3);
        }

        /* Auth Required State */
        .auth-required {
            padding: 80px 24px;
            text-align: center;
        }

        .auth-required svg {
            width: 80px;
            height: 80px;
            margin-bottom: 24px;
            opacity: 0.3;
        }

        .auth-required h2 {
            font-size: 24px;
            font-weight: 700;
            color: #fff;
            margin-bottom: 12px;
        }

        .auth-required p {
            font-size: 16px;
            color: #888;
            margin-bottom: 24px;
        }

        .auth-required .nav-btn {
            display: inline-block;
        }

        /* Loading State */
        .loading-spinner {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 60px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top-color: #00ff87;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            bottom: 24px;
            right: 24px;
            z-index: 1001;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .toast {
            padding: 14px 20px;
            background: rgba(30, 30, 30, 0.95);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideIn 0.3s ease;
            backdrop-filter: blur(10px);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast.success { border-color: rgba(0, 255, 135, 0.3); }
        .toast.error { border-color: rgba(239, 68, 68, 0.3); }
        .toast.info { border-color: rgba(59, 130, 246, 0.3); }

        .toast-icon {
            font-size: 20px;
        }

        .toast-message {
            font-size: 14px;
            color: #fff;
        }

        /* No Matches State */
        .no-matches {
            padding: 60px 24px;
            text-align: center;
            background: rgba(30, 30, 30, 0.5);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .no-matches svg {
            width: 64px;
            height: 64px;
            margin-bottom: 16px;
            opacity: 0.3;
        }

        .no-matches h3 {
            font-size: 18px;
            color: #fff;
            margin-bottom: 8px;
        }

        .no-matches p {
            font-size: 14px;
            color: #888;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .bet-slip-container {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                z-index: 99;
                padding: 0;
            }

            .bet-slip {
                border-radius: 20px 20px 0 0;
                max-height: 60vh;
                overflow-y: auto;
            }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 12px;
            }

            .header-left {
                width: 100%;
                justify-content: space-between;
            }

            .wallet-display {
                gap: 12px;
            }

            .coin-balance {
                padding: 8px 14px;
            }

            .coin-amount {
                font-size: 16px;
            }

            .matches-grid {
                grid-template-columns: 1fr;
            }

            .leaderboard-header-row,
            .leaderboard-row {
                grid-template-columns: 40px 1fr 80px;
            }

            .leaderboard-bets,
            .leaderboard-winrate {
                display: none;
            }
        }

        /* Hidden elements */
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="betting-header">
        <div class="header-content">
            <div class="header-left">
                <a href="/index.html" class="logo-section">
                    <img src="/eplnewshubnewlogo.png" alt="EPL News Hub">
                    <div class="logo-text">
                        <h1>Betting Game</h1>
                        <span>Premier League</span>
                    </div>
                </a>
                <div class="wallet-display" id="walletDisplay">
                    <div class="coin-balance">
                        <div class="coin-icon">C</div>
                        <span class="coin-amount" id="coinBalance">0</span>
                    </div>
                    <div class="streak-badge" id="streakBadge">
                        <span class="streak-icon">&#128293;</span>
                        <span class="streak-count" id="streakCount">0</span>
                    </div>
                </div>
            </div>
            <div class="header-right">
                <a href="/index.html" class="nav-btn secondary">Back to News</a>
                <a href="/signin.html" class="nav-btn primary" id="authBtn">Sign In</a>
            </div>
        </div>
    </header>

    <!-- Tab Navigation -->
    <nav class="tab-nav">
        <button class="tab-btn active" data-tab="matches">Upcoming Matches</button>
        <button class="tab-btn" data-tab="mybets">My Bets</button>
        <button class="tab-btn" data-tab="leaderboard">Leaderboard</button>
    </nav>

    <!-- Main Content -->
    <main class="main-content" id="mainContent">
        <!-- Auth Required State -->
        <div class="auth-required hidden" id="authRequired">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
            </svg>
            <h2>Sign In to Play</h2>
            <p>Create an account to start betting with coins and compete on the leaderboard!</p>
            <a href="/signin.html" class="nav-btn primary">Sign In</a>
            <a href="/create-account.html" class="nav-btn secondary" style="margin-left: 12px;">Create Account</a>
        </div>

        <!-- Matches Section -->
        <section class="matches-section" id="matchesSection">
            <div class="section-header">
                <h2 class="section-title">Upcoming Matches</h2>
                <span class="match-count" id="matchCount">Loading...</span>
            </div>
            <div class="matches-grid" id="matchesGrid">
                <div class="loading-spinner">
                    <div class="spinner"></div>
                </div>
            </div>
        </section>

        <!-- My Bets Section -->
        <section class="bets-section" id="myBetsSection">
            <div class="bets-tabs">
                <button class="bets-tab active" data-filter="pending">Pending</button>
                <button class="bets-tab" data-filter="settled">Settled</button>
                <button class="bets-tab" data-filter="all">All Bets</button>
            </div>
            <div id="betsContainer">
                <div class="loading-spinner">
                    <div class="spinner"></div>
                </div>
            </div>
        </section>

        <!-- Leaderboard Section -->
        <section class="leaderboard-section" id="leaderboardSection">
            <div class="leaderboard-card">
                <div class="leaderboard-header-row">
                    <span>Rank</span>
                    <span>Player</span>
                    <span>Profit</span>
                    <span>Bets</span>
                    <span>Win %</span>
                </div>
                <div id="leaderboardRows">
                    <div class="loading-spinner">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Bet Slip -->
        <aside class="bet-slip-container" id="betSlipContainer">
            <div class="bet-slip">
                <div class="bet-slip-header">
                    <span class="bet-slip-title">Bet Slip</span>
                    <button class="clear-slip-btn" id="clearSlip">Clear</button>
                </div>
                <div class="bet-slip-empty" id="betSlipEmpty">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="2" y="3" width="20" height="14" rx="2"/>
                        <line x1="8" y1="21" x2="16" y2="21"/>
                        <line x1="12" y1="17" x2="12" y2="21"/>
                    </svg>
                    <p>Select a match outcome to place a bet</p>
                </div>
                <div class="bet-slip-content hidden" id="betSlipContent">
                    <div class="slip-match">
                        <div class="slip-match-teams" id="slipTeams">-</div>
                        <div class="slip-selection">
                            <span class="slip-bet-type" id="slipBetType">-</span>
                            <span class="slip-odds" id="slipOdds">-</span>
                        </div>
                    </div>
                    <div class="stake-input-section">
                        <div class="stake-label">Stake Amount</div>
                        <div class="stake-input-wrapper">
                            <div class="stake-coin-icon">C</div>
                            <input type="number" class="stake-input" id="stakeInput" placeholder="0" min="1">
                        </div>
                        <div class="quick-stakes">
                            <button class="quick-stake-btn" data-amount="100">100</button>
                            <button class="quick-stake-btn" data-amount="500">500</button>
                            <button class="quick-stake-btn" data-amount="1000">1K</button>
                            <button class="quick-stake-btn all-in" data-amount="all">ALL</button>
                        </div>
                        <div class="potential-return">
                            <span class="return-label">Potential Return</span>
                            <span class="return-amount" id="potentialReturn">0</span>
                        </div>
                        <button class="place-bet-btn" id="placeBetBtn" disabled>Place Bet</button>
                    </div>
                </div>
            </div>
        </aside>
    </main>

    <!-- Daily Bonus Modal -->
    <div class="modal-overlay" id="bonusModal">
        <div class="modal">
            <div class="modal-icon">&#127873;</div>
            <h2 class="modal-title">Daily Bonus!</h2>
            <p class="modal-subtitle">Welcome back! Here's your daily reward.</p>
            <div class="bonus-amount" id="bonusAmount">+100</div>
            <div class="bonus-day" id="bonusDay">Day 1 of 7</div>
            <button class="claim-btn" id="claimBonus">Claim Bonus</button>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        // Initialize Supabase
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // App State
        let currentUser = null;
        let userWallet = null;
        let selectedBet = null;
        let matches = [];
        let standings = [];
        let userBets = [];

        // Daily Bonus Amounts
        const DAILY_BONUSES = [100, 150, 200, 300, 400, 500, 750];

        // DOM Elements
        const coinBalanceEl = document.getElementById('coinBalance');
        const streakCountEl = document.getElementById('streakCount');
        const streakBadgeEl = document.getElementById('streakBadge');
        const matchesGridEl = document.getElementById('matchesGrid');
        const matchCountEl = document.getElementById('matchCount');
        const betSlipEmpty = document.getElementById('betSlipEmpty');
        const betSlipContent = document.getElementById('betSlipContent');
        const stakeInput = document.getElementById('stakeInput');
        const potentialReturnEl = document.getElementById('potentialReturn');
        const placeBetBtn = document.getElementById('placeBetBtn');
        const authBtn = document.getElementById('authBtn');
        const authRequired = document.getElementById('authRequired');
        const matchesSection = document.getElementById('matchesSection');
        const betSlipContainer = document.getElementById('betSlipContainer');
        const bonusModal = document.getElementById('bonusModal');
        const toastContainer = document.getElementById('toastContainer');

        // Initialize App
        async function init() {
            await checkAuth();
            setupEventListeners();
            await loadStandings();
            await loadMatches();

            if (currentUser) {
                await loadUserBets();
                await checkDailyBonus();
                startSettlementPolling();
            }
        }

        // Check Authentication
        async function checkAuth() {
            const { data: { user } } = await supabase.auth.getUser();
            currentUser = user;

            if (user) {
                authBtn.textContent = 'Account';
                authBtn.href = '/account.html';
                authRequired.classList.add('hidden');
                matchesSection.classList.remove('hidden');
                betSlipContainer.classList.remove('hidden');
                await loadOrCreateWallet();
            } else {
                authRequired.classList.remove('hidden');
                matchesSection.classList.add('hidden');
                betSlipContainer.classList.add('hidden');
            }
        }

        // Load or Create User Wallet
        async function loadOrCreateWallet() {
            const { data: wallet, error } = await supabase
                .from('user_wallets')
                .select('*')
                .eq('user_id', currentUser.id)
                .single();

            if (error && error.code === 'PGRST116') {
                // Wallet doesn't exist, create one
                const { data: newWallet, error: createError } = await supabase
                    .from('user_wallets')
                    .insert({ user_id: currentUser.id, coins: 5000 })
                    .select()
                    .single();

                if (createError) {
                    console.error('Error creating wallet:', createError);
                    showToast('Error creating wallet', 'error');
                    return;
                }
                userWallet = newWallet;
                showToast('Welcome! You received 5,000 coins!', 'success');
            } else if (error) {
                console.error('Error loading wallet:', error);
                return;
            } else {
                userWallet = wallet;
            }

            updateWalletDisplay();
        }

        // Update Wallet Display
        function updateWalletDisplay() {
            if (userWallet) {
                coinBalanceEl.textContent = userWallet.coins.toLocaleString();
                streakCountEl.textContent = userWallet.current_streak;

                if (userWallet.current_streak >= 3) {
                    streakBadgeEl.classList.add('active');
                } else {
                    streakBadgeEl.classList.remove('active');
                }
            }
        }

        // Load League Standings for Odds Calculation
        async function loadStandings() {
            try {
                const response = await fetch('https://www.thesportsdb.com/api/v1/json/3/lookuptable.php?l=4328&s=2024-2025');
                const data = await response.json();
                standings = data.table || [];
            } catch (error) {
                console.error('Error loading standings:', error);
            }
        }

        // Load Upcoming Matches
        async function loadMatches() {
            try {
                // Fetch multiple rounds to get upcoming fixtures
                const now = new Date();
                const allMatches = [];

                // Calculate current round (roughly - EPL season starts mid-August)
                const seasonStart = new Date('2024-08-16');
                const weeksElapsed = Math.floor((now - seasonStart) / (7 * 24 * 60 * 60 * 1000));
                const estimatedRound = Math.min(38, Math.max(1, weeksElapsed + 1));

                // Fetch current and next few rounds
                const roundsToFetch = [estimatedRound, estimatedRound + 1, estimatedRound + 2].filter(r => r <= 38);

                for (const round of roundsToFetch) {
                    try {
                        const response = await fetch('https://www.thesportsdb.com/api/v1/json/3/eventsround.php?id=4328&r=' + round + '&s=2024-2025');
                        const data = await response.json();
                        if (data.events) {
                            allMatches.push(...data.events);
                        }
                    } catch (e) {
                        console.log('Error fetching round ' + round);
                    }
                }

                // Filter for upcoming matches (date in future)
                matches = allMatches.filter(event => {
                    const matchDate = new Date(event.strTimestamp || event.dateEvent);
                    // Match is in the future (at least 1 hour from now)
                    return matchDate > new Date(now.getTime() + 60 * 60 * 1000);
                });

                // Sort by date
                matches.sort((a, b) => {
                    const dateA = new Date(a.strTimestamp || a.dateEvent);
                    const dateB = new Date(b.strTimestamp || b.dateEvent);
                    return dateA - dateB;
                });

                // Limit to 15 matches
                matches = matches.slice(0, 15);

                // If no matches found, use sample EPL fixtures
                if (matches.length === 0) {
                    matches = generateSampleMatches();
                }

                // Get user's existing bets
                if (currentUser) {
                    try {
                        const { data: bets } = await supabase
                            .from('bets')
                            .select('match_id')
                            .eq('user_id', currentUser.id)
                            .eq('status', 'pending');

                        const betMatchIds = new Set((bets || []).map(b => b.match_id));
                        matches = matches.map(m => ({
                            ...m,
                            hasBet: betMatchIds.has(m.idEvent)
                        }));
                    } catch (e) {
                        console.log('Could not load user bets');
                    }
                }

                renderMatches();
            } catch (error) {
                console.error('Error loading matches:', error);
                // Fall back to sample matches
                matches = generateSampleMatches();
                renderMatches();
            }
        }

        // Generate sample EPL matches for demo/fallback
        function generateSampleMatches() {
            const teams = [
                { name: 'Arsenal', badge: 'https://r2.thesportsdb.com/images/media/team/badge/uyhbfe1612467038.png' },
                { name: 'Liverpool', badge: 'https://r2.thesportsdb.com/images/media/team/badge/kfaher1737969724.png' },
                { name: 'Manchester City', badge: 'https://r2.thesportsdb.com/images/media/team/badge/vwpvry1467462651.png' },
                { name: 'Chelsea', badge: 'https://r2.thesportsdb.com/images/media/team/badge/yvwvtu1448813215.png' },
                { name: 'Manchester United', badge: 'https://r2.thesportsdb.com/images/media/team/badge/xzqdr11517660252.png' },
                { name: 'Tottenham', badge: 'https://r2.thesportsdb.com/images/media/team/badge/dfyfhl1604094109.png' },
                { name: 'Newcastle', badge: 'https://r2.thesportsdb.com/images/media/team/badge/lhwuiz1621593302.png' },
                { name: 'Aston Villa', badge: 'https://r2.thesportsdb.com/images/media/team/badge/jykrpv1717309891.png' },
                { name: 'Brighton', badge: 'https://r2.thesportsdb.com/images/media/team/badge/ywypts1448810904.png' },
                { name: 'West Ham', badge: 'https://r2.thesportsdb.com/images/media/team/badge/yutyxs1467459956.png' },
                { name: 'Nottingham Forest', badge: 'https://r2.thesportsdb.com/images/media/team/badge/bk4qjs1546440351.png' },
                { name: 'Bournemouth', badge: 'https://r2.thesportsdb.com/images/media/team/badge/y08nak1534071116.png' },
                { name: 'Fulham', badge: 'https://r2.thesportsdb.com/images/media/team/badge/xwwvyt1448811086.png' },
                { name: 'Crystal Palace', badge: 'https://r2.thesportsdb.com/images/media/team/badge/ia6i3m1656014992.png' },
                { name: 'Brentford', badge: 'https://r2.thesportsdb.com/images/media/team/badge/grv1aw1546453779.png' },
                { name: 'Wolves', badge: 'https://r2.thesportsdb.com/images/media/team/badge/u9qr031621593327.png' },
                { name: 'Everton', badge: 'https://r2.thesportsdb.com/images/media/team/badge/eqayrf1523184794.png' },
                { name: 'Leicester', badge: 'https://r2.thesportsdb.com/images/media/team/badge/xtxwtu1448813356.png' },
                { name: 'Ipswich', badge: 'https://r2.thesportsdb.com/images/media/team/badge/mdj1ey1634670785.png' },
                { name: 'Southampton', badge: 'https://r2.thesportsdb.com/images/media/team/badge/ggqtd01621593274.png' }
            ];

            const sampleMatches = [];
            const baseDate = new Date();
            baseDate.setHours(15, 0, 0, 0);

            // Generate 10 sample matches over the next few days
            const matchups = [
                [0, 5],   // Arsenal vs Tottenham
                [1, 2],   // Liverpool vs Man City
                [3, 4],   // Chelsea vs Man United
                [6, 7],   // Newcastle vs Aston Villa
                [8, 9],   // Brighton vs West Ham
                [10, 11], // Forest vs Bournemouth
                [12, 13], // Fulham vs Crystal Palace
                [14, 15], // Brentford vs Wolves
                [16, 17], // Everton vs Leicester
                [18, 19]  // Ipswich vs Southampton
            ];

            matchups.forEach((pair, index) => {
                const matchDate = new Date(baseDate);
                matchDate.setDate(matchDate.getDate() + Math.floor(index / 3) + 1);
                matchDate.setHours(15 + (index % 3) * 2, 0, 0, 0);

                sampleMatches.push({
                    idEvent: 'sample_' + (index + 1),
                    strHomeTeam: teams[pair[0]].name,
                    strAwayTeam: teams[pair[1]].name,
                    strHomeTeamBadge: teams[pair[0]].badge,
                    strAwayTeamBadge: teams[pair[1]].badge,
                    strTimestamp: matchDate.toISOString(),
                    dateEvent: matchDate.toISOString().split('T')[0],
                    intHomeScore: null,
                    intAwayScore: null
                });
            });

            return sampleMatches;
        }

        // Calculate Odds Based on Standings
        function calculateOdds(homeTeam, awayTeam) {
            const homePos = standings.findIndex(t => t.strTeam === homeTeam) + 1 || 10;
            const awayPos = standings.findIndex(t => t.strTeam === awayTeam) + 1 || 10;

            // Base odds calculation
            const homeStrength = (21 - homePos) / 20;
            const awayStrength = (21 - awayPos) / 20;
            const homeAdvantage = 0.12;

            const totalStrength = homeStrength + homeAdvantage + awayStrength;
            const homeWinProb = (homeStrength + homeAdvantage) / totalStrength;
            const awayWinProb = awayStrength / totalStrength;
            const drawProb = 1 - homeWinProb - awayWinProb + 0.25;

            // Convert to decimal odds (with margin)
            const margin = 1.08;
            let homeOdds = (1 / homeWinProb) * margin;
            let drawOdds = (1 / drawProb) * margin;
            let awayOdds = (1 / awayWinProb) * margin;

            // Clamp odds to reasonable ranges
            homeOdds = Math.max(1.10, Math.min(15, homeOdds));
            drawOdds = Math.max(2.50, Math.min(8, drawOdds));
            awayOdds = Math.max(1.10, Math.min(15, awayOdds));

            return {
                home: parseFloat(homeOdds.toFixed(2)),
                draw: parseFloat(drawOdds.toFixed(2)),
                away: parseFloat(awayOdds.toFixed(2))
            };
        }

        // Render Matches
        function renderMatches() {
            if (matches.length === 0) {
                matchesGridEl.innerHTML = '<div class="no-matches"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><h3>No Upcoming Matches</h3><p>Check back soon for new fixtures</p></div>';
                matchCountEl.textContent = '0 matches';
                return;
            }

            matchCountEl.textContent = matches.length + ' matches';

            matchesGridEl.innerHTML = matches.map(match => {
                const matchDate = new Date(match.strTimestamp || match.dateEvent);
                const odds = calculateOdds(match.strHomeTeam, match.strAwayTeam);
                const isLocked = matchDate < new Date(Date.now() + 5 * 60 * 1000);
                const matchData = JSON.stringify({id: match.idEvent, home: match.strHomeTeam, away: match.strAwayTeam, date: match.strTimestamp || match.dateEvent}).replace(/"/g, '&quot;');

                return '<div class="match-card ' + (match.hasBet ? 'has-bet' : '') + '" data-match-id="' + match.idEvent + '">' +
                    '<div class="match-date">' +
                        '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>' +
                        matchDate.toLocaleDateString('en-GB', { weekday: 'short', month: 'short', day: 'numeric' }) + ' at ' + matchDate.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' }) +
                    '</div>' +
                    '<div class="match-teams">' +
                        '<div class="team">' +
                            '<div class="team-badge"><img src="' + (match.strHomeTeamBadge || '/placeholder.png') + '" alt="' + match.strHomeTeam + '" onerror="this.style.display=\'none\'"></div>' +
                            '<span class="team-name">' + match.strHomeTeam + '</span>' +
                        '</div>' +
                        '<div class="vs-badge">VS</div>' +
                        '<div class="team">' +
                            '<div class="team-badge"><img src="' + (match.strAwayTeamBadge || '/placeholder.png') + '" alt="' + match.strAwayTeam + '" onerror="this.style.display=\'none\'"></div>' +
                            '<span class="team-name">' + match.strAwayTeam + '</span>' +
                        '</div>' +
                    '</div>' +
                    '<div class="betting-options">' +
                        '<div class="bet-option home ' + (isLocked || match.hasBet ? 'disabled' : '') + '" data-match="' + matchData + '" data-bet-type="home" data-odds="' + odds.home + '">' +
                            '<div class="bet-label">' + match.strHomeTeam.split(' ')[0] + '</div>' +
                            '<div class="bet-odds">' + odds.home + '</div>' +
                        '</div>' +
                        '<div class="bet-option draw ' + (isLocked || match.hasBet ? 'disabled' : '') + '" data-match="' + matchData + '" data-bet-type="draw" data-odds="' + odds.draw + '">' +
                            '<div class="bet-label">Draw</div>' +
                            '<div class="bet-odds">' + odds.draw + '</div>' +
                        '</div>' +
                        '<div class="bet-option away ' + (isLocked || match.hasBet ? 'disabled' : '') + '" data-match="' + matchData + '" data-bet-type="away" data-odds="' + odds.away + '">' +
                            '<div class="bet-label">' + match.strAwayTeam.split(' ')[0] + '</div>' +
                            '<div class="bet-odds">' + odds.away + '</div>' +
                        '</div>' +
                    '</div>' +
                    (match.hasBet ? '<div class="bet-placed-badge">&#10003; Bet Placed</div>' : '') +
                '</div>';
            }).join('');

            // Add click handlers for betting options
            document.querySelectorAll('.bet-option:not(.disabled)').forEach(option => {
                option.addEventListener('click', handleBetSelection);
            });
        }

        // Handle Bet Selection
        function handleBetSelection(e) {
            if (!currentUser) {
                showToast('Please sign in to place bets', 'error');
                return;
            }

            const option = e.currentTarget;
            const matchDataStr = option.getAttribute('data-match').replace(/&quot;/g, '"');
            const match = JSON.parse(matchDataStr);
            const betType = option.dataset.betType;
            const odds = parseFloat(option.dataset.odds);

            // Remove previous selection
            document.querySelectorAll('.bet-option.selected').forEach(el => {
                el.classList.remove('selected');
            });

            // Add selection to clicked option
            option.classList.add('selected');

            // Update bet slip
            selectedBet = {
                matchId: match.id,
                homeTeam: match.home,
                awayTeam: match.away,
                matchDate: match.date,
                betType,
                odds
            };

            updateBetSlip();
        }

        // Update Bet Slip
        function updateBetSlip() {
            if (!selectedBet) {
                betSlipEmpty.classList.remove('hidden');
                betSlipContent.classList.add('hidden');
                return;
            }

            betSlipEmpty.classList.add('hidden');
            betSlipContent.classList.remove('hidden');

            document.getElementById('slipTeams').textContent = selectedBet.homeTeam + ' vs ' + selectedBet.awayTeam;

            const betTypeLabels = { home: 'Home Win', draw: 'Draw', away: 'Away Win' };
            document.getElementById('slipBetType').textContent = betTypeLabels[selectedBet.betType];
            document.getElementById('slipOdds').textContent = selectedBet.odds.toFixed(2);

            updatePotentialReturn();
        }

        // Update Potential Return
        function updatePotentialReturn() {
            const stake = parseInt(stakeInput.value) || 0;

            if (stake > 0 && selectedBet) {
                const potentialReturn = Math.floor(stake * selectedBet.odds);
                potentialReturnEl.textContent = potentialReturn.toLocaleString();
                placeBetBtn.disabled = stake > userWallet.coins;

                if (stake > userWallet.coins) {
                    placeBetBtn.textContent = 'Insufficient Coins';
                } else {
                    placeBetBtn.textContent = 'Place Bet';
                }
            } else {
                potentialReturnEl.textContent = '0';
                placeBetBtn.disabled = true;
            }
        }

        // Place Bet
        async function placeBet() {
            if (!selectedBet || !currentUser || !userWallet) return;

            const stake = parseInt(stakeInput.value);

            if (stake <= 0) {
                showToast('Please enter a valid stake amount', 'error');
                return;
            }

            if (stake > userWallet.coins) {
                showToast('Insufficient coins', 'error');
                return;
            }

            const potentialWin = Math.floor(stake * selectedBet.odds);
            const betHomeTeam = selectedBet.homeTeam;
            const betAwayTeam = selectedBet.awayTeam;

            // Deduct coins from wallet
            const { error: walletError } = await supabase
                .from('user_wallets')
                .update({
                    coins: userWallet.coins - stake,
                    total_bets: userWallet.total_bets + 1
                })
                .eq('user_id', currentUser.id);

            if (walletError) {
                showToast('Error placing bet', 'error');
                return;
            }

            // Create bet record
            const { error: betError } = await supabase
                .from('bets')
                .insert({
                    user_id: currentUser.id,
                    match_id: selectedBet.matchId,
                    match_date: selectedBet.matchDate,
                    home_team: selectedBet.homeTeam,
                    away_team: selectedBet.awayTeam,
                    bet_type: selectedBet.betType,
                    stake: stake,
                    odds: selectedBet.odds,
                    potential_win: potentialWin,
                    status: 'pending'
                });

            if (betError) {
                // Refund coins
                await supabase
                    .from('user_wallets')
                    .update({ coins: userWallet.coins })
                    .eq('user_id', currentUser.id);

                if (betError.code === '23505') {
                    showToast('You already have a bet on this match', 'error');
                } else {
                    showToast('Error placing bet', 'error');
                }
                return;
            }

            // Update local state
            userWallet.coins -= stake;
            userWallet.total_bets += 1;
            updateWalletDisplay();

            showToast('Bet placed! ' + stake + ' coins on ' + betHomeTeam + ' vs ' + betAwayTeam, 'success');

            // Clear bet slip
            selectedBet = null;
            stakeInput.value = '';
            updateBetSlip();
            document.querySelectorAll('.bet-option.selected').forEach(el => {
                el.classList.remove('selected');
            });

            // Reload matches to show bet placed
            await loadMatches();
        }

        // Load User Bets
        async function loadUserBets() {
            if (!currentUser) return;

            const { data: bets, error } = await supabase
                .from('bets')
                .select('*')
                .eq('user_id', currentUser.id)
                .order('placed_at', { ascending: false });

            if (error) {
                console.error('Error loading bets:', error);
                return;
            }

            userBets = bets || [];
            renderUserBets('pending');
        }

        // Render User Bets
        function renderUserBets(filter) {
            const container = document.getElementById('betsContainer');

            let filteredBets = userBets;
            if (filter === 'pending') {
                filteredBets = userBets.filter(b => b.status === 'pending');
            } else if (filter === 'settled') {
                filteredBets = userBets.filter(b => b.status !== 'pending');
            }

            if (filteredBets.length === 0) {
                container.innerHTML = '<div class="no-matches"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg><h3>No Bets Yet</h3><p>' + (filter === 'pending' ? 'Place your first bet on an upcoming match!' : 'Your settled bets will appear here') + '</p></div>';
                return;
            }

            const betTypeLabels = { home: 'Home Win', draw: 'Draw', away: 'Away Win' };

            container.innerHTML = filteredBets.map(bet => {
                return '<div class="bet-history-card">' +
                    '<div class="bet-history-header">' +
                        '<span class="bet-history-match">' + bet.home_team + ' vs ' + bet.away_team + '</span>' +
                        '<span class="bet-status ' + bet.status + '">' + bet.status + '</span>' +
                    '</div>' +
                    '<div class="bet-history-details">' +
                        '<span class="bet-history-selection">' + betTypeLabels[bet.bet_type] + ' @ ' + bet.odds + '</span>' +
                        '<div class="bet-history-stake">' +
                            '<span>Stake: ' + bet.stake + '</span>' +
                            '<span class="bet-history-return ' + (bet.status === 'lost' ? 'lost' : '') + '">' + (bet.status === 'won' ? '+' + bet.payout : bet.potential_win) + '</span>' +
                        '</div>' +
                    '</div>' +
                '</div>';
            }).join('');
        }

        // Load Leaderboard
        async function loadLeaderboard() {
            const { data: leaders, error } = await supabase
                .from('betting_leaderboard')
                .select('*')
                .order('profit', { ascending: false })
                .limit(20);

            if (error) {
                console.error('Error loading leaderboard:', error);
                return;
            }

            const container = document.getElementById('leaderboardRows');

            if (!leaders || leaders.length === 0) {
                container.innerHTML = '<div class="no-matches" style="border-radius: 0;"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 21h8m-4-4v4M3 11h18M5 11V7a2 2 0 012-2h10a2 2 0 012 2v4M7 21a2 2 0 01-2-2v-4h14v4a2 2 0 01-2 2H7z"/></svg><h3>Leaderboard Coming Soon</h3><p>Be the first to climb the ranks!</p></div>';
                return;
            }

            container.innerHTML = leaders.map((leader, index) => {
                const winRate = leader.total_bets > 0 ? Math.round((leader.won_bets / leader.total_bets) * 100) : 0;
                return '<div class="leaderboard-row">' +
                    '<span class="leaderboard-rank">#' + (index + 1) + '</span>' +
                    '<span class="leaderboard-user">' + leader.username + '</span>' +
                    '<span class="leaderboard-profit ' + (leader.profit < 0 ? 'negative' : '') + '">' + (leader.profit >= 0 ? '+' : '') + leader.profit.toLocaleString() + '</span>' +
                    '<span class="leaderboard-bets">' + leader.total_bets + '</span>' +
                    '<span class="leaderboard-winrate">' + winRate + '%</span>' +
                '</div>';
            }).join('');
        }

        // Check Daily Bonus
        async function checkDailyBonus() {
            if (!userWallet) return;

            const today = new Date().toISOString().split('T')[0];
            const lastBonus = userWallet.last_daily_bonus;

            if (lastBonus === today) return;

            // Calculate bonus day (reset after 7 days or if missed a day)
            let bonusDay = userWallet.daily_bonus_day || 0;
            const yesterday = new Date(Date.now() - 86400000).toISOString().split('T')[0];

            if (lastBonus !== yesterday) {
                bonusDay = 0; // Reset if missed a day
            }

            bonusDay = (bonusDay % 7) + 1;
            const bonusAmount = DAILY_BONUSES[bonusDay - 1];

            document.getElementById('bonusAmount').textContent = '+' + bonusAmount;
            document.getElementById('bonusDay').textContent = 'Day ' + bonusDay + ' of 7';

            bonusModal.classList.add('active');

            document.getElementById('claimBonus').onclick = async () => {
                const { error } = await supabase
                    .from('user_wallets')
                    .update({
                        coins: userWallet.coins + bonusAmount,
                        last_daily_bonus: today,
                        daily_bonus_day: bonusDay
                    })
                    .eq('user_id', currentUser.id);

                if (!error) {
                    userWallet.coins += bonusAmount;
                    userWallet.last_daily_bonus = today;
                    userWallet.daily_bonus_day = bonusDay;
                    updateWalletDisplay();
                    showToast('Claimed ' + bonusAmount + ' coins!', 'success');
                }

                bonusModal.classList.remove('active');
            };
        }

        // Settlement Polling
        async function settleBets() {
            if (!currentUser) return;

            const { data: pendingBets } = await supabase
                .from('bets')
                .select('*')
                .eq('user_id', currentUser.id)
                .eq('status', 'pending');

            if (!pendingBets || pendingBets.length === 0) return;

            for (const bet of pendingBets) {
                const matchDate = new Date(bet.match_date);
                // Check if match should be finished (3 hours after start)
                if (matchDate < new Date(Date.now() - 3 * 60 * 60 * 1000)) {
                    try {
                        const response = await fetch('https://www.thesportsdb.com/api/v1/json/3/lookupevent.php?id=' + bet.match_id);
                        const data = await response.json();
                        const event = data.events && data.events[0];

                        if (event && event.intHomeScore !== null && event.intAwayScore !== null) {
                            const homeScore = parseInt(event.intHomeScore);
                            const awayScore = parseInt(event.intAwayScore);

                            let actualResult;
                            if (homeScore > awayScore) actualResult = 'home';
                            else if (awayScore > homeScore) actualResult = 'away';
                            else actualResult = 'draw';

                            const won = bet.bet_type === actualResult;
                            const payout = won ? bet.potential_win : 0;

                            // Update bet
                            await supabase
                                .from('bets')
                                .update({
                                    status: won ? 'won' : 'lost',
                                    actual_result: actualResult,
                                    payout: payout,
                                    settled_at: new Date().toISOString()
                                })
                                .eq('id', bet.id);

                            // Update wallet if won
                            if (won) {
                                const streakBonus = userWallet.current_streak >= 5 ? 0.25 :
                                                   userWallet.current_streak >= 3 ? 0.10 : 0;
                                const totalPayout = Math.floor(payout * (1 + streakBonus));

                                await supabase
                                    .from('user_wallets')
                                    .update({
                                        coins: userWallet.coins + totalPayout,
                                        lifetime_winnings: userWallet.lifetime_winnings + totalPayout - bet.stake,
                                        won_bets: userWallet.won_bets + 1,
                                        current_streak: userWallet.current_streak + 1,
                                        best_streak: Math.max(userWallet.best_streak, userWallet.current_streak + 1)
                                    })
                                    .eq('user_id', currentUser.id);

                                userWallet.coins += totalPayout;
                                userWallet.won_bets += 1;
                                userWallet.current_streak += 1;

                                showToast('Won ' + totalPayout + ' coins!' + (streakBonus > 0 ? ' (Streak bonus!)' : ''), 'success');
                            } else {
                                await supabase
                                    .from('user_wallets')
                                    .update({ current_streak: 0 })
                                    .eq('user_id', currentUser.id);

                                userWallet.current_streak = 0;
                                showToast('Bet lost: ' + bet.home_team + ' vs ' + bet.away_team, 'error');
                            }

                            updateWalletDisplay();
                        }
                    } catch (e) {
                        console.error('Error settling bet:', e);
                    }
                }
            }
        }

        function startSettlementPolling() {
            settleBets();
            setInterval(settleBets, 5 * 60 * 1000); // Every 5 minutes
        }

        // Show Toast Notification
        function showToast(message, type) {
            type = type || 'info';
            const icons = {
                success: '&#10003;',
                error: '&#10005;',
                info: 'i'
            };

            const toast = document.createElement('div');
            toast.className = 'toast ' + type;
            toast.innerHTML = '<span class="toast-icon">' + icons[type] + '</span><span class="toast-message">' + message + '</span>';

            toastContainer.appendChild(toast);

            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        }

        // Event Listeners
        function setupEventListeners() {
            // Tab Navigation
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');

                    const tab = btn.dataset.tab;
                    matchesSection.classList.toggle('hidden', tab !== 'matches');
                    document.getElementById('myBetsSection').classList.toggle('active', tab === 'mybets');
                    document.getElementById('leaderboardSection').classList.toggle('active', tab === 'leaderboard');
                    betSlipContainer.classList.toggle('hidden', tab !== 'matches');

                    if (tab === 'mybets') loadUserBets();
                    if (tab === 'leaderboard') loadLeaderboard();
                });
            });

            // Bets Filter Tabs
            document.querySelectorAll('.bets-tab').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.bets-tab').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    renderUserBets(btn.dataset.filter);
                });
            });

            // Stake Input
            stakeInput.addEventListener('input', updatePotentialReturn);

            // Quick Stake Buttons
            document.querySelectorAll('.quick-stake-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const amount = btn.dataset.amount;
                    if (amount === 'all') {
                        stakeInput.value = userWallet ? userWallet.coins : 0;
                    } else {
                        stakeInput.value = amount;
                    }
                    updatePotentialReturn();
                });
            });

            // Place Bet Button
            placeBetBtn.addEventListener('click', placeBet);

            // Clear Slip
            document.getElementById('clearSlip').addEventListener('click', () => {
                selectedBet = null;
                stakeInput.value = '';
                updateBetSlip();
                document.querySelectorAll('.bet-option.selected').forEach(el => {
                    el.classList.remove('selected');
                });
            });
        }

        // Initialize
        init();
    </script>
</body>
</html>
