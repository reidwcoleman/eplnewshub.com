<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FPL Player Data - EPL News Hub</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 0;
            background: #f5f5f5;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        h1 {
            color: #37003c;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }
        
        .filters-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .filter-row {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .filter-group label {
            font-size: 12px;
            color: #666;
            font-weight: 600;
        }
        
        select, input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        button {
            padding: 10px 20px;
            background: #37003c;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #2a002e;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #37003c;
        }
        
        .stat-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        
        .table-container {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        thead {
            background: #37003c;
            color: white;
        }
        
        th {
            padding: 12px;
            text-align: left;
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            user-select: none;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        th:hover {
            background: #2a002e;
        }
        
        tbody tr {
            border-bottom: 1px solid #eee;
            transition: background 0.2s;
        }
        
        tbody tr:hover {
            background: #f9f9f9;
        }
        
        td {
            padding: 12px;
            font-size: 14px;
        }
        
        .player-name {
            font-weight: 600;
            color: #37003c;
        }
        
        .position-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: 600;
        }
        
        .position-GKP { background: #ffd700; color: #333; }
        .position-DEF { background: #00ff87; color: #333; }
        .position-MID { background: #05f0ff; color: #333; }
        .position-FWD { background: #ff1751; color: white; }
        
        .price {
            font-weight: 600;
        }
        
        .positive { color: #00a652; }
        .negative { color: #dc241f; }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #37003c;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error {
            background: #fee;
            color: #c00;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
        }
        
        .team-logo {
            width: 20px;
            height: 20px;
            margin-right: 5px;
            vertical-align: middle;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 1.8em;
            }
            
            .filter-row {
                flex-direction: column;
            }
            
            .table-container {
                overflow-x: auto;
            }
            
            table {
                min-width: 800px;
            }
        }
        
        .sort-arrow {
            display: inline-block;
            margin-left: 5px;
            font-size: 10px;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
        }
        
        .pagination button {
            padding: 5px 10px;
            font-size: 14px;
        }
        
        .pagination span {
            color: #666;
        }
    </style>
</head>
<body>
    <div class="header" include="./header.html"></div>
    
    <div class="container">
        <h1>FPL Player Data</h1>
        <p class="subtitle">Comprehensive player statistics and analysis</p>
        
        <div class="filters-container">
            <div class="filter-row">
                <div class="filter-group">
                    <label>Position</label>
                    <select id="positionFilter">
                        <option value="all">All Positions</option>
                        <option value="GKP">Goalkeepers</option>
                        <option value="DEF">Defenders</option>
                        <option value="MID">Midfielders</option>
                        <option value="FWD">Forwards</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label>Team</label>
                    <select id="teamFilter">
                        <option value="all">All Teams</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label>Max Price (£)</label>
                    <input type="number" id="maxPrice" placeholder="15.0" step="0.1" min="3.5" max="15">
                </div>
                
                <div class="filter-group">
                    <label>Min Minutes</label>
                    <input type="number" id="minMinutes" placeholder="0" min="0" max="3420">
                </div>
                
                <div class="filter-group">
                    <label>Search Player</label>
                    <input type="text" id="playerSearch" placeholder="Player name...">
                </div>
                
                <button onclick="applyFilters()">Apply Filters</button>
                <button onclick="resetFilters()">Reset</button>
            </div>
        </div>
        
        <div class="stats-grid" id="statsGrid">
            <div class="stat-card">
                <div class="stat-value" id="totalPlayers">-</div>
                <div class="stat-label">Total Players</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="avgPoints">-</div>
                <div class="stat-label">Avg Points</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="avgPrice">-</div>
                <div class="stat-label">Avg Price</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="topScorer">-</div>
                <div class="stat-label">Top Scorer</div>
            </div>
        </div>
        
        <div class="table-container">
            <div id="loadingIndicator" class="loading">
                <div class="spinner"></div>
                <p>Loading player data...</p>
            </div>
            
            <table id="playerTable" style="display: none;">
                <thead>
                    <tr>
                        <th onclick="sortTable('name')">Name <span class="sort-arrow">↕</span></th>
                        <th onclick="sortTable('team')">Team <span class="sort-arrow">↕</span></th>
                        <th onclick="sortTable('position')">Pos <span class="sort-arrow">↕</span></th>
                        <th onclick="sortTable('price')">Price <span class="sort-arrow">↕</span></th>
                        <th onclick="sortTable('total_points')">Points <span class="sort-arrow">↕</span></th>
                        <th onclick="sortTable('goals_scored')">Goals <span class="sort-arrow">↕</span></th>
                        <th onclick="sortTable('assists')">Assists <span class="sort-arrow">↕</span></th>
                        <th onclick="sortTable('clean_sheets')">CS <span class="sort-arrow">↕</span></th>
                        <th onclick="sortTable('saves')">Saves <span class="sort-arrow">↕</span></th>
                        <th onclick="sortTable('bonus')">Bonus <span class="sort-arrow">↕</span></th>
                        <th onclick="sortTable('bps')">BPS <span class="sort-arrow">↕</span></th>
                        <th onclick="sortTable('influence')">ICT Index <span class="sort-arrow">↕</span></th>
                        <th onclick="sortTable('form')">Form <span class="sort-arrow">↕</span></th>
                        <th onclick="sortTable('selected_by_percent')">TSB% <span class="sort-arrow">↕</span></th>
                        <th onclick="sortTable('minutes')">Mins <span class="sort-arrow">↕</span></th>
                        <th onclick="sortTable('yellow_cards')">YC <span class="sort-arrow">↕</span></th>
                        <th onclick="sortTable('red_cards')">RC <span class="sort-arrow">↕</span></th>
                        <th onclick="sortTable('points_per_game')">PPG <span class="sort-arrow">↕</span></th>
                        <th onclick="sortTable('value')">Value <span class="sort-arrow">↕</span></th>
                    </tr>
                </thead>
                <tbody id="playerTableBody">
                </tbody>
            </table>
        </div>
        
        <div class="pagination" id="pagination" style="display: none;">
            <button onclick="previousPage()">Previous</button>
            <span id="pageInfo">Page 1 of 1</span>
            <button onclick="nextPage()">Next</button>
        </div>
    </div>
    
    <div class="footer" include="./footer.html"></div>
    
    <script src="index.js"></script>
    <script>
        let allPlayers = [];
        let filteredPlayers = [];
        let teams = {};
        let currentPage = 1;
        const playersPerPage = 50;
        let currentSort = { column: 'total_points', ascending: false };
        
        async function loadPlayerData() {
            try {
                const response = await fetch('https://fantasy.premierleague.com/api/bootstrap-static/');
                const data = await response.json();
                
                // Store teams data
                data.teams.forEach(team => {
                    teams[team.id] = {
                        name: team.name,
                        short_name: team.short_name
                    };
                });
                
                // Populate team filter
                const teamFilter = document.getElementById('teamFilter');
                teamFilter.innerHTML = '<option value="all">All Teams</option>';
                Object.values(teams).forEach(team => {
                    const option = document.createElement('option');
                    option.value = team.name;
                    option.textContent = team.name;
                    teamFilter.appendChild(option);
                });
                
                // Process player data
                allPlayers = data.elements.map(player => ({
                    id: player.id,
                    name: `${player.first_name} ${player.second_name}`,
                    team: teams[player.team].name,
                    team_short: teams[player.team].short_name,
                    position: getPositionName(player.element_type),
                    price: player.now_cost / 10,
                    total_points: player.total_points,
                    goals_scored: player.goals_scored,
                    assists: player.assists,
                    clean_sheets: player.clean_sheets,
                    saves: player.saves || 0,
                    bonus: player.bonus,
                    bps: player.bps,
                    influence: parseFloat(player.influence),
                    creativity: parseFloat(player.creativity),
                    threat: parseFloat(player.threat),
                    ict_index: parseFloat(player.ict_index),
                    form: parseFloat(player.form),
                    selected_by_percent: parseFloat(player.selected_by_percent),
                    minutes: player.minutes,
                    yellow_cards: player.yellow_cards,
                    red_cards: player.red_cards,
                    points_per_game: player.minutes > 0 ? (player.total_points / (player.minutes / 90)).toFixed(1) : '0.0',
                    value: player.total_points > 0 ? (player.total_points / (player.now_cost / 10)).toFixed(1) : '0.0',
                    transfers_in_event: player.transfers_in_event,
                    transfers_out_event: player.transfers_out_event,
                    news: player.news,
                    chance_of_playing: player.chance_of_playing_next_round
                }));
                
                filteredPlayers = [...allPlayers];
                updateStats();
                sortTable('total_points', false);
                renderTable();
                
                document.getElementById('loadingIndicator').style.display = 'none';
                document.getElementById('playerTable').style.display = 'table';
                document.getElementById('pagination').style.display = 'flex';
                
            } catch (error) {
                console.error('Error loading player data:', error);
                document.getElementById('loadingIndicator').innerHTML = `
                    <div class="error">
                        Error loading player data. Please try again later.
                    </div>
                `;
            }
        }
        
        function getPositionName(type) {
            switch(type) {
                case 1: return 'GKP';
                case 2: return 'DEF';
                case 3: return 'MID';
                case 4: return 'FWD';
                default: return 'Unknown';
            }
        }
        
        function applyFilters() {
            const position = document.getElementById('positionFilter').value;
            const team = document.getElementById('teamFilter').value;
            const maxPrice = parseFloat(document.getElementById('maxPrice').value) || 999;
            const minMinutes = parseInt(document.getElementById('minMinutes').value) || 0;
            const searchTerm = document.getElementById('playerSearch').value.toLowerCase();
            
            filteredPlayers = allPlayers.filter(player => {
                if (position !== 'all' && player.position !== position) return false;
                if (team !== 'all' && player.team !== team) return false;
                if (player.price > maxPrice) return false;
                if (player.minutes < minMinutes) return false;
                if (searchTerm && !player.name.toLowerCase().includes(searchTerm)) return false;
                return true;
            });
            
            currentPage = 1;
            updateStats();
            renderTable();
        }
        
        function resetFilters() {
            document.getElementById('positionFilter').value = 'all';
            document.getElementById('teamFilter').value = 'all';
            document.getElementById('maxPrice').value = '';
            document.getElementById('minMinutes').value = '';
            document.getElementById('playerSearch').value = '';
            
            filteredPlayers = [...allPlayers];
            currentPage = 1;
            updateStats();
            renderTable();
        }
        
        function updateStats() {
            document.getElementById('totalPlayers').textContent = filteredPlayers.length;
            
            if (filteredPlayers.length > 0) {
                const avgPoints = (filteredPlayers.reduce((sum, p) => sum + p.total_points, 0) / filteredPlayers.length).toFixed(1);
                const avgPrice = (filteredPlayers.reduce((sum, p) => sum + p.price, 0) / filteredPlayers.length).toFixed(1);
                const topScorer = filteredPlayers.reduce((max, p) => p.total_points > max.total_points ? p : max);
                
                document.getElementById('avgPoints').textContent = avgPoints;
                document.getElementById('avgPrice').textContent = `£${avgPrice}`;
                document.getElementById('topScorer').textContent = `${topScorer.name} (${topScorer.total_points})`;
            }
        }
        
        function sortTable(column, ascending = null) {
            if (ascending === null) {
                ascending = currentSort.column === column ? !currentSort.ascending : false;
            }
            
            currentSort = { column, ascending };
            
            filteredPlayers.sort((a, b) => {
                let aVal = a[column];
                let bVal = b[column];
                
                if (typeof aVal === 'string') {
                    aVal = aVal.toLowerCase();
                    bVal = bVal.toLowerCase();
                }
                
                if (ascending) {
                    return aVal > bVal ? 1 : -1;
                } else {
                    return aVal < bVal ? 1 : -1;
                }
            });
            
            renderTable();
        }
        
        function renderTable() {
            const tbody = document.getElementById('playerTableBody');
            tbody.innerHTML = '';
            
            const start = (currentPage - 1) * playersPerPage;
            const end = start + playersPerPage;
            const pageData = filteredPlayers.slice(start, end);
            
            pageData.forEach(player => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td class="player-name">${player.name}</td>
                    <td>${player.team_short}</td>
                    <td><span class="position-badge position-${player.position}">${player.position}</span></td>
                    <td class="price">£${player.price.toFixed(1)}</td>
                    <td><strong>${player.total_points}</strong></td>
                    <td>${player.goals_scored}</td>
                    <td>${player.assists}</td>
                    <td>${player.clean_sheets}</td>
                    <td>${player.saves}</td>
                    <td>${player.bonus}</td>
                    <td>${player.bps}</td>
                    <td>${player.ict_index.toFixed(1)}</td>
                    <td class="${player.form > 5 ? 'positive' : player.form < 3 ? 'negative' : ''}">${player.form.toFixed(1)}</td>
                    <td>${player.selected_by_percent}%</td>
                    <td>${player.minutes}</td>
                    <td>${player.yellow_cards}</td>
                    <td>${player.red_cards}</td>
                    <td><strong>${player.points_per_game}</strong></td>
                    <td class="${player.value > 10 ? 'positive' : ''}">${player.value}</td>
                `;
            });
            
            updatePagination();
        }
        
        function updatePagination() {
            const totalPages = Math.ceil(filteredPlayers.length / playersPerPage);
            document.getElementById('pageInfo').textContent = `Page ${currentPage} of ${totalPages}`;
        }
        
        function nextPage() {
            const totalPages = Math.ceil(filteredPlayers.length / playersPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                renderTable();
            }
        }
        
        function previousPage() {
            if (currentPage > 1) {
                currentPage--;
                renderTable();
            }
        }
        
        // Load data on page load
        document.addEventListener('DOMContentLoaded', loadPlayerData);
    </script>
</body>
</html>